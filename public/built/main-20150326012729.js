!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){function i(t){var e=t.length,i=oe.type(t);return"function"===i||oe.isWindow(t)?!1:1===t.nodeType&&e?!0:"array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t}function n(t,e,i){if(oe.isFunction(e))return oe.grep(t,function(t,n){return!!e.call(t,n,t)!==i});if(e.nodeType)return oe.grep(t,function(t){return t===e!==i});if("string"==typeof e){if(fe.test(e))return oe.filter(e,t,i);e=oe.filter(e,t)}return oe.grep(t,function(t){return oe.inArray(t,e)>=0!==i})}function r(t,e){do t=t[e];while(t&&1!==t.nodeType);return t}function o(t){var e=we[t]={};return oe.each(t.match(xe)||[],function(t,i){e[i]=!0}),e}function s(){ge.addEventListener?(ge.removeEventListener("DOMContentLoaded",a,!1),t.removeEventListener("load",a,!1)):(ge.detachEvent("onreadystatechange",a),t.detachEvent("onload",a))}function a(){(ge.addEventListener||"load"===event.type||"complete"===ge.readyState)&&(s(),oe.ready())}function c(t,e,i){if(void 0===i&&1===t.nodeType){var n="data-"+e.replace(_e,"-$1").toLowerCase();if(i=t.getAttribute(n),"string"==typeof i){try{i="true"===i?!0:"false"===i?!1:"null"===i?null:+i+""===i?+i:ke.test(i)?oe.parseJSON(i):i}catch(r){}oe.data(t,e,i)}else i=void 0}return i}function l(t){var e;for(e in t)if(("data"!==e||!oe.isEmptyObject(t[e]))&&"toJSON"!==e)return!1;return!0}function h(t,e,i,n){if(oe.acceptData(t)){var r,o,s=oe.expando,a=t.nodeType,c=a?oe.cache:t,l=a?t[s]:t[s]&&s;if(l&&c[l]&&(n||c[l].data)||void 0!==i||"string"!=typeof e)return l||(l=a?t[s]=G.pop()||oe.guid++:s),c[l]||(c[l]=a?{}:{toJSON:oe.noop}),("object"==typeof e||"function"==typeof e)&&(n?c[l]=oe.extend(c[l],e):c[l].data=oe.extend(c[l].data,e)),o=c[l],n||(o.data||(o.data={}),o=o.data),void 0!==i&&(o[oe.camelCase(e)]=i),"string"==typeof e?(r=o[e],null==r&&(r=o[oe.camelCase(e)])):r=o,r}}function u(t,e,i){if(oe.acceptData(t)){var n,r,o=t.nodeType,s=o?oe.cache:t,a=o?t[oe.expando]:oe.expando;if(s[a]){if(e&&(n=i?s[a]:s[a].data)){oe.isArray(e)?e=e.concat(oe.map(e,oe.camelCase)):e in n?e=[e]:(e=oe.camelCase(e),e=e in n?[e]:e.split(" ")),r=e.length;for(;r--;)delete n[e[r]];if(i?!l(n):!oe.isEmptyObject(n))return}(i||(delete s[a].data,l(s[a])))&&(o?oe.cleanData([t],!0):ne.deleteExpando||s!=s.window?delete s[a]:s[a]=null)}}}function d(){return!0}function f(){return!1}function p(){try{return ge.activeElement}catch(t){}}function g(t){var e=Re.split("|"),i=t.createDocumentFragment();if(i.createElement)for(;e.length;)i.createElement(e.pop());return i}function m(t,e){var i,n,r=0,o=typeof t.getElementsByTagName!==Ae?t.getElementsByTagName(e||"*"):typeof t.querySelectorAll!==Ae?t.querySelectorAll(e||"*"):void 0;if(!o)for(o=[],i=t.childNodes||t;null!=(n=i[r]);r++)!e||oe.nodeName(n,e)?o.push(n):oe.merge(o,m(n,e));return void 0===e||e&&oe.nodeName(t,e)?oe.merge([t],o):o}function v(t){De.test(t.type)&&(t.defaultChecked=t.checked)}function b(t,e){return oe.nodeName(t,"table")&&oe.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function y(t){return t.type=(null!==oe.find.attr(t,"type"))+"/"+t.type,t}function x(t){var e=Ge.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function w(t,e){for(var i,n=0;null!=(i=t[n]);n++)oe._data(i,"globalEval",!e||oe._data(e[n],"globalEval"))}function C(t,e){if(1===e.nodeType&&oe.hasData(t)){var i,n,r,o=oe._data(t),s=oe._data(e,o),a=o.events;if(a){delete s.handle,s.events={};for(i in a)for(n=0,r=a[i].length;r>n;n++)oe.event.add(e,i,a[i][n])}s.data&&(s.data=oe.extend({},s.data))}}function S(t,e){var i,n,r;if(1===e.nodeType){if(i=e.nodeName.toLowerCase(),!ne.noCloneEvent&&e[oe.expando]){r=oe._data(e);for(n in r.events)oe.removeEvent(e,n,r.handle);e.removeAttribute(oe.expando)}"script"===i&&e.text!==t.text?(y(e).text=t.text,x(e)):"object"===i?(e.parentNode&&(e.outerHTML=t.outerHTML),ne.html5Clone&&t.innerHTML&&!oe.trim(e.innerHTML)&&(e.innerHTML=t.innerHTML)):"input"===i&&De.test(t.type)?(e.defaultChecked=e.checked=t.checked,e.value!==t.value&&(e.value=t.value)):"option"===i?e.defaultSelected=e.selected=t.defaultSelected:("input"===i||"textarea"===i)&&(e.defaultValue=t.defaultValue)}}function A(e,i){var n=oe(i.createElement(e)).appendTo(i.body),r=t.getDefaultComputedStyle?t.getDefaultComputedStyle(n[0]).display:oe.css(n[0],"display");return n.detach(),r}function k(t){var e=ge,i=ti[t];return i||(i=A(t,e),"none"!==i&&i||(Ze=(Ze||oe("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement),e=(Ze[0].contentWindow||Ze[0].contentDocument).document,e.write(),e.close(),i=A(t,e),Ze.detach()),ti[t]=i),i}function _(t,e){return{get:function(){var i=t();return null!=i?i?void delete this.get:(this.get=e).apply(this,arguments):void 0}}}function T(t,e){if(e in t)return e;for(var i=e.charAt(0).toUpperCase()+e.slice(1),n=e,r=fi.length;r--;)if(e=fi[r]+i,e in t)return e;return n}function O(t,e){for(var i,n,r,o=[],s=0,a=t.length;a>s;s++)n=t[s],n.style&&(o[s]=oe._data(n,"olddisplay"),i=n.style.display,e?(o[s]||"none"!==i||(n.style.display=""),""===n.style.display&&je(n)&&(o[s]=oe._data(n,"olddisplay",k(n.nodeName)))):o[s]||(r=je(n),(i&&"none"!==i||!r)&&oe._data(n,"olddisplay",r?i:oe.css(n,"display"))));for(s=0;a>s;s++)n=t[s],n.style&&(e&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=e?o[s]||"":"none"));return t}function j(t,e,i){var n=li.exec(e);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):e}function E(t,e,i,n,r){for(var o=i===(n?"border":"content")?4:"width"===e?1:0,s=0;4>o;o+=2)"margin"===i&&(s+=oe.css(t,i+Oe[o],!0,r)),n?("content"===i&&(s-=oe.css(t,"padding"+Oe[o],!0,r)),"margin"!==i&&(s-=oe.css(t,"border"+Oe[o]+"Width",!0,r))):(s+=oe.css(t,"padding"+Oe[o],!0,r),"padding"!==i&&(s+=oe.css(t,"border"+Oe[o]+"Width",!0,r)));return s}function D(t,e,i){var n=!0,r="width"===e?t.offsetWidth:t.offsetHeight,o=ei(t),s=ne.boxSizing()&&"border-box"===oe.css(t,"boxSizing",!1,o);if(0>=r||null==r){if(r=ii(t,e,o),(0>r||null==r)&&(r=t.style[e]),ri.test(r))return r;n=s&&(ne.boxSizingReliable()||r===t.style[e]),r=parseFloat(r)||0}return r+E(t,e,i||(s?"border":"content"),n,o)+"px"}function I(t,e,i,n,r){return new I.prototype.init(t,e,i,n,r)}function L(){return setTimeout(function(){pi=void 0}),pi=oe.now()}function P(t,e){var i,n={height:t},r=0;for(e=e?1:0;4>r;r+=2-e)i=Oe[r],n["margin"+i]=n["padding"+i]=t;return e&&(n.opacity=n.width=t),n}function M(t,e,i){for(var n,r=(xi[e]||[]).concat(xi["*"]),o=0,s=r.length;s>o;o++)if(n=r[o].call(i,e,t))return n}function B(t,e,i){var n,r,o,s,a,c,l,h,u=this,d={},f=t.style,p=t.nodeType&&je(t),g=oe._data(t,"fxshow");i.queue||(a=oe._queueHooks(t,"fx"),null==a.unqueued&&(a.unqueued=0,c=a.empty.fire,a.empty.fire=function(){a.unqueued||c()}),a.unqueued++,u.always(function(){u.always(function(){a.unqueued--,oe.queue(t,"fx").length||a.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(i.overflow=[f.overflow,f.overflowX,f.overflowY],l=oe.css(t,"display"),h=k(t.nodeName),"none"===l&&(l=h),"inline"===l&&"none"===oe.css(t,"float")&&(ne.inlineBlockNeedsLayout&&"inline"!==h?f.zoom=1:f.display="inline-block")),i.overflow&&(f.overflow="hidden",ne.shrinkWrapBlocks()||u.always(function(){f.overflow=i.overflow[0],f.overflowX=i.overflow[1],f.overflowY=i.overflow[2]}));for(n in e)if(r=e[n],mi.exec(r)){if(delete e[n],o=o||"toggle"===r,r===(p?"hide":"show")){if("show"!==r||!g||void 0===g[n])continue;p=!0}d[n]=g&&g[n]||oe.style(t,n)}if(!oe.isEmptyObject(d)){g?"hidden"in g&&(p=g.hidden):g=oe._data(t,"fxshow",{}),o&&(g.hidden=!p),p?oe(t).show():u.done(function(){oe(t).hide()}),u.done(function(){var e;oe._removeData(t,"fxshow");for(e in d)oe.style(t,e,d[e])});for(n in d)s=M(p?g[n]:0,n,u),n in g||(g[n]=s.start,p&&(s.end=s.start,s.start="width"===n||"height"===n?1:0))}}function R(t,e){var i,n,r,o,s;for(i in t)if(n=oe.camelCase(i),r=e[n],o=t[i],oe.isArray(o)&&(r=o[1],o=t[i]=o[0]),i!==n&&(t[n]=o,delete t[i]),s=oe.cssHooks[n],s&&"expand"in s){o=s.expand(o),delete t[n];for(i in o)i in t||(t[i]=o[i],e[i]=r)}else e[n]=r}function F(t,e,i){var n,r,o=0,s=yi.length,a=oe.Deferred().always(function(){delete c.elem}),c=function(){if(r)return!1;for(var e=pi||L(),i=Math.max(0,l.startTime+l.duration-e),n=i/l.duration||0,o=1-n,s=0,c=l.tweens.length;c>s;s++)l.tweens[s].run(o);return a.notifyWith(t,[l,o,i]),1>o&&c?i:(a.resolveWith(t,[l]),!1)},l=a.promise({elem:t,props:oe.extend({},e),opts:oe.extend(!0,{specialEasing:{}},i),originalProperties:e,originalOptions:i,startTime:pi||L(),duration:i.duration,tweens:[],createTween:function(e,i){var n=oe.Tween(t,l.opts,e,i,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var i=0,n=e?l.tweens.length:0;if(r)return this;for(r=!0;n>i;i++)l.tweens[i].run(1);return e?a.resolveWith(t,[l,e]):a.rejectWith(t,[l,e]),this}}),h=l.props;for(R(h,l.opts.specialEasing);s>o;o++)if(n=yi[o].call(l,t,h,l.opts))return n;return oe.map(h,M,l),oe.isFunction(l.opts.start)&&l.opts.start.call(t,l),oe.fx.timer(oe.extend(c,{elem:t,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function $(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,r=0,o=e.toLowerCase().match(xe)||[];if(oe.isFunction(i))for(;n=o[r++];)"+"===n.charAt(0)?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function N(t,e,i,n){function r(a){var c;return o[a]=!0,oe.each(t[a]||[],function(t,a){var l=a(e,i,n);return"string"!=typeof l||s||o[l]?s?!(c=l):void 0:(e.dataTypes.unshift(l),r(l),!1)}),c}var o={},s=t===Hi;return r(e.dataTypes[0])||!o["*"]&&r("*")}function z(t,e){var i,n,r=oe.ajaxSettings.flatOptions||{};for(n in e)void 0!==e[n]&&((r[n]?t:i||(i={}))[n]=e[n]);return i&&oe.extend(!0,t,i),t}function W(t,e,i){for(var n,r,o,s,a=t.contents,c=t.dataTypes;"*"===c[0];)c.shift(),void 0===r&&(r=t.mimeType||e.getResponseHeader("Content-Type"));if(r)for(s in a)if(a[s]&&a[s].test(r)){c.unshift(s);break}if(c[0]in i)o=c[0];else{for(s in i){if(!c[0]||t.converters[s+" "+c[0]]){o=s;break}n||(n=s)}o=o||n}return o?(o!==c[0]&&c.unshift(o),i[o]):void 0}function q(t,e,i,n){var r,o,s,a,c,l={},h=t.dataTypes.slice();if(h[1])for(s in t.converters)l[s.toLowerCase()]=t.converters[s];for(o=h.shift();o;)if(t.responseFields[o]&&(i[t.responseFields[o]]=e),!c&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),c=o,o=h.shift())if("*"===o)o=c;else if("*"!==c&&c!==o){if(s=l[c+" "+o]||l["* "+o],!s)for(r in l)if(a=r.split(" "),a[1]===o&&(s=l[c+" "+a[0]]||l["* "+a[0]])){s===!0?s=l[r]:l[r]!==!0&&(o=a[0],h.unshift(a[1]));break}if(s!==!0)if(s&&t["throws"])e=s(e);else try{e=s(e)}catch(u){return{state:"parsererror",error:s?u:"No conversion from "+c+" to "+o}}}return{state:"success",data:e}}function H(t,e,i,n){var r;if(oe.isArray(e))oe.each(e,function(e,r){i||Gi.test(t)?n(t,r):H(t+"["+("object"==typeof r?e:"")+"]",r,i,n)});else if(i||"object"!==oe.type(e))n(t,e);else for(r in e)H(t+"["+r+"]",e[r],i,n)}function X(){try{return new t.XMLHttpRequest}catch(e){}}function Y(){try{return new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function U(t){return oe.isWindow(t)?t:9===t.nodeType?t.defaultView||t.parentWindow:!1}var G=[],V=G.slice,Q=G.concat,J=G.push,K=G.indexOf,Z={},te=Z.toString,ee=Z.hasOwnProperty,ie="".trim,ne={},re="1.11.0",oe=function(t,e){return new oe.fn.init(t,e)},se=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ae=/^-ms-/,ce=/-([\da-z])/gi,le=function(t,e){return e.toUpperCase()};oe.fn=oe.prototype={jquery:re,constructor:oe,selector:"",length:0,toArray:function(){return V.call(this)},get:function(t){return null!=t?0>t?this[t+this.length]:this[t]:V.call(this)},pushStack:function(t){var e=oe.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t,e){return oe.each(this,t,e)},map:function(t){return this.pushStack(oe.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack(V.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(0>t?e:0);return this.pushStack(i>=0&&e>i?[this[i]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:J,sort:G.sort,splice:G.splice},oe.extend=oe.fn.extend=function(){var t,e,i,n,r,o,s=arguments[0]||{},a=1,c=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[a]||{},a++),"object"==typeof s||oe.isFunction(s)||(s={}),a===c&&(s=this,a--);c>a;a++)if(null!=(r=arguments[a]))for(n in r)t=s[n],i=r[n],s!==i&&(l&&i&&(oe.isPlainObject(i)||(e=oe.isArray(i)))?(e?(e=!1,o=t&&oe.isArray(t)?t:[]):o=t&&oe.isPlainObject(t)?t:{},s[n]=oe.extend(l,o,i)):void 0!==i&&(s[n]=i));return s},oe.extend({expando:"jQuery"+(re+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===oe.type(t)},isArray:Array.isArray||function(t){return"array"===oe.type(t)},isWindow:function(t){return null!=t&&t==t.window},isNumeric:function(t){return t-parseFloat(t)>=0},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},isPlainObject:function(t){var e;if(!t||"object"!==oe.type(t)||t.nodeType||oe.isWindow(t))return!1;try{if(t.constructor&&!ee.call(t,"constructor")&&!ee.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}if(ne.ownLast)for(e in t)return ee.call(t,e);for(e in t);return void 0===e||ee.call(t,e)},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?Z[te.call(t)]||"object":typeof t},globalEval:function(e){e&&oe.trim(e)&&(t.execScript||function(e){t.eval.call(t,e)})(e)},camelCase:function(t){return t.replace(ae,"ms-").replace(ce,le)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e,n){var r,o=0,s=t.length,a=i(t);if(n){if(a)for(;s>o&&(r=e.apply(t[o],n),r!==!1);o++);else for(o in t)if(r=e.apply(t[o],n),r===!1)break}else if(a)for(;s>o&&(r=e.call(t[o],o,t[o]),r!==!1);o++);else for(o in t)if(r=e.call(t[o],o,t[o]),r===!1)break;return t},trim:ie&&!ie.call("﻿ ")?function(t){return null==t?"":ie.call(t)}:function(t){return null==t?"":(t+"").replace(se,"")},makeArray:function(t,e){var n=e||[];return null!=t&&(i(Object(t))?oe.merge(n,"string"==typeof t?[t]:t):J.call(n,t)),n},inArray:function(t,e,i){var n;if(e){if(K)return K.call(e,t,i);for(n=e.length,i=i?0>i?Math.max(0,n+i):i:0;n>i;i++)if(i in e&&e[i]===t)return i}return-1},merge:function(t,e){for(var i=+e.length,n=0,r=t.length;i>n;)t[r++]=e[n++];if(i!==i)for(;void 0!==e[n];)t[r++]=e[n++];return t.length=r,t},grep:function(t,e,i){for(var n,r=[],o=0,s=t.length,a=!i;s>o;o++)n=!e(t[o],o),n!==a&&r.push(t[o]);return r},map:function(t,e,n){var r,o=0,s=t.length,a=i(t),c=[];if(a)for(;s>o;o++)r=e(t[o],o,n),null!=r&&c.push(r);else for(o in t)r=e(t[o],o,n),null!=r&&c.push(r);return Q.apply([],c)},guid:1,proxy:function(t,e){var i,n,r;return"string"==typeof e&&(r=t[e],e=t,t=r),oe.isFunction(t)?(i=V.call(arguments,2),n=function(){return t.apply(e||this,i.concat(V.call(arguments)))},n.guid=t.guid=t.guid||oe.guid++,n):void 0},now:function(){return+new Date},support:ne}),oe.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){Z["[object "+e+"]"]=e.toLowerCase()});var he=function(t){function e(t,e,i,n){var r,o,s,a,c,l,u,p,g,m;if((e?e.ownerDocument||e:N)!==I&&D(e),e=e||I,i=i||[],!t||"string"!=typeof t)return i;if(1!==(a=e.nodeType)&&9!==a)return[];if(P&&!n){if(r=be.exec(t))if(s=r[1]){if(9===a){if(o=e.getElementById(s),!o||!o.parentNode)return i;if(o.id===s)return i.push(o),i}else if(e.ownerDocument&&(o=e.ownerDocument.getElementById(s))&&F(e,o)&&o.id===s)return i.push(o),i}else{if(r[2])return Z.apply(i,e.getElementsByTagName(t)),i;if((s=r[3])&&S.getElementsByClassName&&e.getElementsByClassName)return Z.apply(i,e.getElementsByClassName(s)),i}if(S.qsa&&(!M||!M.test(t))){if(p=u=$,g=e,m=9===a&&t,1===a&&"object"!==e.nodeName.toLowerCase()){for(l=d(t),(u=e.getAttribute("id"))?p=u.replace(xe,"\\$&"):e.setAttribute("id",p),p="[id='"+p+"'] ",c=l.length;c--;)l[c]=p+f(l[c]);g=ye.test(t)&&h(e.parentNode)||e,m=l.join(",")}if(m)try{return Z.apply(i,g.querySelectorAll(m)),i}catch(v){}finally{u||e.removeAttribute("id")}}}return w(t.replace(ce,"$1"),e,i,n)}function i(){function t(i,n){return e.push(i+" ")>A.cacheLength&&delete t[e.shift()],t[i+" "]=n}var e=[];return t}function n(t){return t[$]=!0,t}function r(t){var e=I.createElement("div");try{return!!t(e)}catch(i){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function o(t,e){for(var i=t.split("|"),n=t.length;n--;)A.attrHandle[i[n]]=e}function s(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||G)-(~t.sourceIndex||G);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function a(t){return function(e){var i=e.nodeName.toLowerCase();return"input"===i&&e.type===t}}function c(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function l(t){return n(function(e){return e=+e,n(function(i,n){for(var r,o=t([],i.length,e),s=o.length;s--;)i[r=o[s]]&&(i[r]=!(n[r]=i[r]))})})}function h(t){return t&&typeof t.getElementsByTagName!==U&&t}function u(){}function d(t,i){var n,r,o,s,a,c,l,h=H[t+" "];if(h)return i?0:h.slice(0);for(a=t,c=[],l=A.preFilter;a;){(!n||(r=le.exec(a)))&&(r&&(a=a.slice(r[0].length)||a),c.push(o=[])),n=!1,(r=he.exec(a))&&(n=r.shift(),o.push({value:n,type:r[0].replace(ce," ")}),a=a.slice(n.length));for(s in A.filter)!(r=pe[s].exec(a))||l[s]&&!(r=l[s](r))||(n=r.shift(),o.push({value:n,type:s,matches:r}),a=a.slice(n.length));if(!n)break}return i?a.length:a?e.error(t):H(t,c).slice(0)}function f(t){for(var e=0,i=t.length,n="";i>e;e++)n+=t[e].value;return n}function p(t,e,i){var n=e.dir,r=i&&"parentNode"===n,o=W++;return e.first?function(e,i,o){for(;e=e[n];)if(1===e.nodeType||r)return t(e,i,o)}:function(e,i,s){var a,c,l=[z,o];if(s){for(;e=e[n];)if((1===e.nodeType||r)&&t(e,i,s))return!0}else for(;e=e[n];)if(1===e.nodeType||r){if(c=e[$]||(e[$]={}),(a=c[n])&&a[0]===z&&a[1]===o)return l[2]=a[2];if(c[n]=l,l[2]=t(e,i,s))return!0}}}function g(t){return t.length>1?function(e,i,n){for(var r=t.length;r--;)if(!t[r](e,i,n))return!1;return!0}:t[0]}function m(t,e,i,n,r){for(var o,s=[],a=0,c=t.length,l=null!=e;c>a;a++)(o=t[a])&&(!i||i(o,n,r))&&(s.push(o),l&&e.push(a));return s}function v(t,e,i,r,o,s){return r&&!r[$]&&(r=v(r)),o&&!o[$]&&(o=v(o,s)),n(function(n,s,a,c){var l,h,u,d=[],f=[],p=s.length,g=n||x(e||"*",a.nodeType?[a]:a,[]),v=!t||!n&&e?g:m(g,d,t,a,c),b=i?o||(n?t:p||r)?[]:s:v;if(i&&i(v,b,a,c),r)for(l=m(b,f),r(l,[],a,c),h=l.length;h--;)(u=l[h])&&(b[f[h]]=!(v[f[h]]=u));if(n){if(o||t){if(o){for(l=[],h=b.length;h--;)(u=b[h])&&l.push(v[h]=u);o(null,b=[],l,c)}for(h=b.length;h--;)(u=b[h])&&(l=o?ee.call(n,u):d[h])>-1&&(n[l]=!(s[l]=u))}}else b=m(b===s?b.splice(p,b.length):b),o?o(null,s,b,c):Z.apply(s,b)})}function b(t){for(var e,i,n,r=t.length,o=A.relative[t[0].type],s=o||A.relative[" "],a=o?1:0,c=p(function(t){return t===e},s,!0),l=p(function(t){return ee.call(e,t)>-1},s,!0),h=[function(t,i,n){return!o&&(n||i!==O)||((e=i).nodeType?c(t,i,n):l(t,i,n))}];r>a;a++)if(i=A.relative[t[a].type])h=[p(g(h),i)];else{if(i=A.filter[t[a].type].apply(null,t[a].matches),i[$]){for(n=++a;r>n&&!A.relative[t[n].type];n++);return v(a>1&&g(h),a>1&&f(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(ce,"$1"),i,n>a&&b(t.slice(a,n)),r>n&&b(t=t.slice(n)),r>n&&f(t))}h.push(i)}return g(h)}function y(t,i){var r=i.length>0,o=t.length>0,s=function(n,s,a,c,l){var h,u,d,f=0,p="0",g=n&&[],v=[],b=O,y=n||o&&A.find.TAG("*",l),x=z+=null==b?1:Math.random()||.1,w=y.length;for(l&&(O=s!==I&&s);p!==w&&null!=(h=y[p]);p++){if(o&&h){for(u=0;d=t[u++];)if(d(h,s,a)){c.push(h);break}l&&(z=x)}r&&((h=!d&&h)&&f--,n&&g.push(h))}if(f+=p,r&&p!==f){for(u=0;d=i[u++];)d(g,v,s,a);if(n){if(f>0)for(;p--;)g[p]||v[p]||(v[p]=J.call(c));v=m(v)}Z.apply(c,v),l&&!n&&v.length>0&&f+i.length>1&&e.uniqueSort(c)}return l&&(z=x,O=b),g};return r?n(s):s}function x(t,i,n){for(var r=0,o=i.length;o>r;r++)e(t,i[r],n);return n}function w(t,e,i,n){var r,o,s,a,c,l=d(t);if(!n&&1===l.length){if(o=l[0]=l[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&S.getById&&9===e.nodeType&&P&&A.relative[o[1].type]){if(e=(A.find.ID(s.matches[0].replace(we,Ce),e)||[])[0],!e)return i;t=t.slice(o.shift().value.length)}for(r=pe.needsContext.test(t)?0:o.length;r--&&(s=o[r],!A.relative[a=s.type]);)if((c=A.find[a])&&(n=c(s.matches[0].replace(we,Ce),ye.test(o[0].type)&&h(e.parentNode)||e))){if(o.splice(r,1),t=n.length&&f(o),!t)return Z.apply(i,n),i;break}}return T(t,l)(n,e,!P,i,ye.test(t)&&h(e.parentNode)||e),i}var C,S,A,k,_,T,O,j,E,D,I,L,P,M,B,R,F,$="sizzle"+-new Date,N=t.document,z=0,W=0,q=i(),H=i(),X=i(),Y=function(t,e){return t===e&&(E=!0),0},U="undefined",G=1<<31,V={}.hasOwnProperty,Q=[],J=Q.pop,K=Q.push,Z=Q.push,te=Q.slice,ee=Q.indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(this[e]===t)return e;return-1},ie="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ne="[\\x20\\t\\r\\n\\f]",re="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",oe=re.replace("w","w#"),se="\\["+ne+"*("+re+")"+ne+"*(?:([*^$|!~]?=)"+ne+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+oe+")|)|)"+ne+"*\\]",ae=":("+re+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+se.replace(3,8)+")*)|.*)\\)|)",ce=new RegExp("^"+ne+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ne+"+$","g"),le=new RegExp("^"+ne+"*,"+ne+"*"),he=new RegExp("^"+ne+"*([>+~]|"+ne+")"+ne+"*"),ue=new RegExp("="+ne+"*([^\\]'\"]*?)"+ne+"*\\]","g"),de=new RegExp(ae),fe=new RegExp("^"+oe+"$"),pe={ID:new RegExp("^#("+re+")"),CLASS:new RegExp("^\\.("+re+")"),TAG:new RegExp("^("+re.replace("w","w*")+")"),ATTR:new RegExp("^"+se),PSEUDO:new RegExp("^"+ae),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ne+"*(even|odd|(([+-]|)(\\d*)n|)"+ne+"*(?:([+-]|)"+ne+"*(\\d+)|))"+ne+"*\\)|)","i"),bool:new RegExp("^(?:"+ie+")$","i"),needsContext:new RegExp("^"+ne+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ne+"*((?:-\\d)?\\d*)"+ne+"*\\)|)(?=[^-]|$)","i")},ge=/^(?:input|select|textarea|button)$/i,me=/^h\d$/i,ve=/^[^{]+\{\s*\[native \w/,be=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ye=/[+~]/,xe=/'|\\/g,we=new RegExp("\\\\([\\da-f]{1,6}"+ne+"?|("+ne+")|.)","ig"),Ce=function(t,e,i){var n="0x"+e-65536;return n!==n||i?e:0>n?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)};try{Z.apply(Q=te.call(N.childNodes),N.childNodes),Q[N.childNodes.length].nodeType}catch(Se){Z={apply:Q.length?function(t,e){K.apply(t,te.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}S=e.support={},_=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return e?"HTML"!==e.nodeName:!1},D=e.setDocument=function(t){var e,i=t?t.ownerDocument||t:N,n=i.defaultView;return i!==I&&9===i.nodeType&&i.documentElement?(I=i,L=i.documentElement,P=!_(i),n&&n!==n.top&&(n.addEventListener?n.addEventListener("unload",function(){D()},!1):n.attachEvent&&n.attachEvent("onunload",function(){D()})),S.attributes=r(function(t){return t.className="i",!t.getAttribute("className")}),S.getElementsByTagName=r(function(t){return t.appendChild(i.createComment("")),!t.getElementsByTagName("*").length}),S.getElementsByClassName=ve.test(i.getElementsByClassName)&&r(function(t){return t.innerHTML="<div class='a'></div><div class='a i'></div>",t.firstChild.className="i",2===t.getElementsByClassName("i").length}),S.getById=r(function(t){return L.appendChild(t).id=$,!i.getElementsByName||!i.getElementsByName($).length}),S.getById?(A.find.ID=function(t,e){if(typeof e.getElementById!==U&&P){var i=e.getElementById(t);return i&&i.parentNode?[i]:[]}},A.filter.ID=function(t){var e=t.replace(we,Ce);return function(t){return t.getAttribute("id")===e}}):(delete A.find.ID,A.filter.ID=function(t){var e=t.replace(we,Ce);return function(t){var i=typeof t.getAttributeNode!==U&&t.getAttributeNode("id");return i&&i.value===e}}),A.find.TAG=S.getElementsByTagName?function(t,e){return typeof e.getElementsByTagName!==U?e.getElementsByTagName(t):void 0}:function(t,e){var i,n=[],r=0,o=e.getElementsByTagName(t);if("*"===t){for(;i=o[r++];)1===i.nodeType&&n.push(i);return n}return o},A.find.CLASS=S.getElementsByClassName&&function(t,e){return typeof e.getElementsByClassName!==U&&P?e.getElementsByClassName(t):void 0},B=[],M=[],(S.qsa=ve.test(i.querySelectorAll))&&(r(function(t){t.innerHTML="<select t=''><option selected=''></option></select>",t.querySelectorAll("[t^='']").length&&M.push("[*^$]="+ne+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||M.push("\\["+ne+"*(?:value|"+ie+")"),t.querySelectorAll(":checked").length||M.push(":checked")}),r(function(t){var e=i.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&M.push("name"+ne+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||M.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),M.push(",.*:")})),(S.matchesSelector=ve.test(R=L.webkitMatchesSelector||L.mozMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&r(function(t){S.disconnectedMatch=R.call(t,"div"),R.call(t,"[s!='']:x"),B.push("!=",ae)}),M=M.length&&new RegExp(M.join("|")),B=B.length&&new RegExp(B.join("|")),e=ve.test(L.compareDocumentPosition),F=e||ve.test(L.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},Y=e?function(t,e){if(t===e)return E=!0,0;var n=!t.compareDocumentPosition-!e.compareDocumentPosition;return n?n:(n=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&n||!S.sortDetached&&e.compareDocumentPosition(t)===n?t===i||t.ownerDocument===N&&F(N,t)?-1:e===i||e.ownerDocument===N&&F(N,e)?1:j?ee.call(j,t)-ee.call(j,e):0:4&n?-1:1)}:function(t,e){if(t===e)return E=!0,0;var n,r=0,o=t.parentNode,a=e.parentNode,c=[t],l=[e];if(!o||!a)return t===i?-1:e===i?1:o?-1:a?1:j?ee.call(j,t)-ee.call(j,e):0;if(o===a)return s(t,e);for(n=t;n=n.parentNode;)c.unshift(n);for(n=e;n=n.parentNode;)l.unshift(n);for(;c[r]===l[r];)r++;return r?s(c[r],l[r]):c[r]===N?-1:l[r]===N?1:0},i):I},e.matches=function(t,i){return e(t,null,null,i)},e.matchesSelector=function(t,i){if((t.ownerDocument||t)!==I&&D(t),i=i.replace(ue,"='$1']"),!(!S.matchesSelector||!P||B&&B.test(i)||M&&M.test(i)))try{var n=R.call(t,i);if(n||S.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(r){}return e(i,I,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==I&&D(t),F(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==I&&D(t);var i=A.attrHandle[e.toLowerCase()],n=i&&V.call(A.attrHandle,e.toLowerCase())?i(t,e,!P):void 0;return void 0!==n?n:S.attributes||!P?t.getAttribute(e):(n=t.getAttributeNode(e))&&n.specified?n.value:null},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,i=[],n=0,r=0;if(E=!S.detectDuplicates,j=!S.sortStable&&t.slice(0),t.sort(Y),E){for(;e=t[r++];)e===t[r]&&(n=i.push(r));for(;n--;)t.splice(i[n],1)}return j=null,t},k=e.getText=function(t){var e,i="",n=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=k(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[n++];)i+=k(e);return i},A=e.selectors={cacheLength:50,createPseudo:n,match:pe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(we,Ce),t[3]=(t[4]||t[5]||"").replace(we,Ce),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,i=!t[5]&&t[2];return pe.CHILD.test(t[0])?null:(t[3]&&void 0!==t[4]?t[2]=t[4]:i&&de.test(i)&&(e=d(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(we,Ce).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=q[t+" "];return e||(e=new RegExp("(^|"+ne+")"+t+"("+ne+"|$)"))&&q(t,function(t){return e.test("string"==typeof t.className&&t.className||typeof t.getAttribute!==U&&t.getAttribute("class")||"")})},ATTR:function(t,i,n){return function(r){var o=e.attr(r,t);return null==o?"!="===i:i?(o+="","="===i?o===n:"!="===i?o!==n:"^="===i?n&&0===o.indexOf(n):"*="===i?n&&o.indexOf(n)>-1:"$="===i?n&&o.slice(-n.length)===n:"~="===i?(" "+o+" ").indexOf(n)>-1:"|="===i?o===n||o.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(t,e,i,n,r){var o="nth"!==t.slice(0,3),s="last"!==t.slice(-4),a="of-type"===e;return 1===n&&0===r?function(t){return!!t.parentNode}:function(e,i,c){var l,h,u,d,f,p,g=o!==s?"nextSibling":"previousSibling",m=e.parentNode,v=a&&e.nodeName.toLowerCase(),b=!c&&!a;if(m){if(o){for(;g;){for(u=e;u=u[g];)if(a?u.nodeName.toLowerCase()===v:1===u.nodeType)return!1;p=g="only"===t&&!p&&"nextSibling"}return!0}if(p=[s?m.firstChild:m.lastChild],s&&b){for(h=m[$]||(m[$]={}),l=h[t]||[],f=l[0]===z&&l[1],d=l[0]===z&&l[2],u=f&&m.childNodes[f];u=++f&&u&&u[g]||(d=f=0)||p.pop();)if(1===u.nodeType&&++d&&u===e){h[t]=[z,f,d];break}}else if(b&&(l=(e[$]||(e[$]={}))[t])&&l[0]===z)d=l[1];else for(;(u=++f&&u&&u[g]||(d=f=0)||p.pop())&&((a?u.nodeName.toLowerCase()!==v:1!==u.nodeType)||!++d||(b&&((u[$]||(u[$]={}))[t]=[z,d]),u!==e)););return d-=r,d===n||d%n===0&&d/n>=0}}},PSEUDO:function(t,i){var r,o=A.pseudos[t]||A.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return o[$]?o(i):o.length>1?(r=[t,t,"",i],A.setFilters.hasOwnProperty(t.toLowerCase())?n(function(t,e){for(var n,r=o(t,i),s=r.length;s--;)n=ee.call(t,r[s]),t[n]=!(e[n]=r[s])}):function(t){return o(t,0,r)}):o}},pseudos:{not:n(function(t){var e=[],i=[],r=T(t.replace(ce,"$1"));return r[$]?n(function(t,e,i,n){for(var o,s=r(t,null,n,[]),a=t.length;a--;)(o=s[a])&&(t[a]=!(e[a]=o))}):function(t,n,o){return e[0]=t,r(e,null,o,i),!i.pop()}}),has:n(function(t){return function(i){return e(t,i).length>0}}),contains:n(function(t){return function(e){return(e.textContent||e.innerText||k(e)).indexOf(t)>-1}}),lang:n(function(t){return fe.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(we,Ce).toLowerCase(),function(e){var i;do if(i=P?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return i=i.toLowerCase(),i===t||0===i.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===L},focus:function(t){return t===I.activeElement&&(!I.hasFocus||I.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return t.disabled===!1},disabled:function(t){return t.disabled===!0},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!A.pseudos.empty(t)},header:function(t){return me.test(t.nodeName)},input:function(t){return ge.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:l(function(){return[0]}),last:l(function(t,e){return[e-1]
}),eq:l(function(t,e,i){return[0>i?i+e:i]}),even:l(function(t,e){for(var i=0;e>i;i+=2)t.push(i);return t}),odd:l(function(t,e){for(var i=1;e>i;i+=2)t.push(i);return t}),lt:l(function(t,e,i){for(var n=0>i?i+e:i;--n>=0;)t.push(n);return t}),gt:l(function(t,e,i){for(var n=0>i?i+e:i;++n<e;)t.push(n);return t})}},A.pseudos.nth=A.pseudos.eq;for(C in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})A.pseudos[C]=a(C);for(C in{submit:!0,reset:!0})A.pseudos[C]=c(C);return u.prototype=A.filters=A.pseudos,A.setFilters=new u,T=e.compile=function(t,e){var i,n=[],r=[],o=X[t+" "];if(!o){for(e||(e=d(t)),i=e.length;i--;)o=b(e[i]),o[$]?n.push(o):r.push(o);o=X(t,y(r,n))}return o},S.sortStable=$.split("").sort(Y).join("")===$,S.detectDuplicates=!!E,D(),S.sortDetached=r(function(t){return 1&t.compareDocumentPosition(I.createElement("div"))}),r(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||o("type|href|height|width",function(t,e,i){return i?void 0:t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),S.attributes&&r(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||o("value",function(t,e,i){return i||"input"!==t.nodeName.toLowerCase()?void 0:t.defaultValue}),r(function(t){return null==t.getAttribute("disabled")})||o(ie,function(t,e,i){var n;return i?void 0:t[e]===!0?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null}),e}(t);oe.find=he,oe.expr=he.selectors,oe.expr[":"]=oe.expr.pseudos,oe.unique=he.uniqueSort,oe.text=he.getText,oe.isXMLDoc=he.isXML,oe.contains=he.contains;var ue=oe.expr.match.needsContext,de=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,fe=/^.[^:#\[\.,]*$/;oe.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?oe.find.matchesSelector(n,t)?[n]:[]:oe.find.matches(t,oe.grep(e,function(t){return 1===t.nodeType}))},oe.fn.extend({find:function(t){var e,i=[],n=this,r=n.length;if("string"!=typeof t)return this.pushStack(oe(t).filter(function(){for(e=0;r>e;e++)if(oe.contains(n[e],this))return!0}));for(e=0;r>e;e++)oe.find(t,n[e],i);return i=this.pushStack(r>1?oe.unique(i):i),i.selector=this.selector?this.selector+" "+t:t,i},filter:function(t){return this.pushStack(n(this,t||[],!1))},not:function(t){return this.pushStack(n(this,t||[],!0))},is:function(t){return!!n(this,"string"==typeof t&&ue.test(t)?oe(t):t||[],!1).length}});var pe,ge=t.document,me=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ve=oe.fn.init=function(t,e){var i,n;if(!t)return this;if("string"==typeof t){if(i="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&t.length>=3?[null,t,null]:me.exec(t),!i||!i[1]&&e)return!e||e.jquery?(e||pe).find(t):this.constructor(e).find(t);if(i[1]){if(e=e instanceof oe?e[0]:e,oe.merge(this,oe.parseHTML(i[1],e&&e.nodeType?e.ownerDocument||e:ge,!0)),de.test(i[1])&&oe.isPlainObject(e))for(i in e)oe.isFunction(this[i])?this[i](e[i]):this.attr(i,e[i]);return this}if(n=ge.getElementById(i[2]),n&&n.parentNode){if(n.id!==i[2])return pe.find(t);this.length=1,this[0]=n}return this.context=ge,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):oe.isFunction(t)?"undefined"!=typeof pe.ready?pe.ready(t):t(oe):(void 0!==t.selector&&(this.selector=t.selector,this.context=t.context),oe.makeArray(t,this))};ve.prototype=oe.fn,pe=oe(ge);var be=/^(?:parents|prev(?:Until|All))/,ye={children:!0,contents:!0,next:!0,prev:!0};oe.extend({dir:function(t,e,i){for(var n=[],r=t[e];r&&9!==r.nodeType&&(void 0===i||1!==r.nodeType||!oe(r).is(i));)1===r.nodeType&&n.push(r),r=r[e];return n},sibling:function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i}}),oe.fn.extend({has:function(t){var e,i=oe(t,this),n=i.length;return this.filter(function(){for(e=0;n>e;e++)if(oe.contains(this,i[e]))return!0})},closest:function(t,e){for(var i,n=0,r=this.length,o=[],s=ue.test(t)||"string"!=typeof t?oe(t,e||this.context):0;r>n;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&oe.find.matchesSelector(i,t))){o.push(i);break}return this.pushStack(o.length>1?oe.unique(o):o)},index:function(t){return t?"string"==typeof t?oe.inArray(this[0],oe(t)):oe.inArray(t.jquery?t[0]:t,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(oe.unique(oe.merge(this.get(),oe(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),oe.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return oe.dir(t,"parentNode")},parentsUntil:function(t,e,i){return oe.dir(t,"parentNode",i)},next:function(t){return r(t,"nextSibling")},prev:function(t){return r(t,"previousSibling")},nextAll:function(t){return oe.dir(t,"nextSibling")},prevAll:function(t){return oe.dir(t,"previousSibling")},nextUntil:function(t,e,i){return oe.dir(t,"nextSibling",i)},prevUntil:function(t,e,i){return oe.dir(t,"previousSibling",i)},siblings:function(t){return oe.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return oe.sibling(t.firstChild)},contents:function(t){return oe.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:oe.merge([],t.childNodes)}},function(t,e){oe.fn[t]=function(i,n){var r=oe.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=oe.filter(n,r)),this.length>1&&(ye[t]||(r=oe.unique(r)),be.test(t)&&(r=r.reverse())),this.pushStack(r)}});var xe=/\S+/g,we={};oe.Callbacks=function(t){t="string"==typeof t?we[t]||o(t):oe.extend({},t);var e,i,n,r,s,a,c=[],l=!t.once&&[],h=function(o){for(i=t.memory&&o,n=!0,s=a||0,a=0,r=c.length,e=!0;c&&r>s;s++)if(c[s].apply(o[0],o[1])===!1&&t.stopOnFalse){i=!1;break}e=!1,c&&(l?l.length&&h(l.shift()):i?c=[]:u.disable())},u={add:function(){if(c){var n=c.length;!function o(e){oe.each(e,function(e,i){var n=oe.type(i);"function"===n?t.unique&&u.has(i)||c.push(i):i&&i.length&&"string"!==n&&o(i)})}(arguments),e?r=c.length:i&&(a=n,h(i))}return this},remove:function(){return c&&oe.each(arguments,function(t,i){for(var n;(n=oe.inArray(i,c,n))>-1;)c.splice(n,1),e&&(r>=n&&r--,s>=n&&s--)}),this},has:function(t){return t?oe.inArray(t,c)>-1:!(!c||!c.length)},empty:function(){return c=[],r=0,this},disable:function(){return c=l=i=void 0,this},disabled:function(){return!c},lock:function(){return l=void 0,i||u.disable(),this},locked:function(){return!l},fireWith:function(t,i){return!c||n&&!l||(i=i||[],i=[t,i.slice?i.slice():i],e?l.push(i):h(i)),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!n}};return u},oe.extend({Deferred:function(t){var e=[["resolve","done",oe.Callbacks("once memory"),"resolved"],["reject","fail",oe.Callbacks("once memory"),"rejected"],["notify","progress",oe.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var t=arguments;return oe.Deferred(function(i){oe.each(e,function(e,o){var s=oe.isFunction(t[e])&&t[e];r[o[1]](function(){var t=s&&s.apply(this,arguments);t&&oe.isFunction(t.promise)?t.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[o[0]+"With"](this===n?i.promise():this,s?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?oe.extend(t,n):n}},r={};return n.pipe=n.then,oe.each(e,function(t,o){var s=o[2],a=o[3];n[o[1]]=s.add,a&&s.add(function(){i=a},e[1^t][2].disable,e[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?n:this,arguments),this},r[o[0]+"With"]=s.fireWith}),n.promise(r),t&&t.call(r,r),r},when:function(t){var e,i,n,r=0,o=V.call(arguments),s=o.length,a=1!==s||t&&oe.isFunction(t.promise)?s:0,c=1===a?t:oe.Deferred(),l=function(t,i,n){return function(r){i[t]=this,n[t]=arguments.length>1?V.call(arguments):r,n===e?c.notifyWith(i,n):--a||c.resolveWith(i,n)}};if(s>1)for(e=new Array(s),i=new Array(s),n=new Array(s);s>r;r++)o[r]&&oe.isFunction(o[r].promise)?o[r].promise().done(l(r,n,o)).fail(c.reject).progress(l(r,i,e)):--a;return a||c.resolveWith(n,o),c.promise()}});var Ce;oe.fn.ready=function(t){return oe.ready.promise().done(t),this},oe.extend({isReady:!1,readyWait:1,holdReady:function(t){t?oe.readyWait++:oe.ready(!0)},ready:function(t){if(t===!0?!--oe.readyWait:!oe.isReady){if(!ge.body)return setTimeout(oe.ready);oe.isReady=!0,t!==!0&&--oe.readyWait>0||(Ce.resolveWith(ge,[oe]),oe.fn.trigger&&oe(ge).trigger("ready").off("ready"))}}}),oe.ready.promise=function(e){if(!Ce)if(Ce=oe.Deferred(),"complete"===ge.readyState)setTimeout(oe.ready);else if(ge.addEventListener)ge.addEventListener("DOMContentLoaded",a,!1),t.addEventListener("load",a,!1);else{ge.attachEvent("onreadystatechange",a),t.attachEvent("onload",a);var i=!1;try{i=null==t.frameElement&&ge.documentElement}catch(n){}i&&i.doScroll&&!function r(){if(!oe.isReady){try{i.doScroll("left")}catch(t){return setTimeout(r,50)}s(),oe.ready()}}()}return Ce.promise(e)};var Se,Ae="undefined";for(Se in oe(ne))break;ne.ownLast="0"!==Se,ne.inlineBlockNeedsLayout=!1,oe(function(){var t,e,i=ge.getElementsByTagName("body")[0];i&&(t=ge.createElement("div"),t.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",e=ge.createElement("div"),i.appendChild(t).appendChild(e),typeof e.style.zoom!==Ae&&(e.style.cssText="border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1",(ne.inlineBlockNeedsLayout=3===e.offsetWidth)&&(i.style.zoom=1)),i.removeChild(t),t=e=null)}),function(){var t=ge.createElement("div");if(null==ne.deleteExpando){ne.deleteExpando=!0;try{delete t.test}catch(e){ne.deleteExpando=!1}}t=null}(),oe.acceptData=function(t){var e=oe.noData[(t.nodeName+" ").toLowerCase()],i=+t.nodeType||1;return 1!==i&&9!==i?!1:!e||e!==!0&&t.getAttribute("classid")===e};var ke=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,_e=/([A-Z])/g;oe.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(t){return t=t.nodeType?oe.cache[t[oe.expando]]:t[oe.expando],!!t&&!l(t)},data:function(t,e,i){return h(t,e,i)},removeData:function(t,e){return u(t,e)},_data:function(t,e,i){return h(t,e,i,!0)},_removeData:function(t,e){return u(t,e,!0)}}),oe.fn.extend({data:function(t,e){var i,n,r,o=this[0],s=o&&o.attributes;if(void 0===t){if(this.length&&(r=oe.data(o),1===o.nodeType&&!oe._data(o,"parsedAttrs"))){for(i=s.length;i--;)n=s[i].name,0===n.indexOf("data-")&&(n=oe.camelCase(n.slice(5)),c(o,n,r[n]));oe._data(o,"parsedAttrs",!0)}return r}return"object"==typeof t?this.each(function(){oe.data(this,t)}):arguments.length>1?this.each(function(){oe.data(this,t,e)}):o?c(o,t,oe.data(o,t)):void 0},removeData:function(t){return this.each(function(){oe.removeData(this,t)})}}),oe.extend({queue:function(t,e,i){var n;return t?(e=(e||"fx")+"queue",n=oe._data(t,e),i&&(!n||oe.isArray(i)?n=oe._data(t,e,oe.makeArray(i)):n.push(i)),n||[]):void 0},dequeue:function(t,e){e=e||"fx";var i=oe.queue(t,e),n=i.length,r=i.shift(),o=oe._queueHooks(t,e),s=function(){oe.dequeue(t,e)};"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===e&&i.unshift("inprogress"),delete o.stop,r.call(t,s,o)),!n&&o&&o.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return oe._data(t,i)||oe._data(t,i,{empty:oe.Callbacks("once memory").add(function(){oe._removeData(t,e+"queue"),oe._removeData(t,i)})})}}),oe.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?oe.queue(this[0],t):void 0===e?this:this.each(function(){var i=oe.queue(this,t,e);oe._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&oe.dequeue(this,t)})},dequeue:function(t){return this.each(function(){oe.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,r=oe.Deferred(),o=this,s=this.length,a=function(){--n||r.resolveWith(o,[o])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";s--;)i=oe._data(o[s],t+"queueHooks"),i&&i.empty&&(n++,i.empty.add(a));return a(),r.promise(e)}});var Te=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Oe=["Top","Right","Bottom","Left"],je=function(t,e){return t=e||t,"none"===oe.css(t,"display")||!oe.contains(t.ownerDocument,t)},Ee=oe.access=function(t,e,i,n,r,o,s){var a=0,c=t.length,l=null==i;if("object"===oe.type(i)){r=!0;for(a in i)oe.access(t,e,a,i[a],!0,o,s)}else if(void 0!==n&&(r=!0,oe.isFunction(n)||(s=!0),l&&(s?(e.call(t,n),e=null):(l=e,e=function(t,e,i){return l.call(oe(t),i)})),e))for(;c>a;a++)e(t[a],i,s?n:n.call(t[a],a,e(t[a],i)));return r?t:l?e.call(t):c?e(t[0],i):o},De=/^(?:checkbox|radio)$/i;!function(){var t=ge.createDocumentFragment(),e=ge.createElement("div"),i=ge.createElement("input");if(e.setAttribute("className","t"),e.innerHTML="  <link/><table></table><a href='/a'>a</a>",ne.leadingWhitespace=3===e.firstChild.nodeType,ne.tbody=!e.getElementsByTagName("tbody").length,ne.htmlSerialize=!!e.getElementsByTagName("link").length,ne.html5Clone="<:nav></:nav>"!==ge.createElement("nav").cloneNode(!0).outerHTML,i.type="checkbox",i.checked=!0,t.appendChild(i),ne.appendChecked=i.checked,e.innerHTML="<textarea>x</textarea>",ne.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue,t.appendChild(e),e.innerHTML="<input type='radio' checked='checked' name='t'/>",ne.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,ne.noCloneEvent=!0,e.attachEvent&&(e.attachEvent("onclick",function(){ne.noCloneEvent=!1}),e.cloneNode(!0).click()),null==ne.deleteExpando){ne.deleteExpando=!0;try{delete e.test}catch(n){ne.deleteExpando=!1}}t=e=i=null}(),function(){var e,i,n=ge.createElement("div");for(e in{submit:!0,change:!0,focusin:!0})i="on"+e,(ne[e+"Bubbles"]=i in t)||(n.setAttribute(i,"t"),ne[e+"Bubbles"]=n.attributes[i].expando===!1);n=null}();var Ie=/^(?:input|select|textarea)$/i,Le=/^key/,Pe=/^(?:mouse|contextmenu)|click/,Me=/^(?:focusinfocus|focusoutblur)$/,Be=/^([^.]*)(?:\.(.+)|)$/;oe.event={global:{},add:function(t,e,i,n,r){var o,s,a,c,l,h,u,d,f,p,g,m=oe._data(t);if(m){for(i.handler&&(c=i,i=c.handler,r=c.selector),i.guid||(i.guid=oe.guid++),(s=m.events)||(s=m.events={}),(h=m.handle)||(h=m.handle=function(t){return typeof oe===Ae||t&&oe.event.triggered===t.type?void 0:oe.event.dispatch.apply(h.elem,arguments)},h.elem=t),e=(e||"").match(xe)||[""],a=e.length;a--;)o=Be.exec(e[a])||[],f=g=o[1],p=(o[2]||"").split(".").sort(),f&&(l=oe.event.special[f]||{},f=(r?l.delegateType:l.bindType)||f,l=oe.event.special[f]||{},u=oe.extend({type:f,origType:g,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&oe.expr.match.needsContext.test(r),namespace:p.join(".")},c),(d=s[f])||(d=s[f]=[],d.delegateCount=0,l.setup&&l.setup.call(t,n,p,h)!==!1||(t.addEventListener?t.addEventListener(f,h,!1):t.attachEvent&&t.attachEvent("on"+f,h))),l.add&&(l.add.call(t,u),u.handler.guid||(u.handler.guid=i.guid)),r?d.splice(d.delegateCount++,0,u):d.push(u),oe.event.global[f]=!0);t=null}},remove:function(t,e,i,n,r){var o,s,a,c,l,h,u,d,f,p,g,m=oe.hasData(t)&&oe._data(t);if(m&&(h=m.events)){for(e=(e||"").match(xe)||[""],l=e.length;l--;)if(a=Be.exec(e[l])||[],f=g=a[1],p=(a[2]||"").split(".").sort(),f){for(u=oe.event.special[f]||{},f=(n?u.delegateType:u.bindType)||f,d=h[f]||[],a=a[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),c=o=d.length;o--;)s=d[o],!r&&g!==s.origType||i&&i.guid!==s.guid||a&&!a.test(s.namespace)||n&&n!==s.selector&&("**"!==n||!s.selector)||(d.splice(o,1),s.selector&&d.delegateCount--,u.remove&&u.remove.call(t,s));c&&!d.length&&(u.teardown&&u.teardown.call(t,p,m.handle)!==!1||oe.removeEvent(t,f,m.handle),delete h[f])}else for(f in h)oe.event.remove(t,f+e[l],i,n,!0);oe.isEmptyObject(h)&&(delete m.handle,oe._removeData(t,"events"))}},trigger:function(e,i,n,r){var o,s,a,c,l,h,u,d=[n||ge],f=ee.call(e,"type")?e.type:e,p=ee.call(e,"namespace")?e.namespace.split("."):[];if(a=h=n=n||ge,3!==n.nodeType&&8!==n.nodeType&&!Me.test(f+oe.event.triggered)&&(f.indexOf(".")>=0&&(p=f.split("."),f=p.shift(),p.sort()),s=f.indexOf(":")<0&&"on"+f,e=e[oe.expando]?e:new oe.Event(f,"object"==typeof e&&e),e.isTrigger=r?2:3,e.namespace=p.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),i=null==i?[e]:oe.makeArray(i,[e]),l=oe.event.special[f]||{},r||!l.trigger||l.trigger.apply(n,i)!==!1)){if(!r&&!l.noBubble&&!oe.isWindow(n)){for(c=l.delegateType||f,Me.test(c+f)||(a=a.parentNode);a;a=a.parentNode)d.push(a),h=a;h===(n.ownerDocument||ge)&&d.push(h.defaultView||h.parentWindow||t)}for(u=0;(a=d[u++])&&!e.isPropagationStopped();)e.type=u>1?c:l.bindType||f,o=(oe._data(a,"events")||{})[e.type]&&oe._data(a,"handle"),o&&o.apply(a,i),o=s&&a[s],o&&o.apply&&oe.acceptData(a)&&(e.result=o.apply(a,i),e.result===!1&&e.preventDefault());if(e.type=f,!r&&!e.isDefaultPrevented()&&(!l._default||l._default.apply(d.pop(),i)===!1)&&oe.acceptData(n)&&s&&n[f]&&!oe.isWindow(n)){h=n[s],h&&(n[s]=null),oe.event.triggered=f;try{n[f]()}catch(g){}oe.event.triggered=void 0,h&&(n[s]=h)}return e.result}},dispatch:function(t){t=oe.event.fix(t);var e,i,n,r,o,s=[],a=V.call(arguments),c=(oe._data(this,"events")||{})[t.type]||[],l=oe.event.special[t.type]||{};if(a[0]=t,t.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,t)!==!1){for(s=oe.event.handlers.call(this,t,c),e=0;(r=s[e++])&&!t.isPropagationStopped();)for(t.currentTarget=r.elem,o=0;(n=r.handlers[o++])&&!t.isImmediatePropagationStopped();)(!t.namespace_re||t.namespace_re.test(n.namespace))&&(t.handleObj=n,t.data=n.data,i=((oe.event.special[n.origType]||{}).handle||n.handler).apply(r.elem,a),void 0!==i&&(t.result=i)===!1&&(t.preventDefault(),t.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,t),t.result}},handlers:function(t,e){var i,n,r,o,s=[],a=e.delegateCount,c=t.target;if(a&&c.nodeType&&(!t.button||"click"!==t.type))for(;c!=this;c=c.parentNode||this)if(1===c.nodeType&&(c.disabled!==!0||"click"!==t.type)){for(r=[],o=0;a>o;o++)n=e[o],i=n.selector+" ",void 0===r[i]&&(r[i]=n.needsContext?oe(i,this).index(c)>=0:oe.find(i,this,null,[c]).length),r[i]&&r.push(n);r.length&&s.push({elem:c,handlers:r})}return a<e.length&&s.push({elem:this,handlers:e.slice(a)}),s},fix:function(t){if(t[oe.expando])return t;var e,i,n,r=t.type,o=t,s=this.fixHooks[r];for(s||(this.fixHooks[r]=s=Pe.test(r)?this.mouseHooks:Le.test(r)?this.keyHooks:{}),n=s.props?this.props.concat(s.props):this.props,t=new oe.Event(o),e=n.length;e--;)i=n[e],t[i]=o[i];return t.target||(t.target=o.srcElement||ge),3===t.target.nodeType&&(t.target=t.target.parentNode),t.metaKey=!!t.metaKey,s.filter?s.filter(t,o):t},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var i,n,r,o=e.button,s=e.fromElement;return null==t.pageX&&null!=e.clientX&&(n=t.target.ownerDocument||ge,r=n.documentElement,i=n.body,t.pageX=e.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),t.pageY=e.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!t.relatedTarget&&s&&(t.relatedTarget=s===t.target?e.toElement:s),t.which||void 0===o||(t.which=1&o?1:2&o?3:4&o?2:0),t}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==p()&&this.focus)try{return this.focus(),!1}catch(t){}},delegateType:"focusin"},blur:{trigger:function(){return this===p()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return oe.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(t){return oe.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,i,n){var r=oe.extend(new oe.Event,i,{type:t,isSimulated:!0,originalEvent:{}});n?oe.event.trigger(r,null,e):oe.event.dispatch.call(e,r),r.isDefaultPrevented()&&i.preventDefault()}},oe.removeEvent=ge.removeEventListener?function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i,!1)}:function(t,e,i){var n="on"+e;t.detachEvent&&(typeof t[n]===Ae&&(t[n]=null),t.detachEvent(n,i))},oe.Event=function(t,e){return this instanceof oe.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&(t.returnValue===!1||t.getPreventDefault&&t.getPreventDefault())?d:f):this.type=t,e&&oe.extend(this,e),this.timeStamp=t&&t.timeStamp||oe.now(),void(this[oe.expando]=!0)):new oe.Event(t,e)},oe.Event.prototype={isDefaultPrevented:f,isPropagationStopped:f,isImmediatePropagationStopped:f,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=d,t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=d,t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=d,this.stopPropagation()}},oe.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,e){oe.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=this,r=t.relatedTarget,o=t.handleObj;return(!r||r!==n&&!oe.contains(n,r))&&(t.type=o.origType,i=o.handler.apply(this,arguments),t.type=e),i}}}),ne.submitBubbles||(oe.event.special.submit={setup:function(){return oe.nodeName(this,"form")?!1:void oe.event.add(this,"click._submit keypress._submit",function(t){var e=t.target,i=oe.nodeName(e,"input")||oe.nodeName(e,"button")?e.form:void 0;i&&!oe._data(i,"submitBubbles")&&(oe.event.add(i,"submit._submit",function(t){t._submit_bubble=!0}),oe._data(i,"submitBubbles",!0))})},postDispatch:function(t){t._submit_bubble&&(delete t._submit_bubble,this.parentNode&&!t.isTrigger&&oe.event.simulate("submit",this.parentNode,t,!0))},teardown:function(){return oe.nodeName(this,"form")?!1:void oe.event.remove(this,"._submit")}}),ne.changeBubbles||(oe.event.special.change={setup:function(){return Ie.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(oe.event.add(this,"propertychange._change",function(t){"checked"===t.originalEvent.propertyName&&(this._just_changed=!0)}),oe.event.add(this,"click._change",function(t){this._just_changed&&!t.isTrigger&&(this._just_changed=!1),oe.event.simulate("change",this,t,!0)})),!1):void oe.event.add(this,"beforeactivate._change",function(t){var e=t.target;Ie.test(e.nodeName)&&!oe._data(e,"changeBubbles")&&(oe.event.add(e,"change._change",function(t){!this.parentNode||t.isSimulated||t.isTrigger||oe.event.simulate("change",this.parentNode,t,!0)}),oe._data(e,"changeBubbles",!0))})},handle:function(t){var e=t.target;return this!==e||t.isSimulated||t.isTrigger||"radio"!==e.type&&"checkbox"!==e.type?t.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return oe.event.remove(this,"._change"),!Ie.test(this.nodeName)}}),ne.focusinBubbles||oe.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){oe.event.simulate(e,t.target,oe.event.fix(t),!0)};oe.event.special[e]={setup:function(){var n=this.ownerDocument||this,r=oe._data(n,e);r||n.addEventListener(t,i,!0),oe._data(n,e,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this,r=oe._data(n,e)-1;r?oe._data(n,e,r):(n.removeEventListener(t,i,!0),oe._removeData(n,e))}}}),oe.fn.extend({on:function(t,e,i,n,r){var o,s;if("object"==typeof t){"string"!=typeof e&&(i=i||e,e=void 0);for(o in t)this.on(o,e,i,t[o],r);return this}if(null==i&&null==n?(n=e,i=e=void 0):null==n&&("string"==typeof e?(n=i,i=void 0):(n=i,i=e,e=void 0)),n===!1)n=f;else if(!n)return this;return 1===r&&(s=n,n=function(t){return oe().off(t),s.apply(this,arguments)},n.guid=s.guid||(s.guid=oe.guid++)),this.each(function(){oe.event.add(this,t,n,i,e)})},one:function(t,e,i,n){return this.on(t,e,i,n,1)},off:function(t,e,i){var n,r;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,oe(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(r in t)this.off(r,e,t[r]);return this}return(e===!1||"function"==typeof e)&&(i=e,e=void 0),i===!1&&(i=f),this.each(function(){oe.event.remove(this,t,i,e)})},trigger:function(t,e){return this.each(function(){oe.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];return i?oe.event.trigger(t,e,i,!0):void 0}});var Re="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Fe=/ jQuery\d+="(?:null|\d+)"/g,$e=new RegExp("<(?:"+Re+")[\\s/>]","i"),Ne=/^\s+/,ze=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,We=/<([\w:]+)/,qe=/<tbody/i,He=/<|&#?\w+;/,Xe=/<(?:script|style|link)/i,Ye=/checked\s*(?:[^=]|=\s*.checked.)/i,Ue=/^$|\/(?:java|ecma)script/i,Ge=/^true\/(.*)/,Ve=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Qe={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ne.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Je=g(ge),Ke=Je.appendChild(ge.createElement("div"));Qe.optgroup=Qe.option,Qe.tbody=Qe.tfoot=Qe.colgroup=Qe.caption=Qe.thead,Qe.th=Qe.td,oe.extend({clone:function(t,e,i){var n,r,o,s,a,c=oe.contains(t.ownerDocument,t);if(ne.html5Clone||oe.isXMLDoc(t)||!$e.test("<"+t.nodeName+">")?o=t.cloneNode(!0):(Ke.innerHTML=t.outerHTML,Ke.removeChild(o=Ke.firstChild)),!(ne.noCloneEvent&&ne.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||oe.isXMLDoc(t)))for(n=m(o),a=m(t),s=0;null!=(r=a[s]);++s)n[s]&&S(r,n[s]);if(e)if(i)for(a=a||m(t),n=n||m(o),s=0;null!=(r=a[s]);s++)C(r,n[s]);else C(t,o);return n=m(o,"script"),n.length>0&&w(n,!c&&m(t,"script")),n=a=r=null,o},buildFragment:function(t,e,i,n){for(var r,o,s,a,c,l,h,u=t.length,d=g(e),f=[],p=0;u>p;p++)if(o=t[p],o||0===o)if("object"===oe.type(o))oe.merge(f,o.nodeType?[o]:o);else if(He.test(o)){for(a=a||d.appendChild(e.createElement("div")),c=(We.exec(o)||["",""])[1].toLowerCase(),h=Qe[c]||Qe._default,a.innerHTML=h[1]+o.replace(ze,"<$1></$2>")+h[2],r=h[0];r--;)a=a.lastChild;if(!ne.leadingWhitespace&&Ne.test(o)&&f.push(e.createTextNode(Ne.exec(o)[0])),!ne.tbody)for(o="table"!==c||qe.test(o)?"<table>"!==h[1]||qe.test(o)?0:a:a.firstChild,r=o&&o.childNodes.length;r--;)oe.nodeName(l=o.childNodes[r],"tbody")&&!l.childNodes.length&&o.removeChild(l);for(oe.merge(f,a.childNodes),a.textContent="";a.firstChild;)a.removeChild(a.firstChild);a=d.lastChild}else f.push(e.createTextNode(o));for(a&&d.removeChild(a),ne.appendChecked||oe.grep(m(f,"input"),v),p=0;o=f[p++];)if((!n||-1===oe.inArray(o,n))&&(s=oe.contains(o.ownerDocument,o),a=m(d.appendChild(o),"script"),s&&w(a),i))for(r=0;o=a[r++];)Ue.test(o.type||"")&&i.push(o);return a=null,d},cleanData:function(t,e){for(var i,n,r,o,s=0,a=oe.expando,c=oe.cache,l=ne.deleteExpando,h=oe.event.special;null!=(i=t[s]);s++)if((e||oe.acceptData(i))&&(r=i[a],o=r&&c[r])){if(o.events)for(n in o.events)h[n]?oe.event.remove(i,n):oe.removeEvent(i,n,o.handle);c[r]&&(delete c[r],l?delete i[a]:typeof i.removeAttribute!==Ae?i.removeAttribute(a):i[a]=null,G.push(r))}}}),oe.fn.extend({text:function(t){return Ee(this,function(t){return void 0===t?oe.text(this):this.empty().append((this[0]&&this[0].ownerDocument||ge).createTextNode(t))},null,t,arguments.length)},append:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=b(this,t);e.appendChild(t)}})},prepend:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=b(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},remove:function(t,e){for(var i,n=t?oe.filter(t,this):this,r=0;null!=(i=n[r]);r++)e||1!==i.nodeType||oe.cleanData(m(i)),i.parentNode&&(e&&oe.contains(i.ownerDocument,i)&&w(m(i,"script")),i.parentNode.removeChild(i));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++){for(1===t.nodeType&&oe.cleanData(m(t,!1));t.firstChild;)t.removeChild(t.firstChild);t.options&&oe.nodeName(t,"select")&&(t.options.length=0)}return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return oe.clone(this,t,e)})},html:function(t){return Ee(this,function(t){var e=this[0]||{},i=0,n=this.length;if(void 0===t)return 1===e.nodeType?e.innerHTML.replace(Fe,""):void 0;if(!("string"!=typeof t||Xe.test(t)||!ne.htmlSerialize&&$e.test(t)||!ne.leadingWhitespace&&Ne.test(t)||Qe[(We.exec(t)||["",""])[1].toLowerCase()])){t=t.replace(ze,"<$1></$2>");try{for(;n>i;i++)e=this[i]||{},1===e.nodeType&&(oe.cleanData(m(e,!1)),e.innerHTML=t);e=0}catch(r){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=arguments[0];return this.domManip(arguments,function(e){t=this.parentNode,oe.cleanData(m(this)),t&&t.replaceChild(e,this)}),t&&(t.length||t.nodeType)?this:this.remove()},detach:function(t){return this.remove(t,!0)},domManip:function(t,e){t=Q.apply([],t);var i,n,r,o,s,a,c=0,l=this.length,h=this,u=l-1,d=t[0],f=oe.isFunction(d);if(f||l>1&&"string"==typeof d&&!ne.checkClone&&Ye.test(d))return this.each(function(i){var n=h.eq(i);f&&(t[0]=d.call(this,i,n.html())),n.domManip(t,e)});if(l&&(a=oe.buildFragment(t,this[0].ownerDocument,!1,this),i=a.firstChild,1===a.childNodes.length&&(a=i),i)){for(o=oe.map(m(a,"script"),y),r=o.length;l>c;c++)n=a,c!==u&&(n=oe.clone(n,!0,!0),r&&oe.merge(o,m(n,"script"))),e.call(this[c],n,c);if(r)for(s=o[o.length-1].ownerDocument,oe.map(o,x),c=0;r>c;c++)n=o[c],Ue.test(n.type||"")&&!oe._data(n,"globalEval")&&oe.contains(s,n)&&(n.src?oe._evalUrl&&oe._evalUrl(n.src):oe.globalEval((n.text||n.textContent||n.innerHTML||"").replace(Ve,"")));a=i=null}return this}}),oe.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){oe.fn[t]=function(t){for(var i,n=0,r=[],o=oe(t),s=o.length-1;s>=n;n++)i=n===s?this:this.clone(!0),oe(o[n])[e](i),J.apply(r,i.get());return this.pushStack(r)}});var Ze,ti={};!function(){var t,e,i=ge.createElement("div"),n="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";i.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=i.getElementsByTagName("a")[0],t.style.cssText="float:left;opacity:.5",ne.opacity=/^0.5/.test(t.style.opacity),ne.cssFloat=!!t.style.cssFloat,i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",ne.clearCloneStyle="content-box"===i.style.backgroundClip,t=i=null,ne.shrinkWrapBlocks=function(){var t,i,r,o;if(null==e){if(t=ge.getElementsByTagName("body")[0],!t)return;o="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",i=ge.createElement("div"),r=ge.createElement("div"),t.appendChild(i).appendChild(r),e=!1,typeof r.style.zoom!==Ae&&(r.style.cssText=n+";width:1px;padding:1px;zoom:1",r.innerHTML="<div></div>",r.firstChild.style.width="5px",e=3!==r.offsetWidth),t.removeChild(i),t=i=r=null}return e}}();var ei,ii,ni=/^margin/,ri=new RegExp("^("+Te+")(?!px)[a-z%]+$","i"),oi=/^(top|right|bottom|left)$/;t.getComputedStyle?(ei=function(t){return t.ownerDocument.defaultView.getComputedStyle(t,null)},ii=function(t,e,i){var n,r,o,s,a=t.style;return i=i||ei(t),s=i?i.getPropertyValue(e)||i[e]:void 0,i&&(""!==s||oe.contains(t.ownerDocument,t)||(s=oe.style(t,e)),ri.test(s)&&ni.test(e)&&(n=a.width,r=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=i.width,a.width=n,a.minWidth=r,a.maxWidth=o)),void 0===s?s:s+""
}):ge.documentElement.currentStyle&&(ei=function(t){return t.currentStyle},ii=function(t,e,i){var n,r,o,s,a=t.style;return i=i||ei(t),s=i?i[e]:void 0,null==s&&a&&a[e]&&(s=a[e]),ri.test(s)&&!oi.test(e)&&(n=a.left,r=t.runtimeStyle,o=r&&r.left,o&&(r.left=t.currentStyle.left),a.left="fontSize"===e?"1em":s,s=a.pixelLeft+"px",a.left=n,o&&(r.left=o)),void 0===s?s:s+""||"auto"}),!function(){function e(){var e,i,n=ge.getElementsByTagName("body")[0];n&&(e=ge.createElement("div"),i=ge.createElement("div"),e.style.cssText=l,n.appendChild(e).appendChild(i),i.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%",oe.swap(n,null!=n.style.zoom?{zoom:1}:{},function(){r=4===i.offsetWidth}),o=!0,s=!1,a=!0,t.getComputedStyle&&(s="1%"!==(t.getComputedStyle(i,null)||{}).top,o="4px"===(t.getComputedStyle(i,null)||{width:"4px"}).width),n.removeChild(e),i=n=null)}var i,n,r,o,s,a,c=ge.createElement("div"),l="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",h="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",i=c.getElementsByTagName("a")[0],i.style.cssText="float:left;opacity:.5",ne.opacity=/^0.5/.test(i.style.opacity),ne.cssFloat=!!i.style.cssFloat,c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",ne.clearCloneStyle="content-box"===c.style.backgroundClip,i=c=null,oe.extend(ne,{reliableHiddenOffsets:function(){if(null!=n)return n;var t,e,i,r=ge.createElement("div"),o=ge.getElementsByTagName("body")[0];return o?(r.setAttribute("className","t"),r.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=ge.createElement("div"),t.style.cssText=l,o.appendChild(t).appendChild(r),r.innerHTML="<table><tr><td></td><td>t</td></tr></table>",e=r.getElementsByTagName("td"),e[0].style.cssText="padding:0;margin:0;border:0;display:none",i=0===e[0].offsetHeight,e[0].style.display="",e[1].style.display="none",n=i&&0===e[0].offsetHeight,o.removeChild(t),r=o=null,n):void 0},boxSizing:function(){return null==r&&e(),r},boxSizingReliable:function(){return null==o&&e(),o},pixelPosition:function(){return null==s&&e(),s},reliableMarginRight:function(){var e,i,n,r;if(null==a&&t.getComputedStyle){if(e=ge.getElementsByTagName("body")[0],!e)return;i=ge.createElement("div"),n=ge.createElement("div"),i.style.cssText=l,e.appendChild(i).appendChild(n),r=n.appendChild(ge.createElement("div")),r.style.cssText=n.style.cssText=h,r.style.marginRight=r.style.width="0",n.style.width="1px",a=!parseFloat((t.getComputedStyle(r,null)||{}).marginRight),e.removeChild(i)}return a}})}(),oe.swap=function(t,e,i,n){var r,o,s={};for(o in e)s[o]=t.style[o],t.style[o]=e[o];r=i.apply(t,n||[]);for(o in e)t.style[o]=s[o];return r};var si=/alpha\([^)]*\)/i,ai=/opacity\s*=\s*([^)]*)/,ci=/^(none|table(?!-c[ea]).+)/,li=new RegExp("^("+Te+")(.*)$","i"),hi=new RegExp("^([+-])=("+Te+")","i"),ui={position:"absolute",visibility:"hidden",display:"block"},di={letterSpacing:0,fontWeight:400},fi=["Webkit","O","Moz","ms"];oe.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=ii(t,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ne.cssFloat?"cssFloat":"styleFloat"},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,o,s,a=oe.camelCase(e),c=t.style;if(e=oe.cssProps[a]||(oe.cssProps[a]=T(c,a)),s=oe.cssHooks[e]||oe.cssHooks[a],void 0===i)return s&&"get"in s&&void 0!==(r=s.get(t,!1,n))?r:c[e];if(o=typeof i,"string"===o&&(r=hi.exec(i))&&(i=(r[1]+1)*r[2]+parseFloat(oe.css(t,e)),o="number"),null!=i&&i===i&&("number"!==o||oe.cssNumber[a]||(i+="px"),ne.clearCloneStyle||""!==i||0!==e.indexOf("background")||(c[e]="inherit"),!(s&&"set"in s&&void 0===(i=s.set(t,i,n)))))try{c[e]="",c[e]=i}catch(l){}}},css:function(t,e,i,n){var r,o,s,a=oe.camelCase(e);return e=oe.cssProps[a]||(oe.cssProps[a]=T(t.style,a)),s=oe.cssHooks[e]||oe.cssHooks[a],s&&"get"in s&&(o=s.get(t,!0,i)),void 0===o&&(o=ii(t,e,n)),"normal"===o&&e in di&&(o=di[e]),""===i||i?(r=parseFloat(o),i===!0||oe.isNumeric(r)?r||0:o):o}}),oe.each(["height","width"],function(t,e){oe.cssHooks[e]={get:function(t,i,n){return i?0===t.offsetWidth&&ci.test(oe.css(t,"display"))?oe.swap(t,ui,function(){return D(t,e,n)}):D(t,e,n):void 0},set:function(t,i,n){var r=n&&ei(t);return j(t,i,n?E(t,e,n,ne.boxSizing()&&"border-box"===oe.css(t,"boxSizing",!1,r),r):0)}}}),ne.opacity||(oe.cssHooks.opacity={get:function(t,e){return ai.test((e&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":e?"1":""},set:function(t,e){var i=t.style,n=t.currentStyle,r=oe.isNumeric(e)?"alpha(opacity="+100*e+")":"",o=n&&n.filter||i.filter||"";i.zoom=1,(e>=1||""===e)&&""===oe.trim(o.replace(si,""))&&i.removeAttribute&&(i.removeAttribute("filter"),""===e||n&&!n.filter)||(i.filter=si.test(o)?o.replace(si,r):o+" "+r)}}),oe.cssHooks.marginRight=_(ne.reliableMarginRight,function(t,e){return e?oe.swap(t,{display:"inline-block"},ii,[t,"marginRight"]):void 0}),oe.each({margin:"",padding:"",border:"Width"},function(t,e){oe.cssHooks[t+e]={expand:function(i){for(var n=0,r={},o="string"==typeof i?i.split(" "):[i];4>n;n++)r[t+Oe[n]+e]=o[n]||o[n-2]||o[0];return r}},ni.test(t)||(oe.cssHooks[t+e].set=j)}),oe.fn.extend({css:function(t,e){return Ee(this,function(t,e,i){var n,r,o={},s=0;if(oe.isArray(e)){for(n=ei(t),r=e.length;r>s;s++)o[e[s]]=oe.css(t,e[s],!1,n);return o}return void 0!==i?oe.style(t,e,i):oe.css(t,e)},t,e,arguments.length>1)},show:function(){return O(this,!0)},hide:function(){return O(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){je(this)?oe(this).show():oe(this).hide()})}}),oe.Tween=I,I.prototype={constructor:I,init:function(t,e,i,n,r,o){this.elem=t,this.prop=i,this.easing=r||"swing",this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=o||(oe.cssNumber[i]?"":"px")},cur:function(){var t=I.propHooks[this.prop];return t&&t.get?t.get(this):I.propHooks._default.get(this)},run:function(t){var e,i=I.propHooks[this.prop];return this.pos=e=this.options.duration?oe.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):I.propHooks._default.set(this),this}},I.prototype.init.prototype=I.prototype,I.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=oe.css(t.elem,t.prop,""),e&&"auto"!==e?e:0):t.elem[t.prop]},set:function(t){oe.fx.step[t.prop]?oe.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[oe.cssProps[t.prop]]||oe.cssHooks[t.prop])?oe.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},I.propHooks.scrollTop=I.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},oe.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},oe.fx=I.prototype.init,oe.fx.step={};var pi,gi,mi=/^(?:toggle|show|hide)$/,vi=new RegExp("^(?:([+-])=|)("+Te+")([a-z%]*)$","i"),bi=/queueHooks$/,yi=[B],xi={"*":[function(t,e){var i=this.createTween(t,e),n=i.cur(),r=vi.exec(e),o=r&&r[3]||(oe.cssNumber[t]?"":"px"),s=(oe.cssNumber[t]||"px"!==o&&+n)&&vi.exec(oe.css(i.elem,t)),a=1,c=20;if(s&&s[3]!==o){o=o||s[3],r=r||[],s=+n||1;do a=a||".5",s/=a,oe.style(i.elem,t,s+o);while(a!==(a=i.cur()/n)&&1!==a&&--c)}return r&&(s=i.start=+s||+n||0,i.unit=o,i.end=r[1]?s+(r[1]+1)*r[2]:+r[2]),i}]};oe.Animation=oe.extend(F,{tweener:function(t,e){oe.isFunction(t)?(e=t,t=["*"]):t=t.split(" ");for(var i,n=0,r=t.length;r>n;n++)i=t[n],xi[i]=xi[i]||[],xi[i].unshift(e)},prefilter:function(t,e){e?yi.unshift(t):yi.push(t)}}),oe.speed=function(t,e,i){var n=t&&"object"==typeof t?oe.extend({},t):{complete:i||!i&&e||oe.isFunction(t)&&t,duration:t,easing:i&&e||e&&!oe.isFunction(e)&&e};return n.duration=oe.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in oe.fx.speeds?oe.fx.speeds[n.duration]:oe.fx.speeds._default,(null==n.queue||n.queue===!0)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){oe.isFunction(n.old)&&n.old.call(this),n.queue&&oe.dequeue(this,n.queue)},n},oe.fn.extend({fadeTo:function(t,e,i,n){return this.filter(je).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var r=oe.isEmptyObject(t),o=oe.speed(e,i,n),s=function(){var e=F(this,oe.extend({},t),o);(r||oe._data(this,"finish"))&&e.stop(!0)};return s.finish=s,r||o.queue===!1?this.each(s):this.queue(o.queue,s)},stop:function(t,e,i){var n=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,r=null!=t&&t+"queueHooks",o=oe.timers,s=oe._data(this);if(r)s[r]&&s[r].stop&&n(s[r]);else for(r in s)s[r]&&s[r].stop&&bi.test(r)&&n(s[r]);for(r=o.length;r--;)o[r].elem!==this||null!=t&&o[r].queue!==t||(o[r].anim.stop(i),e=!1,o.splice(r,1));(e||!i)&&oe.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,i=oe._data(this),n=i[t+"queue"],r=i[t+"queueHooks"],o=oe.timers,s=n?n.length:0;for(i.finish=!0,oe.queue(this,t,[]),r&&r.stop&&r.stop.call(this,!0),e=o.length;e--;)o[e].elem===this&&o[e].queue===t&&(o[e].anim.stop(!0),o.splice(e,1));for(e=0;s>e;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish})}}),oe.each(["toggle","show","hide"],function(t,e){var i=oe.fn[e];oe.fn[e]=function(t,n,r){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(P(e,!0),t,n,r)}}),oe.each({slideDown:P("show"),slideUp:P("hide"),slideToggle:P("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){oe.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}}),oe.timers=[],oe.fx.tick=function(){var t,e=oe.timers,i=0;for(pi=oe.now();i<e.length;i++)t=e[i],t()||e[i]!==t||e.splice(i--,1);e.length||oe.fx.stop(),pi=void 0},oe.fx.timer=function(t){oe.timers.push(t),t()?oe.fx.start():oe.timers.pop()},oe.fx.interval=13,oe.fx.start=function(){gi||(gi=setInterval(oe.fx.tick,oe.fx.interval))},oe.fx.stop=function(){clearInterval(gi),gi=null},oe.fx.speeds={slow:600,fast:200,_default:400},oe.fn.delay=function(t,e){return t=oe.fx?oe.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,i){var n=setTimeout(e,t);i.stop=function(){clearTimeout(n)}})},function(){var t,e,i,n,r=ge.createElement("div");r.setAttribute("className","t"),r.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=r.getElementsByTagName("a")[0],i=ge.createElement("select"),n=i.appendChild(ge.createElement("option")),e=r.getElementsByTagName("input")[0],t.style.cssText="top:1px",ne.getSetAttribute="t"!==r.className,ne.style=/top/.test(t.getAttribute("style")),ne.hrefNormalized="/a"===t.getAttribute("href"),ne.checkOn=!!e.value,ne.optSelected=n.selected,ne.enctype=!!ge.createElement("form").enctype,i.disabled=!0,ne.optDisabled=!n.disabled,e=ge.createElement("input"),e.setAttribute("value",""),ne.input=""===e.getAttribute("value"),e.value="t",e.setAttribute("type","radio"),ne.radioValue="t"===e.value,t=e=i=n=r=null}();var wi=/\r/g;oe.fn.extend({val:function(t){var e,i,n,r=this[0];return arguments.length?(n=oe.isFunction(t),this.each(function(i){var r;1===this.nodeType&&(r=n?t.call(this,i,oe(this).val()):t,null==r?r="":"number"==typeof r?r+="":oe.isArray(r)&&(r=oe.map(r,function(t){return null==t?"":t+""})),e=oe.valHooks[this.type]||oe.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,r,"value")||(this.value=r))})):r?(e=oe.valHooks[r.type]||oe.valHooks[r.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(i=e.get(r,"value"))?i:(i=r.value,"string"==typeof i?i.replace(wi,""):null==i?"":i)):void 0}}),oe.extend({valHooks:{option:{get:function(t){var e=oe.find.attr(t,"value");return null!=e?e:oe.text(t)}},select:{get:function(t){for(var e,i,n=t.options,r=t.selectedIndex,o="select-one"===t.type||0>r,s=o?null:[],a=o?r+1:n.length,c=0>r?a:o?r:0;a>c;c++)if(i=n[c],!(!i.selected&&c!==r||(ne.optDisabled?i.disabled:null!==i.getAttribute("disabled"))||i.parentNode.disabled&&oe.nodeName(i.parentNode,"optgroup"))){if(e=oe(i).val(),o)return e;s.push(e)}return s},set:function(t,e){for(var i,n,r=t.options,o=oe.makeArray(e),s=r.length;s--;)if(n=r[s],oe.inArray(oe.valHooks.option.get(n),o)>=0)try{n.selected=i=!0}catch(a){n.scrollHeight}else n.selected=!1;return i||(t.selectedIndex=-1),r}}}}),oe.each(["radio","checkbox"],function(){oe.valHooks[this]={set:function(t,e){return oe.isArray(e)?t.checked=oe.inArray(oe(t).val(),e)>=0:void 0}},ne.checkOn||(oe.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var Ci,Si,Ai=oe.expr.attrHandle,ki=/^(?:checked|selected)$/i,_i=ne.getSetAttribute,Ti=ne.input;oe.fn.extend({attr:function(t,e){return Ee(this,oe.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){oe.removeAttr(this,t)})}}),oe.extend({attr:function(t,e,i){var n,r,o=t.nodeType;return t&&3!==o&&8!==o&&2!==o?typeof t.getAttribute===Ae?oe.prop(t,e,i):(1===o&&oe.isXMLDoc(t)||(e=e.toLowerCase(),n=oe.attrHooks[e]||(oe.expr.match.bool.test(e)?Si:Ci)),void 0===i?n&&"get"in n&&null!==(r=n.get(t,e))?r:(r=oe.find.attr(t,e),null==r?void 0:r):null!==i?n&&"set"in n&&void 0!==(r=n.set(t,i,e))?r:(t.setAttribute(e,i+""),i):void oe.removeAttr(t,e)):void 0},removeAttr:function(t,e){var i,n,r=0,o=e&&e.match(xe);if(o&&1===t.nodeType)for(;i=o[r++];)n=oe.propFix[i]||i,oe.expr.match.bool.test(i)?Ti&&_i||!ki.test(i)?t[n]=!1:t[oe.camelCase("default-"+i)]=t[n]=!1:oe.attr(t,i,""),t.removeAttribute(_i?i:n)},attrHooks:{type:{set:function(t,e){if(!ne.radioValue&&"radio"===e&&oe.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}}}),Si={set:function(t,e,i){return e===!1?oe.removeAttr(t,i):Ti&&_i||!ki.test(i)?t.setAttribute(!_i&&oe.propFix[i]||i,i):t[oe.camelCase("default-"+i)]=t[i]=!0,i}},oe.each(oe.expr.match.bool.source.match(/\w+/g),function(t,e){var i=Ai[e]||oe.find.attr;Ai[e]=Ti&&_i||!ki.test(e)?function(t,e,n){var r,o;return n||(o=Ai[e],Ai[e]=r,r=null!=i(t,e,n)?e.toLowerCase():null,Ai[e]=o),r}:function(t,e,i){return i?void 0:t[oe.camelCase("default-"+e)]?e.toLowerCase():null}}),Ti&&_i||(oe.attrHooks.value={set:function(t,e,i){return oe.nodeName(t,"input")?void(t.defaultValue=e):Ci&&Ci.set(t,e,i)}}),_i||(Ci={set:function(t,e,i){var n=t.getAttributeNode(i);return n||t.setAttributeNode(n=t.ownerDocument.createAttribute(i)),n.value=e+="","value"===i||e===t.getAttribute(i)?e:void 0}},Ai.id=Ai.name=Ai.coords=function(t,e,i){var n;return i?void 0:(n=t.getAttributeNode(e))&&""!==n.value?n.value:null},oe.valHooks.button={get:function(t,e){var i=t.getAttributeNode(e);return i&&i.specified?i.value:void 0},set:Ci.set},oe.attrHooks.contenteditable={set:function(t,e,i){Ci.set(t,""===e?!1:e,i)}},oe.each(["width","height"],function(t,e){oe.attrHooks[e]={set:function(t,i){return""===i?(t.setAttribute(e,"auto"),i):void 0}}})),ne.style||(oe.attrHooks.style={get:function(t){return t.style.cssText||void 0},set:function(t,e){return t.style.cssText=e+""}});var Oi=/^(?:input|select|textarea|button|object)$/i,ji=/^(?:a|area)$/i;oe.fn.extend({prop:function(t,e){return Ee(this,oe.prop,t,e,arguments.length>1)},removeProp:function(t){return t=oe.propFix[t]||t,this.each(function(){try{this[t]=void 0,delete this[t]}catch(e){}})}}),oe.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(t,e,i){var n,r,o,s=t.nodeType;return t&&3!==s&&8!==s&&2!==s?(o=1!==s||!oe.isXMLDoc(t),o&&(e=oe.propFix[e]||e,r=oe.propHooks[e]),void 0!==i?r&&"set"in r&&void 0!==(n=r.set(t,i,e))?n:t[e]=i:r&&"get"in r&&null!==(n=r.get(t,e))?n:t[e]):void 0},propHooks:{tabIndex:{get:function(t){var e=oe.find.attr(t,"tabindex");return e?parseInt(e,10):Oi.test(t.nodeName)||ji.test(t.nodeName)&&t.href?0:-1}}}}),ne.hrefNormalized||oe.each(["href","src"],function(t,e){oe.propHooks[e]={get:function(t){return t.getAttribute(e,4)}}}),ne.optSelected||(oe.propHooks.selected={get:function(t){var e=t.parentNode;return e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex),null}}),oe.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){oe.propFix[this.toLowerCase()]=this}),ne.enctype||(oe.propFix.enctype="encoding");var Ei=/[\t\r\n\f]/g;oe.fn.extend({addClass:function(t){var e,i,n,r,o,s,a=0,c=this.length,l="string"==typeof t&&t;if(oe.isFunction(t))return this.each(function(e){oe(this).addClass(t.call(this,e,this.className))});if(l)for(e=(t||"").match(xe)||[];c>a;a++)if(i=this[a],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Ei," "):" ")){for(o=0;r=e[o++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");s=oe.trim(n),i.className!==s&&(i.className=s)}return this},removeClass:function(t){var e,i,n,r,o,s,a=0,c=this.length,l=0===arguments.length||"string"==typeof t&&t;if(oe.isFunction(t))return this.each(function(e){oe(this).removeClass(t.call(this,e,this.className))});if(l)for(e=(t||"").match(xe)||[];c>a;a++)if(i=this[a],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Ei," "):"")){for(o=0;r=e[o++];)for(;n.indexOf(" "+r+" ")>=0;)n=n.replace(" "+r+" "," ");s=t?oe.trim(n):"",i.className!==s&&(i.className=s)}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):this.each(oe.isFunction(t)?function(i){oe(this).toggleClass(t.call(this,i,this.className,e),e)}:function(){if("string"===i)for(var e,n=0,r=oe(this),o=t.match(xe)||[];e=o[n++];)r.hasClass(e)?r.removeClass(e):r.addClass(e);else(i===Ae||"boolean"===i)&&(this.className&&oe._data(this,"__className__",this.className),this.className=this.className||t===!1?"":oe._data(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",i=0,n=this.length;n>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(Ei," ").indexOf(e)>=0)return!0;return!1}}),oe.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){oe.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}),oe.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)},bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}});var Di=oe.now(),Ii=/\?/,Li=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;oe.parseJSON=function(e){if(t.JSON&&t.JSON.parse)return t.JSON.parse(e+"");var i,n=null,r=oe.trim(e+"");return r&&!oe.trim(r.replace(Li,function(t,e,r,o){return i&&e&&(n=0),0===n?t:(i=r||e,n+=!o-!r,"")}))?Function("return "+r)():oe.error("Invalid JSON: "+e)},oe.parseXML=function(e){var i,n;if(!e||"string"!=typeof e)return null;try{t.DOMParser?(n=new DOMParser,i=n.parseFromString(e,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(e))}catch(r){i=void 0}return i&&i.documentElement&&!i.getElementsByTagName("parsererror").length||oe.error("Invalid XML: "+e),i};var Pi,Mi,Bi=/#.*$/,Ri=/([?&])_=[^&]*/,Fi=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,$i=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ni=/^(?:GET|HEAD)$/,zi=/^\/\//,Wi=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,qi={},Hi={},Xi="*/".concat("*");try{Mi=location.href}catch(Yi){Mi=ge.createElement("a"),Mi.href="",Mi=Mi.href}Pi=Wi.exec(Mi.toLowerCase())||[],oe.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Mi,type:"GET",isLocal:$i.test(Pi[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Xi,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":oe.parseJSON,"text xml":oe.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?z(z(t,oe.ajaxSettings),e):z(oe.ajaxSettings,t)},ajaxPrefilter:$(qi),ajaxTransport:$(Hi),ajax:function(t,e){function i(t,e,i,n){var r,h,v,b,x,C=e;2!==y&&(y=2,a&&clearTimeout(a),l=void 0,s=n||"",w.readyState=t>0?4:0,r=t>=200&&300>t||304===t,i&&(b=W(u,w,i)),b=q(u,b,w,r),r?(u.ifModified&&(x=w.getResponseHeader("Last-Modified"),x&&(oe.lastModified[o]=x),x=w.getResponseHeader("etag"),x&&(oe.etag[o]=x)),204===t||"HEAD"===u.type?C="nocontent":304===t?C="notmodified":(C=b.state,h=b.data,v=b.error,r=!v)):(v=C,(t||!C)&&(C="error",0>t&&(t=0))),w.status=t,w.statusText=(e||C)+"",r?p.resolveWith(d,[h,C,w]):p.rejectWith(d,[w,C,v]),w.statusCode(m),m=void 0,c&&f.trigger(r?"ajaxSuccess":"ajaxError",[w,u,r?h:v]),g.fireWith(d,[w,C]),c&&(f.trigger("ajaxComplete",[w,u]),--oe.active||oe.event.trigger("ajaxStop")))}"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,r,o,s,a,c,l,h,u=oe.ajaxSetup({},e),d=u.context||u,f=u.context&&(d.nodeType||d.jquery)?oe(d):oe.event,p=oe.Deferred(),g=oe.Callbacks("once memory"),m=u.statusCode||{},v={},b={},y=0,x="canceled",w={readyState:0,getResponseHeader:function(t){var e;if(2===y){if(!h)for(h={};e=Fi.exec(s);)h[e[1].toLowerCase()]=e[2];e=h[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===y?s:null},setRequestHeader:function(t,e){var i=t.toLowerCase();return y||(t=b[i]=b[i]||t,v[t]=e),this},overrideMimeType:function(t){return y||(u.mimeType=t),this},statusCode:function(t){var e;if(t)if(2>y)for(e in t)m[e]=[m[e],t[e]];else w.always(t[w.status]);return this},abort:function(t){var e=t||x;return l&&l.abort(e),i(0,e),this}};if(p.promise(w).complete=g.add,w.success=w.done,w.error=w.fail,u.url=((t||u.url||Mi)+"").replace(Bi,"").replace(zi,Pi[1]+"//"),u.type=e.method||e.type||u.method||u.type,u.dataTypes=oe.trim(u.dataType||"*").toLowerCase().match(xe)||[""],null==u.crossDomain&&(n=Wi.exec(u.url.toLowerCase()),u.crossDomain=!(!n||n[1]===Pi[1]&&n[2]===Pi[2]&&(n[3]||("http:"===n[1]?"80":"443"))===(Pi[3]||("http:"===Pi[1]?"80":"443")))),u.data&&u.processData&&"string"!=typeof u.data&&(u.data=oe.param(u.data,u.traditional)),N(qi,u,e,w),2===y)return w;c=u.global,c&&0===oe.active++&&oe.event.trigger("ajaxStart"),u.type=u.type.toUpperCase(),u.hasContent=!Ni.test(u.type),o=u.url,u.hasContent||(u.data&&(o=u.url+=(Ii.test(o)?"&":"?")+u.data,delete u.data),u.cache===!1&&(u.url=Ri.test(o)?o.replace(Ri,"$1_="+Di++):o+(Ii.test(o)?"&":"?")+"_="+Di++)),u.ifModified&&(oe.lastModified[o]&&w.setRequestHeader("If-Modified-Since",oe.lastModified[o]),oe.etag[o]&&w.setRequestHeader("If-None-Match",oe.etag[o])),(u.data&&u.hasContent&&u.contentType!==!1||e.contentType)&&w.setRequestHeader("Content-Type",u.contentType),w.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+("*"!==u.dataTypes[0]?", "+Xi+"; q=0.01":""):u.accepts["*"]);for(r in u.headers)w.setRequestHeader(r,u.headers[r]);if(u.beforeSend&&(u.beforeSend.call(d,w,u)===!1||2===y))return w.abort();x="abort";for(r in{success:1,error:1,complete:1})w[r](u[r]);if(l=N(Hi,u,e,w)){w.readyState=1,c&&f.trigger("ajaxSend",[w,u]),u.async&&u.timeout>0&&(a=setTimeout(function(){w.abort("timeout")},u.timeout));try{y=1,l.send(v,i)}catch(C){if(!(2>y))throw C;i(-1,C)}}else i(-1,"No Transport");return w},getJSON:function(t,e,i){return oe.get(t,e,i,"json")},getScript:function(t,e){return oe.get(t,void 0,e,"script")}}),oe.each(["get","post"],function(t,e){oe[e]=function(t,i,n,r){return oe.isFunction(i)&&(r=r||n,n=i,i=void 0),oe.ajax({url:t,type:e,dataType:r,data:i,success:n})}}),oe.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){oe.fn[e]=function(t){return this.on(e,t)}}),oe._evalUrl=function(t){return oe.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},oe.fn.extend({wrapAll:function(t){if(oe.isFunction(t))return this.each(function(e){oe(this).wrapAll(t.call(this,e))});if(this[0]){var e=oe(t,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(t){return this.each(oe.isFunction(t)?function(e){oe(this).wrapInner(t.call(this,e))}:function(){var e=oe(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=oe.isFunction(t);return this.each(function(i){oe(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(){return this.parent().each(function(){oe.nodeName(this,"body")||oe(this).replaceWith(this.childNodes)}).end()}}),oe.expr.filters.hidden=function(t){return t.offsetWidth<=0&&t.offsetHeight<=0||!ne.reliableHiddenOffsets()&&"none"===(t.style&&t.style.display||oe.css(t,"display"))},oe.expr.filters.visible=function(t){return!oe.expr.filters.hidden(t)};var Ui=/%20/g,Gi=/\[\]$/,Vi=/\r?\n/g,Qi=/^(?:submit|button|image|reset|file)$/i,Ji=/^(?:input|select|textarea|keygen)/i;oe.param=function(t,e){var i,n=[],r=function(t,e){e=oe.isFunction(e)?e():null==e?"":e,n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(void 0===e&&(e=oe.ajaxSettings&&oe.ajaxSettings.traditional),oe.isArray(t)||t.jquery&&!oe.isPlainObject(t))oe.each(t,function(){r(this.name,this.value)});else for(i in t)H(i,t[i],e,r);return n.join("&").replace(Ui,"+")},oe.fn.extend({serialize:function(){return oe.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=oe.prop(this,"elements");return t?oe.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!oe(this).is(":disabled")&&Ji.test(this.nodeName)&&!Qi.test(t)&&(this.checked||!De.test(t))}).map(function(t,e){var i=oe(this).val();return null==i?null:oe.isArray(i)?oe.map(i,function(t){return{name:e.name,value:t.replace(Vi,"\r\n")}}):{name:e.name,value:i.replace(Vi,"\r\n")}}).get()}}),oe.ajaxSettings.xhr=void 0!==t.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&X()||Y()}:X;var Ki=0,Zi={},tn=oe.ajaxSettings.xhr();t.ActiveXObject&&oe(t).on("unload",function(){for(var t in Zi)Zi[t](void 0,!0)}),ne.cors=!!tn&&"withCredentials"in tn,tn=ne.ajax=!!tn,tn&&oe.ajaxTransport(function(t){if(!t.crossDomain||ne.cors){var e;return{send:function(i,n){var r,o=t.xhr(),s=++Ki;if(o.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(r in t.xhrFields)o[r]=t.xhrFields[r];t.mimeType&&o.overrideMimeType&&o.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(r in i)void 0!==i[r]&&o.setRequestHeader(r,i[r]+"");o.send(t.hasContent&&t.data||null),e=function(i,r){var a,c,l;if(e&&(r||4===o.readyState))if(delete Zi[s],e=void 0,o.onreadystatechange=oe.noop,r)4!==o.readyState&&o.abort();else{l={},a=o.status,"string"==typeof o.responseText&&(l.text=o.responseText);try{c=o.statusText}catch(h){c=""}a||!t.isLocal||t.crossDomain?1223===a&&(a=204):a=l.text?200:404}l&&n(a,c,l,o.getAllResponseHeaders())},t.async?4===o.readyState?setTimeout(e):o.onreadystatechange=Zi[s]=e:e()},abort:function(){e&&e(void 0,!0)}}}}),oe.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(t){return oe.globalEval(t),t}}}),oe.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),oe.ajaxTransport("script",function(t){if(t.crossDomain){var e,i=ge.head||oe("head")[0]||ge.documentElement;return{send:function(n,r){e=ge.createElement("script"),e.async=!0,t.scriptCharset&&(e.charset=t.scriptCharset),e.src=t.url,e.onload=e.onreadystatechange=function(t,i){(i||!e.readyState||/loaded|complete/.test(e.readyState))&&(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),e=null,i||r(200,"success"))},i.insertBefore(e,i.firstChild)},abort:function(){e&&e.onload(void 0,!0)}}}});var en=[],nn=/(=)\?(?=&|$)|\?\?/;oe.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=en.pop()||oe.expando+"_"+Di++;return this[t]=!0,t}}),oe.ajaxPrefilter("json jsonp",function(e,i,n){var r,o,s,a=e.jsonp!==!1&&(nn.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&nn.test(e.data)&&"data");return a||"jsonp"===e.dataTypes[0]?(r=e.jsonpCallback=oe.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(nn,"$1"+r):e.jsonp!==!1&&(e.url+=(Ii.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return s||oe.error(r+" was not called"),s[0]},e.dataTypes[0]="json",o=t[r],t[r]=function(){s=arguments},n.always(function(){t[r]=o,e[r]&&(e.jsonpCallback=i.jsonpCallback,en.push(r)),s&&oe.isFunction(o)&&o(s[0]),s=o=void 0}),"script"):void 0}),oe.parseHTML=function(t,e,i){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(i=e,e=!1),e=e||ge;var n=de.exec(t),r=!i&&[];return n?[e.createElement(n[1])]:(n=oe.buildFragment([t],e,r),r&&r.length&&oe(r).remove(),oe.merge([],n.childNodes))};var rn=oe.fn.load;oe.fn.load=function(t,e,i){if("string"!=typeof t&&rn)return rn.apply(this,arguments);var n,r,o,s=this,a=t.indexOf(" ");return a>=0&&(n=t.slice(a,t.length),t=t.slice(0,a)),oe.isFunction(e)?(i=e,e=void 0):e&&"object"==typeof e&&(o="POST"),s.length>0&&oe.ajax({url:t,type:o,dataType:"html",data:e}).done(function(t){r=arguments,s.html(n?oe("<div>").append(oe.parseHTML(t)).find(n):t)}).complete(i&&function(t,e){s.each(i,r||[t.responseText,e,t])}),this},oe.expr.filters.animated=function(t){return oe.grep(oe.timers,function(e){return t===e.elem}).length};var on=t.document.documentElement;oe.offset={setOffset:function(t,e,i){var n,r,o,s,a,c,l,h=oe.css(t,"position"),u=oe(t),d={};"static"===h&&(t.style.position="relative"),a=u.offset(),o=oe.css(t,"top"),c=oe.css(t,"left"),l=("absolute"===h||"fixed"===h)&&oe.inArray("auto",[o,c])>-1,l?(n=u.position(),s=n.top,r=n.left):(s=parseFloat(o)||0,r=parseFloat(c)||0),oe.isFunction(e)&&(e=e.call(t,i,a)),null!=e.top&&(d.top=e.top-a.top+s),null!=e.left&&(d.left=e.left-a.left+r),"using"in e?e.using.call(t,d):u.css(d)}},oe.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){oe.offset.setOffset(this,t,e)});var e,i,n={top:0,left:0},r=this[0],o=r&&r.ownerDocument;return o?(e=o.documentElement,oe.contains(e,r)?(typeof r.getBoundingClientRect!==Ae&&(n=r.getBoundingClientRect()),i=U(o),{top:n.top+(i.pageYOffset||e.scrollTop)-(e.clientTop||0),left:n.left+(i.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}):n):void 0},position:function(){if(this[0]){var t,e,i={top:0,left:0},n=this[0];return"fixed"===oe.css(n,"position")?e=n.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),oe.nodeName(t[0],"html")||(i=t.offset()),i.top+=oe.css(t[0],"borderTopWidth",!0),i.left+=oe.css(t[0],"borderLeftWidth",!0)),{top:e.top-i.top-oe.css(n,"marginTop",!0),left:e.left-i.left-oe.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||on;t&&!oe.nodeName(t,"html")&&"static"===oe.css(t,"position");)t=t.offsetParent;return t||on})}}),oe.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var i=/Y/.test(e);oe.fn[t]=function(n){return Ee(this,function(t,n,r){var o=U(t);return void 0===r?o?e in o?o[e]:o.document.documentElement[n]:t[n]:void(o?o.scrollTo(i?oe(o).scrollLeft():r,i?r:oe(o).scrollTop()):t[n]=r)},t,n,arguments.length,null)}}),oe.each(["top","left"],function(t,e){oe.cssHooks[e]=_(ne.pixelPosition,function(t,i){return i?(i=ii(t,e),ri.test(i)?oe(t).position()[e]+"px":i):void 0
})}),oe.each({Height:"height",Width:"width"},function(t,e){oe.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,n){oe.fn[n]=function(n,r){var o=arguments.length&&(i||"boolean"!=typeof n),s=i||(n===!0||r===!0?"margin":"border");return Ee(this,function(e,i,n){var r;return oe.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+t],r["scroll"+t],e.body["offset"+t],r["offset"+t],r["client"+t])):void 0===n?oe.css(e,i,s):oe.style(e,i,n,s)},e,o?n:void 0,o,null)}})}),oe.fn.size=function(){return this.length},oe.fn.andSelf=oe.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return oe});var sn=t.jQuery,an=t.$;return oe.noConflict=function(e){return t.$===oe&&(t.$=an),e&&t.jQuery===oe&&(t.jQuery=sn),oe},typeof e===Ae&&(t.jQuery=t.$=oe),oe}),define("storm",[],function(){return{fillColor:"",points:{},palette:{},layout:{},sync:!0,locked:!1,type_upload:"",mathX:100,mathY:100,canMove:!0,activeDrag:null,eraseMode:!1,highlightMode:!1,processingPdf:!1,pathMode:!1,currentCanvas:null,currentBoardId:null,user:{},users:{},roles:{TEACHER:"role_teacher",STUDENT:"role_student",MONITOR:"role_monitor",ADMIN:"role_admin"},teachers:{},students:{},sessionStatus:0,enableDraw:!0,timer_started:!1,myTimer:null,parentBoardId:null,boardLoaded:{},canvases:{},dataBoards:[],canvasHeights:[],loadedPdf:[],loadedBackground:[],currentPages:[],currentBoardPage:[],currentBoardScale:[],totalPages:[],panigationInit:!1,pdfObj:[],currentScale:[],drawText:!1,eraserSize:20,eraserCorlor:"#FFF",highlightSize:16,highlightCorlor:"rgba(250,212,10,0.3)",modifyText:!1,currentCursor:"default",showingLoad:!1,lastTimeClick:0,canScaling:!0,containers:{},textEl:null,drawShape:!1,action:null,shapeArgs:null,currTool:null,xPoints:[],yPoints:[],xOffset:null,topScroll:0,yOffset:null,paletteName:null,associateText:{},focusInput:"stroke",palettes:{},Properties:{},$currActiveIcon:null,main:{},comm:{},events:{},hLine:{},vLine:{},horIndent:1,verIndent:1,indentMultiplier:10,imageTag:null,containerName:null,eventObj:{},layoutURL:null,undoStack:[],redoStack:[],groupCopyMode:!1,isUpdatingProperties:!1,started:!1,x:0,y:0,currentObj:{},reloadConfirm:!0,resetValue:function(){this.type_upload="",this.canMove=!0,this.activeDrag=null,this.eraseMode=!1,this.currentCanvas=null,this.currentBoardId=null,this.parentBoardId=null,this.boardLoaded={},this.canvases={},this.dataBoards=[],this.canvasHeights=[],this.loadedPdf=[],this.loadedBackground=[],this.currentPages=[],this.currentBoardPage=[],this.totalPages=[],this.panigationInit=!1,this.pdfObj=[],this.drawText=!1,this.modifyText=!1,this.currentCursor="default",this.showingLoad=!1,this.currentObj={},this.undoStack=[],this.redoStack=[]}}}),define("storm.ui",["storm"],function(t){var e={bodyWidth:null,bodyHeight:null,initialBodyWidth:$(window).width()>700?$(window).width():700,initialBodyHeight:$(window).height()>800?$(window).height():800,topPanelHeight:null,leftPanelWidth:null,leftPanelHeight:null,accordionContentHeight:null,canvasWidth:null,canvasHeight:null,deviceWidth:$(window).width()>700?$(window).width():700,deviceHeight:null,deiviceInnerHeight:null,deviceInnerWidth:null,initWidthAndHeightOfPanels:function(){this.topPanelHeight=100,this.leftPanelWidth=80},resizeWindow:function(){this.resizeBody(),this.resizeHeader(),this.resizeMainPanel(),this.resizeLeftPanel(),this.resizeCanvas(),this.resizeRightDiv()},resizeRightDiv:function(){var t=$(window).height()-63,e=$("#webcam").height(),i=$("#friendsicon").height(),n=$(".ui-widget-content #chat").height(),r=parseInt(t)-(parseInt(e)+parseInt(i)+parseInt(n));$(".ui-widget-content .listChat").height(r),$(".slimScrollDiv").height(r),$(".listChat").scrollTop($(".listChat #chattext").height())},resizeBody:function(){},resizeHeader:function(){},resizeMainPanel:function(){},resizeLeftPanel:function(){$("#leftdiv").height($(window).height())},resizeCanvas:function(){var e=$(".rightdiv").width();$("#boards-tab").width($(window).width()-(42+e)),$("#containerDiv").height($(window).height()-30),$("#containerDiv").width($(window).width()-(42+e)),$(".rightdiv").height($(window).height());var i=0,n=0;t.canvasHeights[t.currentBoardId]?(i=parseInt(t.canvasHeights[t.currentBoardId]),n=parseInt(t.canvasHeights[t.currentBoardId])):(i=this.deviceHeight,n=this.canvasHeight),$("#containerBody").height(i),$("#canvasId").height(i),$("#canvasId").width(this.deviceInnerWidth+80),canvas.setDimensions({width:parseInt(this.deviceInnerWidth)+80,height:n}),this.resizeBoardTabs()},resizeBoardTabs:function(){var t=$("#boards-tab").width()-60,e=$("#boards-tab ul li").length,i=t/e-1;i>140&&(i=140),$("#boards-tab ul li").width(i)},bindResizeWindow:function(){var t=this;$(window).resize(function(){t.initWidthAndHeightOfPanels(),t.resizeWindow(),t.drawHVLines()})},resetIconSelection:function(){t.$currActiveIcon&&(t.$currActiveIcon.attr("src",t.$currActiveIcon.attr("data-inactive")),t.$currActiveIcon.parent().parent().removeClass("shape-active"))},resetShapeSelection:function(){t.$currShape&&t.$currShape.removeClass("shape-selected")},setCanvasSize:function(){var t=this.canvasWidth,e=this.canvasHeight;canvas.setDimensions({width:t,height:e})},showLoading:function(){t.showingLoad=!0,$("#myModal").modal("hide"),$("#loading").show()},hideLoading:function(){t.showingLoad=!1,$("#loading").hide()},showDisconnecting:function(){$("body").append('<div class="modal-backdrop fade in disconnecting"><div class="alert-reconnecting"><b style="color: red">THÔNG BÁO</b><br/>1. Đã có lỗi liên quan đến internet xảy ra <br />2. Hệ thống đang kết nối lại <br /> 3. Vui lòng <span style="color: red">refresh, reload (Nhấn F5)</span> lại trình duyệt nếu đợi quá lâu <br>4. Gọi hỗ trợ nếu làm lại bước 3 nhiều lần nhưng vẫn không hết lỗi <br><b>Điện thoại hỗ trợ: </b> <span style="color: red;">0969496795</span> <br>Mã lỗi: NO#1</div></div>')},showMediaDisconnecting:function(){$("body").append('<div class="modal-backdrop fade in disconnecting"><div class="alert-reconnecting"><b style="color: red">THÔNG BÁO</b><br/>1. Đã có lỗi liên quan đến internet xảy ra <br />2. Hệ thống đang kết nối lại <br /> 3. Vui lòng <span style="color: red">refresh, reload (Nhấn F5)</span> lại trình duyệt nếu đợi quá lâu<br>4. Gọi hỗ trợ nếu làm lại bước 3 nhiều lần nhưng vẫn không hết lỗi <br><b>Điện thoại hỗ trợ: </b> <span style="color: red;">0969496795</span> <br>Mã lỗi: MEDIA#2</div></div>')},hideDisconnecting:function(){$("body .modal-backdrop").remove()},updateAccordian:function(t){$("#accordion").append('<div class="p-header p-close" data-accName="'+t+'"></div><div  class="p-cntr" data-paletteName="'+t+'" id="'+t+'"></div>')},drawHVLines:function(){canvas.remove(t.hLine),canvas.remove(t.vLine);var e=this.canvasWidth,i=this.canvasHeight;t.hLine=new fabric.Line([0,-10,e,-10],{enabled:!1,stroke:"#ff0000",left:e/2}),t.vLine=new fabric.Line([-10,0,-10,i],{enabled:!1,stroke:"#ff0000",top:i/2}),t.vLine.name="vline",t.hLine.name="hline",canvas.add(t.hLine),canvas.add(t.vLine),t.hLine.set("fill","#ff0000"),t.vLine.set("fill","#ff0000"),t.hLine.set("strokeWidth",".5"),t.vLine.set("strokeWidth",".5")}};return e}),function(){var t=this,e=t._,i={},n=Array.prototype,r=Object.prototype,o=Function.prototype,s=n.push,a=n.slice,c=n.concat,l=r.toString,h=r.hasOwnProperty,u=n.forEach,d=n.map,f=n.reduce,p=n.reduceRight,g=n.filter,m=n.every,v=n.some,b=n.indexOf,y=n.lastIndexOf,x=Array.isArray,w=Object.keys,C=o.bind,S=function(t){return t instanceof S?t:this instanceof S?void(this._wrapped=t):new S(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=S),exports._=S):t._=S,S.VERSION="1.6.0";var A=S.each=S.forEach=function(t,e,n){if(null==t)return t;if(u&&t.forEach===u)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,o=t.length;o>r;r++)if(e.call(n,t[r],r,t)===i)return}else for(var s=S.keys(t),r=0,o=s.length;o>r;r++)if(e.call(n,t[s[r]],s[r],t)===i)return;return t};S.map=S.collect=function(t,e,i){var n=[];return null==t?n:d&&t.map===d?t.map(e,i):(A(t,function(t,r,o){n.push(e.call(i,t,r,o))}),n)};var k="Reduce of empty array with no initial value";S.reduce=S.foldl=S.inject=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),f&&t.reduce===f)return n&&(e=S.bind(e,n)),r?t.reduce(e,i):t.reduce(e);if(A(t,function(t,o,s){r?i=e.call(n,i,t,o,s):(i=t,r=!0)}),!r)throw new TypeError(k);return i},S.reduceRight=S.foldr=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),p&&t.reduceRight===p)return n&&(e=S.bind(e,n)),r?t.reduceRight(e,i):t.reduceRight(e);var o=t.length;if(o!==+o){var s=S.keys(t);o=s.length}if(A(t,function(a,c,l){c=s?s[--o]:--o,r?i=e.call(n,i,t[c],c,l):(i=t[c],r=!0)}),!r)throw new TypeError(k);return i},S.find=S.detect=function(t,e,i){var n;return _(t,function(t,r,o){return e.call(i,t,r,o)?(n=t,!0):void 0}),n},S.filter=S.select=function(t,e,i){var n=[];return null==t?n:g&&t.filter===g?t.filter(e,i):(A(t,function(t,r,o){e.call(i,t,r,o)&&n.push(t)}),n)},S.reject=function(t,e,i){return S.filter(t,function(t,n,r){return!e.call(i,t,n,r)},i)},S.every=S.all=function(t,e,n){e||(e=S.identity);var r=!0;return null==t?r:m&&t.every===m?t.every(e,n):(A(t,function(t,o,s){return(r=r&&e.call(n,t,o,s))?void 0:i}),!!r)};var _=S.some=S.any=function(t,e,n){e||(e=S.identity);var r=!1;return null==t?r:v&&t.some===v?t.some(e,n):(A(t,function(t,o,s){return r||(r=e.call(n,t,o,s))?i:void 0}),!!r)};S.contains=S.include=function(t,e){return null==t?!1:b&&t.indexOf===b?-1!=t.indexOf(e):_(t,function(t){return t===e})},S.invoke=function(t,e){var i=a.call(arguments,2),n=S.isFunction(e);return S.map(t,function(t){return(n?e:t[e]).apply(t,i)})},S.pluck=function(t,e){return S.map(t,S.property(e))},S.where=function(t,e){return S.filter(t,S.matches(e))},S.findWhere=function(t,e){return S.find(t,S.matches(e))},S.max=function(t,e,i){if(!e&&S.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);var n=-1/0,r=-1/0;return A(t,function(t,o,s){var a=e?e.call(i,t,o,s):t;a>r&&(n=t,r=a)}),n},S.min=function(t,e,i){if(!e&&S.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);var n=1/0,r=1/0;return A(t,function(t,o,s){var a=e?e.call(i,t,o,s):t;r>a&&(n=t,r=a)}),n},S.shuffle=function(t){var e,i=0,n=[];return A(t,function(t){e=S.random(i++),n[i-1]=n[e],n[e]=t}),n},S.sample=function(t,e,i){return null==e||i?(t.length!==+t.length&&(t=S.values(t)),t[S.random(t.length-1)]):S.shuffle(t).slice(0,Math.max(0,e))};var T=function(t){return null==t?S.identity:S.isFunction(t)?t:S.property(t)};S.sortBy=function(t,e,i){return e=T(e),S.pluck(S.map(t,function(t,n,r){return{value:t,index:n,criteria:e.call(i,t,n,r)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index-e.index}),"value")};var O=function(t){return function(e,i,n){var r={};return i=T(i),A(e,function(o,s){var a=i.call(n,o,s,e);t(r,a,o)}),r}};S.groupBy=O(function(t,e,i){S.has(t,e)?t[e].push(i):t[e]=[i]}),S.indexBy=O(function(t,e,i){t[e]=i}),S.countBy=O(function(t,e){S.has(t,e)?t[e]++:t[e]=1}),S.sortedIndex=function(t,e,i,n){i=T(i);for(var r=i.call(n,e),o=0,s=t.length;s>o;){var a=o+s>>>1;i.call(n,t[a])<r?o=a+1:s=a}return o},S.toArray=function(t){return t?S.isArray(t)?a.call(t):t.length===+t.length?S.map(t,S.identity):S.values(t):[]},S.size=function(t){return null==t?0:t.length===+t.length?t.length:S.keys(t).length},S.first=S.head=S.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:0>e?[]:a.call(t,0,e)},S.initial=function(t,e,i){return a.call(t,0,t.length-(null==e||i?1:e))},S.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},S.rest=S.tail=S.drop=function(t,e,i){return a.call(t,null==e||i?1:e)},S.compact=function(t){return S.filter(t,S.identity)};var j=function(t,e,i){return e&&S.every(t,S.isArray)?c.apply(i,t):(A(t,function(t){S.isArray(t)||S.isArguments(t)?e?s.apply(i,t):j(t,e,i):i.push(t)}),i)};S.flatten=function(t,e){return j(t,e,[])},S.without=function(t){return S.difference(t,a.call(arguments,1))},S.partition=function(t,e){var i=[],n=[];return A(t,function(t){(e(t)?i:n).push(t)}),[i,n]},S.uniq=S.unique=function(t,e,i,n){S.isFunction(e)&&(n=i,i=e,e=!1);var r=i?S.map(t,i,n):t,o=[],s=[];return A(r,function(i,n){(e?n&&s[s.length-1]===i:S.contains(s,i))||(s.push(i),o.push(t[n]))}),o},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=function(t){var e=a.call(arguments,1);return S.filter(S.uniq(t),function(t){return S.every(e,function(e){return S.contains(e,t)})})},S.difference=function(t){var e=c.apply(n,a.call(arguments,1));return S.filter(t,function(t){return!S.contains(e,t)})},S.zip=function(){for(var t=S.max(S.pluck(arguments,"length").concat(0)),e=new Array(t),i=0;t>i;i++)e[i]=S.pluck(arguments,""+i);return e},S.object=function(t,e){if(null==t)return{};for(var i={},n=0,r=t.length;r>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},S.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return n=S.sortedIndex(t,e),t[n]===e?n:-1;n=0>i?Math.max(0,r+i):i}if(b&&t.indexOf===b)return t.indexOf(e,i);for(;r>n;n++)if(t[n]===e)return n;return-1},S.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=null!=i;if(y&&t.lastIndexOf===y)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var r=n?i:t.length;r--;)if(t[r]===e)return r;return-1},S.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=0,o=new Array(n);n>r;)o[r++]=t,t+=i;return o};var E=function(){};S.bind=function(t,e){var i,n;if(C&&t.bind===C)return C.apply(t,a.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return i=a.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,i.concat(a.call(arguments)));E.prototype=t.prototype;var r=new E;E.prototype=null;var o=t.apply(r,i.concat(a.call(arguments)));return Object(o)===o?o:r}},S.partial=function(t){var e=a.call(arguments,1);return function(){for(var i=0,n=e.slice(),r=0,o=n.length;o>r;r++)n[r]===S&&(n[r]=arguments[i++]);for(;i<arguments.length;)n.push(arguments[i++]);return t.apply(this,n)}},S.bindAll=function(t){var e=a.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return A(e,function(e){t[e]=S.bind(t[e],t)}),t},S.memoize=function(t,e){var i={};return e||(e=S.identity),function(){var n=e.apply(this,arguments);return S.has(i,n)?i[n]:i[n]=t.apply(this,arguments)}},S.delay=function(t,e){var i=a.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},S.defer=function(t){return S.delay.apply(S,[t,1].concat(a.call(arguments,1)))},S.throttle=function(t,e,i){var n,r,o,s=null,a=0;i||(i={});var c=function(){a=i.leading===!1?0:S.now(),s=null,o=t.apply(n,r),n=r=null};return function(){var l=S.now();a||i.leading!==!1||(a=l);var h=e-(l-a);return n=this,r=arguments,0>=h?(clearTimeout(s),s=null,a=l,o=t.apply(n,r),n=r=null):s||i.trailing===!1||(s=setTimeout(c,h)),o}},S.debounce=function(t,e,i){var n,r,o,s,a,c=function(){var l=S.now()-s;e>l?n=setTimeout(c,e-l):(n=null,i||(a=t.apply(o,r),o=r=null))};return function(){o=this,r=arguments,s=S.now();var l=i&&!n;return n||(n=setTimeout(c,e)),l&&(a=t.apply(o,r),o=r=null),a}},S.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},S.wrap=function(t,e){return S.partial(e,t)},S.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},S.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},S.keys=function(t){if(!S.isObject(t))return[];if(w)return w(t);var e=[];for(var i in t)S.has(t,i)&&e.push(i);return e},S.values=function(t){for(var e=S.keys(t),i=e.length,n=new Array(i),r=0;i>r;r++)n[r]=t[e[r]];return n},S.pairs=function(t){for(var e=S.keys(t),i=e.length,n=new Array(i),r=0;i>r;r++)n[r]=[e[r],t[e[r]]];return n},S.invert=function(t){for(var e={},i=S.keys(t),n=0,r=i.length;r>n;n++)e[t[i[n]]]=i[n];return e},S.functions=S.methods=function(t){var e=[];for(var i in t)S.isFunction(t[i])&&e.push(i);return e.sort()},S.extend=function(t){return A(a.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},S.pick=function(t){var e={},i=c.apply(n,a.call(arguments,1));return A(i,function(i){i in t&&(e[i]=t[i])}),e},S.omit=function(t){var e={},i=c.apply(n,a.call(arguments,1));for(var r in t)S.contains(i,r)||(e[r]=t[r]);return e},S.defaults=function(t){return A(a.call(arguments,1),function(e){if(e)for(var i in e)void 0===t[i]&&(t[i]=e[i])}),t},S.clone=function(t){return S.isObject(t)?S.isArray(t)?t.slice():S.extend({},t):t},S.tap=function(t,e){return e(t),t};var D=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof S&&(t=t._wrapped),e instanceof S&&(e=e._wrapped);var r=l.call(t);if(r!=l.call(e))return!1;switch(r){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var o=i.length;o--;)if(i[o]==t)return n[o]==e;var s=t.constructor,a=e.constructor;if(s!==a&&!(S.isFunction(s)&&s instanceof s&&S.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1;i.push(t),n.push(e);var c=0,h=!0;if("[object Array]"==r){if(c=t.length,h=c==e.length)for(;c--&&(h=D(t[c],e[c],i,n)););}else{for(var u in t)if(S.has(t,u)&&(c++,!(h=S.has(e,u)&&D(t[u],e[u],i,n))))break;if(h){for(u in e)if(S.has(e,u)&&!c--)break;h=!c}}return i.pop(),n.pop(),h};S.isEqual=function(t,e){return D(t,e,[],[])},S.isEmpty=function(t){if(null==t)return!0;if(S.isArray(t)||S.isString(t))return 0===t.length;for(var e in t)if(S.has(t,e))return!1;return!0},S.isElement=function(t){return!(!t||1!==t.nodeType)},S.isArray=x||function(t){return"[object Array]"==l.call(t)},S.isObject=function(t){return t===Object(t)},A(["Arguments","Function","String","Number","Date","RegExp"],function(t){S["is"+t]=function(e){return l.call(e)=="[object "+t+"]"}}),S.isArguments(arguments)||(S.isArguments=function(t){return!(!t||!S.has(t,"callee"))}),"function"!=typeof/./&&(S.isFunction=function(t){return"function"==typeof t}),S.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},S.isNaN=function(t){return S.isNumber(t)&&t!=+t},S.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==l.call(t)},S.isNull=function(t){return null===t},S.isUndefined=function(t){return void 0===t},S.has=function(t,e){return h.call(t,e)},S.noConflict=function(){return t._=e,this},S.identity=function(t){return t},S.constant=function(t){return function(){return t}},S.property=function(t){return function(e){return e[t]}},S.matches=function(t){return function(e){if(e===t)return!0;for(var i in t)if(t[i]!==e[i])return!1;return!0}},S.times=function(t,e,i){for(var n=Array(Math.max(0,t)),r=0;t>r;r++)n[r]=e.call(i,r);return n},S.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},S.now=Date.now||function(){return(new Date).getTime()};var I={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};I.unescape=S.invert(I.escape);var L={escape:new RegExp("["+S.keys(I.escape).join("")+"]","g"),unescape:new RegExp("("+S.keys(I.unescape).join("|")+")","g")};S.each(["escape","unescape"],function(t){S[t]=function(e){return null==e?"":(""+e).replace(L[t],function(e){return I[t][e]})}}),S.result=function(t,e){if(null==t)return void 0;var i=t[e];return S.isFunction(i)?i.call(t):i},S.mixin=function(t){A(S.functions(t),function(e){var i=S[e]=t[e];S.prototype[e]=function(){var t=[this._wrapped];return s.apply(t,arguments),F.call(this,i.apply(S,t))}})};var P=0;S.uniqueId=function(t){var e=++P+"";return t?t+e:e},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var M=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},R=/\\|'|\r|\n|\t|\u2028|\u2029/g;S.template=function(t,e,i){var n;i=S.defaults({},i,S.templateSettings);var r=new RegExp([(i.escape||M).source,(i.interpolate||M).source,(i.evaluate||M).source].join("|")+"|$","g"),o=0,s="__p+='";t.replace(r,function(e,i,n,r,a){return s+=t.slice(o,a).replace(R,function(t){return"\\"+B[t]}),i&&(s+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(s+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),r&&(s+="';\n"+r+"\n__p+='"),o=a+e.length,e}),s+="';\n",i.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{n=new Function(i.variable||"obj","_",s)}catch(a){throw a.source=s,a}if(e)return n(e,S);var c=function(t){return n.call(this,t,S)};return c.source="function("+(i.variable||"obj")+"){\n"+s+"}",c},S.chain=function(t){return S(t).chain()};var F=function(t){return this._chain?S(t).chain():t};S.mixin(S),A(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];S.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],F.call(this,i)}}),A(["concat","join","slice"],function(t){var e=n[t];S.prototype[t]=function(){return F.call(this,e.apply(this._wrapped,arguments))}}),S.extend(S.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return S})}.call(this),define("storm.util",["storm","underscore"],function(t,e){return{assertNotNull:function(t,e){if(null===t||null===t.palette||null===t.name)throw new Error(e);return!0},numbersonly:function(t,e,i){var n,r;if(window.event)n=window.event.keyCode;else{if(!e)return!0;n=e.which}return r=String.fromCharCode(n),null===n||0===n||8===n||9===n||13===n||27===n?!0:"0123456789".indexOf(r)>-1?!0:i&&"."===r?(t.form.elements[i].focus(),!1):!1},letternumber:function(t){var e,i;if(window.event)e=window.event.keyCode;else{if(!t)return!0;e=t.which}return i=String.fromCharCode(e),i=i.toLowerCase(),null===e||0===e||8===e||9===e||13===e||27===e?!0:"abcdefghijklmnopqrstuvwxyz0123456789".indexOf(i)>-1?!0:!1},getStringWidth:function(t){var e="20px delicious_500",i=$("<div id=div1>"+t+"</div>").css({position:"absolute","float":"left","white-space":"pre-wrap",visibility:"hidden",font:e}).appendTo($("body")),n=document.getElementById("div1").clientWidth;return i.remove(),n},getStringHeight:function(t){var e="20px delicious_500",i=$("<div id=div1>"+t+"</div>").css({position:"absolute","float":"left","white-space":"pre-wrap",visibility:"hidden",font:e}).appendTo($("body")),n=document.getElementById("div1").clientHeight;return i.remove(),n},uniqid:function(){var t=new Date;return this.randomString()+t.getTime()},randomString:function(){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",e=8,i="",n=0;for(n=0;e>n;n++){var r=Math.floor(Math.random()*t.length);i+=t.substring(r,r+1)}return i},getOffset:function(t){for(var e=0,i=0;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)e+=t.offsetLeft-t.scrollLeft,i+=t.offsetTop-t.scrollTop,t=t.offsetParent;return{top:i,left:e}},textForm:function(t){$("div.m-quick-edit").hide();var e='<select id="choose-font" class="effect-obj" name="font-size" style="width: 35px;">'+this.for_select_num(6,30,t.fontSize)+"</select>",i='<textarea id="inputsometext" class="effect-obj" uid="'+t.uid+'" name="text" style="resize:both;color:'+t.stroke+";min-height:20px; padding: 5px; min-width:50px;line-height:"+(t.fontSize+1)+"px;  overflow:hidden;font-size:"+t.fontSize+"px;font-family:"+t.fontFamily+";width:"+(t.currentWidth+10)+"px; min-width:150px; height: "+(t.currentHeight+13)+'px; ">'+t.text+"</textarea>",n='<span class="effect-obj" style="position:absolute;top:'+(t.oCoords.bl.y-t.currentHeight)+"px; left: "+(t.oCoords.bl.x-5)+'px;z-index:999999;"><div class="effect-obj" style="position: relative">';n+='<div class="effect-obj" style="position: absolute; top: -20px; left: 0px;">',n+=e,n+="</div>",n+=i,n+="</div></span>",$(".load-text-box").html(n),setTimeout(function(){$(".load-text-box").show(),$(".load-text-box textarea").focus()},300)},scalingForm:function(t){t.setCoords(),$("#canvasId .load-text-box span").css({top:t.oCoords.bl.y-t.currentHeight-9+"px",left:t.oCoords.bl.x-5+"px"}),$("#canvasId .load-text-box textarea").css({"line-height":t.fontSize+1+"px","font-size":t.fontSize+"px",width:t.currentWidth+10+"px",height:t.currentHeight+10+"px"})},getCanvasByBoardId:function(e){e||(e=t.currentBoardId);var i=$("#boards-tab ul li[data-holder="+e+"]").attr("data");if(!i)return canvas;var n=null;return n=t.canvases[i]?t.canvases[i]:t.canvases[i]=new fabric.Canvas(i,{backgroundImageStretch:!1}),n?n:canvas},changeText:function(e){var i=$(".load-text-box textarea"),n=$(e);if($(".load-text-box").is(":visible")&&!n.hasClass("effect-obj")){var r=i.attr("uid"),e=this.getObjectById(r,canvas);if(!e)return;var o=i.parents(".load-text-box").find("select[name='font-size']").val();this.scalingForm(e);var s=i.val();if(""==$.trim(s))return void this.removeAnObj(e);e.set("text",s),e.set("fontSize",parseInt(o)),t.drawText=!1,t.modifyText=!0,$(".load-text-box").hide(),setTimeout(function(){$(".s-pointer").click()},200),canvas.renderAll(),t.comm.sendDrawMsg({action:"modified",name:e.name,palette:e.palette,path:e.path,args:[{uid:e.uid,object:e}]}),t.drawText=!1,t.modifyText=!0,$(".load-text-box").hide()}},for_select_num:function(t,e,i){var n,r,o="";for(r=t;e>=r;r++)o=r==i?'selected="selected"':"",n+='<option class="effect-obj" value="'+r+'" '+o+">"+r+"</option>";return n},getObjectById:function(t,e){void 0==e&&(e=canvas);var i,n=e.getObjects();return n.forEach(function(e){e.uid===t&&(i=e)}),i},checkForImage:function(){var t=canvas.getObjects(),e=!1;return t.forEach(function(t){"image"===t.type&&(e=!0)}),e},getDefaultDataFromArray:function(t){if(void 0===t)return null;var e={},i=0;for(i=0;i<t.length;i++)e[t[i].name]=t[i].defaultvalue;return e},getPropertiesFromObject:function(t,e){if(void 0===t)return null;var i={},n=0;for(n=0;n<t.length;n++)i[t[n].name]=e[t[n].name];return i.height=e.height,i.width=e.width,i.paths=e.paths,i},INVISIBLE_OPACITY:.2,displayImage:function(e){(0==e.opacity||e.opacity==this.INVISIBLE_OPACITY)&&(e.opacity=t.user.canViewInvisibleImage()?this.INVISIBLE_OPACITY:0),canvas.renderAll()},removeAnObj:function(e){canvas.remove(e),canvas.renderAll(),console.log("remove obj"),t.comm.sendDrawMsg({action:"delete",args:[{uid:e.uid}]})},parseQuery:function(t){var e={},i=t.split("&");for(var n in i){var r=i[n].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e},updateURLParameter:function(t,e,n){var r="",o=t.split("?"),s=o[0],a=o[1],c="";if(a)for(o=a.split("&"),i=0;i<o.length;i++)o[i].split("=")[0]!=e&&(r+=c+o[i],c="&");var l=c+""+e+"="+n;return s+"?"+r+l},isAllowBoard:function(i){var n=t.dataBoards[i].students?t.dataBoards[i].students:[];return!t.sync&&t.user.role==t.roles.STUDENT&&e(n).size()>0&&!e(n).contains(t.user.userId)?!1:!0}}}),define("storm.palettes.properties",["storm","storm.util","storm.ui"],function(t,e){return{_applyProperties:function(i){keyPressed_letterNumber=function(t){return e.letternumber(t)},keyPressed_numbersOnly=function(t){return e.numbersonly(this,t)};$("#propdiv").append('<div id="prop"><table id="proptable"><tr><td bgcolor="#FFFFFF" border="1px" class= "cp" id="colorpicker"></td></tr></table></div>'),jQuery.each(i,function(e,i){var n=canvas.getActiveObject();if(i="angle"===e?n.getAngle():"source"===e?null==n[e]||void 0==n[e]?"http://":n[e]:n[e],"fill"===e||"stroke"===e)var r="<input style='width:100px' onKeyPress = keyPressed_letterNumber()  class= 'color' id='"+e+"' value='"+i+"'></input></div>";else if("text"===e)var r="<textarea cols=10 style='height:75px' id='"+e+"'>"+i+"</textarea>";else var r="<input type='text' style='width:100px' onKeyPress = keyPressed_numbersOnly() id='"+e+"' value='"+i+"'></input>";var o=$("#proptable");o.append("<tr class='"+e+"tr'><td ><label style = 'text-align: right' for='"+e+"'>"+e+": </label></td><td >"+r+"</td></tr>");var s=$("#"+e);("width"===e||"height"===e)&&s.closest("tr").hide(),s.keyup(function(){if(canvas.getActiveObject()){var i=canvas.getActiveObject(),n=$("#"+e).val();if(parseFloat(n)||"scaleX"!==e&&"scaleY"!==e||(n="0.01"),i.set(e,n),"angle"===e)i.setAngle(n);else if("source"===e&&-1!=n.search(/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/))return void fabric.Image.fromURL(n,function(e){e.set({left:i.left,top:i.top,scaleX:i.scaleX,scaleY:i.scaleY,source:n}),e.setAngle(i.getAngle()),e.setCoords(),e.name="image",e.uid=i.uid,e.palette="components",canvas.remove(i),canvas.add(e),canvas.renderAll(),t.comm.sendDrawMsg({action:"modified",args:[{uid:e.uid,object:e}]}),t.isUpdatingProperties=!0,canvas.setActiveObject(e),t.isUpdatingProperties=!1,t.quickMenu.showQuickMenu(e)});canvas.renderAll(),canvas.getActiveObject().setCoords(),t.comm.sendDrawMsg({action:"modified",args:[{uid:i.uid,object:i}]}),t.quickMenu.showQuickMenu(i)}})})},updatePropertyPanel:function(i){if(null!==t.palette[t.paletteName]&&!canvas.getActiveGroup()&&i&&i.name&&i.palette){var n=e.getDefaultDataFromArray(t.palette[t.paletteName].shapes[i.name].properties);jQuery.each(n,function(t){$("#"+t).val(i[t])}),i.getAngle()&&$("#angle").val(i.getAngle())}},createPropertiesPanel:function(i){if(i.palette&&i&&i.name){$("#prop").remove();var n=i.name;if(t.paletteName=i.palette,null===t.palette[t.paletteName])return;if(void 0===n)return;var r=e.getDefaultDataFromArray(t.palette[t.paletteName].shapes[n].properties);r&&(t.palette[t.paletteName].shapes[n].applyProperties?t.palette[t.paletteName].shapes[n].applyProperties(r):null)}}}}),define("storm.comm",["storm","storm.ui","storm.util"],function(t,e){function i(i){var n=baseUrl.replace("/","")+"socket.io",r={resource:n};this.socket=io.connect(i,r);var o=this;this.socket.on("containerDraw",function(t){o.drawContainerHandler(t)}),this.socket.on("eventDraw",function(t){o.drawHandler(t)}),this.socket.on("setBackground",function(t){o.setBackgroundHandler(t)}),this.socket.on("eventConnect",function(t){o.connectHandler(t)}),this.socket.on("connect_failed",function(){console.log("connect failed")}),this.socket.on("error",function(t){"handshake unauthorized"==t&&alert("Tài khoản bạn đang đăng nhập đã tham gia vào buổi học này ở một nơi khác. Xin vui lòng thử lại sau!"),console.log("connect error, reason: "+t)}),this.socket.on("disconnect",function(i){"booted"!=i?setTimeout(e.showDisconnecting,1e3):(alert("Bạn đã được Quản lý học tập mời ra khỏi lớp. Mọi thắc mắc xin vui lòng liên hệ 0969496795"),t.reloadConfirm=!1,window.location.reload())}),this.socket.on("kickUser",function(){t.comm.socket.disconnect()})}return function(){this.connectHandler=function(t){this.onConnect(t)},this.drawHandler=function(t){this.onDraw(t)},this.setBackgroundHandler=function(t){return t.background?canvas.setBackgroundColor({source:$.trim(t.background)},function(){canvas.renderAll()}):void 0},this.drawContainerHandler=function(t){this.onContainerDraw(t)},this.sendContainerInfo=function(e){this.socket.emit("setContainer",t.parentBoardId,e)},this.sendDrawMsg=function(e){e.boardId=t.currentBoardId,e.page=t.currentBoardPage[t.currentBoardId]?t.currentBoardPage[t.currentBoardId]:1,this.socket.emit("eventDraw",t.parentBoardId,e)},this.setBackground=function(e){e.boardId=t.currentBoardId,this.socket.emit("setBackground",t.parentBoardId,e)},this.onDraw=function(){},this.onConnect=function(i){e.hideDisconnecting();var n=document.location.pathname,r=n.replace("/",""),o=r.substr(r.lastIndexOf("/")+1);t.parentBoardId=o,$("#boards ul li:first").attr("data-holder",o),$("#boards ul li.tab-wb").remove(),$("#canvasAll .child-board-canvas").remove();for(var s in t.boardLoaded)t.boardLoaded[s]=!1;_(t.user).extend(i.user),this.socket.emit("setUrl",t.parentBoardId)}}.call(i.prototype),i
}),define("math.util",["storm","storm.util","storm.comm"],function(t,e){var i={mathEditID:$("#editable-math"),latexSource:$("#latex-source"),latex:null,init:function(){var t=this;return setTimeout(function(){t.createTools(),t.eventActionClick(),t.uploadLatex()},1500),t},uploadLatex:function(){var t=this;t.mathEditID.bind("keydown keyup",function(){setTimeout(function(){t.latex=t.mathEditID.mathquill("latex"),t.latexSource.val(t.latex)})}).keydown().focus(),t.latexSource.bind("keydown keypress, change",function(){setTimeout(function(){var e=t.latexSource.val();t.mathEditID.mathquill("latex",e),t.latex=e})})},updateLatex:function(){this.latex=this.mathEditID.mathquill("latex")},object:null,eventActionClick:function(){var t=this;$(".math_quill").on("click",".math_save",function(e){e.preventDefault(),t.latex?(t.saveLatexAndCreateObject(),t.resetEditor(),$(".s-pointer").click()):alert("Vui lòng nhập thông tin trước khi lưu")}),$(".math_quill").on("click",".math_cancel",function(e){e.preventDefault(),t.hiddenEditor(),t.resetEditor()})},resetEditor:function(){},hiddenEditor:function(){$(".math_quill").hide()},saveLatexAndCreateObject:function(){return this.hiddenEditor(),canvas.getActiveObject()?this.update():this.create()},createMathEditor:function(t,e,i){$(".math_quill").css({left:300,top:100}),this.latexSource.val(t),this.latexSource.trigger("change"),$(".math_quill").show()},getUrl:function(){return this.latex?"https://chart.googleapis.com/chart?cht=tx&chs=32&chl="+encodeURIComponent(this.latex):void 0},create:function(){var i="";i=this.getUrl();var n=this,r=e.getDefaultDataFromArray(t.palette.components.shapes.image.properties);r.uid=e.uniqid();var o=[r];o[0].name="image",o[0].src=i,o[0].source=i,o[0].latex=n.latex,o[0].top=t.mathY,o[0].left=t.mathX,o[0].type="math",o[0].showEditIcon=!0,o[0].scale=1,o[0].palette="components",o[0].opacity=1,t.palette.components.shapes.image.toolAction.apply(this,o),t.comm.sendDrawMsg({palette:"components",action:"image",args:o})},update:function(){var i=canvas.getActiveObject();if(""!=this.latex){var n=this.getUrl(),r=e.getDefaultDataFromArray(t.palette.components.shapes.image.properties),o=[r];i.latex=this.latex,i.src=n,i.showEditIcon=!0,o[0].name="image",i.palette="components",o[0].name="image",o[0].palette="components",o[0].uid=i.uid,o[0].object=i,o[0].width=i.width,o[0].height=i.height,o[0].top=i.top,o[0].left=i.left,o[0].scaleX=i.scaleX,o[0].scaleY=i.scaleY,o[0].latex=this.latex,o[0].showEditIcon=!0,o[0].src=n,t.palette.components.shapes.image.modifyAction.apply(this,o),t.comm.sendDrawMsg({palette:"components",action:"modified",args:[{uid:i.uid,object:o[0]}]})}},writeMathLatex:function(t){this.mathEditID.mathquill("write",t)},createIconTool:function(t){return'<i class="'+t+'">&nbsp;</i> '},toolsLatex:[{tabName:"basic",htmlValue:"Cơ bản",active:!0,button:[{htmlOptions:{style:"width:72px"},button_tools:[{latex:"\\frac{}{}","class":"latex-icon-fraction ",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\sqrt{}","class":"latex-icon-square-root",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"{}/{}","class":"latex-icon-bevelled-fraction",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\sqrt[]{}","class":"latex-icon-root",htmlOptions:{style:"width:30px;height:30px;"}}]},{htmlOptions:{style:"width:30px;border-right:none"},button_tools:[{latex:"{}^{}","class":"latex-icon-superscript",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"{}_{}","class":"latex-icon-suberscript",htmlOptions:{style:"width:30px;height:30px;"}}]},{htmlOptions:{style:"width:72px;"},button_tools:[{latex:"\\left(\\right)","class":"latex-icon-parentheses",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\left[\\right] ","class":"latex-icon-square-brackets",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\left|\\right|","class":"latex-icon-vertical-bars",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\left\\{\\right\\}","class":"latex-icon-curly-brackets",htmlOptions:{style:"width:30px;height:30px;"}}]},{htmlOptions:{style:"width:30px;border-right:none"},button_tools:[{latex:"\\int{}","class":"latex-icon-integral",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\int^{}_{}","class":"latex-icon-integral__",htmlOptions:{style:"width:30px;height:30px;"}}]},{htmlOptions:{style:"width:108px"},button_tools:[{latex:"\\sin({})","class":"latex-icon-sin",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\cos({})","class":"latex-icon-cos",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\tan({})","class":"latex-icon-tan",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\log","class":"latex-icon-log",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\log_{}","class":"latex-icon-log_",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\ln({})","class":"latex-icon-ln",htmlOptions:{style:"width:30px;height:30px;"}}]},{htmlOptions:{style:"width:72px;border-right:none"},button_tools:[{latex:"\\sum","class":"latex-icon-sum",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\sum^{}_{}","class":"latex-icon-sum__",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\prod{}","class":"latex-icon-coprod",htmlOptions:{style:"width:30px;height:30px;"}},{latex:"\\prod^{}_{}{}","class":"latex-icon-coprod__",htmlOptions:{style:"width:30px;height:30px;"}}]}]},{tabName:"dau",htmlValue:"Dấu",button:[{htmlOptions:{style:"width:55px"},button_tools:[{latex:"+","class":"latex-icon-plus-sign",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"-","class":"latex-icon-minus-sign",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\times","class":"latex-icon-multiplication-sign",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\div","class":"latex-icon-division-sign",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\pm","class":"latex-icon-plus-minus-sign",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"/","class":"latex-icon-forward-slash",htmlOptions:{style:"width:20px;height:20px;"}}]},{htmlOptions:{style:"width:52px"},button_tools:[{latex:"\\leftarrow","class":"latex-icon-leftwards-arrow",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\rightarrow","class":"latex-icon-rightwards-arrow",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\leftrightarrow","class":"latex-icon-left-right-arrow",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\Leftarrow","class":"latex-icon-leftwards-double-arrow",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\Rightarrow","class":"latex-icon-rightwards-double-arrow",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\Leftrightarrow","class":"latex-icon-left-right-double-arrow",htmlOptions:{style:"width:20px;height:20px;"}}]},{htmlOptions:{style:"width:78px"},button_tools:[{latex:"\\lt","class":"latex-icon-lt",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\gt","class":"latex-icon-gt",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\le","class":"latex-icon-le",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\ge","class":"latex-icon-ge",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\neq","class":"latex-icon-neq",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\sim","class":"latex-icon-sim",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\infty","class":"latex-icon-infty",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\equiv","class":"latex-icon-equiv",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"=",htmlValue:"=",htmlOptions:{style:"width:20px;height:20px;"}}]},{htmlOptions:{style:"width:78px;border-right:none"},button_tools:[{latex:"\\in","class":"latex-icon-in",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\ni","class":"latex-icon-ni",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\notin","class":"latex-icon-notin",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\notni","class":"latex-icon-notni",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\subset","class":"latex-icon-subset",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\supset","class":"latex-icon-supset",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\cap","class":"latex-icon-cap",htmlOptions:{style:"width:20px;height:20px;"}},{latex:"\\cup","class":"latex-icon-cup",htmlOptions:{style:"width:20px;height:20px;"}}]}]}],createToolsTabLatex:function(){var t,e='<ul class="nav nav-tabs">';return this.toolsLatex.forEach(function(i){t=i.active?'class="active"':"",e+="<li "+t+'><a href="#'+i.tabName+'_tab" data-toggle="tab">'+i.htmlValue+"</a></li>"}),e+="</ul>"},htmlOptionLatex:function(t){var e="";return t?($.each(t,function(t,i){e+=" "+t+" = "+i+" "}),e):e},createToolsTabContentLatex:function(){var t,e,i='<div class="tab-content">',n=this;return this.toolsLatex.forEach(function(r){t=r.active?"active":"",i+='<div class="tab-pane '+t+'" id="'+r.tabName+'_tab">',r.button.forEach(function(t){i+='<ul class="ul_tools_latex" '+n.htmlOptionLatex(t.htmlOptions)+">",t.button_tools.forEach(function(t){e=t.class?n.createIconTool(t.class):t.htmlValue,i+="<li><button "+n.htmlOptionLatex(t.htmlOptions)+' type="button" latex="'+t.latex+'">'+e+"</button></li>"}),i+="</ul>"}),i+='<div style="clear: both"></div></div>'}),i+="</div>"},createTools:function(){var t,e=this;$("#mathTools").append(this.createToolsTabLatex()),$("#mathTools").append(this.createToolsTabContentLatex()),$(".ul_tools_latex li button").click(function(){t=$(this).attr("latex"),e.writeMathLatex(t),e.latex=e.mathEditID.mathquill("latex"),e.latexSource.val(e.latex)})}};return i.init()}),define("board.scroll",["storm","storm.ui","storm.util"],function(t,e){function i(){$("#containerDiv").bind("scroll",function(){$("div.m-quick-edit").hide(),canvas.discardActiveObject(),e.resizeWindow(),l&&(clearTimeout(s),s=setTimeout(o,10))})}function n(t){var e=$("#containerDiv").scrollTop(),i=$("#containerDiv").scrollLeft(),n=$("#containerDiv").width(),r=$("#containerDiv").height();switch(t.direction){case"up":t.y1<e&&$("#containerDiv").scrollTop(t.y1);break;case"down":t.y2>e+r&&$("#containerDiv").scrollTop(t.y2-r);break;case"left":t.x1<i&&$("#containerDiv").scrollLeft(t.x1);break;case"right":t.x2>i+n&&$("#containerDiv").scrollLeft(t.x2-n)}}function r(){l=!1,setTimeout(function(){l=!0},50)}function o(){var e=$("#containerDiv").scrollTop(),i=$("#containerDiv").scrollLeft(),n=$("#containerDiv").width(),r=$("#containerDiv").height(),o="";e>a?o="down":a>e&&(o="up"),i>c?o="right":c>i&&(o="left"),a=e,c=i;var s=i,l=e,h=n+i,u=r+e;if(""!=o){var d={direction:o,x1:s,y1:l,x2:h,y2:u};t.comm.socket.emit("viewport",t.parentBoardId,d)}}var s,a=0,c=0,l=!0,h={init:function(){t.comm.socket.on("viewport",function(t){r(),n(t)}),i()},setScrollLeft:function(t){r(),$("#containerDiv").scrollLeft(t),e.resizeWindow()},setScrollTop:function(t){r(),$("#containerDiv").scrollTop(t),e.resizeWindow()}};return h}),define("board.mouse",["storm","storm.util","board.scroll"],function(t,e,i){function n(i,n){var r=e.getDefaultDataFromArray(t.palette.shapes.shapes.circle.properties),o=r.uid=e.uniqid();t.shapeArgs=[r],t.shapeArgs[0].name="circle",t.shapeArgs[0].width=t.shapeArgs[0].height=18,t.shapeArgs[0].left=i-9,t.shapeArgs[0].top=n-9,t.shapeArgs[0].stroke="red",t.shapeArgs[0].strokeWidth=1,t.shapeArgs[0].uid=o,t.shapeArgs[0].radius=9,t.shapeArgs[0].palette="shapes",t.palette.shapes.shapes.circle.toolAction.apply(this,t.shapeArgs);var s=canvas.item(canvas.getObjects().length-1);s.hasControls=!1,s.selectable=!1,canvas.renderAll();var a=5,c=2;for(a=15;60>a;a+=c){var l=e.getObjectById(o,canvas);a>57&&setTimeout(function(){var t=0;for(t=60;t>2;t-=1){var r=e.getObjectById(o,canvas);if(5>=t){canvas.remove(r),canvas.renderAll();break}r.top=n-t/2,r.left=i-t/2,r.width=t,r.height=t,r.radius=t/2,r.setCoords()}},300),l.width=a,l.height=a,l.radius=a/2,l.top=n-a/2,l.left=i-a/2,l.setCoords()}}var r={init:function(){t.comm.socket.on("mousePointClick",function(t){if(t.mouse_X&&t.mouse_Y){var e=$("#containerDiv").scrollTop(),r=$("#containerDiv").scrollLeft(),o=$("#containerDiv").width(),s=$("#containerDiv").height();if(t.mouse_X<r){var a=t.mouse_X<50?0:t.mouse_X-50;i.setScrollLeft(a)}else if(t.mouse_X>o+r){var a=t.mouse_X-$("#containerDiv").width()+50;i.setScrollLeft(a)}if(t.mouse_Y<e){var c=t.mouse_Y<50?0:t.mouse_Y-50;i.setScrollTop(c)}else if(t.mouse_Y>s+e){var c=t.mouse_Y-s+50;i.setScrollTop(c)}n(t.mouse_X,t.mouse_Y)}}),t.comm.socket.on("mousePointMove",function(t){t.mouse_X&&t.mouse_Y&&$("#remote_mouse").css({top:t.mouse_Y,left:t.mouse_X})}),t.comm.socket.on("mousePointStart",function(t){"start"==t.action?$("#remote_mouse").show():$("#remote_mouse").hide()})},mousePointClick:function(e){t.comm.socket.emit("mousePointClick",t.parentBoardId,e),n(e.mouse_X,e.mouse_Y)},mousePointStart:function(e){t.comm.socket.emit("mousePointStart",t.parentBoardId,e)},mousePointMove:function(e){document.location.pathname;t.comm.socket.emit("mousePointMove",t.parentBoardId,e)}};return r}),define("storm.events",["storm","storm.ui","storm.comm","storm.util","storm.palettes.properties","math.util","board.mouse"],function(t,e,i,n,r,o,s){function a(){t.shapeArgs[0].name=t.action,t.shapeArgs[0].palette=t.paletteName,t.palette[t.paletteName].shapes[t.action].toolAction.apply(this,t.shapeArgs),t.comm.sendDrawMsg({palette:t.paletteName,action:t.action,args:t.shapeArgs})}function c(){t.shapeArgs[0].name=t.action,t.shapeArgs[0].palette=t.paletteName,t.palette[t.paletteName].shapes[t.action].modifyAction.apply(this,t.shapeArgs)}function l(){t.shapeArgs[0].name=t.action,t.shapeArgs[0].palette=t.paletteName,t.palette[t.paletteName].shapes[t.action].modifyAction.apply(this,t.shapeArgs),t.comm.sendDrawMsg({palette:t.paletteName,action:"modified",args:t.shapeArgs})}function h(){var t=document.getElementById("popUpDiv"),e=document.getElementById("blanket");t&&"none"!=t.style.display&&(t.style.display="none"),e&&"none"!=e.style.display&&(e.style.display="none"),$(t).removeClass("scale-container"),$("div.m-submenu-list").hide()}function u(e){canvas.renderAll(),e.setCoords(),canvas.fire("object:moving",{target:e}),t.quickMenu.showQuickMenu(e),d(e)}function d(e){t.comm.sendDrawMsg({action:"modified",palette:e.palette,args:[{uid:e.uid,object:e}]})}function f(e,i){t.comm.sendDrawMsg({action:"zindexchange",name:e.name,palette:e.palette,args:[{uid:e.uid,object:e,change:i}]})}return{keyDown:function(e){var i=e?e:window.event?window.event:null;if(i&&0===$("#propdiv:visible").length){var n=i.charCode?i.charCode:i.keyCode?i.keyCode:i.which?i.which:0;if("46"==n)t.quickMenu.hideQuickMenu(),t.quickMenu.hideQuickMenuGroup();else if(t.drawText||t.modifyText)return!0;if("38"==n&&i.ctrlKey){var r=canvas.getActiveObject();r&&(canvas.bringForward(r),f(r,"forward"))}else if("40"==n&&i.ctrlKey){var r=canvas.getActiveObject();r&&(canvas.sendBackwards(r),f(r,"backward"))}else if("27"==n)i.preventDefault(),h();else if("37"==n&&i.shiftKey){var r=canvas.getActiveObject();if(r){var o=r.left;r.set("left",o-t.horIndent*t.indentMultiplier),u(r)}}else if("37"==n){var r=canvas.getActiveObject();if(r){var o=r.left;r.set("left",o-t.horIndent),u(r)}}else if("39"==n&&i.shiftKey){var r=canvas.getActiveObject(),o=r.left;r&&(r.set("left",o+t.horIndent*t.indentMultiplier),u(r))}else if("39"==n){var r=canvas.getActiveObject();if(r){var o=r.left;r.set("left",o+t.horIndent),u(r)}}else if("38"==n&&i.shiftKey){var r=canvas.getActiveObject();if(r){var s=r.top;r.set("top",s-t.verIndent*t.indentMultiplier),u(r)}}else if("38"==n){var r=canvas.getActiveObject();if(r){var s=r.top;r.set("top",s-t.verIndent),u(r)}}else if("40"==n&&i.shiftKey){var r=canvas.getActiveObject();if(r){var s=r.top;r.set("top",s+t.verIndent*t.indentMultiplier),u(r)}}else if("40"==n){var r=canvas.getActiveObject();if(r){var s=r.top;r.set("top",s+t.verIndent),u(r)}}}},mouseDown:function(e){var i=e.e.target;if("text"===t.action&&n.changeText(i),"math"===t.action){var r=canvas.getPointer(e.e);return t.mathX=r.x-parseInt(document.getElementById("canvasId").scrollLeft),t.mathY=r.y-parseInt(document.getElementById("canvasId").scrollTop),canvas.deactivateAll(),o.createMathEditor("",r.x+parseInt(document.getElementById("canvasId").scrollLeft),r.y+parseInt(document.getElementById("canvasId").scrollTop))}if("click"===t.action){var r=canvas.getPointer(e.e);t.x=r.x,t.y=r.y,s.mousePointClick({mouse_X:t.x,mouse_Y:t.y})}$("#border input").val();if(document.getElementById("delete_menuItem")&&0==e.button&&$("#delete_menuItem").remove(),!canvas.isDrawingMode&&t.drawShape)if(t.points.x=e.pageX+document.getElementById("canvasId").scrollLeft+document.getElementById("containerDiv").scrollLeft-t.xOffset,t.points.y=e.pageY+document.getElementById("canvasId").scrollTop+document.getElementById("containerDiv").scrollTop-t.yOffset,t.groupCopyMode){var c=canvas.getActiveGroup().getObjects(),l=[];$.each(c,function(i,r){t.action=r.name,t.paletteName=r.palette;var o=n.getPropertiesFromObject(t.palette[t.paletteName].shapes[t.action].properties,r);o.uid=n.uniqid(),t.shapeArgs=[o],t.shapeArgs[0].left=t.points.x+o.left,t.shapeArgs[0].top=t.points.y+o.top,l.push({palette:t.paletteName,action:t.action,args:t.shapeArgs}),a(e)}),t.groupCopyMode=!1,$("span.copy_icon","div.m-quick-edit-group").removeClass("selected")}else if(!canvas.isSelectMode){if(t.started=!0,"line"===t.action){var r=canvas.getPointer(e.e);t.x=r.x,t.y=r.y,t.shapeArgs[0].left=t.x,t.shapeArgs[0].top=t.y;var h=$("#color ul li.background ul li.click");if(0==h.length)var u="";else var u=h.attr("color");var d=$("#color ul li.border ul li.click").attr("color");if(t.shapeArgs[0].fill=u,t.shapeArgs[0].stroke=d,t.shapeArgs[0].width=t.shapeArgs[0].height=0,"line"===t.action){var f=[r.x,r.y,r.x,r.y];t.shapeArgs[0].points=f}a(e),canvas.setActiveObject(canvas.item(canvas.getObjects().length-1))}var p=e.target;if("text"==t.action)if(p&&"text"==p.type&&t.modifyText);else if(t.drawText){var r=canvas.getPointer(e.e);t.x=r.x,t.y=r.y,t.shapeArgs[0].left=t.x,t.shapeArgs[0].top=t.y;var h=$("#color ul li.background ul li.click");if(0==h.length)var u="";else var u=h.attr("color");var d=$("#color ul li.border ul li.click").attr("color");t.shapeArgs[0].fill=d,t.shapeArgs[0].textBackgroundColor=u,t.shapeArgs[0].stroke=d,t.shapeArgs[0].width=t.shapeArgs[0].height=0,t.shapeArgs[0].uid=n.uniqid(),a(e);var g=canvas.item(canvas.getObjects().length-1);g.fontSize=16,canvas.setActiveObject(g),n.textForm(g,!1)}}canvas.isDrawingMode&&(t.xPoints=[],t.yPoints=[],t.xPoints.push(e.pageX+document.getElementById("canvasId").scrollLeft+document.getElementById("containerDiv").scrollLeft-t.xOffset),t.yPoints.push(e.pageY+document.getElementById("canvasId").scrollTop+document.getElementById("containerDiv").scrollTop-t.yOffset))},contextMenu:function(e){var i=canvas.getActiveObject();if(i&&e.clientX-$("#canvasId").css("left").split("px")[0]-$("#leftdiv").css("width").split("px")[0]>=i.left-i.width/2&&e.clientX-$("#canvasId").css("left").split("px")[0]-$("#leftdiv").css("width").split("px")[0]<=i.left+i.width/2&&e.clientY-$("#canvasId").css("top").split("px")[0]-$("#header").css("height").split("px")[0]>=i.top-i.height/2&&e.clientY-$("#canvasId").css("top").split("px")[0]-$("#header").css("height").split("px")[0]<=i.top+i.height/2){e.preventDefault(),document.getElementById("delete_menuItem")&&$("#delete_menuItem").remove();var n=document.createElement("div");n.id="delete_menuItem",n.innerHTML="Delete",$("#_body").append(n),n.style.left=e.clientX+"px",n.style.top=e.clientY+"px",$("#delete_menuItem").click(function(){t.main.deleteObjects(),$("#delete_menuItem").css("display","none")}),$("#delete_menuItem").mouseenter(function(){$("#delete_menuItem").css("background-color","#ddd")}),$("#delete_menuItem").mouseleave(function(){$("#delete_menuItem").css("background-color","#eee")})}else document.getElementById("delete_menuItem")&&$("#delete_menuItem").remove()},mouseMove:function(e){if(t.eventObj=e,"text"==t.action)return!1;var i=canvas.getPointer(e.e);if("click"==t.action)return void s.mousePointMove({mouse_X:i.x,mouse_Y:i.y});if(!canvas.isDrawingMode&&!canvas.isSelectMode&&t.drawShape&&t.started)if(canvas.getActiveObject()){var n=canvas.getActiveObject(),r=Math.abs(i.x-t.x),o=Math.abs(i.y-t.y);if(!r||!o)return!1;i.x<t.x&&n.set("left",i.x),i.y<t.y&&n.set("top",i.y),n.set("width",r).set("height",o),t.shapeArgs[0].uid=n.uid,t.shapeArgs[0].object=n,"line"===t.action&&n.set({x2:i.x,y2:i.y}),c(e),canvas.renderAll()}else{if(t.x=i.x,t.y=i.y,!t.shapeArgs)return;t.shapeArgs[0].left=t.x,t.shapeArgs[0].top=t.y;var l=$("#color ul li.background ul li.click");if(0==l.length)var h="";else var h=l.attr("color");var u=$("#color ul li.border ul li.click").attr("color");if(t.shapeArgs[0].fill=h,t.shapeArgs[0].stroke=u,t.shapeArgs[0].width=t.shapeArgs[0].height=0,"line"===t.action){var d=[i.x,i.y,i.x,i.y];t.shapeArgs[0].points=d}a(e),canvas.setActiveObject(canvas.item(canvas.getObjects().length-1))}},mouseUp:function(e){if(t.started&&(t.started=!1),canvas.getActiveObject()&&t.drawShape&&"text"!=t.action&&!canvas.isDrawingMode){var i=(canvas.getPointer(e.e),canvas.getActiveObject());t.shapeArgs[0].uid=i.uid,t.shapeArgs[0].object=i,l(e),t.x=t.y=0,canvas.renderAll();var r=n.getDefaultDataFromArray(t.palette[t.paletteName].shapes[t.action].properties);r.uid=n.uniqid(),t.shapeArgs=[r],"text"!=i.type&&(i.selectable=!1,canvas.discardActiveObject())}},notifyServerGroupMoved:function(){var e=canvas.getActiveGroup(),i=e.getObjects();canvas.discardActiveGroup(),t.quickMenu.hideQuickMenuGroup(),i.forEach(function(t){d(t)})}}}),define("geometry.basic",["storm","storm.util"],function(t,e){var i={circleArc:[{id:"circleArc",self:null,object:null,event:null,remove:!1,create:function(t,e){this.event=t,this.self=e;var i=this,n=new fabric.Circle({left:i.event.mouse.x,top:i.event.mouse.y,strokeWidth:1,radius:1,fill:"#fff",opacity:.3,selectable:!1,strokeDashArray:[2,2]});canvas.add(n),this.object=n},update:function(){}}],vector:[{id:"line",self:null,object:null,event:null,remove:!1,style:{name:"line",fill:"red",stroke:"red",strokeWidth:1,selectable:!1,strokeDashArray:[14,13],type:"vector",palette:"shapes",uid:null},create:function(i,n){this.event=i,this.self=n,this.self.closestPoint(i,0),this.style.uid=e.uniqid();var r=[this.event.mouse.x,this.event.mouse.y,this.event.mouse.x,this.event.mouse.y],o=e.getDefaultDataFromArray(t.palette.shapes.shapes.line.properties);o.uid=this.style.uid,t.shapeArgs=[o],t.shapeArgs[0].name="line";var s=$("#color ul li.background ul li.click");if(0==s.length)var a="";else var a=s.attr("color");var c=$("#color ul li.border ul li.click").attr("color");this.style.fill=a,this.style.stroke=c,t.shapeArgs[0].style=this.style,t.shapeArgs[0].points=r,t.shapeArgs[0].palette="shapes";var l=t.palette.shapes.shapes.line.toolAction.apply(this,t.shapeArgs);this.object=l,t.comm.sendDrawMsg({palette:"shapes",action:"line",args:t.shapeArgs})},update:function(e){this.event=e;var i=this.object;i&&(this.self.drawingLines(e,i),i.set({x2:this.event.mouse.x,y2:this.event.mouse.y}),t.shapeArgs[0].object=i,t.palette.shapes.shapes.line.modifyAction.apply(this,t.shapeArgs))},getLength:function(){var t,e,i=this.object;return t=Math.max(this.event.mouse.x,i.x1)-Math.min(this.event.mouse.x,i.x1),e=Math.max(this.event.mouse.y,i.y1)-Math.min(this.event.mouse.y,i.y1),this.self.diagonalRectangle(t,e)},getArcTag:function(){var t,e,i=this.object;return t=Math.max(this.event.mouse.x,i.x1)-Math.min(this.event.mouse.x,i.x1),e=Math.max(this.event.mouse.y,i.y1)-Math.min(this.event.mouse.y,i.y1),Math.atan(e/t)},getAngle:function(){var t=this.object;return t.x1<=t.x2?this.getArcTag()/(Math.PI/180):180-this.getArcTag()/(Math.PI/180)}},{id:"lineLength",self:null,object:null,event:null,remove:!0,style:{fill:"red",stroke:"#666666",strokeWidth:1,selectable:!1,strokeDashArray:[1,3]},create:function(t,e){this.event=t,this.self=e;var i=new fabric.Line([this.event.mouse.x-5,this.event.mouse.y-5,this.event.mouse.x-5,this.event.mouse.y-5],this.style);canvas.add(i),this.object=i},update:function(t){this.event=t;var e=this.object;e&&e.set({x2:this.event.mouse.x-5,y2:this.event.mouse.y-5})}},{id:"lineVector",self:null,object:null,event:null,remove:!0,style:{fill:"red",stroke:"red",strokeWidth:.5,selectable:!1,strokeDashArray:[1,1]},create:function(t,e){this.event=t,this.self=e;var i=$("#color ul li.border ul li.click").attr("color");this.style.stroke=this.style.fill=i;var n=new fabric.Line([this.event.mouse.x,this.event.mouse.y,this.event.mouse.x+50,this.event.mouse.y],this.style);canvas.add(n),this.object=n},update:function(t){this.event=t}},{id:"length",self:null,object:null,event:null,remove:!0,style:{fontSize:13},create:function(t,e){this.event=t,this.self=e;var i=this,n=new fabric.Text("",{fontSize:13,left:i.event.mouse.x,top:i.event.mouse.y});canvas.add(n),this.object=n},update:function(t){this.event=t;var e=this.object;if(e){var i=this.self.getVectorById("line");e.set("text",""+Math.round(i.getLength()));var n,r;n=Math.min(i.object.x1,i.object.x2),r=Math.min(i.object.y1,i.object.y2),e.set({top:r+i.object.height/2-25,left:n+i.object.width/2-25})}}},{id:"angle",self:null,object:null,event:null,remove:!0,style:{fontSize:13},create:function(t,e){this.event=t,this.self=e;var i=this,n=new fabric.Text("",{left:i.event.mouse.x+15,top:i.event.mouse.y+15,oldLeft:i.event.mouse.x+15,oldTop:i.event.mouse.y+15});canvas.add(n),this.object=n,e.updateStyle(this)},update:function(t){this.event=t;var e=this.object;if(e){var i=this.self.getVectorById("line");e.top=i.object.y1<i.object.y2?e.oldTop:e.oldTop-45,e.set("text",""+Math.round(i.getAngle())+"°")}}},{id:"center",self:null,object:null,event:null,remove:!0,style:{fontSize:13},create:function(t,e){this.event=t,this.self=e;var i=this,n=new fabric.Circle({left:i.event.mouse.x,top:i.event.mouse.y,strokeWidth:1,radius:1,fill:"#fff",opacity:.3,selectable:!1,strokeDashArray:[2,2]});canvas.add(n),this.object=n},update:function(t){this.event=t;var e=this.object;if(e){var i=this.self.getVectorById("line");i.object.y1>i.object.y2?(e.piBy=0,e.sAngle=i.object.x1>i.object.x2?Math.PI+i.getArcTag():2*Math.PI-i.getArcTag()):(e.sAngle=0,e.piBy=i.object.x1<i.object.x2?i.getArcTag():Math.PI-i.getArcTag()),e.radius=20}}}],updateStyle:function(t){$.each(t.style,function(e,i){t.object.set(e,i)})},diagonalRectangle:function(t,e){var i=Math.pow(t,2)+Math.pow(e,2);return Math.sqrt(i)},removeEvent:function(){this.removeObjectVector(),$.each(this.vector,function(t,e){e.object=null})},removeObjectVector:function(){$.each(this.vector,function(t,e){1==e.remove&&canvas.remove(e.object)})},drawingLines:function(t,e){function i(){o=e.x1-(e.x1-t.mouse.x),s=e.y1}function n(){o=e.x1,s=t.mouse.y}function r(){if(c-a>=2*(l-h))i();else{if(!((l-h)/2>=c-a))return!1;n()}}var o,s,a=Math.min(t.mouse.x,e.x1),c=Math.max(t.mouse.x,e.x1),l=Math.max(t.mouse.y,e.y1),h=Math.min(t.mouse.y,e.y1);if(t.e.altKey&&e){var u=this.diagonalRectangle(e.x1-t.mouse.x,e.y1-t.mouse.y);u=Math.sqrt(Math.pow(u,2)/2),t.mouse.y<e.y1?(s=e.y1-u,t.mouse.x>e.x1?0==r()&&(o=e.x1+u):0==r()&&(o=e.x1-u)):(s=e.y1+u,t.mouse.x>e.x1?0==r()&&(o=e.x1+u):0==r()&&(o=e.x1-u)),t.mouse.x=o,t.mouse.y=s}},getObjectByType:function(t){var e=[],i=0;return canvas.getObjects().forEach(function(n){n.type==t&&(e[i]=n,i+=1)}),e},closestPoint:function(t,e){function i(t,e,i,n,r){var s,a,c,l,h,u,d,f,p,g,m=r.mouse,v=[];return s=Math.min(t,m.x),h=Math.max(t,m.x),a=Math.min(e,m.y),d=Math.max(e,m.y),c=Math.min(i,m.x),u=Math.max(i,m.x),l=Math.min(n,m.y),f=Math.max(n,m.y),p=o.diagonalRectangle(h-s,d-a),g=o.diagonalRectangle(u-c,f-l),g>p?(v.type="top",v.val=p):(v.type="bottom",v.val=g),v}var n,r=this.getObjectByType("vector"),o=this,s=Number.POSITIVE_INFINITY,a=(Number.NEGATIVE_INFINITY,[]);if(a.x=t.mouse.x,a.y=t.mouse.y,t.e.ctrlKey){for(var c=0;c<r.length-e;c++){var l=r[c];n=i(l.x1,l.y1,l.x2,l.y2,t),n.val<s&&(s=n.val,"top"==n.type?(a.x=l.x1,a.y=l.y1):(a.x=l.x2,a.y=l.y2))}t.mouse.x=a.x,t.mouse.y=a.y}},getVectorById:function(t){var e=null;return $.each(this.vector,function(i,n){n.id==t&&(e=n)}),e}};return i}),define("geometry.util",["storm"],function(){var t={init:function(){return this.setKeyCode(),this.setActionTools(),this.actionToolsDefault(),this},actionToolsDefault:function(){this.actionName=this.actionNameObject.existingRoads.action},keyCode:null,actionName:null,actionNameObject:{measureTraffic:{action:"measureTraffic",keyCode:"11",value:"mT"},hiddenSugar:{action:"hiddenSugar",keyCode:"12",value:"hS"},existingRoads:{action:"existingRoads",keyCode:"13",value:"eR"},pathAngle:{action:"pathAngle",keyCode:"14",value:"pA"}},setKeyCode:function(){var t=this;return $(window).keydown(function(e){t.keyCode=e.keyCode}).keyup(function(){t.keyCode=0}),this},setActionTools:function(){var t=this;return $(document).on("click",".shape-holder",function(){$(this).find("ul").show()}),$(document).on("click",".shape-holder ul li",function(){t.actionNameObject[$(this).attr("name")]&&($(".shape-holder ul li").removeClass("selected"),$(this).addClass("selected"),t.actionName=t.actionNameObject[$(this).attr("name")].action)}),$("body").click(function(t){"vector"!=$(t.target).attr("class")&&$(".shape-holder ul").hide()}),this}};return t.init()}),define("geometry.tools",["storm","storm.util","geometry.basic","geometry.util"],function(t,e,i,n){var r={vector:{setObject:function(t){var e=i.getVectorById("line");this.measureTraffic(e),this.hiddenSugar(e),this.existingRoads(t,e),this.pathAngle()},pathAngle:function(){var t=i.getVectorById("lineLength"),e=i.getVectorById("length"),r=i.getVectorById("line");"pathAngle"==n.actionName?(t.remove=!1,e.remove=!1,r.remove=!0):(t.remove=!0,e.remove=!0,r.remove=!1)},measureTraffic:function(t){t.remove="measureTraffic"==n.actionName?!0:!1},existingRoads:function(t,e){e.style.strokeDashArray=t.e.shiftKey?["2","2"]:null},hiddenSugar:function(t){t.style.strokeDashArray="hiddenSugar"==n.actionName?["2","2"]:null},onMouseDown:function(t){this.setObject(t),i.vector.forEach(function(e){e.create(t,i)}),canvas.renderAll()},onMouseMove:function(t){i.vector.forEach(function(e){e.update(t)}),canvas.renderAll()},onMouseUp:function(t){i.closestPoint(t,1),i.getVectorById("line").update(t),this.vectorEmit(),i.removeEvent(),canvas.renderAll()},vectorEmit:function(){i.vector.forEach(function(e){var i=e.object;0==e.remove&&(t.shapeArgs[0].object=i,t.palette.shapes.shapes.line.toolAction.apply(this,t.shapeArgs),t.comm.sendDrawMsg({palette:"shapes",action:"modified",args:t.shapeArgs}))})}},circleArc:{onMouseDown:function(t){i.circleArc.forEach(function(e){e.create(t,i)}),canvas.renderAll()},onMouseMove:function(t){i.circleArc.forEach(function(e){e.update(t)}),canvas.renderAll()},onMouseUp:function(){i.removeEvent(),canvas.renderAll()}}};return r}),define("storm.fabric",["storm","storm.util","storm.palettes.properties","storm.ui","storm.events","geometry.tools"],function(t,e,i,n,r,o){function s(){var t=canvas._resizeObject;canvas._resizeObject=function(e,i,n){var r=canvas._currentTransform.target,o={},s=["top","left","width","height"];s.forEach(function(t){o[t]=r[t]}),t.call(this,e,i,n),(r.width<1||r.height<1)&&s.forEach(function(t){r[t]=o[t]})}}function a(n){canvas.observe(n,function(s){switch(n){case"object:cleared":var a=s.target;a.setCoords();break;case"object:modified":if(canvas.getActiveGroup())return void r.notifyServerGroupMoved();var l=s.target;t.comm.sendDrawMsg({action:"modified",name:l.name,palette:l.palette,path:l.path,args:[{uid:l.uid,latex:l.latex?l.latex:"",showEditIcon:l.showEditIcon?l.showEditIcon:"",top:l.top,left:l.left,originX:l.originX,originY:l.originY,object:l}]}),t.hLine.set("top",-10),t.vLine.set("left",-10),i.updatePropertyPanel(a),t.quickMenu.showQuickMenu(l),l.setCoords();break;case"selection:created":break;case"selection:cleared":t.quickMenu.hideQuickMenu(),t.quickMenu.hideQuickMenuGroup();break;case"path:created":var h=s.path,u="path";h.uid=e.uniqid(),h.name="drawingpath",h.palette=t.paletteName;var a={action:"drawpath",type:u,palette:t.paletteName,args:[{uid:h.uid,left:h.left,top:h.top,originX:"center",originY:"center",width:h.width,height:h.height,path:h.path,name:h.name,strokeWidth:t.highlightMode?t.highlightSize:t.eraseMode?t.eraserSize:canvas.freeDrawingBrush.width,palette:t.paletteName,stroke:t.highlightMode?t.highlightCorlor:t.eraseMode?t.eraserCorlor:canvas.freeDrawingBrush.color}]};
t.comm.sendDrawMsg(a),t.xPoints=[],t.yPoints=[];break;case"object:selected":if(t.isUpdatingProperties)return;var d=s.target;if(d.strokeWidth&&$("#border input").val(d.strokeWidth),canvas.getActiveGroup())return void t.quickMenu.showQuickMenuGroup(d);t.quickMenu.showQuickMenu(d);break;case"object:moving":{s.target}$(".load-text-box").hide(),t.quickMenu.hideQuickMenu(),t.quickMenu.hideQuickMenuGroup();break;case"object:resizing":var f=s.target;f.setCoords();var p=[];p.push(f),t.palette[f.palette]&&(t.palette[f.palette].shapes[f.name].resizeAction?t.palette[f.palette].shapes[f.name].resizeAction.apply(null,p):null);break;case"object:scaling":var g=s.target,m=canvas.upperCanvasEl.style.cursor,v=g.originalState.left,b=g.originalState.top,y=g.width,x=g.currentWidth,w=g.height,C=g.currentHeight,S=0,A=0;"e-resize"==m?(S=y*g.scaleX,g.left=v+(S-x)/2):"w-resize"==m?(S=y*g.scaleX,g.left=v-(S-x)/2):"n-resize"==m?(A=w*g.scaleY,g.top=b-(A-C)/2):"s-resize"==m?(A=w*g.scaleY,g.top=b+(A-C)/2):"ne-resize"==m?(A=w*g.scaleY,g.top=b-(A-C)/2,S=y*g.scaleX,g.left=v+(S-x)/2):"nw-resize"==m?(A=w*g.scaleY,g.top=b-(A-C)/2,S=y*g.scaleX,g.left=v-(S-x)/2):"se-resize"==m?(A=w*g.scaleY,g.top=b+(A-C)/2,S=y*g.scaleX,g.left=v+(S-x)/2):"sw-resize"==m&&(A=w*g.scaleY,g.top=b+(A-C)/2,S=y*g.scaleX,g.left=v-(S-x)/2);break;case"mouse:down":if(s=c(s),o[t.action])return o[t.action].onMouseDown(s);r.mouseDown(s);break;case"mouse:move":if(s=c(s),o[t.action])return o[t.action].onMouseMove(s);r.mouseMove(s);break;case"mouse:up":if(s=c(s),o[t.action])return o[t.action].onMouseUp(s);r.mouseUp(s);break;case"object:added":t.enableDraw||(s.target.selectable=!1)}})}function c(t){return t.mouse=canvas.getPointer(t.e),t}return{initialize:function(){a("object:modified"),a("path:created"),a("selection:cleared"),a("object:cleared"),a("object:selected"),a("object:moving"),a("selection:created"),a("mouse:down"),a("mouse:move"),a("mouse:up"),a("object:added"),s()}}}),define("board.pdf",["storm","storm.ui"],function(t,e){function i(i,n){if(!t.pdfObj[n]){var r=t.dataBoards[n];try{PDFJS.getDocument(r.docUrl).then(function(i){if(!i)return e.hideLoading(),alert("Có lỗi xảy ra khi tải pdf, vui lòng thử lại!"),!1;t.pdfObj[r.boardId]=i,t.totalPages[r.boardId]=i.numPages,t.loadedPdf[r.boardId]=r.docUrl;t.currentPages[r.boardId]>0?t.currentPages[r.boardId]:1})}catch(o){e.hideLoading()}}t.pdfObj[n]&&t.pdfObj[n].getPage(i).then(function(r){if(t.processingPdf)return!1;t.processingPdf=!0,e.hideLoading(),canvas.clear(),t.boards.sendLoadBoard({boardId:n,page:i}),t.currentBoardPage[n]=i,t.currentPages[n]=i;var o=1;o=t.currentScale[n]&&parseFloat(t.currentScale[n])>0?parseFloat(t.currentScale[n]):canvas.width/r.getViewport(1).width,t.currentScale[n]=o;var s=100*o;s=Math.round(s),n==t.currentBoardId&&($("ul.navication .currentPage").val(i),$("input.c-percent").val(s));var a=r.getViewport(o);t.canvasHeights[n]=a.height,e.resizeWindow(),$("#pdf"+n).remove();var c=$("#boards ul li[data-holder="+n+"]").attr("data");0==$("#pdf"+n).length&&$("#"+c).parent().prepend("<canvas id='pdf"+n+"'></canvas>");var l=$("#pdf"+n)[0],h=l.getContext("2d");l.height=a.height,l.width=a.width;var u={canvasContext:h,viewport:a};r.render(u),t.processingPdf=!1})}function n(e,n){t.currentScale[n]=e,i(t.currentBoardPage[n],n)}function r(e){e=parseInt(e),e=e>200?200:e,e=50>e?50:e;var i=e/100;n(i,t.currentBoardId),s(i)}function o(e){var i={boardId:t.currentBoardId,docPage:e};t.comm.socket.emit("changePage",t.parentBoardId,i)}function s(e){var i={boardId:t.currentBoardId,docScale:e};t.comm.socket.emit("changeScale",t.parentBoardId,i)}function a(){$("#boards").on("click",".navication .nextPage",function(){var e=$(this).parent().find(".currentPage").val();if(e=parseInt(e),e<parseInt($(this).parent().find(".totalPage").html())){var n=e+1;o(n),i(n,t.currentBoardId),$(this).parent().find("select.currentPage").val(n)}}),$("#boards").on("change","select.currentPage",function(){var e=$(this).val();e=parseInt(e),e>0&&(o(e),i(e,t.currentBoardId))}),$("#boards").on("click",".navication ._zoonOut",function(){var t=$(this).parent().find(".c-percent"),e=parseInt(t.val());e=e;var e=e+5;r(e)}),$("#boards").on("click",".navication ._zoonIn",function(){var t=$(this).parent().find(".c-percent"),e=parseInt(t.val());e=e;var e=e-5;r(e)}),$("#boards").on("keypress",".c-percent",function(t){if(8!=t.which&&isNaN(String.fromCharCode(t.which))&&t.preventDefault(),13==t.keyCode){var e=parseInt($(this).val());r(e)}}),$("#boards").on("click",".navication .prevPage",function(){var e=$(this).parent().find(".currentPage").val();if(e=parseInt(e),e>1){var n=e-1;o(n),i(n,t.currentBoardId),$(this).parent().find(".currentPage").val(n)}})}function c(e){var i='<ul class="navication"><li class="_zoonIn"><a href="javascript:void(0)">-</a></li><li class="_currentPercent"><input type="text" class="c-percent" name="percent" value="100" />%</li><li class="_zoonOut"><a href="javascript:void(0)">+</a></li><li class="prevPage"><a href="javascript:void(0)">Prev</a></li><li class="currentPage">'+l(t.currentPages[t.currentBoardId],e)+'</li>/<li class="totalPage">'+e+'</li><li class="nextPage"><a href="javascript:void(0)">Next</a></li></ul>';return i}function l(t,e){var i=h(t,e);return'<select class="currentPage">'+i+"</select>"}function h(t,e){for(var i="",n=1;e>=n;n++)i+=n==t?'<option selected="selected" value="'+n+'">'+n+"</option>":'<option value="'+n+'">'+n+"</option>";return i}var u={init:function(){t.comm.socket.on("loadPdf",function(t){u.renderPdf(t)}),t.comm.socket.on("changePage",function(e){t.currentBoardPage[e.boardId]=e.docPage,t.currentPages[e.boardId]=e.docPage,i(e.docPage,e.boardId)}),t.comm.socket.on("changeScale",function(t){t.docScale&&n(t.docScale,t.boardId)}),a()},loadPdfOnBoard:function(e){var i=t.dataBoards[e];if(i&&i.docUrl||t.loadedPdf[e]){var n={};n.docUrl=i.docUrl,n.docPage=i.docPage?i.docPage:1,n.docScale=i.docScale?i.docScale:1,n.boardId=e,t.currentPages[e]=n.docPage,u.renderPdf(n)}},renderPdf:function(n){if(!n.docUrl||!n.boardId)return!1;t.sync&&(e.resizeWindow(),e.showLoading());try{PDFJS.getDocument(n.docUrl+"x").then(function(r){if(e.hideLoading(),!r)return alert("Có lỗi xảy ra khi tải pdf, vui lòng thử lại!"),!1;u.addFiles&&u.addFiles(n.docUrl),t.pdfObj[n.boardId]=r,t.totalPages[n.boardId]=r.numPages,t.loadedPdf[n.boardId]=n.docUrl,t.currentScale[n.boardId]=n.docScale;var o=t.currentPages[n.boardId]>0?t.currentPages[n.boardId]:1;$(".navication .currentPage").val(o),$(".navication .totalPage").html(t.totalPages[n.boardId]),u.appendPagination(r.numPages),n.docPage&&parseInt(n.docPage)>0?i(parseInt(n.docPage),n.boardId):i(1,n.boardId)},function(t){t&&(e.hideLoading(),alert("Đã có lỗi xảy ra với file vừa upload. Vui lòng thử lại hoặc upload file mới!"))})}catch(r){e.hideLoading()}return t.pdfObj},appendPagination:function(t){var e=c(t);$("#boards #nav").html(e)},addFiles:void 0};return u}),define("boards",["storm","storm.ui","storm.util","storm.fabric","storm.events","board.pdf","underscore"],function(t,e,i,n,r,o,s){function a(){$("#boards div#boards-tab ul").on("click","li a.link-board",function(){if(!(t.showingLoad||t.user.isStudent()&&t.sync)){var e=$(this).parent().attr("data-holder");g.setActiveBoard(e,!0)}}),$("#boards").on("click",".board-icon-setting",function(){if(!t.user.isStudent()){var e=$(this).parents("li.tab-wb");if(!e.hasClass("active"))return!1;var i=t.dataBoards[t.currentBoardId];$("#settingBoardName").val(i.name);var n=t.dataBoards[t.parentBoardId].users,r=i.students;if(s(r).isEmpty())var o='<input type="radio" name="boardPermmistion" onchange="$(\'#settingBoardName\').val($(this).next().text())" class="students"  id="student_0" value="0" checked> <label for="student_0" class="lab">Tất cả</label><br />';else var o='<input type="radio" name="boardPermmistion" onchange="$(\'#settingBoardName\').val($(this).next().text())" class="students"  id="student_0" value="0"> <label for="student_0" class="lab">Tất cả</label><br />';for(var a in n)n[a].role==t.roles.STUDENT&&(o+=r[0]&&r[0]==a?'<input type="radio" name="boardPermmistion" onchange="$(\'#settingBoardName\').val($(this).next().text())" class="students" id="student_'+a+'" value="'+a+'" checked> <label for="student_'+a+'" class="lab">'+n[a].name+"</label><br/>":'<input type="radio" name="boardPermmistion" onchange="$(\'#settingBoardName\').val($(this).next().text())" class="students" id="student_'+a+'" value="'+a+'"> <label for="student_'+a+'" class="lab">'+n[a].name+"</label><br/>");$("#roleAccessBoard").html(o),$("#boardSettings").modal("show")}}),$("#boards div#boards-tab .board-icon-add").click(function(){t.user.isStudent()||g.createChildBoard()}),$("#saveBoardSettings").click(function(){var e=$("#settingBoardName").val(),i=[],n=$('input[name="boardPermmistion"]:checked').val();n&&"0"!=n&&i.push(n),t.dataBoards[t.currentBoardId].students=i,t.dataBoards[t.currentBoardId].name=e;var r=$("#boards-tab").find("li[data-holder="+t.currentBoardId+"]");r.find("a.link-board span.boardName").html(e),$("#boardSettings").modal("hide"),u({boardId:t.currentBoardId,boardName:e,students:i})}),$("#boards div#boards-tab ul ").on("click","li span.board-icon-close",function(){if(!t.user.isStudent()){var e=$(this).parent().attr("data-holder"),i=$(this).parent().prev().attr("data-holder");g.removeTabToServer(e,i),g.removeChildBoard(e,i)}}),document.onkeydown=r.keyDown,$(".load-text-box").on("change","#choose-font",function(){$(".load-text-box textarea").css({"line-height":$(this).val()+"px","font-size":$(this).val()+"px"})}),$("#color ul ul li").click(function(){var e=$(this).attr("name"),i=$(this).attr("color");$("#color ul  ul li[name='"+e+"']").removeClass("click"),$(this).addClass("click"),$(this).parents("#color ul li").find("span.mau").css("background",i);var n=canvas.getActiveObject();"border"==e&&(canvas.freeDrawingBrush.color=i),n&&("background"==e?"text"==n.type?n.set("textBackgroundColor",i):n.set("fill",i):(e="border")&&(n.set("stroke",i),$(".load-text-box textarea").css("color",i)),canvas.renderAll(),t.comm.sendDrawMsg({action:"modified",name:n.name,palette:n.palette,path:n.path,args:[{uid:n.uid,object:n}]}))}),$("#border span").click(function(){var e=$(this).attr("class"),i=parseInt($("#border input[name='input-border']").val());"minus"==e?i>1&&$("#border input[name='input-border']").val(i-1):"plus"==e&&$("#border input[name='input-border']").val(1*i+1);var n=canvas.getActiveObject();n&&(n.set("strokeWidth",i),canvas.renderAll(),t.comm.sendDrawMsg({action:"modified",name:n.name,palette:n.palette,path:n.path,args:[{uid:n.uid,object:n}]}))}),$("body").click(function(t){var e=t.target;i.changeText(e)}),$(".rightdiv").click(function(){setTimeout(function(){e.resizeRightDiv()},100)})}function c(t){$("#boards div#boards-tab ul li.active span.setting").removeClass("board-icon-setting"),$("#boards div#boards-tab ul li.active span.remove").removeClass("board-icon-close"),$("#boards div#boards-tab ul li").removeClass("active"),$("#boards div#boards-tab ul li[data-holder="+t+"]").addClass("active"),$("#boards div#boards-tab ul li[data-holder="+t+"] span.setting").addClass("board-icon-setting"),$("#boards div#boards-tab ul li[data-holder="+t+"] span.remove").addClass("board-icon-close")}function l(e){t.comm.socket.emit("createTab",t.parentBoardId,e)}function h(e){t.comm.socket.emit("removeTab",t.parentBoardId,e)}function u(e){t.comm.socket.emit("setBoard",t.parentBoardId,e)}function d(e){t.comm.socket.emit("loadBoard",t.parentBoardId,e),t.boardLoaded[e.boardId]=!0}function f(e){t.comm.socket.emit("setActive",t.parentBoardId,e)}function p(){var t=$("#boards-tab ul li:last").attr("data"),e=t.split("canvas"),e=parseInt(e[1])+1;return"canvas"+e}var g={init:function(){this.createFabricCanvas("canvas0",!0),t.comm.socket.on("setBoard",function(t){g.setBoardFromServer(t)}),t.comm.socket.on("setActive",function(t){g.setActiveBoard(t.boardId,!1)}),t.comm.socket.on("createTab",function(e){g.createChildBoardFromServer(e.data),t.sync&&g.setActiveBoard(e.boardId,!1)}),t.comm.socket.on("removeTab",function(t){t.boardId&&t.activeBoardId&&g.removeChildBoard(t.boardId,t.activeBoardId)}),a()},setBoardFromServer:function(e){if(e.boardId&&e.boardName){var n=$("#boards-tab").find("li[data-holder="+e.boardId+"]");n.find("a.link-board span.boardName").html(e.boardName),t.dataBoards[e.boardId]&&(t.dataBoards[e.boardId].students=e.students,i.isAllowBoard(e.boardId)||$("#boards div#boards-tab ul li:first a.link-board").click())}},createChildBoardFromServer:function(i){t.dataBoards[i.boardId]=i;var n=p();this.appendBoard(n,i.name,i.boardId),i.boardId==t.currentBoardId?this.createNewCanvas(n,!0):this.createNewCanvas(n,!1),e.resizeBoardTabs()},setActiveBoard:function(n,r){if(void 0==t.dataBoards[n]&&(n=t.parentBoardId),(t.sync||r)&&i.isAllowBoard(n)){t.currentBoardId=n,c(n),t.quickMenu.hideQuickMenu(),t.quickMenu.hideQuickMenuGroup();var s=$("#boards div#boards-tab ul li[data-holder="+n+"]").attr("data");window.canvas=t.canvases[s],canvas.renderAll(),$(".shape-selected").length&&$(".shape-selected").click();var a=t.dataBoards[n];t.boardLoaded[n]?a&&a.docUrl||t.loadedPdf[n]?(o.appendPagination(t.totalPages[n]),$("input.c-percent").val(Math.round(100*t.currentScale[n])),$(".navication .currentPage").val(t.currentPages[n]),$(".navication .totalPage").html(t.totalPages[n]),$(".navication").show()):$(".navication").hide():(d({boardId:n}),o.loadPdfOnBoard(n),a&&a.background&&(canvas.setBackgroundColor({source:$.trim(a.background)},function(){canvas.renderAll()}),t.loadedBackground[n]=!0)),$("#boards .canvasIdActive").hide(),$("#boards .canvasIdActive[name='"+s+"'] ").show(),r&&f({boardId:n}),e.resizeWindow()}},createChildBoard:function(){var t=p(),i="Bảng "+t.substring(6);this.appendBoard(t,i,""),this.createTabToServer(i,function(t,e){g.setActiveBoard(e,!0)}),this.createNewCanvas(t,!0),e.resizeBoardTabs()},initFabricCanvas:function(){e.initWidthAndHeightOfPanels(),e.resizeWindow(),e.bindResizeWindow(),e.drawHVLines(),canvas.isSelectMode=!0,canvas.freeDrawingBrush.width=1,canvas.freeDrawingBrush.color="#000",t.xOffset=i.getOffset(document.getElementById("canvasId")).left+t.xOffset,t.yOffset=i.getOffset(document.getElementById("canvasId")).top+t.yOffset,n.initialize()},createFabricCanvas:function(e,i){window.canvas=t.canvases[e]=new fabric.Canvas(e,{backgroundImageStretch:!1}),i&&($("#boards .canvasIdActive").hide(),$("#boards .canvasIdActive[name='"+e+"'] ").show(),t.currentCanvas=document.getElementById(e)),this.initFabricCanvas()},createTabToServer:function(e,i){var n=[],r=e,o={parentId:t.parentBoardId,whiteboardName:r,students:n};$.post(baseUrl+"boards/createtab",o).done(function(e){e.success&&e.boardId&&e.data?(t.currentBoardId=e.boardId,t.dataBoards[e.boardId]=e.data,$("#boards div#boards-tab ul li:last").attr("data-holder",e.boardId),l({boardId:e.boardId,parentId:t.parentBoardId,students:n,name:r,data:e.data}),i&&i(null,e.boardId)):i&&i("create tab error")})},removeTabToServer:function(e,i){var n={boardId:e,activeBoardId:i};$.post(baseUrl+"boards/removetab",n).done(function(n){n.success&&(t.currentBoardId=t.parentBoardId,h({boardId:e,activeBoardId:i}))})},appendBoard:function(t,e,i){$(".navication").hide(),$("#boards div#boards-tab ul").append('<li data="'+t+'" data-holder="'+i+'" class="tab-wb"><a class="link-board" href="#"><span class="boardName">'+e+'</span></a><span class="setting" title="Chỉnh sửa, phân quyền" data-toggle="modal" data-target="boardSettings"></span><span class="remove" title="Xóa tab"></span></li>')},removeChildBoard:function(n,r){i.isAllowBoard(r)||(r=t.parentBoardId);var s=$("#boards div#boards-tab ul li[data-holder='"+n+"']").attr("data"),a=$("#boards div#boards-tab ul li[data-holder='"+r+"']").attr("data");$("#boards div#boards-tab ul li[data-holder='"+n+"']").remove(),$("#boards .canvasIdActive[name='"+s+"']").remove(),window.canvas=t.canvases[a],$("#boards .canvasIdActive").hide(),$("#boards .canvasIdActive[name='"+a+"'] ").show(),c(r),o.loadPdfOnBoard(r),t.boardLoaded[r]||d({boardId:r}),e.resizeBoardTabs()},createNewCanvas:function(t,e){$("#boards #canvasAll").append("<div class='canvasIdActive child-board-canvas' style='display: none' name='"+t+"'><canvas id='"+t+"'></canvas></div>"),this.createFabricCanvas(t,e)},sendLoadBoard:d};return g}),define("features/popup",["storm"],function(t){function e(){$("#help .board-icon-help").click(function(){i.showHelp()})}var i={init:function(){void 0==$.cookie("welcome-message")&&$.cookie("welcome-message",0),t.comm.socket.on("feedback",function(t){i.showFeedback(t)}),e()},showWelcome:function(){var t=$.cookie("welcome-message");2>t&&($("#welcome").modal("show"),t++,$.cookie("welcome-message",t))},showFeedback:function(e){if(e.form_url){var i=e.form_url,n=t.dataBoards[t.parentBoardId].users;_(n).each(function(e){return e.role==t.roles.TEACHER?(i=i.replace("teacher_name",e.name),!1):void 0}),t.user.role==t.roles.STUDENT&&(i=i.replace("student_name",t.user.name)),i=i.replace("session_id",t.dataBoards[t.parentBoardId].sessionId),$("#feedbackIF").attr("src",i),$("#feedback").modal({keyboard:!1,backdrop:"static"}),$("#feedback").modal("show")}},showHelp:function(){$("#welcome").modal("show")}};return i}),define("features/list-users",["storm","boards","underscore","features/popup"],function(t,e,i,n){function r(e){function r(i){i.role==t.roles.STUDENT?t.students[i.userId]=i:i.role==t.roles.TEACHER&&(t.teachers[i.userId]=i),t.users[i.userId]=i,e.add(i)}function o(e){e.role==t.roles.STUDENT?delete t.students[e.userId]:e.role==t.roles.TEACHER&&delete t.teachers[e.userId],delete t.users[e.userId]}var s=t.comm.socket;s.on("hello",function(t){r(t)}),s.on("bye",function(t){o(t),e.remove(t)}),s.on("joined",function(e){t.users={},i.each(e,function(t){r(t)}),s.emit("hello",t.user),n.showWelcome()})}function o(){$(".list-user").on("click","li span",function(){if(t.user.canKickUser()){var e=this;$(".list-user li span").each(function(t,i){$(i).html()!=$(e).html()&&$(i).popover("hide")}),$(this).popover("toggle")}}),$(".list-user").on("click","button.close",function(){var t=$(this).attr("data");$("#user"+t+" span").popover("hide")}),$(".list-user").on("click","button.js-leave",function(){var e=$(this).attr("data"),i=t.users[e].name;if(confirm("Bạn có chắc chắn loại học sinh "+i+" ra khỏi lớp không?")){{({boardId:t.parentBoardId})}t.comm.socket.emit("kickUser",t.parentBoardId,{userId:e}),$("#user"+e+" span").popover("hide")}})}function s(t){$("#user"+t+" span").popover({placement:"left",html:!0,trigger:"manual",container:".list-user",title:function(){var e='<button type="button" class="close" data="'+t+'">&times;</button>',i=$(this).html();return"<div>"+i+"&nbsp"+e+"</div>"},content:'<button type="button" class="btn btn-default js-leave" data="'+t+'">Rời lớp</button>'})}var a={init:function(){r(c()),o()},setMicroStatus:function(e,i){var n=t.users[e];if(void 0!=n&&t.user.userId!=e){var r=i&&""!=i?"micro board-icon-micro-"+i:"micro";n.role==t.roles.TEACHER?$("#teacher_area .micro").attr("class",r):$("#user"+e+" div .micro").attr("class",r)}}},c=function(){function e(e,i){var n=i.role==t.roles.TEACHER?"(GV) "+i.name:i.name;i.role!=t.roles.TEACHER||$("#teacher_area").attr("data")?0==$("li#user"+i.userId).length&&(e.append('<li id="user'+i.userId+'"><span>'+n+'</span><div class="action"><div class="micro"></div></div></li>'),i.userId==t.user.userId&&$("#user"+i.userId).attr("style","color: #245ba7"),s(i.userId)):($("#teacher_area .name").text(n),$("#teacher_area").attr("data",i.userId))}function i(t){$("#teacher_area").attr("data")==t.userId?($("#teacher_area .name").text(""),$("#teacher_area").removeAttr("data"),$("#teacher_area .micro").attr("class","micro")):$("#user"+t.userId).remove()}return{ul:$(".list-user"),add:function(t){e(this.ul,t)},remove:function(t){i(t)}}};return a});var Erizo=Erizo||{};Erizo.EventDispatcher=function(t){var e={};return t.dispatcher={},t.dispatcher.eventListeners={},e.addEventListener=function(e,i){void 0===t.dispatcher.eventListeners[e]&&(t.dispatcher.eventListeners[e]=[]),t.dispatcher.eventListeners[e].push(i)},e.removeEventListener=function(e,i){var n;n=t.dispatcher.eventListeners[e].indexOf(i),-1!==n&&t.dispatcher.eventListeners[e].splice(n,1)},e.dispatchEvent=function(e){var i;L.Logger.debug("Event: "+e.type);for(i in t.dispatcher.eventListeners[e.type])t.dispatcher.eventListeners[e.type].hasOwnProperty(i)&&t.dispatcher.eventListeners[e.type][i](e)},e},Erizo.LicodeEvent=function(t){var e={};return e.type=t.type,e},Erizo.RoomEvent=function(t){var e=Erizo.LicodeEvent(t);return e.streams=t.streams,e},Erizo.StreamEvent=function(t){var e=Erizo.LicodeEvent(t);return e.stream=t.stream,e.msg=t.msg,e},Erizo.PublisherEvent=function(t){return Erizo.LicodeEvent(t)},Erizo=Erizo||{},Erizo.FcStack=function(){return{addStream:function(){}}},Erizo=Erizo||{},Erizo.FirefoxStack=function(t){var e={},i=mozRTCPeerConnection,n=mozRTCSessionDescription,r=!1;return e.pc_config={iceServers:[]},void 0!==t.stunServerUrl&&e.pc_config.iceServers.push({url:t.stunServerUrl}),void 0===t.audio&&(t.audio=!0),void 0===t.video&&(t.video=!0),e.mediaConstraints={optional:[],mandatory:{OfferToReceiveAudio:t.audio,OfferToReceiveVideo:t.video,MozDontOfferDataChannel:!0}},e.roapSessionId=103,e.peerConnection=new i,e.peerConnection.onicecandidate=function(i){L.Logger.debug("PeerConnection: ",t.session_id),i.candidate?e.iceCandidateCount=e.iceCandidateCount+1:(L.Logger.debug("State: "+e.peerConnection.iceGatheringState),void 0===e.ices&&(e.ices=0),e.ices=e.ices+1,L.Logger.debug(e.ices),e.ices>=1&&e.moreIceComing&&(e.moreIceComing=!1,e.markActionNeeded()))},L.Logger.debug('Created webkitRTCPeerConnnection with config "'+JSON.stringify(e.pc_config)+'".'),e.processSignalingMessage=function(t){L.Logger.debug("Activity on conn "+e.sessionId),console.log(t),t=JSON.parse(t),e.incomingMessage=t,"new"===e.state?"OFFER"===t.messageType?(t={sdp:t.sdp,type:"offer"},e.peerConnection.setRemoteDescription(new n(t)),e.state="offer-received",e.markActionNeeded()):e.error("Illegal message for this state: "+t.messageType+" in state "+e.state):"offer-sent"===e.state?"ANSWER"===t.messageType?(t.sdp=t.sdp.replace(/ generation 0/g,""),t.sdp=t.sdp.replace(/ udp /g," UDP "),t={sdp:t.sdp,type:"answer"},L.Logger.debug("Received ANSWER: ",t.sdp),e.peerConnection.setRemoteDescription(new n(t)),e.sendOK(),e.state="established"):"pr-answer"===t.messageType?(t={sdp:t.sdp,type:"pr-answer"},e.peerConnection.setRemoteDescription(new n(t))):e.error("offer"===t.messageType?"Not written yet":"Illegal message for this state: "+t.messageType+" in state "+e.state):"established"===e.state&&("OFFER"===t.messageType?(t={sdp:t.sdp,type:"offer"},e.peerConnection.setRemoteDescription(new n(t)),e.state="offer-received",e.markActionNeeded()):e.error("Illegal message for this state: "+t.messageType+" in state "+e.state))},e.addStream=function(t){r=!0,e.peerConnection.addStream(t),e.markActionNeeded()},e.removeStream=function(){e.markActionNeeded()},e.close=function(){e.state="closed",e.peerConnection.close()},e.markActionNeeded=function(){e.actionNeeded=!0,e.doLater(function(){e.onstablestate()})},e.doLater=function(t){window.setTimeout(t,1)},e.onstablestate=function(){var t;if(e.actionNeeded){if("new"===e.state||"established"===e.state)L.Logger.debug("Creating offer"),r&&(e.mediaConstraints=void 0),function(){e.peerConnection.createOffer(function(t){var i=t.sdp;L.Logger.debug("Changed",t.sdp),i!==e.prevOffer?(e.peerConnection.setLocalDescription(t),e.state="preparing-offer",e.markActionNeeded()):L.Logger.debug("Not sending a new offer")},function(t){L.Logger.debug("Ups! Something went wrong ",t)},e.mediaConstraints)}();else if("preparing-offer"===e.state){if(e.moreIceComing)return;e.prevOffer=e.peerConnection.localDescription.sdp,L.Logger.debug("Sending OFFER: ",e.prevOffer),e.sendMessage("OFFER",e.prevOffer),e.state="offer-sent"}else if("offer-received"===e.state)e.peerConnection.createAnswer(function(t){e.peerConnection.setLocalDescription(t),e.state="offer-received-preparing-answer",e.iceStarted?e.markActionNeeded():(L.Logger.debug((new Date).getTime()+": Starting ICE in responder"),e.iceStarted=!0)},function(){L.Logger.debug("Ups! Something went wrong")});else if("offer-received-preparing-answer"===e.state){if(e.moreIceComing)return;t=e.peerConnection.localDescription.sdp,e.sendMessage("ANSWER",t),e.state="established"}else e.error("Dazed and confused in state "+e.state+", stopping here");e.actionNeeded=!1}},e.sendOK=function(){e.sendMessage("OK")},e.sendMessage=function(t,i){var n={};n.messageType=t,n.sdp=i,"OFFER"===t?(n.offererSessionId=e.sessionId,n.answererSessionId=e.otherSessionId,n.seq=e.sequenceNumber=e.sequenceNumber+1,n.tiebreaker=Math.floor(429496723*Math.random()+1)):(n.offererSessionId=e.incomingMessage.offererSessionId,n.answererSessionId=e.sessionId,n.seq=e.incomingMessage.seq),e.onsignalingmessage(JSON.stringify(n))},e.error=function(t){throw"Error in RoapOnJsep: "+t},e.sessionId=e.roapSessionId+=1,e.sequenceNumber=0,e.actionNeeded=!1,e.iceStarted=!1,e.moreIceComing=!0,e.iceCandidateCount=0,e.onsignalingmessage=t.callback,e.peerConnection.onopen=function(){e.onopen&&e.onopen()},e.peerConnection.onaddstream=function(t){e.onaddstream&&e.onaddstream(t)},e.peerConnection.onremovestream=function(t){e.onremovestream&&e.onremovestream(t)},e.peerConnection.oniceconnectionstatechange=function(t){e.oniceconnectionstatechange&&e.oniceconnectionstatechange(t.currentTarget.iceConnectionState)},e.onaddstream=null,e.onremovestream=null,e.state="new",e.markActionNeeded(),e},Erizo=Erizo||{},Erizo.ChromeStableStack=function(t){var e={},i=webkitRTCPeerConnection;e.pc_config={iceServers:[]},e.con={optional:[{DtlsSrtpKeyAgreement:!0}]},void 0!==t.stunServerUrl&&e.pc_config.iceServers.push({url:t.stunServerUrl}),(t.turnServer||{}).url&&e.pc_config.iceServers.push({username:t.turnServer.username,credential:t.turnServer.password,url:t.turnServer.url}),(void 0===t.audio||t.nop2p)&&(t.audio=!0),(void 0===t.video||t.nop2p)&&(t.video=!0),e.mediaConstraints={mandatory:{OfferToReceiveVideo:t.video,OfferToReceiveAudio:t.audio}},e.roapSessionId=103,e.peerConnection=new i(e.pc_config,e.con),e.peerConnection.onicecandidate=function(i){L.Logger.debug("PeerConnection: ",t.session_id),i.candidate?e.iceCandidateCount+=1:(L.Logger.debug("State: "+e.peerConnection.iceGatheringState),void 0===e.ices&&(e.ices=0),e.ices+=1,1<=e.ices&&e.moreIceComing&&(e.moreIceComing=!1,e.markActionNeeded()))};var n=function(e){if(t.maxVideoBW)var i=e.match(/m=video.*\r\n/),n=i[0]+"b=AS:"+t.maxVideoBW+"\r\n",e=e.replace(i[0],n);return t.maxAudioBW&&(i=e.match(/m=audio.*\r\n/),n=i[0]+"b=AS:"+t.maxAudioBW+"\r\n",e=e.replace(i[0],n)),e};return e.processSignalingMessage=function(t){L.Logger.debug("Activity on conn "+e.sessionId),console.log(t),t=JSON.parse(t),e.incomingMessage=t,"new"===e.state?"OFFER"===t.messageType?(t={sdp:t.sdp,type:"offer"},e.peerConnection.setRemoteDescription(new RTCSessionDescription(t)),e.state="offer-received",e.markActionNeeded()):e.error("Illegal message for this state: "+t.messageType+" in state "+e.state):"offer-sent"===e.state?"ANSWER"===t.messageType?(t={sdp:t.sdp,type:"answer"},L.Logger.debug("Received ANSWER: ",t.sdp),t.sdp=n(t.sdp),e.peerConnection.setRemoteDescription(new RTCSessionDescription(t)),e.sendOK(),e.state="established"):"pr-answer"===t.messageType?(t={sdp:t.sdp,type:"pr-answer"},e.peerConnection.setRemoteDescription(new RTCSessionDescription(t))):e.error("offer"===t.messageType?"Not written yet":"Illegal message for this state: "+t.messageType+" in state "+e.state):"established"===e.state&&("OFFER"===t.messageType?(t={sdp:t.sdp,type:"offer"},e.peerConnection.setRemoteDescription(new RTCSessionDescription(t)),e.state="offer-received",e.markActionNeeded()):e.error("Illegal message for this state: "+t.messageType+" in state "+e.state))},e.addStream=function(t){e.peerConnection.addStream(t),e.markActionNeeded()},e.removeStream=function(){e.markActionNeeded()},e.close=function(){e.state="closed",e.peerConnection.close()},e.markActionNeeded=function(){e.actionNeeded=!0,e.doLater(function(){e.onstablestate()})},e.doLater=function(t){window.setTimeout(t,1)},e.onstablestate=function(){var t;if(e.actionNeeded){if("new"===e.state||"established"===e.state)e.peerConnection.createOffer(function(t){t.sdp=n(t.sdp),L.Logger.debug("Changed",t.sdp),t.sdp!==e.prevOffer?(e.peerConnection.setLocalDescription(t),e.state="preparing-offer",e.markActionNeeded()):L.Logger.debug("Not sending a new offer")},null,e.mediaConstraints);else if("preparing-offer"===e.state){if(e.moreIceComing)return;e.prevOffer=e.peerConnection.localDescription.sdp,L.Logger.debug("Sending OFFER: "+e.prevOffer),e.sendMessage("OFFER",e.prevOffer),e.state="offer-sent"}else if("offer-received"===e.state)e.peerConnection.createAnswer(function(t){e.peerConnection.setLocalDescription(t),e.state="offer-received-preparing-answer",e.iceStarted?e.markActionNeeded():(L.Logger.debug((new Date).getTime()+": Starting ICE in responder"),e.iceStarted=!0)},null,e.mediaConstraints);else if("offer-received-preparing-answer"===e.state){if(e.moreIceComing)return;t=e.peerConnection.localDescription.sdp,e.sendMessage("ANSWER",t),e.state="established"}else e.error("Dazed and confused in state "+e.state+", stopping here");e.actionNeeded=!1}},e.sendOK=function(){e.sendMessage("OK")},e.sendMessage=function(t,i){var n={};n.messageType=t,n.sdp=i,"OFFER"===t?(n.offererSessionId=e.sessionId,n.answererSessionId=e.otherSessionId,n.seq=e.sequenceNumber+=1,n.tiebreaker=Math.floor(429496723*Math.random()+1)):(n.offererSessionId=e.incomingMessage.offererSessionId,n.answererSessionId=e.sessionId,n.seq=e.incomingMessage.seq),e.onsignalingmessage(JSON.stringify(n))},e.error=function(t){throw"Error in RoapOnJsep: "+t},e.sessionId=e.roapSessionId+=1,e.sequenceNumber=0,e.actionNeeded=!1,e.iceStarted=!1,e.moreIceComing=!0,e.iceCandidateCount=0,e.onsignalingmessage=t.callback,e.peerConnection.onopen=function(){e.onopen&&e.onopen()},e.peerConnection.onaddstream=function(t){e.onaddstream&&e.onaddstream(t)},e.peerConnection.onremovestream=function(t){e.onremovestream&&e.onremovestream(t)},e.peerConnection.oniceconnectionstatechange=function(t){e.oniceconnectionstatechange&&e.oniceconnectionstatechange(t.currentTarget.iceConnectionState)},e.onaddstream=null,e.onremovestream=null,e.state="new",e.markActionNeeded(),e},Erizo=Erizo||{},Erizo.ChromeCanaryStack=function(t){var e={},i=webkitRTCPeerConnection;e.pc_config={iceServers:[]},e.con={optional:[{DtlsSrtpKeyAgreement:!0}]},void 0!==t.stunServerUrl&&e.pc_config.iceServers.push({url:t.stunServerUrl}),(t.turnServer||{}).url&&e.pc_config.iceServers.push({username:t.turnServer.username,credential:t.turnServer.password,url:t.turnServer.url}),(void 0===t.audio||t.nop2p)&&(t.audio=!0),(void 0===t.video||t.nop2p)&&(t.video=!0),e.mediaConstraints={mandatory:{OfferToReceiveVideo:t.video,OfferToReceiveAudio:t.audio}},e.roapSessionId=103,e.peerConnection=new i(e.pc_config,e.con),e.peerConnection.onicecandidate=function(i){L.Logger.debug("PeerConnection: ",t.session_id),i.candidate?e.iceCandidateCount+=1:(L.Logger.debug("State: "+e.peerConnection.iceGatheringState),void 0===e.ices&&(e.ices=0),e.ices+=1,1<=e.ices&&e.moreIceComing&&(e.moreIceComing=!1,e.markActionNeeded()))};var n=function(e){if(t.maxVideoBW)var i=e.match(/m=video.*\r\n/),n=i[0]+"b=AS:"+t.maxVideoBW+"\r\n",e=e.replace(i[0],n);return t.maxAudioBW&&(i=e.match(/m=audio.*\r\n/),n=i[0]+"b=AS:"+t.maxAudioBW+"\r\n",e=e.replace(i[0],n)),e};return e.processSignalingMessage=function(t){L.Logger.debug("Activity on conn "+e.sessionId),t=JSON.parse(t),e.incomingMessage=t,"new"===e.state?"OFFER"===t.messageType?(t={sdp:t.sdp,type:"offer"},e.peerConnection.setRemoteDescription(new RTCSessionDescription(t)),e.state="offer-received",e.markActionNeeded()):e.error("Illegal message for this state: "+t.messageType+" in state "+e.state):"offer-sent"===e.state?"ANSWER"===t.messageType?(t={sdp:t.sdp,type:"answer"},L.Logger.debug("Received ANSWER: ",t.sdp),t.sdp=n(t.sdp),e.peerConnection.setRemoteDescription(new RTCSessionDescription(t)),e.sendOK(),e.state="established"):"pr-answer"===t.messageType?(t={sdp:t.sdp,type:"pr-answer"},e.peerConnection.setRemoteDescription(new RTCSessionDescription(t))):e.error("offer"===t.messageType?"Not written yet":"Illegal message for this state: "+t.messageType+" in state "+e.state):"established"===e.state&&("OFFER"===t.messageType?(t={sdp:t.sdp,type:"offer"},e.peerConnection.setRemoteDescription(new RTCSessionDescription(t)),e.state="offer-received",e.markActionNeeded()):e.error("Illegal message for this state: "+t.messageType+" in state "+e.state))
},e.addStream=function(t){e.peerConnection.addStream(t),e.markActionNeeded()},e.removeStream=function(){e.markActionNeeded()},e.close=function(){e.state="closed",e.peerConnection.close()},e.markActionNeeded=function(){e.actionNeeded=!0,e.doLater(function(){e.onstablestate()})},e.doLater=function(t){window.setTimeout(t,1)},e.onstablestate=function(){var t;if(e.actionNeeded){if("new"===e.state||"established"===e.state)e.peerConnection.createOffer(function(t){t.sdp=n(t.sdp),L.Logger.debug("Changed",t.sdp),t.sdp!==e.prevOffer?(e.peerConnection.setLocalDescription(t),e.state="preparing-offer",e.markActionNeeded()):L.Logger.debug("Not sending a new offer")},null,e.mediaConstraints);else if("preparing-offer"===e.state){if(e.moreIceComing)return;e.prevOffer=e.peerConnection.localDescription.sdp,L.Logger.debug("Sending OFFER: "+e.prevOffer),e.sendMessage("OFFER",e.prevOffer),e.state="offer-sent"}else if("offer-received"===e.state)e.peerConnection.createAnswer(function(t){e.peerConnection.setLocalDescription(t),e.state="offer-received-preparing-answer",e.iceStarted?e.markActionNeeded():(L.Logger.debug((new Date).getTime()+": Starting ICE in responder"),e.iceStarted=!0)},null,e.mediaConstraints);else if("offer-received-preparing-answer"===e.state){if(e.moreIceComing)return;t=e.peerConnection.localDescription.sdp,e.sendMessage("ANSWER",t),e.state="established"}else e.error("Dazed and confused in state "+e.state+", stopping here");e.actionNeeded=!1}},e.sendOK=function(){e.sendMessage("OK")},e.sendMessage=function(t,i){var n={};n.messageType=t,n.sdp=i,"OFFER"===t?(n.offererSessionId=e.sessionId,n.answererSessionId=e.otherSessionId,n.seq=e.sequenceNumber+=1,n.tiebreaker=Math.floor(429496723*Math.random()+1)):(n.offererSessionId=e.incomingMessage.offererSessionId,n.answererSessionId=e.sessionId,n.seq=e.incomingMessage.seq),e.onsignalingmessage(JSON.stringify(n))},e.error=function(t){throw"Error in RoapOnJsep: "+t},e.sessionId=e.roapSessionId+=1,e.sequenceNumber=0,e.actionNeeded=!1,e.iceStarted=!1,e.moreIceComing=!0,e.iceCandidateCount=0,e.onsignalingmessage=t.callback,e.peerConnection.onopen=function(){e.onopen&&e.onopen()},e.peerConnection.onaddstream=function(t){e.onaddstream&&e.onaddstream(t)},e.peerConnection.onremovestream=function(t){e.onremovestream&&e.onremovestream(t)},e.peerConnection.oniceconnectionstatechange=function(t){e.oniceconnectionstatechange&&e.oniceconnectionstatechange(t.currentTarget.iceConnectionState)},e.onaddstream=null,e.onremovestream=null,e.state="new",e.markActionNeeded(),e},Erizo=Erizo||{},Erizo.sessionId=103,Erizo.Connection=function(t){var e={};if(t.session_id=Erizo.sessionId+=1,e.browser="","undefined"!=typeof module&&module.exports)L.Logger.error("Publish/subscribe video/audio streams not supported in erizofc yet"),e=Erizo.FcStack(t);else if(null!==window.navigator.userAgent.match("Firefox"))e.browser="mozilla",e=Erizo.FirefoxStack(t);else if(26<=window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1])L.Logger.debug("Stable"),e=Erizo.ChromeStableStack(t),e.browser="chrome-stable";else{if("25"!==window.navigator.appVersion.match(/Bowser\/([\w\W]*?)\./)[1])throw e.browser="none","WebRTC stack not available";e.browser="bowser"}return e},Erizo.GetUserMedia=function(t,e,i){if(navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,t.screen)if(L.Logger.debug("Screen access requested"),34<=!window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1])i({code:"This browser does not support screen sharing"});else{var n="okeephmleflklcdebijnponpabbmmgeo";t.extensionId&&(L.Logger.debug("extensionId supplied, using "+t.extensionId),n=t.extensionId),L.Logger.debug("Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(n,{getStream:!0},function(n){void 0==n?(L.Logger.debug("Access to screen denied"),i({code:"Access to screen denied"})):(t={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n.streamId}}},navigator.getMedia(t,e,i))})}catch(r){L.Logger.debug("Lynckia screensharing plugin is not accessible "),i({code:"no_plugin_present"})}}else"undefined"!=typeof module&&module.exports?L.Logger.error("Video/audio streams not supported in erizofc yet"):navigator.getMedia(t,e,i)},Erizo=Erizo||{},Erizo.Stream=function(t){var e,i=Erizo.EventDispatcher(t);if(i.stream=t.stream,i.url=t.url,i.recording=t.recording,i.room=void 0,i.showing=!1,i.local=!1,i.video=t.video,i.audio=t.audio,i.screen=t.screen,i.videoSize=t.videoSize,i.extensionId=t.extensionId,!(void 0===i.videoSize||i.videoSize instanceof Array&&4==i.videoSize.length))throw Error("Invalid Video Size");return(void 0===t.local||!0===t.local)&&(i.local=!0),i.getID=function(){return t.streamID},i.getAttributes=function(){return t.attributes},i.setAttributes=function(){L.Logger.error("Failed to set attributes data. This Stream object has not been published.")},i.updateLocalAttributes=function(e){t.attributes=e},i.hasAudio=function(){return t.audio},i.hasVideo=function(){return t.video},i.hasData=function(){return t.data},i.hasScreen=function(){return t.screen},i.sendData=function(){L.Logger.error("Failed to send data. This Stream object has not that channel enabled.")},i.init=function(){try{if((t.audio||t.video||t.screen)&&void 0===t.url){L.Logger.debug("Requested access to local media");var e=t.video;1==e&&void 0!==i.videoSize&&(e={mandatory:{minWidth:i.videoSize[0],minHeight:i.videoSize[1],maxWidth:i.videoSize[2],maxHeight:i.videoSize[3]}});var n={video:e,audio:t.audio,fake:t.fake,screen:t.screen,extensionId:i.extensionId};L.Logger.debug(n),Erizo.GetUserMedia(n,function(t){L.Logger.info("User has granted access to local media."),i.stream=t,t=Erizo.StreamEvent({type:"access-accepted"}),i.dispatchEvent(t)},function(t){L.Logger.error("Failed to get access to local media. Error code was "+t.code+"."),t=Erizo.StreamEvent({type:"access-denied"}),i.dispatchEvent(t)})}else{var r=Erizo.StreamEvent({type:"access-accepted"});i.dispatchEvent(r)}}catch(o){L.Logger.error("Error accessing to local media",o)}},i.close=function(){i.local&&(void 0!==i.room&&i.room.unpublish(i),i.hide(),void 0!==i.stream&&i.stream.stop(),i.stream=void 0)},i.play=function(t,e){if(e=e||{},i.elementID=t,i.hasVideo()||this.hasScreen()){if(void 0!==t){var n=new Erizo.VideoPlayer({id:i.getID(),stream:i,elementID:t,options:e});i.player=n,i.showing=!0}}else i.hasAudio&&(n=new Erizo.AudioPlayer({id:i.getID(),stream:i,elementID:t,options:e}),i.player=n,i.showing=!0)},i.stop=function(){i.showing&&void 0!==i.player&&(i.player.destroy(),i.showing=!1)},i.show=i.play,i.hide=i.stop,e=function(){if(void 0!==i.player&&void 0!==i.stream){var t=i.player.video,e=document.defaultView.getComputedStyle(t),n=parseInt(e.getPropertyValue("width"),10),r=parseInt(e.getPropertyValue("height"),10),o=parseInt(e.getPropertyValue("left"),10),e=parseInt(e.getPropertyValue("top"),10),s=document.getElementById(i.elementID),a=document.defaultView.getComputedStyle(s),s=parseInt(a.getPropertyValue("width"),10),a=parseInt(a.getPropertyValue("height"),10),c=document.createElement("canvas");return c.id="testing",c.width=s,c.height=a,c.setAttribute("style","display: none"),c.getContext("2d").drawImage(t,o,e,n,r),c}return null},i.getVideoFrameURL=function(t){var i=e();return null!==i?t?i.toDataURL(t):i.toDataURL():null},i.getVideoFrame=function(){var t=e();return null!==t?t.getContext("2d").getImageData(0,0,t.width,t.height):null},i},Erizo=Erizo||{},Erizo.Room=function(t){var e,i,n,r,o,s,a=Erizo.EventDispatcher(t);return a.remoteStreams={},a.localStreams={},a.roomID="",a.socket={},a.state=0,a.p2p=!1,a.addEventListener("room-disconnected",function(){var t,e;a.state=0;for(t in a.remoteStreams)a.remoteStreams.hasOwnProperty(t)&&(e=a.remoteStreams[t],s(e),delete a.remoteStreams[t],e=Erizo.StreamEvent({type:"stream-removed",stream:e}),a.dispatchEvent(e));a.remoteStreams={};for(t in a.localStreams)a.localStreams.hasOwnProperty(t)&&(e=a.localStreams[t],e.pc.close(),delete a.localStreams[t]);try{a.socket.disconnect()}catch(i){L.Logger.debug("Socket already disconnected")}a.socket=void 0}),s=function(t){void 0!==t.stream&&(t.hide(),t.pc.close(),t.local&&t.stream.stop())},r=function(t,e){t.local?i("sendDataStream",{id:t.getID(),msg:e}):L.Logger.error("You can not send data through a remote stream")},o=function(t,e){t.local?(t.updateLocalAttributes(e),i("updateStreamAttributes",{id:t.getID(),attrs:e})):L.Logger.error("You can not update attributes in a remote stream")},e=function(e,r,o){var c=e.host,l="socket.io",h=e.host.indexOf("/"),u=e.host.indexOf(":");-1!==h&&(c=e.host.substring(0,h)+":"+e.host.substring(u+1,e.host.length),l=e.host.substring(h+1,u)+"/"+l),a.socket=io.connect(c,{reconnect:!1,secure:e.secure,"force new connection":!0,resource:l}),a.socket.on("onAddStream",function(t){var e=Erizo.Stream({streamID:t.id,local:!1,audio:t.audio,video:t.video,data:t.data,screen:t.screen,attributes:t.attributes});a.remoteStreams[t.id]=e,t=Erizo.StreamEvent({type:"stream-added",stream:e}),a.dispatchEvent(t)}),a.socket.on("onSubscribeP2P",function(t){var e=a.localStreams[t.streamId];void 0===e.pc&&(e.pc={}),e.pc[t.subsSocket]=Erizo.Connection({callback:function(i){n("publish",{state:"p2pSignaling",streamId:t.streamId,subsSocket:t.subsSocket},i,function(i){"error"===i&&callbackError&&callbackError(i),e.pc[t.subsSocket].onsignalingmessage=function(){e.pc[t.subsSocket].onsignalingmessage=function(){}},e.pc[t.subsSocket].processSignalingMessage(i)})},audio:e.hasAudio(),video:e.hasVideo(),stunServerUrl:a.stunServerUrl,turnServer:a.turnServer}),e.pc[t.subsSocket].addStream(e.stream),e.pc[t.subsSocket].oniceconnectionstatechange=function(i){"disconnected"===i&&(e.pc[t.subsSocket].close(),delete e.pc[t.subsSocket])}}),a.socket.on("onPublishP2P",function(e,i){var n=a.remoteStreams[e.streamId];n.pc=Erizo.Connection({callback:function(){},stunServerUrl:a.stunServerUrl,turnServer:a.turnServer,maxAudioBW:t.maxAudioBW,maxVideoBW:t.maxVideoBW}),n.pc.onsignalingmessage=function(t){n.pc.onsignalingmessage=function(){},i(t)},n.pc.processSignalingMessage(e.sdp),n.pc.onaddstream=function(t){L.Logger.info("Stream subscribed"),n.stream=t.stream,t=Erizo.StreamEvent({type:"stream-subscribed",stream:n}),a.dispatchEvent(t)}}),a.socket.on("onDataStream",function(t){var e=a.remoteStreams[t.id],t=Erizo.StreamEvent({type:"stream-data",msg:t.msg,stream:e});e.dispatchEvent(t)}),a.socket.on("onUpdateAttributeStream",function(t){var e=a.remoteStreams[t.id],i=Erizo.StreamEvent({type:"stream-attributes-update",attrs:t.attrs,stream:e});e.updateLocalAttributes(t.attrs),e.dispatchEvent(i)}),a.socket.on("onRemoveStream",function(t){var e=a.remoteStreams[t.id];delete a.remoteStreams[t.id],s(e),t=Erizo.StreamEvent({type:"stream-removed",stream:e}),a.dispatchEvent(t)}),a.socket.on("disconnect",function(){if(L.Logger.info("Socket disconnected"),0!==a.state){var t=Erizo.RoomEvent({type:"room-disconnected"});a.dispatchEvent(t)}}),i("token",e,r,o)},i=function(t,e,i,n){a.socket.emit(t,e,function(t,e){"success"===t?void 0!==i&&i(e):void 0!==n&&n(e)})},n=function(t,e,i,n){a.socket.emit(t,e,i,function(t,e){void 0!==n&&n(t,e)})},a.connect=function(){var i=L.Base64.decodeBase64(t.token);0!==a.state&&L.Logger.error("Room already connected"),a.state=1,e(JSON.parse(i),function(e){var i,n,r,o=0,s=[];i=e.streams,a.p2p=e.p2p,n=e.id,a.stunServerUrl=e.stunServerUrl,a.turnServer=e.turnServer,a.state=2,t.defaultVideoBW=e.defaultVideoBW,t.maxVideoBW=e.maxVideoBW;for(o in i)i.hasOwnProperty(o)&&(r=i[o],e=Erizo.Stream({streamID:r.id,local:!1,audio:r.audio,video:r.video,data:r.data,screen:r.screen,attributes:r.attributes}),s.push(e),a.remoteStreams[r.id]=e);a.roomID=n,L.Logger.info("Connected to room "+a.roomID),o=Erizo.RoomEvent({type:"room-connected",streams:s}),a.dispatchEvent(o)},function(t){L.Logger.error("Not Connected! Error: "+t)})},a.disconnect=function(){var t=Erizo.RoomEvent({type:"room-disconnected"});a.dispatchEvent(t)},a.publish=function(e,i,s,c){if(i=i||{},i.maxVideoBW=i.maxVideoBW||t.defaultVideoBW,i.maxVideoBW>t.maxVideoBW&&(i.maxVideoBW=t.maxVideoBW),e.local&&void 0===a.localStreams[e.getID()])if(e.hasAudio()||e.hasVideo()||e.hasScreen())if(void 0!==e.url||void 0!==e.recording){var l;e.url?(i="url",l=e.url):(i="recording",l=e.recording),n("publish",{state:i,data:e.hasData(),audio:e.hasAudio(),video:e.hasVideo(),attributes:e.getAttributes()},l,function(t,i){"success"===t?(L.Logger.info("Stream published"),e.getID=function(){return i},e.sendData=function(t){r(e,t)},e.setAttributes=function(t){o(e,t)},a.localStreams[i]=e,e.room=a,s&&s()):(L.Logger.info("Error when publishing the stream",t),c&&c(t))})}else a.p2p?(t.maxAudioBW=i.maxAudioBW,t.maxVideoBW=i.maxVideoBW,n("publish",{state:"p2p",data:e.hasData(),audio:e.hasAudio(),video:e.hasVideo(),screen:e.hasScreen(),attributes:e.getAttributes()},void 0,function(t,i){"error"===t&&c&&c(t),L.Logger.info("Stream published"),e.getID=function(){return i},e.hasData()&&(e.sendData=function(t){r(e,t)}),e.setAttributes=function(t){o(e,t)},a.localStreams[i]=e,e.room=a})):(e.pc=Erizo.Connection({callback:function(t){n("publish",{state:"offer",data:e.hasData(),audio:e.hasAudio(),video:e.hasVideo(),attributes:e.getAttributes()},t,function(t,i){"error"===t?c&&c(t):(e.pc.onsignalingmessage=function(t){e.pc.onsignalingmessage=function(){},n("publish",{state:"ok",streamId:i,data:e.hasData(),audio:e.hasAudio(),video:e.hasVideo(),screen:e.hasScreen(),attributes:e.getAttributes()},t),L.Logger.info("Stream published"),e.getID=function(){return i},e.hasData()&&(e.sendData=function(t){r(e,t)}),e.setAttributes=function(t){o(e,t)},a.localStreams[i]=e,e.room=a},e.pc.processSignalingMessage(t))})},stunServerUrl:a.stunServerUrl,turnServer:a.turnServer,maxAudioBW:i.maxAudioBW,maxVideoBW:i.maxVideoBW}),e.pc.addStream(e.stream));else e.hasData()&&n("publish",{state:"data",data:e.hasData(),audio:!1,video:!1,screen:!1,attributes:e.getAttributes()},void 0,function(t,i){"error"===t?c&&c(t):(L.Logger.info("Stream published"),e.getID=function(){return i},e.sendData=function(t){r(e,t)},e.setAttributes=function(t){o(e,t)},a.localStreams[i]=e,e.room=a)})},a.startRecording=function(t,e,n){L.Logger.debug("Start Recording streamaa: "+t.getID()),i("startRecorder",{to:t.getID()},e,n)},a.stopRecording=function(t,e,n){i("stopRecorder",{id:t},e,n)},a.unpublish=function(t){t.local&&(i("unpublish",t.getID()),t.room=void 0,(t.hasAudio()||t.hasVideo()||t.hasScreen())&&void 0===t.url&&(t.pc.close(),t.pc=void 0),delete a.localStreams[t.getID()],t.getID=function(){},t.sendData=function(){},t.setAttributes=function(){})},a.subscribe=function(t,e,i){if(e=e||{},!t.local){if(t.hasVideo()||t.hasAudio()||t.hasScreen())a.p2p?n("subscribe",{streamId:t.getID()}):(t.pc=Erizo.Connection({callback:function(r){n("subscribe",{streamId:t.getID(),audio:e.audio,video:e.video,data:e.data},r,function(e){"error"===e?i&&i(e):(e.match(/a=ssrc:55543/)&&(e=e.replace(/a=sendrecv\\r\\na=mid:video/,"a=recvonly\\r\\na=mid:video"),e=e.split("a=ssrc:55543")[0]+'"}'),t.pc.processSignalingMessage(e))})},nop2p:!0,audio:t.hasAudio(),video:t.hasVideo(),stunServerUrl:a.stunServerUrl,turnServer:a.turnServer}),t.pc.onaddstream=function(e){L.Logger.info("Stream subscribed"),t.stream=e.stream,e=Erizo.StreamEvent({type:"stream-subscribed",stream:t}),a.dispatchEvent(e)});else{if(!t.hasData()||!1===e.data)return void L.Logger.info("Subscribing to anything");n("subscribe",{streamId:t.getID(),data:e.data},void 0,function(e){"error"===e?i&&i(e):(L.Logger.info("Stream subscribed"),e=Erizo.StreamEvent({type:"stream-subscribed",stream:t}),a.dispatchEvent(e))})}L.Logger.info("Subscribing to: "+t.getID())}},a.unsubscribe=function(t,e){void 0!==a.socket&&(t.local||i("unsubscribe",t.getID(),function(){"error"===answer?e&&e(answer):s(t)},function(){L.Logger.error("Error calling unsubscribe.")}))},a.getStreamsByAttribute=function(t,e){var i,n,r=[];for(i in a.remoteStreams)a.remoteStreams.hasOwnProperty(i)&&(n=a.remoteStreams[i],void 0!==n.getAttributes()&&void 0!==n.getAttributes()[t]&&n.getAttributes()[t]===e&&r.push(n));return r},a};var L=L||{};L.Logger=function(t){return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,enableLogPanel:function(){t.Logger.panel=document.createElement("textarea"),t.Logger.panel.setAttribute("id","licode-logs"),t.Logger.panel.setAttribute("style","width: 100%; height: 100%; display: none"),t.Logger.panel.setAttribute("rows",20),t.Logger.panel.setAttribute("cols",20),t.Logger.panel.setAttribute("readOnly",!0),document.body.appendChild(t.Logger.panel)},setLogLevel:function(e){e>t.Logger.NONE?e=t.Logger.NONE:e<t.Logger.DEBUG&&(e=t.Logger.DEBUG),t.Logger.logLevel=e},log:function(e){var i="";if(!(e<t.Logger.logLevel)){e===t.Logger.DEBUG?i+="DEBUG":e===t.Logger.TRACE?i+="TRACE":e===t.Logger.INFO?i+="INFO":e===t.Logger.WARNING?i+="WARNING":e===t.Logger.ERROR&&(i+="ERROR");for(var i=i+": ",n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(n=n.slice(1),n=[i].concat(n),void 0!==t.Logger.panel){for(i="",r=0;r<n.length;r++)i+=n[r];t.Logger.panel.value=t.Logger.panel.value+"\n"+i}else console.log.apply(console,n)}},debug:function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.Logger.log.apply(t.Logger,[t.Logger.DEBUG].concat(e))},trace:function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.Logger.log.apply(t.Logger,[t.Logger.TRACE].concat(e))},info:function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.Logger.log.apply(t.Logger,[t.Logger.INFO].concat(e))},warning:function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.Logger.log.apply(t.Logger,[t.Logger.WARNING].concat(e))},error:function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.Logger.log.apply(t.Logger,[t.Logger.ERROR].concat(e))}}}(L),L=L||{},L.Base64=function(){var t,e,i,n,r,o,s,a,c;for(t="A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,+,/".split(","),e=[],r=0;r<t.length;r+=1)e[t[r]]=r;return o=function(t){i=t,n=0},s=function(){var t;return!i||n>=i.length?-1:(t=255&i.charCodeAt(n),n+=1,t)},a=function(){if(!i)return-1;for(;;){if(n>=i.length)return-1;var t=i.charAt(n);if(n+=1,e[t])return e[t];if("A"===t)return 0}},c=function(t){return t=t.toString(16),1===t.length&&(t="0"+t),unescape("%"+t)},{encodeBase64:function(e){var i,n,r;for(o(e),e="",i=Array(3),n=0,r=!1;!r&&-1!==(i[0]=s());)i[1]=s(),i[2]=s(),e+=t[i[0]>>2],-1!==i[1]?(e+=t[i[0]<<4&48|i[1]>>4],-1!==i[2]?(e+=t[i[1]<<2&60|i[2]>>6],e+=t[63&i[2]]):(e+=t[i[1]<<2&60],e+="=",r=!0)):(e+=t[i[0]<<4&48],e+="=",e+="=",r=!0),n+=4,n>=76&&(e+="\n",n=0);return e},decodeBase64:function(t){var e,i;for(o(t),t="",e=Array(4),i=!1;!i&&-1!==(e[0]=a())&&-1!==(e[1]=a());)e[2]=a(),e[3]=a(),t+=c(e[0]<<2&255|e[1]>>4),-1!==e[2]?(t+=c(e[1]<<4&255|e[2]>>2),-1!==e[3]?t+=c(e[2]<<6&255|e[3]):i=!0):i=!0;return t}}}(L),function(){function t(){(new L.ElementQueries).init()}this.L=this.L||{},this.L.ElementQueries=function(){function t(t){return t||(t=document.documentElement),t=getComputedStyle(t,"fontSize"),parseFloat(t)||16}function e(e,i){var n=i.replace(/[0-9]*/,""),i=parseFloat(i);switch(n){case"px":return i;case"em":return i*t(e);case"rem":return i*t();case"vw":return i*document.documentElement.clientWidth/100;case"vh":return i*document.documentElement.clientHeight/100;case"vmin":case"vmax":return i*Math["vmin"===n?"min":"max"](document.documentElement.clientWidth/100,document.documentElement.clientHeight/100);default:return i}}function i(t){this.element=t,this.options=[];var i,n,r,o,s,a,c,l,h=0,u=0;this.addOption=function(t){this.options.push(t)};var d=["min-width","min-height","max-width","max-height"];this.call=function(){for(h=this.element.offsetWidth,u=this.element.offsetHeight,a={},i=0,n=this.options.length;n>i;i++)r=this.options[i],o=e(this.element,r.value),s="width"==r.property?h:u,l=r.mode+"-"+r.property,c="","min"==r.mode&&s>=o&&(c+=r.value),"max"==r.mode&&o>=s&&(c+=r.value),a[l]||(a[l]=""),c&&-1===(" "+a[l]+" ").indexOf(" "+c+" ")&&(a[l]+=" "+c);for(var t in d)a[d[t]]?this.element.setAttribute(d[t],a[d[t]].substr(1)):this.element.removeAttribute(d[t])}}function n(t,e){t.elementQueriesSetupInformation?t.elementQueriesSetupInformation.addOption(e):(t.elementQueriesSetupInformation=new i(t),t.elementQueriesSetupInformation.addOption(e),new ResizeSensor(t,function(){t.elementQueriesSetupInformation.call()})),t.elementQueriesSetupInformation.call()}function r(t){for(var e,t=t.replace(/'/g,'"');null!==(e=s.exec(t));)if(5<e.length){var i=e[1]||e[5],r=e[2],o=e[3];e=e[4];var a=void 0;if(document.querySelectorAll&&(a=document.querySelectorAll.bind(document)),!a&&"undefined"!=typeof $$&&(a=$$),!a&&"undefined"!=typeof jQuery&&(a=jQuery),!a)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";for(var i=a(i),a=0,c=i.length;c>a;a++)n(i[a],{mode:r,property:o,value:e})}}function o(t){var e="";if(t)if("string"==typeof t)t=t.toLowerCase(),(-1!==t.indexOf("min-width")||-1!==t.indexOf("max-width"))&&r(t);else for(var i=0,n=t.length;n>i;i++)1===t[i].type?(e=t[i].selectorText||t[i].cssText,-1!==e.indexOf("min-height")||-1!==e.indexOf("max-height")?r(e):(-1!==e.indexOf("min-width")||-1!==e.indexOf("max-width"))&&r(e)):4===t[i].type&&o(t[i].cssRules||t[i].rules)}var s=/,?([^,\n]*)\[[\s\t]*(min|max)-(width|height)[\s\t]*[~$\^]?=[\s\t]*"([^"]*)"[\s\t]*]([^\n\s\{]*)/gim;this.init=function(){for(var t=0,e=document.styleSheets.length;e>t;t++)o(document.styleSheets[t].cssText||document.styleSheets[t].cssRules||document.styleSheets[t].rules)}},window.addEventListener?window.addEventListener("load",t,!1):window.attachEvent("onload",t),this.L.ResizeSensor=function(t,e){function i(t,e){window.OverflowEvent?t.addEventListener("overflowchanged",function(t){e.call(this,t)}):(t.addEventListener("overflow",function(t){e.call(this,t)}),t.addEventListener("underflow",function(t){e.call(this,t)}))}function n(){this.q=[],this.add=function(t){this.q.push(t)};var t,e;this.call=function(){for(t=0,e=this.q.length;e>t;t++)this.q[t].call()}}function r(t,e){function r(){var e=!1,i=t.resizeSensor.offsetWidth,n=t.resizeSensor.offsetHeight;return s!=i&&(c.width=i-1+"px",l.width=i+1+"px",e=!0,s=i),a!=n&&(c.height=n-1+"px",l.height=n+1+"px",e=!0,a=n),e}if(t.resizedAttached){if(t.resizedAttached)return void t.resizedAttached.add(e)}else t.resizedAttached=new n,t.resizedAttached.add(e);var o=function(){r()&&t.resizedAttached.call()};t.resizeSensor=document.createElement("div"),t.resizeSensor.className="resize-sensor",t.resizeSensor.style.cssText="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1;",t.resizeSensor.innerHTML='<div class="resize-sensor-overflow" style="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1;"><div></div></div><div class="resize-sensor-underflow" style="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1;"><div></div></div>',t.appendChild(t.resizeSensor),"absolute"!==(t.currentStyle?t.currentStyle.position:window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue("position"):t.style.position)&&(t.style.position="relative");var s=-1,a=-1,c=t.resizeSensor.firstElementChild.firstChild.style,l=t.resizeSensor.lastElementChild.firstChild.style;r(),i(t.resizeSensor,o),i(t.resizeSensor.firstElementChild,o),i(t.resizeSensor.lastElementChild,o)}if("array"==typeof t||"undefined"!=typeof jQuery&&t instanceof jQuery||"undefined"!=typeof Elements&&t instanceof Elements)for(var o=0,s=t.length;s>o;o++)r(t[o],e);else r(t,e)}}(),Erizo=Erizo||{},Erizo.View=function(){var t=Erizo.EventDispatcher({});return t.url="/images",t},Erizo=Erizo||{},Erizo.VideoPlayer=function(t){var e=Erizo.View({});return e.id=t.id,e.stream=t.stream.stream,e.elementID=t.elementID,e.destroy=function(){e.video.pause(),delete e.resizer,e.parentNode.removeChild(e.div)},e.resize=function(){var i=e.container.offsetWidth,n=e.container.offsetHeight;t.stream.screen||!1===t.options.crop?n>.75*i?(e.video.style.width=i+"px",e.video.style.height=.75*i+"px",e.video.style.top=-(.75*i/2-n/2)+"px",e.video.style.left="0px"):(e.video.style.height=n+"px",e.video.style.width=4/3*n+"px",e.video.style.left=-(4/3*n/2-i/2)+"px",e.video.style.top="0px"):(i!==e.containerWidth||n!==e.containerHeight)&&(.75*i>n?(e.video.style.width=i+"px",e.video.style.height=.75*i+"px",e.video.style.top=-(.75*i/2-n/2)+"px",e.video.style.left="0px"):(e.video.style.height=n+"px",e.video.style.width=4/3*n+"px",e.video.style.left=-(4/3*n/2-i/2)+"px",e.video.style.top="0px")),e.containerWidth=i,e.containerHeight=n},L.Logger.debug("Creating URL from stream "+e.stream),e.stream_url=(window.URL||webkitURL).createObjectURL(e.stream),e.div=document.createElement("div"),e.div.setAttribute("id","player_"+e.id),e.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),e.video=document.createElement("video"),e.video.setAttribute("id","stream"+e.id),e.video.setAttribute("style","width: 100%; height: 100%; position: absolute"),e.video.setAttribute("autoplay","autoplay"),t.stream.local&&(e.video.volume=0),void 0!==e.elementID?(document.getElementById(e.elementID).appendChild(e.div),e.container=document.getElementById(e.elementID)):(document.body.appendChild(e.div),e.container=document.body),e.parentNode=e.div.parentNode,e.div.appendChild(e.video),e.containerWidth=0,e.containerHeight=0,e.resizer=new L.ResizeSensor(e.container,e.resize),e.resize(),e.bar=new Erizo.Bar({elementID:"player_"+e.id,id:e.id,stream:t.stream,media:e.video,options:t.options}),e.div.onmouseover=function(){e.bar.display()},e.div.onmouseout=function(){e.bar.hide()},e.video.src=e.stream_url,e},Erizo=Erizo||{},Erizo.AudioPlayer=function(t){var e,i,n=Erizo.View({});return n.id=t.id,n.stream=t.stream.stream,n.elementID=t.elementID,L.Logger.debug("Creating URL from stream "+n.stream),n.stream_url=(window.URL||webkitURL).createObjectURL(n.stream),n.audio=document.createElement("audio"),n.audio.setAttribute("id","stream"+n.id),n.audio.setAttribute("style","width: 100%; height: 100%; position: absolute"),n.audio.setAttribute("autoplay","autoplay"),t.stream.local&&(n.audio.volume=0),t.stream.local&&(n.audio.volume=0),void 0!==n.elementID?(n.destroy=function(){n.audio.pause(),n.parentNode.removeChild(n.div)},e=function(){n.bar.display()},i=function(){n.bar.hide()},n.div=document.createElement("div"),n.div.setAttribute("id","player_"+n.id),n.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),document.getElementById(n.elementID).appendChild(n.div),n.container=document.getElementById(n.elementID),n.parentNode=n.div.parentNode,n.div.appendChild(n.audio),n.bar=new Erizo.Bar({elementID:"player_"+n.id,id:n.id,stream:t.stream,media:n.audio,options:t.options}),n.div.onmouseover=e,n.div.onmouseout=i):(n.destroy=function(){n.audio.pause(),n.parentNode.removeChild(n.audio)},document.body.appendChild(n.audio),n.parentNode=document.body),n.audio.src=n.stream_url,n},Erizo=Erizo||{},Erizo.Bar=function(t){var e,i,n=Erizo.View({});return n.elementID=t.elementID,n.id=t.id,n.div=document.createElement("div"),n.div.setAttribute("id","bar_"+n.id),n.bar=document.createElement("div"),n.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62); display: table;"),n.bar.setAttribute("id","subbar_"+n.id),n.boxName=document.createElement("span"),n.boxName.setAttribute("style","display: table-cell; vertical-align: middle; text-align: center;"),i=function(t){"block"!==t?t="none":clearTimeout(e),n.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+t)},n.display=function(){i("block")},n.hide=function(){e=setTimeout(i,1e3)},document.getElementById(n.elementID).appendChild(n.div),n.div.appendChild(n.bar),n.bar.appendChild(n.boxName),void 0!==t.options.name&&(n.textName=document.createTextNode(t.options.name),n.boxName.appendChild(n.textName)),t.stream.screen||void 0!==t.options&&void 0!==t.options.speaker&&!0!==t.options.speaker||(n.speaker=new Erizo.Speaker({elementID:"subbar_"+n.id,id:n.id,stream:t.stream,media:t.media})),n.display(),n.hide(),n},Erizo=Erizo||{},Erizo.Speaker=function(t){var e,i,n,r=Erizo.View({}),o=50,s=!1;return r.elementID=t.elementID,r.media=t.media,r.id=t.id,r.stream=t.stream,r.div=document.createElement("div"),r.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;"),r.icon=document.createElement("img"),r.icon.setAttribute("id","volume_"+r.id),r.icon.setAttribute("src",r.url+"/assets/sound48.png"),r.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;"),r.div.appendChild(r.icon),r.stream.local?(i=function(){s=!0,r.icon.setAttribute("src",r.url+"/assets/mute48.png"),r.stream.stream.getAudioTracks()[0].enabled=!1},n=function(){s=!1,r.icon.setAttribute("src",r.url+"/assets/sound48.png"),r.stream.stream.getAudioTracks()[0].enabled=!0},r.icon.onclick=function(){s?n():i()}):(r.picker=document.createElement("input"),r.picker.setAttribute("id","picker_"+r.id),r.picker.type="range",r.picker.min=0,r.picker.max=100,r.picker.step=10,r.picker.value=o,r.picker.orient="vertical",r.div.appendChild(r.picker),r.media.volume=r.picker.value/100,r.picker.oninput=function(){0<r.picker.value?(s=!1,r.icon.setAttribute("src",r.url+"/assets/sound48.png")):(s=!0,r.icon.setAttribute("src",r.url+"/assets/mute48.png")),r.media.volume=r.picker.value/100},e=function(t){r.picker.setAttribute("style","width: 32px; height: 100px; position: absolute; bottom: 90%; z-index: 1;"+r.div.offsetHeight+"px; right: 0px; -webkit-appearance: slider-vertical; display: "+t)},i=function(){s=!0,r.icon.setAttribute("src",r.url+"/assets/mute48.png"),o=r.picker.value,r.picker.value=0,r.media.volume=0},n=function(){s=!1,r.icon.setAttribute("src",r.url+"/assets/sound48.png"),r.picker.value=o,r.media.volume=r.picker.value/100},r.icon.onclick=function(){s?n():i()},r.div.onmouseover=function(){e("block")},r.div.onmouseout=function(){e("none")},e("none")),document.getElementById(r.elementID).appendChild(r.div),r},define("erizo",function(){}),define("licode.client",["storm","features/list-users","underscore","erizo"],function(t,e,i){function n(n){if(void 0!=h&&h.getID()==n.getID())c("on");else if(void 0!=u&&u.getID()==n.getID())a("on");else if(n.hasAudio()){var s=n.getAttributes().userId,l=t.users[s];(void 0==n.state||n.state==m)&&e.setMicroStatus(s,"on-small");var f=t.user,g=f.userId;if(t.sync)r(n);else if(f.role!=t.roles.STUDENT)r(n);else if(l&&l.role==t.roles.TEACHER){p||(p=t.parentBoardId);var v=t.dataBoards[p].students;i(v).isEmpty()||i(v).contains(g)?r(n):o(n)}else o(n)}else n.hasVideo()&&d.subscribe(n)}function r(t){if((void 0==t.state||t.state==m)&&(d.subscribe(t),t.state=v,console.log("subscribed stream from user: "+t.getAttributes().userId),t.hasAudio())){var i=t.getAttributes().userId;e.setMicroStatus(i,"loading-small")}}function o(t){if(void 0!=t.state&&t.state==b){var i=t.getAttributes().userId;if(d.unsubscribe(t),t.hide(),t.pc.close(),t.state=m,console.log("unsubscribed stream from user: "+i),t.hasAudio()){var n=t.getAttributes().userId;e.setMicroStatus(n,"on-small")}}}function s(){$("#friendsicon .list-user").on("change","input[type=range]",function(){var t=$(this).parent().attr("id").substring(4);if(void 0!=d){var e=$(this).val()/100,i=d.getStreamsByAttribute("userId",t)[0];i.player.audio.volume=e}}),$("#button_webcam").click(function(){$(this).hasClass("board-icon-webcam-on")?y.publishVideo(!1):$(this).hasClass("board-icon-webcam-off")&&y.publishVideo(!0)}),$("#button_mic").click(function(){$(this).hasClass("board-icon-micro-on")?y.publishAudio(!1):$(this).hasClass("board-icon-micro-off")&&y.publishAudio(!0)}),$("#label_button_webcam").click(function(){$("#button_webcam").click()}),$("#label_button_mic").click(function(){$("#button_mic").click()
})}function a(t){$("#button_webcam").attr("class","board-icon-webcam-"+t)}function c(t){$("#button_mic").attr("class","board-icon-micro-"+t)}function l(t){var e,i,n,r,o,s,a,c,l;switch(t=t?t:{},o=t.container?t.container:"#video",n=t.element?t.element:".video",s=$(o),s.css({"padding-top":"0"}),c=s.find(n).length,l=s.innerWidth(),r=s.innerHeight(),c){case 0:a=1,e=1;break;case 1:a=1,e=1;break;case 2:a=1,e=2;break;case 3:a=2,e=2;break;case 4:a=2,e=2;break;default:a=Math.ceil(c/3),e=3;var h=l*a/4;h>r&&$(o).height(l*a/4)}return i=Math.floor(l/e),s.find(n).each(function(t,e){return $(e).width(i),$(e).height(3*i/4)})}var h,u,d,f,p,g,m=0,v=1,b=2,y={init:function(){t.comm.socket.on("token",function(t){""!=t&&y.start(t)}),t.comm.socket.on("syncVoice",function(t){y.syncVoice(t)}),s()},start:function(r){return void 0!=d?(void 0!=f&&(clearInterval(f),f=void 0),void t.ui.hideDisconnecting()):(d=Erizo.Room({token:r}),d.connect(),d.addEventListener("room-connected",function(e){a("off"),c("off"),(t.user.isTeacher()||t.user.isStudent())&&y.publishAudio(!0),i(e.streams).each(function(t){n(t)})}),d.addEventListener("room-disconnected",function(){c("disabled"),a("disabled"),d=void 0,h=void 0,u=void 0,setTimeout(t.ui.showMediaDisconnecting,500),f=setInterval(function(){t.comm.socket.emit("token",t.parentBoardId,{})},1e3)}),d.addEventListener("stream-subscribed",function(t){var i=t.stream;if(i.hasVideo()){$("#video").append("<div class='video' id='subscriber-"+i.getID()+"'></div>");var n=i.getAttributes().name;i.show("subscriber-"+i.getID(),{speaker:!1,name:n}),l({container:"#video",element:".video"})}else if(i.hasAudio()){i.state=b,$("#video").append("<div class='audio' id='subscriber-"+i.getID()+"'></div>"),i.show("subscriber-"+i.getID(),{speaker:!1});var r=i.getAttributes().userId;e.setMicroStatus(r,"speaking")}}),d.addEventListener("stream-added",function(t){var e=t.stream;n(e)}),void d.addEventListener("stream-removed",function(t){var i=t.stream;if(void 0!==i.elementID&&($("#"+i.elementID).remove(),l({container:"#video",element:".video"}),i.hasAudio())){var n=i.getAttributes().userId;e.setMicroStatus(n,"")}}))},stop:function(){void 0!=h&&h.close(),void 0!=u&&u.close(),void 0!=d&&d.disconnect()},publishAudio:function(e){1==e&&void 0==h?(h=Erizo.Stream({audio:!0,video:!1,attributes:{userId:t.user.userId}}),h.init(),c("loading"),h.addEventListener("access-accepted",function(){d.publish(h,{},function(){console.log("published audio stream")},function(t){console.log("Failed to publish audio stream, anwser: "+t)})}),h.addEventListener("access-denied",function(){c("disabled")})):void 0!=h&&(h.close(),h=void 0,c("off"))},publishVideo:function(e){1==e&&void 0==u?(u=Erizo.Stream({audio:!1,video:!0,attributes:{name:t.user.name}}),u.init(),a("loading"),u.addEventListener("access-accepted",function(){d.publish(u,{},function(){console.log("published video stream")},function(t){console.log("Failed to publish video stream, anwser: "+t)}),$("#webcam .publisher").append('<div id="publisher"></div>'),u.show("publisher",{speaker:!1})}),u.addEventListener("access-denied",function(){a("disabled")})):void 0!=u&&(u.close(),u=void 0,$("#publisher").remove(),a("off"))},syncVoice:function(t){p=t.teacherActiveBoard,void 0!=d&&(g&&clearTimeout(g),g=setTimeout(function(){i(d.remoteStreams).each(function(t){n(t)}),g=void 0},1e3))}};return y}),function(t){function e(e){var i=e||window.event,n=[].slice.call(arguments,1),r=0,o=0,s=0;return e=t.event.fix(i),e.type="mousewheel",i.wheelDelta&&(r=i.wheelDelta/120),i.detail&&(r=-i.detail/3),s=r,void 0!==i.axis&&i.axis===i.HORIZONTAL_AXIS&&(s=0,o=-1*r),void 0!==i.wheelDeltaY&&(s=i.wheelDeltaY/120),void 0!==i.wheelDeltaX&&(o=-1*i.wheelDeltaX/120),n.unshift(e,r,o,s),(t.event.dispatch||t.event.handle).apply(this,n)}var i=["DOMMouseScroll","mousewheel"];if(t.event.fixHooks)for(var n=i.length;n;)t.event.fixHooks[i[--n]]=t.event.mouseHooks;t.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var t=i.length;t;)this.addEventListener(i[--t],e,!1);else this.onmousewheel=e},teardown:function(){if(this.removeEventListener)for(var t=i.length;t;)this.removeEventListener(i[--t],e,!1);else this.onmousewheel=null}},t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}(jQuery),define("jquery.mousewheel",["jquery"],function(){}),function(t){var e={init:function(e){function i(){return"ontouchstart"in window?1:0}var n={set_width:!1,set_height:!1,horizontalScroll:!1,scrollInertia:550,scrollEasing:"easeOutCirc",mouseWheel:"auto",autoDraggerLength:!0,scrollButtons:{enable:!1,scrollType:"continuous",scrollSpeed:20,scrollAmount:40},advanced:{updateOnBrowserResize:!0,updateOnContentResize:!1,autoExpandHorizontalScroll:!1},callbacks:{onScroll:function(){},onTotalScroll:function(){},onTotalScrollOffset:0}},e=t.extend(!0,n,e);return t(document).data("mCS-is-touch-device",!1),i()&&t(document).data("mCS-is-touch-device",!0),this.each(function(){var n=t(this);if(e.set_width&&n.css("width",e.set_width),e.set_height&&n.css("height",e.set_height),t(document).data("mCustomScrollbar-index")){var r=parseInt(t(document).data("mCustomScrollbar-index"));t(document).data("mCustomScrollbar-index",r+1)}else t(document).data("mCustomScrollbar-index","1");n.wrapInner("<div class='mCustomScrollBox' style='position:relative; height:100%; overflow:hidden; max-width:100%;' />").addClass("mCustomScrollbar _mCS_"+t(document).data("mCustomScrollbar-index"));var o=n.children(".mCustomScrollBox");if(e.horizontalScroll){o.addClass("mCSB_horizontal").wrapInner("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />");var s=o.children(".mCSB_h_wrapper");s.wrapInner("<div class='mCSB_container' style='position:absolute; left:0;' />").children(".mCSB_container").css({width:s.children().outerWidth(),position:"relative"}).unwrap()}else o.wrapInner("<div class='mCSB_container' style='position:relative; top:0;' />");var a=o.children(".mCSB_container");if(t(document).data("mCS-is-touch-device"))o.css({overflow:"auto","-webkit-overflow-scrolling":"touch"}),a.addClass("mCS_no_scrollbar mCS_touch"),n.data({horizontalScroll:e.horizontalScroll,scrollInertia:e.scrollInertia,scrollEasing:e.scrollEasing,autoExpandHorizontalScroll:e.advanced.autoExpandHorizontalScroll,"onScroll-Callback":e.callbacks.onScroll,"onTotalScroll-Callback":e.callbacks.onTotalScroll,"onTotalScroll-Offset":e.callbacks.onTotalScrollOffset}),o.scroll(function(){n.mCustomScrollbar("callbacks",o,a)});else{a.after("<div class='mCSB_scrollTools' style='position:absolute;'><div class='mCSB_draggerContainer' style='position:relative;'><div class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' style='position:relative;'></div></div><div class='mCSB_draggerRail'></div></div></div>");var c=o.children(".mCSB_scrollTools"),l=c.children(".mCSB_draggerContainer"),h=l.children(".mCSB_dragger");if(e.horizontalScroll?h.data("minDraggerWidth",h.width()):h.data("minDraggerHeight",h.height()),e.scrollButtons.enable&&(e.horizontalScroll?c.prepend("<a class='mCSB_buttonLeft' style='display:block; position:relative;'></a>").append("<a class='mCSB_buttonRight' style='display:block; position:relative;'></a>"):c.prepend("<a class='mCSB_buttonUp' style='display:block; position:relative;'></a>").append("<a class='mCSB_buttonDown' style='display:block; position:relative;'></a>")),o.bind("scroll",function(){o.scrollTop(0).scrollLeft(0)}),n.data({horizontalScroll:e.horizontalScroll,scrollInertia:e.scrollInertia,scrollEasing:e.scrollEasing,mouseWheel:e.mouseWheel,autoDraggerLength:e.autoDraggerLength,"scrollButtons-enable":e.scrollButtons.enable,"scrollButtons-scrollType":e.scrollButtons.scrollType,"scrollButtons-scrollSpeed":e.scrollButtons.scrollSpeed,"scrollButtons-scrollAmount":e.scrollButtons.scrollAmount,autoExpandHorizontalScroll:e.advanced.autoExpandHorizontalScroll,"onScroll-Callback":e.callbacks.onScroll,"onTotalScroll-Callback":e.callbacks.onTotalScroll,"onTotalScroll-Offset":e.callbacks.onTotalScrollOffset}).mCustomScrollbar("update"),e.advanced.updateOnBrowserResize){var u;t(window).resize(function(){u&&clearTimeout(u),u=setTimeout(function(){n.mCustomScrollbar("update")},150)})}}if(e.advanced.updateOnContentResize){var d;if(e.horizontalScroll){var f=a.outerWidth();i()&&o.css({"-webkit-overflow-scrolling":"auto"})}else var f=a.outerHeight();d=setInterval(function(){if(e.horizontalScroll){e.advanced.autoExpandHorizontalScroll&&a.css({position:"absolute",width:"auto"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:a.outerWidth(),position:"relative"}).unwrap();var t=a.outerWidth()}else var t=a.outerHeight();t!=f&&(n.mCustomScrollbar("update"),f=t)},300)}})},update:function(){var e=t(this),i=e.children(".mCustomScrollBox"),n=i.children(".mCSB_container");t(document).data("mCS-is-touch-device")||n.removeClass("mCS_no_scrollbar");var r=i.children(".mCSB_scrollTools"),o=r.children(".mCSB_draggerContainer"),s=o.children(".mCSB_dragger");if(e.data("horizontalScroll")){var a=r.children(".mCSB_buttonLeft"),c=r.children(".mCSB_buttonRight"),l=i.width();e.data("autoExpandHorizontalScroll")&&n.css({position:"absolute",width:"auto"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:n.outerWidth(),position:"relative"}).unwrap();var h=n.outerWidth()}else var u=r.children(".mCSB_buttonUp"),d=r.children(".mCSB_buttonDown"),f=i.height(),p=n.outerHeight();if(p>f&&!e.data("horizontalScroll")&&!t(document).data("mCS-is-touch-device")){r.css("display","block");var g=o.height();if(e.data("autoDraggerLength")){var m=Math.round(p-1.3*(p-f)),v=s.data("minDraggerHeight");if(v>=m)s.css({height:v});else if(m>=g-10){var b=g-10;s.css({height:b})}else s.css({height:m});s.children(".mCSB_dragger_bar").css({"line-height":s.height()+"px"})}var y=s.height(),x=(p-f)/(g-y);e.data("scrollAmount",x),e.mCustomScrollbar("scrolling",i,n,o,s,u,d,a,c),s.position().top>g-y&&s.css("top",g-y),e.mCustomScrollbar("scroll",!0)}else if(h>l&&e.data("horizontalScroll")&&!t(document).data("mCS-is-touch-device")){r.css("display","block");var w=o.width();if(e.data("autoDraggerLength")){var C=Math.round(h-1.3*(h-l)),S=s.data("minDraggerWidth");if(S>=C)s.css({width:S});else if(C>=w-10){var A=w-10;s.css({width:A})}else s.css({width:C})}var k=s.width(),x=(h-l)/(w-k);e.data("scrollAmount",x),e.mCustomScrollbar("scrolling",i,n,o,s,u,d,a,c),s.position().left>w-k&&s.css("left",w-k),e.mCustomScrollbar("scroll",!0)}else i.unbind("mousewheel"),i.unbind("focusin"),e.data("horizontalScroll")?s.add(n).css("left",0):s.add(n).css("top",0),r.css("display","none"),n.addClass("mCS_no_scrollbar")},scrolling:function(e,i,n,r,o,s,a,c){var l=t(this);if(!r.hasClass("ui-draggable")){if(l.data("horizontalScroll"))var h="x";else var h="y";r.draggable({axis:h,containment:"parent",drag:function(){l.mCustomScrollbar("scroll"),r.addClass("mCSB_dragger_onDrag")},stop:function(){r.removeClass("mCSB_dragger_onDrag")}})}if(n.unbind("click").bind("click",function(t){if(l.data("horizontalScroll")){var e=t.pageX-n.offset().left;if(e<r.position().left||e>r.position().left+r.width()){var i=e;i>=n.width()-r.width()&&(i=n.width()-r.width()),r.css("left",i),l.mCustomScrollbar("scroll")}}else{var e=t.pageY-n.offset().top;if(e<r.position().top||e>r.position().top+r.height()){var i=e;i>=n.height()-r.height()&&(i=n.height()-r.height()),r.css("top",i),l.mCustomScrollbar("scroll")}}}),l.data("mouseWheel")){var u=l.data("mouseWheel");if("auto"===l.data("mouseWheel")){u=8;var d=navigator.userAgent;-1!=d.indexOf("Mac")&&-1!=d.indexOf("Safari")&&-1!=d.indexOf("AppleWebKit")&&-1==d.indexOf("Chrome")&&(u=1)}e.unbind("mousewheel").bind("mousewheel",function(t,e){t.preventDefault();var i=Math.abs(e*u);if(l.data("horizontalScroll")){var o=r.position().left-e*i;r.css("left",o),r.position().left<0&&r.css("left",0);var s=n.width(),a=r.width();r.position().left>s-a&&r.css("left",s-a)}else{var c=r.position().top-e*i;r.css("top",c),r.position().top<0&&r.css("top",0);var h=n.height(),d=r.height();r.position().top>h-d&&r.css("top",h-d)}l.mCustomScrollbar("scroll")})}if(l.data("scrollButtons-enable"))if("pixels"===l.data("scrollButtons-scrollType")){var f;t.browser.msie&&parseInt(t.browser.version)<9&&l.data("scrollInertia",0),l.data("horizontalScroll")?(c.add(a).unbind("click mousedown mouseup mouseout",v,y),c.bind("click",function(t){t.preventDefault(),i.is(":animated")||(f=Math.abs(i.position().left)+l.data("scrollButtons-scrollAmount"),l.mCustomScrollbar("scrollTo",f))}),a.bind("click",function(t){t.preventDefault(),i.is(":animated")||(f=Math.abs(i.position().left)-l.data("scrollButtons-scrollAmount"),i.position().left>=-l.data("scrollButtons-scrollAmount")&&(f="left"),l.mCustomScrollbar("scrollTo",f))})):(s.add(o).unbind("click mousedown mouseup mouseout",S,k),s.bind("click",function(t){t.preventDefault(),i.is(":animated")||(f=Math.abs(i.position().top)+l.data("scrollButtons-scrollAmount"),l.mCustomScrollbar("scrollTo",f))}),o.bind("click",function(t){t.preventDefault(),i.is(":animated")||(f=Math.abs(i.position().top)-l.data("scrollButtons-scrollAmount"),i.position().top>=-l.data("scrollButtons-scrollAmount")&&(f="top"),l.mCustomScrollbar("scrollTo",f))}))}else if(l.data("horizontalScroll")){c.add(a).unbind("click mousedown mouseup mouseout",v,y);var p,g=n.width(),m=r.width();c.bind("mousedown",function(t){t.preventDefault();var e=g-m;p=setInterval(function(){var t=Math.abs(r.position().left-e)*(100/l.data("scrollButtons-scrollSpeed"));r.stop().animate({left:e},t,"linear"),l.mCustomScrollbar("scroll")},20)});var v=function(t){t.preventDefault(),clearInterval(p),r.stop()};c.bind("mouseup mouseout",v);var b;a.bind("mousedown",function(t){t.preventDefault();var e=0;b=setInterval(function(){var t=Math.abs(r.position().left-e)*(100/l.data("scrollButtons-scrollSpeed"));r.stop().animate({left:e},t,"linear"),l.mCustomScrollbar("scroll")},20)});var y=function(t){t.preventDefault(),clearInterval(b),r.stop()};a.bind("mouseup mouseout",y)}else{s.add(o).unbind("click mousedown mouseup mouseout",S,k);var x,w=n.height(),C=r.height();s.bind("mousedown",function(t){t.preventDefault();var e=w-C;x=setInterval(function(){var t=Math.abs(r.position().top-e)*(100/l.data("scrollButtons-scrollSpeed"));r.stop().animate({top:e},t,"linear"),l.mCustomScrollbar("scroll")},20)});var S=function(t){t.preventDefault(),clearInterval(x),r.stop()};s.bind("mouseup mouseout",S);var A;o.bind("mousedown",function(t){t.preventDefault();var e=0;A=setInterval(function(){var t=Math.abs(r.position().top-e)*(100/l.data("scrollButtons-scrollSpeed"));r.stop().animate({top:e},t,"linear"),l.mCustomScrollbar("scroll")},20)});var k=function(t){t.preventDefault(),clearInterval(A),r.stop()};o.bind("mouseup mouseout",k)}e.unbind("focusin").bind("focusin",function(){e.scrollTop(0).scrollLeft(0);var o=t(document.activeElement);if(o.is("input,textarea,select,button,a[tabindex],area,object"))if(l.data("horizontalScroll")){var s=i.position().left,a=o.position().left,c=e.width(),h=o.outerWidth();if(s+a>=0&&c-h>=s+a);else{var u=a/l.data("scrollAmount");u>=n.width()-r.width()&&(u=n.width()-r.width()),r.css("left",u),l.mCustomScrollbar("scroll")}}else{var d=i.position().top,f=o.position().top,p=e.height(),g=o.outerHeight();if(d+f>=0&&p-g>=d+f);else{var u=f/l.data("scrollAmount");u>=n.height()-r.height()&&(u=n.height()-r.height()),r.css("top",u),l.mCustomScrollbar("scroll")}}})},scroll:function(e){var i=t(this),n=i.find(".mCSB_dragger"),r=i.find(".mCSB_container"),o=i.find(".mCustomScrollBox");if(i.data("horizontalScroll"))var s=n.position().left,a=-s*i.data("scrollAmount"),c=r.position().left,l=Math.round(c-a);else var h=n.position().top,u=-h*i.data("scrollAmount"),d=r.position().top,f=Math.round(d-u);if(t.browser.webkit)var p=(window.outerWidth-8)/window.innerWidth,g=.98>p||p>1.02;0===i.data("scrollInertia")||g?(i.data("horizontalScroll")?r.css("left",a):r.css("top",u),e||i.mCustomScrollbar("callbacks",o,r)):i.data("horizontalScroll")?r.stop().animate({left:"-="+l},i.data("scrollInertia"),i.data("scrollEasing"),function(){e||i.mCustomScrollbar("callbacks",o,r)}):r.stop().animate({top:"-="+f},i.data("scrollInertia"),i.data("scrollEasing"),function(){e||i.mCustomScrollbar("callbacks",o,r)})},scrollTo:function(e,i){var n,r={moveDragger:!1,callback:!0},i=t.extend(r,i),o=t(this),s=o.find(".mCustomScrollBox"),a=s.children(".mCSB_container");if(!t(document).data("mCS-is-touch-device"))var c=o.find(".mCSB_draggerContainer"),l=c.children(".mCSB_dragger");var h;if(e){if("number"==typeof e)i.moveDragger?n=e:(h=e,n=Math.round(h/o.data("scrollAmount")));else if("string"==typeof e){var u;u="top"===e?0:"bottom"!==e||o.data("horizontalScroll")?"left"===e?0:"right"===e&&o.data("horizontalScroll")?a.outerWidth()-s.width():"first"===e?o.find(".mCSB_container").find(":first"):"last"===e?o.find(".mCSB_container").find(":last"):o.find(e):a.outerHeight()-s.height(),1===u.length?(h=o.data("horizontalScroll")?u.position().left:u.position().top,n=t(document).data("mCS-is-touch-device")?h:Math.ceil(h/o.data("scrollAmount"))):n=u}t(document).data("mCS-is-touch-device")?o.data("horizontalScroll")?s.stop().animate({scrollLeft:n},o.data("scrollInertia"),o.data("scrollEasing"),function(){i.callback&&o.mCustomScrollbar("callbacks",s,a)}):s.stop().animate({scrollTop:n},o.data("scrollInertia"),o.data("scrollEasing"),function(){i.callback&&o.mCustomScrollbar("callbacks",s,a)}):(o.data("horizontalScroll")?(n>=c.width()-l.width()&&(n=c.width()-l.width()),l.css("left",n)):(n>=c.height()-l.height()&&(n=c.height()-l.height()),l.css("top",n)),i.callback?o.mCustomScrollbar("scroll"):o.mCustomScrollbar("scroll",!0))}},callbacks:function(e,i){var n=t(this);if(t(document).data("mCS-is-touch-device"))if(n.data("horizontalScroll")){var r=Math.round(e.scrollLeft());r>0&&r>=i.outerWidth()-n.width()-n.data("onTotalScroll-Offset")?n.data("onTotalScroll-Callback").call():n.data("onScroll-Callback").call()}else{var o=Math.round(e.scrollTop());o>0&&o>=i.outerHeight()-n.height()-n.data("onTotalScroll-Offset")?n.data("onTotalScroll-Callback").call():n.data("onScroll-Callback").call()}else if(n.data("horizontalScroll")){var s=Math.round(i.position().left);0>s&&s<=e.width()-i.outerWidth()+n.data("onTotalScroll-Offset")?n.data("onTotalScroll-Callback").call():n.data("onScroll-Callback").call()}else{var a=Math.round(i.position().top);0>a&&a<=e.height()-i.outerHeight()+n.data("onTotalScroll-Offset")?n.data("onTotalScroll-Callback").call():n.data("onScroll-Callback").call()}}};t.fn.mCustomScrollbar=function(i){return e[i]?e[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void t.error("Method "+i+" does not exist"):e.init.apply(this,arguments)}}(jQuery),define("jquery.mCustomScrollbar",["jquery"],function(){}),function(t){function e(e){var i=e.data;e.isDefaultPrevented()||(e.preventDefault(),t(this).ajaxSubmit(i))}function i(e){var i=e.target,n=t(i);if(!n.is("[type=submit],[type=image]")){var r=n.closest("[type=submit]");if(0===r.length)return;i=r[0]}var o=this;if(o.clk=i,"image"==i.type)if(void 0!==e.offsetX)o.clk_x=e.offsetX,o.clk_y=e.offsetY;else if("function"==typeof t.fn.offset){var s=n.offset();o.clk_x=e.pageX-s.left,o.clk_y=e.pageY-s.top}else o.clk_x=e.pageX-i.offsetLeft,o.clk_y=e.pageY-i.offsetTop;setTimeout(function(){o.clk=o.clk_x=o.clk_y=null},100)}function n(){if(t.fn.ajaxSubmit.debug){var e="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(e):window.opera&&window.opera.postError&&window.opera.postError(e)}}var r={};r.fileapi=void 0!==t("<input type='file'/>").get(0).files,r.formdata=void 0!==window.FormData,t.fn.ajaxSubmit=function(e){function i(e){var i,n,r=t.param(e).split("&"),o=r.length,s=[];for(i=0;o>i;i++)r[i]=r[i].replace(/\+/g," "),n=r[i].split("="),s.push([decodeURIComponent(n[0]),decodeURIComponent(n[1])]);return s}function o(n){for(var r=new FormData,o=0;o<n.length;o++)r.append(n[o].name,n[o].value);if(e.extraData){var s=i(e.extraData);for(o=0;o<s.length;o++)s[o]&&r.append(s[o][0],s[o][1])}e.data=null;var c=t.extend(!0,{},t.ajaxSettings,e,{contentType:!1,processData:!1,cache:!1,type:a||"POST"});e.uploadProgress&&(c.xhr=function(){var t=jQuery.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(t){var i=0,n=t.loaded||t.position,r=t.total;t.lengthComputable&&(i=Math.ceil(n/r*100)),e.uploadProgress(t,n,r,i)},!1),t}),c.data=null;var l=c.beforeSend;return c.beforeSend=function(t,e){e.data=r,l&&l.call(this,t,e)},t.ajax(c)}function s(i){function r(t){var e=t.contentWindow?t.contentWindow.document:t.contentDocument?t.contentDocument:t.document;return e}function o(){function e(){try{var t=r(m).readyState;n("state = "+t),t&&"uninitialized"==t.toLowerCase()&&setTimeout(e,50)}catch(i){n("Server abort: ",i," (",i.name,")"),s(_),w&&clearTimeout(w),w=void 0}}var i=h.attr("target"),o=h.attr("action");C.setAttribute("target",f),a||C.setAttribute("method","POST"),o!=u.url&&C.setAttribute("action",u.url),u.skipEncodingOverride||a&&!/post/i.test(a)||h.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),u.timeout&&(w=setTimeout(function(){x=!0,s(k)},u.timeout));var c=[];try{if(u.extraData)for(var l in u.extraData)u.extraData.hasOwnProperty(l)&&c.push(t.isPlainObject(u.extraData[l])&&u.extraData[l].hasOwnProperty("name")&&u.extraData[l].hasOwnProperty("value")?t('<input type="hidden" name="'+u.extraData[l].name+'">').val(u.extraData[l].value).appendTo(C)[0]:t('<input type="hidden" name="'+l+'">').val(u.extraData[l]).appendTo(C)[0]);u.iframeTarget||(g.appendTo("body"),m.attachEvent?m.attachEvent("onload",s):m.addEventListener("load",s,!1)),setTimeout(e,15);var d=document.createElement("form").submit;d.apply(C)}finally{C.setAttribute("action",o),i?C.setAttribute("target",i):h.removeAttr("target"),t(c).remove()}}function s(e){if(!v.aborted&&!D){try{E=r(m)}catch(i){n("cannot access response document: ",i),e=_}if(e===k&&v)return v.abort("timeout"),void A.reject(v,"timeout");if(e==_&&v)return v.abort("server abort"),void A.reject(v,"error","server abort");if(E&&E.location.href!=u.iframeSrc||x){m.detachEvent?m.detachEvent("onload",s):m.removeEventListener("load",s,!1);var o,a="success";try{if(x)throw"timeout";var c="xml"==u.dataType||E.XMLDocument||t.isXMLDoc(E);if(n("isXml="+c),!c&&window.opera&&(null===E.body||!E.body.innerHTML)&&--I)return n("requeing onLoad callback, DOM not available"),void setTimeout(s,250);var l=E.body?E.body:E.documentElement;v.responseText=l?l.innerHTML:null,v.responseXML=E.XMLDocument?E.XMLDocument:E,c&&(u.dataType="xml"),v.getResponseHeader=function(t){var e={"content-type":u.dataType};return e[t]},l&&(v.status=Number(l.getAttribute("status"))||v.status,v.statusText=l.getAttribute("statusText")||v.statusText);var h=(u.dataType||"").toLowerCase(),f=/(json|script|text)/.test(h);if(f||u.textarea){var p=E.getElementsByTagName("textarea")[0];if(p)v.responseText=p.value,v.status=Number(p.getAttribute("status"))||v.status,v.statusText=p.getAttribute("statusText")||v.statusText;else if(f){var b=E.getElementsByTagName("pre")[0],y=E.getElementsByTagName("body")[0];b?v.responseText=b.textContent?b.textContent:b.innerText:y&&(v.responseText=y.textContent?y.textContent:y.innerText)}}else"xml"==h&&!v.responseXML&&v.responseText&&(v.responseXML=L(v.responseText));try{j=M(v,h,u)}catch(e){a="parsererror",v.error=o=e||a}}catch(e){n("error caught: ",e),a="error",v.error=o=e||a}v.aborted&&(n("upload aborted"),a=null),v.status&&(a=v.status>=200&&v.status<300||304===v.status?"success":"error"),"success"===a?(u.success&&u.success.call(u.context,j,"success",v),A.resolve(v.responseText,"success",v),d&&t.event.trigger("ajaxSuccess",[v,u])):a&&(void 0===o&&(o=v.statusText),u.error&&u.error.call(u.context,v,a,o),A.reject(v,"error",o),d&&t.event.trigger("ajaxError",[v,u,o])),d&&t.event.trigger("ajaxComplete",[v,u]),d&&!--t.active&&t.event.trigger("ajaxStop"),u.complete&&u.complete.call(u.context,v,a),D=!0,u.timeout&&clearTimeout(w),setTimeout(function(){u.iframeTarget||g.remove(),v.responseXML=null},100)}}}var c,l,u,d,f,g,m,v,b,y,x,w,C=h[0],S=!!t.fn.prop,A=t.Deferred();if(i)for(l=0;l<p.length;l++)c=t(p[l]),S?c.prop("disabled",!1):c.removeAttr("disabled");if(u=t.extend(!0,{},t.ajaxSettings,e),u.context=u.context||u,f="jqFormIO"+(new Date).getTime(),u.iframeTarget?(g=t(u.iframeTarget),y=g.attr("name"),y?f=y:g.attr("name",f)):(g=t('<iframe name="'+f+'" src="'+u.iframeSrc+'" />'),g.css({position:"absolute",top:"-1000px",left:"-1000px"})),m=g[0],v={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(e){var i="timeout"===e?"timeout":"aborted";n("aborting upload... "+i),this.aborted=1;try{m.contentWindow.document.execCommand&&m.contentWindow.document.execCommand("Stop")}catch(r){}g.attr("src",u.iframeSrc),v.error=i,u.error&&u.error.call(u.context,v,i,e),d&&t.event.trigger("ajaxError",[v,u,i]),u.complete&&u.complete.call(u.context,v,i)}},d=u.global,d&&0===t.active++&&t.event.trigger("ajaxStart"),d&&t.event.trigger("ajaxSend",[v,u]),u.beforeSend&&u.beforeSend.call(u.context,v,u)===!1)return u.global&&t.active--,A.reject(),A;if(v.aborted)return A.reject(),A;b=C.clk,b&&(y=b.name,y&&!b.disabled&&(u.extraData=u.extraData||{},u.extraData[y]=b.value,"image"==b.type&&(u.extraData[y+".x"]=C.clk_x,u.extraData[y+".y"]=C.clk_y)));var k=1,_=2,T=t("meta[name=csrf-token]").attr("content"),O=t("meta[name=csrf-param]").attr("content");O&&T&&(u.extraData=u.extraData||{},u.extraData[O]=T),u.forceSync?o():setTimeout(o,10);var j,E,D,I=50,L=t.parseXML||function(t,e){return window.ActiveXObject?(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)):e=(new DOMParser).parseFromString(t,"text/xml"),e&&e.documentElement&&"parsererror"!=e.documentElement.nodeName?e:null},P=t.parseJSON||function(t){return window.eval("("+t+")")},M=function(e,i,n){var r=e.getResponseHeader("content-type")||"",o="xml"===i||!i&&r.indexOf("xml")>=0,s=o?e.responseXML:e.responseText;return o&&"parsererror"===s.documentElement.nodeName&&t.error&&t.error("parsererror"),n&&n.dataFilter&&(s=n.dataFilter(s,i)),"string"==typeof s&&("json"===i||!i&&r.indexOf("json")>=0?s=P(s):("script"===i||!i&&r.indexOf("javascript")>=0)&&t.globalEval(s)),s};return A}if(!this.length)return n("ajaxSubmit: skipping submit process - no element selected"),this;var a,c,l,h=this;"function"==typeof e&&(e={success:e}),a=this.attr("method"),c=this.attr("action"),l="string"==typeof c?t.trim(c):"",l=l||window.location.href||"",l&&(l=(l.match(/^([^#]+)/)||[])[1]),e=t.extend(!0,{url:l,success:t.ajaxSettings.success,type:a||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},e);var u={};if(this.trigger("form-pre-serialize",[this,e,u]),u.veto)return n("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(e.beforeSerialize&&e.beforeSerialize(this,e)===!1)return n("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var d=e.traditional;void 0===d&&(d=t.ajaxSettings.traditional);var f,p=[],g=this.formToArray(e.semantic,p);if(e.data&&(e.extraData=e.data,f=t.param(e.data,d)),e.beforeSubmit&&e.beforeSubmit(g,this,e)===!1)return n("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[g,this,e,u]),u.veto)return n("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var m=t.param(g,d);f&&(m=m?m+"&"+f:f),"GET"==e.type.toUpperCase()?(e.url+=(e.url.indexOf("?")>=0?"&":"?")+m,e.data=null):e.data=m;var v=[];if(e.resetForm&&v.push(function(){h.resetForm()}),e.clearForm&&v.push(function(){h.clearForm(e.includeHidden)}),!e.dataType&&e.target){var b=e.success||function(){};v.push(function(i){var n=e.replaceTarget?"replaceWith":"html";t(e.target)[n](i).each(b,arguments)})}else e.success&&v.push(e.success);e.success=function(t,i,n){for(var r=e.context||this,o=0,s=v.length;s>o;o++)v[o].apply(r,[t,i,n||h,h])};var y=t('input[type=file]:enabled[value!=""]',this),x=y.length>0,w="multipart/form-data",C=h.attr("enctype")==w||h.attr("encoding")==w,S=r.fileapi&&r.formdata;n("fileAPI :"+S);var A,k=(x||C)&&!S;e.iframe!==!1&&(e.iframe||k)?e.closeKeepAlive?t.get(e.closeKeepAlive,function(){A=s(g)}):A=s(g):A=(x||C)&&S?o(g):t.ajax(e),h.removeData("jqxhr").data("jqxhr",A);for(var _=0;_<p.length;_++)p[_]=null;return this.trigger("form-submit-notify",[this,e]),this},t.fn.ajaxForm=function(r){if(r=r||{},r.delegation=r.delegation&&t.isFunction(t.fn.on),!r.delegation&&0===this.length){var o={s:this.selector,c:this.context};return!t.isReady&&o.s?(n("DOM not ready, queuing ajaxForm"),t(function(){t(o.s,o.c).ajaxForm(r)}),this):(n("terminating; zero elements found by selector"+(t.isReady?"":" (DOM not ready)")),this)}return r.delegation?(t(document).off("submit.form-plugin",this.selector,e).off("click.form-plugin",this.selector,i).on("submit.form-plugin",this.selector,r,e).on("click.form-plugin",this.selector,r,i),this):this.ajaxFormUnbind().bind("submit.form-plugin",r,e).bind("click.form-plugin",r,i)},t.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},t.fn.formToArray=function(e,i){var n=[];if(0===this.length)return n;var o=this[0],s=e?o.getElementsByTagName("*"):o.elements;if(!s)return n;var a,c,l,h,u,d,f;for(a=0,d=s.length;d>a;a++)if(u=s[a],l=u.name)if(e&&o.clk&&"image"==u.type)u.disabled||o.clk!=u||(n.push({name:l,value:t(u).val(),type:u.type}),n.push({name:l+".x",value:o.clk_x},{name:l+".y",value:o.clk_y}));else if(h=t.fieldValue(u,!0),h&&h.constructor==Array)for(i&&i.push(u),c=0,f=h.length;f>c;c++)n.push({name:l,value:h[c]});else if(r.fileapi&&"file"==u.type&&!u.disabled){i&&i.push(u);var p=u.files;if(p.length)for(c=0;c<p.length;c++)n.push({name:l,value:p[c],type:u.type});else n.push({name:l,value:"",type:u.type})}else null!==h&&"undefined"!=typeof h&&(i&&i.push(u),n.push({name:l,value:h,type:u.type,required:u.required}));if(!e&&o.clk){var g=t(o.clk),m=g[0];l=m.name,l&&!m.disabled&&"image"==m.type&&(n.push({name:l,value:g.val()}),n.push({name:l+".x",value:o.clk_x},{name:l+".y",value:o.clk_y}))}return n},t.fn.formSerialize=function(e){return t.param(this.formToArray(e))},t.fn.fieldSerialize=function(e){var i=[];return this.each(function(){var n=this.name;if(n){var r=t.fieldValue(this,e);if(r&&r.constructor==Array)for(var o=0,s=r.length;s>o;o++)i.push({name:n,value:r[o]});else null!==r&&"undefined"!=typeof r&&i.push({name:this.name,value:r})}}),t.param(i)},t.fn.fieldValue=function(e){for(var i=[],n=0,r=this.length;r>n;n++){var o=this[n],s=t.fieldValue(o,e);null===s||"undefined"==typeof s||s.constructor==Array&&!s.length||(s.constructor==Array?t.merge(i,s):i.push(s))}return i},t.fieldValue=function(e,i){var n=e.name,r=e.type,o=e.tagName.toLowerCase();if(void 0===i&&(i=!0),i&&(!n||e.disabled||"reset"==r||"button"==r||("checkbox"==r||"radio"==r)&&!e.checked||("submit"==r||"image"==r)&&e.form&&e.form.clk!=e||"select"==o&&-1==e.selectedIndex))return null;if("select"==o){var s=e.selectedIndex;if(0>s)return null;for(var a=[],c=e.options,l="select-one"==r,h=l?s+1:c.length,u=l?s:0;h>u;u++){var d=c[u];if(d.selected){var f=d.value;if(f||(f=d.attributes&&d.attributes.value&&!d.attributes.value.specified?d.text:d.value),l)return f;a.push(f)}}return a}return t(e).val()},t.fn.clearForm=function(e){return this.each(function(){t("input,select,textarea",this).clearFields(e)})},t.fn.clearFields=t.fn.clearInputs=function(e){var i=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var n=this.type,r=this.tagName.toLowerCase();i.test(n)||"textarea"==r?this.value="":"checkbox"==n||"radio"==n?this.checked=!1:"select"==r?this.selectedIndex=-1:"file"==n?/MSIE/.test(navigator.userAgent)?t(this).replaceWith(t(this).clone()):t(this).val(""):e&&(e===!0&&/hidden/.test(n)||"string"==typeof e&&t(this).is(e))&&(this.value="")
})},t.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},t.fn.enable=function(t){return void 0===t&&(t=!0),this.each(function(){this.disabled=!t})},t.fn.selected=function(e){return void 0===e&&(e=!0),this.each(function(){var i=this.type;if("checkbox"==i||"radio"==i)this.checked=e;else if("option"==this.tagName.toLowerCase()){var n=t(this).parent("select");e&&n[0]&&"select-one"==n[0].type&&n.find("option").selected(!1),this.selected=e}})},t.fn.ajaxSubmit.debug=!1}(jQuery),define("jquery.form",["jquery"],function(){}),function(e){jQuery.fn.extend({slimScroll:function(i){var n=e.extend({width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:.2,railDraggable:!0,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px"},i);return this.each(function(){function r(t){if(h){t=t||window.event;var i=0;t.wheelDelta&&(i=-t.wheelDelta/120),t.detail&&(i=t.detail/3),e(t.target||t.srcTarget||t.srcElement).closest("."+n.wrapperClass).is(x.parent())&&o(i,!0),t.preventDefault&&!y&&t.preventDefault(),y||(t.returnValue=!1)}}function o(t,e,i){y=!1;var r=t,o=x.outerHeight()-C.outerHeight();e&&(r=parseInt(C.css("top"))+t*parseInt(n.wheelStep)/100*C.outerHeight(),r=Math.min(Math.max(r,0),o),r=t>0?Math.ceil(r):Math.floor(r),C.css({top:r+"px"})),m=parseInt(C.css("top"))/(x.outerHeight()-C.outerHeight()),r=m*(x[0].scrollHeight-x.outerHeight()),i&&(r=t,t=r/x[0].scrollHeight*x.outerHeight(),t=Math.min(Math.max(t,0),o),C.css({top:t+"px"})),x.scrollTop(r),x.trigger("slimscrolling",~~r),c(),l()}function s(){window.addEventListener?(this.addEventListener("DOMMouseScroll",r,!1),this.addEventListener("mousewheel",r,!1),this.addEventListener("MozMousePixelScroll",r,!1)):document.attachEvent("onmousewheel",r)}function a(){g=Math.max(x.outerHeight()/x[0].scrollHeight*x.outerHeight(),b),C.css({height:g+"px"});var t=g==x.outerHeight()?"none":"block";C.css({display:t})}function c(){a(),clearTimeout(f),m==~~m?(y=n.allowPageScroll,v!=m&&x.trigger("slimscroll",0==~~m?"top":"bottom")):y=!1,v=m,g>=x.outerHeight()?y=!0:(C.stop(!0,!0).fadeIn("fast"),n.railVisible&&S.stop(!0,!0).fadeIn("fast"))}function l(){n.alwaysVisible||(f=setTimeout(function(){n.disableFadeOut&&h||u||d||(C.fadeOut("slow"),S.fadeOut("slow"))},1e3))}var h,u,d,f,p,g,m,v,b=30,y=!1,x=e(this);if(x.parent().hasClass(n.wrapperClass)){var w=x.scrollTop(),C=x.parent().find("."+n.barClass),S=x.parent().find("."+n.railClass);if(a(),e.isPlainObject(i)){if("height"in i&&"auto"==i.height){x.parent().css("height","auto"),x.css("height","auto");var A=x.parent().parent().height();x.parent().css("height",A),x.css("height",A)}if("scrollTo"in i)w=parseInt(n.scrollTo);else if("scrollBy"in i)w+=parseInt(n.scrollBy);else if("destroy"in i)return C.remove(),S.remove(),void x.unwrap();o(w,!1,!0)}}else{n.height="auto"==n.height?x.parent().height():n.height,w=e("<div></div>").addClass(n.wrapperClass).css({position:"relative",overflow:"hidden",width:n.width,height:n.height}),x.css({overflow:"hidden",width:n.width,height:n.height});var S=e("<div></div>").addClass(n.railClass).css({width:n.size,height:"100%",position:"absolute",top:0,display:n.alwaysVisible&&n.railVisible?"block":"none","border-radius":n.railBorderRadius,background:n.railColor,opacity:n.railOpacity,zIndex:90}),C=e("<div></div>").addClass(n.barClass).css({background:n.color,width:n.size,position:"absolute",top:0,opacity:n.opacity,display:n.alwaysVisible?"block":"none","border-radius":n.borderRadius,BorderRadius:n.borderRadius,MozBorderRadius:n.borderRadius,WebkitBorderRadius:n.borderRadius,zIndex:99}),A="right"==n.position?{right:n.distance}:{left:n.distance};S.css(A),C.css(A),x.wrap(w),x.parent().append(C),x.parent().append(S),n.railDraggable&&C.bind("mousedown",function(i){var n=e(document);return d=!0,t=parseFloat(C.css("top")),pageY=i.pageY,n.bind("mousemove.slimscroll",function(e){currTop=t+e.pageY-pageY,C.css("top",currTop),o(0,C.position().top,!1)}),n.bind("mouseup.slimscroll",function(){d=!1,l(),n.unbind(".slimscroll")}),!1}).bind("selectstart.slimscroll",function(t){return t.stopPropagation(),t.preventDefault(),!1}),S.hover(function(){c()},function(){l()}),C.hover(function(){u=!0},function(){u=!1}),x.hover(function(){h=!0,c(),l()},function(){h=!1,l()}),x.bind("touchstart",function(t){t.originalEvent.touches.length&&(p=t.originalEvent.touches[0].pageY)}),x.bind("touchmove",function(t){y||t.originalEvent.preventDefault(),t.originalEvent.touches.length&&(o((p-t.originalEvent.touches[0].pageY)/n.touchScrollStep,!0),p=t.originalEvent.touches[0].pageY)}),a(),"bottom"===n.start?(C.css({top:x.outerHeight()-C.outerHeight()}),o(0,!0)):"top"!==n.start&&(o(e(n.start).position().top,null,!0),n.alwaysVisible||C.hide()),s()}}),this}}),jQuery.fn.extend({slimscroll:jQuery.fn.slimScroll})}(jQuery),define("jquery.slimscroll",["jquery"],function(){}),function(t){"function"==typeof define&&define.amd?define("jquery.cookie",["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){function e(t){return a.raw?t:encodeURIComponent(t)}function i(t){return a.raw?t:decodeURIComponent(t)}function n(t){return e(a.json?JSON.stringify(t):String(t))}function r(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(s," ")),a.json?JSON.parse(t):t}catch(e){}}function o(e,i){var n=a.raw?e:r(e);return t.isFunction(i)?i(n):n}var s=/\+/g,a=t.cookie=function(r,s,c){if(void 0!==s&&!t.isFunction(s)){if(c=t.extend({},a.defaults,c),"number"==typeof c.expires){var l=c.expires,h=c.expires=new Date;h.setTime(+h+864e5*l)}return document.cookie=[e(r),"=",n(s),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}for(var u=r?void 0:{},d=document.cookie?document.cookie.split("; "):[],f=0,p=d.length;p>f;f++){var g=d[f].split("="),m=i(g.shift()),v=g.join("=");if(r&&r===m){u=o(v,s);break}r||void 0===(v=o(v))||(u[m]=v)}return u};a.defaults={},t.removeCookie=function(e,i){return void 0===t.cookie(e)?!1:(t.cookie(e,"",t.extend({},i,{expires:-1})),!t.cookie(e))}}),"undefined"==typeof PDFJS&&(("undefined"!=typeof window?window:this).PDFJS={}),PDFJS.version="0.8.1124",PDFJS.build="3e93104",function(){function t(t){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.infos&&console.log("Info: "+t)}function e(t){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.warnings&&console.log("Warning: "+t)}function i(t){if(arguments.length>1){var e=["Error:"];e.push.apply(e,arguments),console.log.apply(console,e),t=[].join.call(arguments," ")}else console.log("Error: "+t);throw console.log(n()),I.notify(D.unknown),new Error(t)}function n(){try{throw new Error}catch(t){return t.stack?t.stack.split("\n").slice(2).join("\n"):""}}function r(t,e){t||i(e)}function o(t,e){if(!e)return t;if(/^[a-z][a-z0-9+\-.]*:/i.test(e))return e;if("/"==e.charAt(0)){var i=t.indexOf("://");return"/"===e.charAt(1)?++i:i=t.indexOf("/",i+3),t.substring(0,i)+e}var i,n=t.length;i=t.lastIndexOf("#"),n=i>=0?i:n,i=t.lastIndexOf("?",n),n=i>=0?i:n;var r=t.lastIndexOf("/",n);return t.substring(0,r+1)+e}function s(t,e){if(!t)return!1;var i=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(t);if(!i)return e;switch(i=i[0].toLowerCase()){case"http":case"https":case"ftp":case"mailto":return!0;default:return!1}}function a(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!1}),i}function c(t){for(var e=[],i=t.length,n=0;i>n;++n)e.push(String.fromCharCode(t[n]));return e.join("")}function l(t){for(var e=t.length,i=new Uint8Array(e),n=0;e>n;++n)i[n]=255&t.charCodeAt(n);return i}function h(t){var e,i=t.length,n=[];if("þ"===t[0]&&"ÿ"===t[1])for(e=2;i>e;e+=2)n.push(String.fromCharCode(t.charCodeAt(e)<<8|t.charCodeAt(e+1)));else for(e=0;i>e;++e){var r=R[t.charCodeAt(e)];n.push(r?String.fromCharCode(r):t.charAt(e))}return n.join("")}function u(t){return"boolean"==typeof t}function d(t){return"number"==typeof t}function f(t){return"string"==typeof t}function p(t){return t instanceof Name}function g(t,e){if(!(t instanceof Dict))return!1;if(!e)return!0;var i=t.get("Type");return p(i)&&i.name==e}function m(t){return t instanceof Array}function v(t){return"object"==typeof t&&null!==t&&void 0!==t&&"getBytes"in t}function b(t){return"object"==typeof t&&null!==t&&void 0!==t&&"byteLength"in t}function y(t,e){this.name=t,this.comObj=e,this.callbackIndex=1,this.postMessageTransfers=!0;var n=this.callbacks={},r=this.actionHandler={};r.console_log=[function(t){console.log.apply(console,t)}],r.console_error=[function(t){console.error.apply(console,t)}],r._unsupported_feature=[function(t){I.notify(t)}],e.onmessage=function(t){var o=t.data;if(o.isReply){var s=o.callbackId;if(o.callbackId in n){var a=n[s];delete n[s],a(o.data)}else i("Cannot resolve callback "+s)}else if(o.action in r){var c=r[o.action];if(o.callbackId){var l={},h=new Promise(function(t,e){l.resolve=t,l.reject=e});l.promise=h,h.then(function(t){e.postMessage({isReply:!0,callbackId:o.callbackId,data:t})}),c[0].call(c[1],o.data,l)}else c[0].call(c[1],o.data)}else i("Unkown action from worker: "+o.action)}}function x(t,e,i){var n=new Image;n.onload=function(){i.resolve(t,n)},n.src=e}function w(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i}function C(t){t.mozCurrentTransform||(t._scaleX=t._scaleX||1,t._scaleY=t._scaleY||1,t._originalSave=t.save,t._originalRestore=t.restore,t._originalRotate=t.rotate,t._originalScale=t.scale,t._originalTranslate=t.translate,t._originalTransform=t.transform,t._originalSetTransform=t.setTransform,t._transformMatrix=[t._scaleX,0,0,t._scaleY,0,0],t._transformStack=[],Object.defineProperty(t,"mozCurrentTransform",{get:function(){return this._transformMatrix}}),Object.defineProperty(t,"mozCurrentTransformInverse",{get:function(){var t=this._transformMatrix,e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=e*r-i*n,c=i*n-e*r;return[r/a,i/c,n/c,e/a,(r*o-n*s)/c,(i*o-e*s)/a]}}),t.save=function(){var t=this._transformMatrix;this._transformStack.push(t),this._transformMatrix=t.slice(0,6),this._originalSave()},t.restore=function(){var t=this._transformStack.pop();t&&(this._transformMatrix=t,this._originalRestore())},t.translate=function(t,e){var i=this._transformMatrix;i[4]=i[0]*t+i[2]*e+i[4],i[5]=i[1]*t+i[3]*e+i[5],this._originalTranslate(t,e)},t.scale=function(t,e){var i=this._transformMatrix;i[0]=i[0]*t,i[1]=i[1]*t,i[2]=i[2]*e,i[3]=i[3]*e,this._originalScale(t,e)},t.transform=function(e,i,n,r,o,s){var a=this._transformMatrix;this._transformMatrix=[a[0]*e+a[2]*i,a[1]*e+a[3]*i,a[0]*n+a[2]*r,a[1]*n+a[3]*r,a[0]*o+a[2]*s+a[4],a[1]*o+a[3]*s+a[5]],t._originalTransform(e,i,n,r,o,s)},t.setTransform=function(e,i,n,r,o,s){this._transformMatrix=[e,i,n,r,o,s],t._originalSetTransform(e,i,n,r,o,s)},t.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this._transformMatrix;this._transformMatrix=[n[0]*e+n[2]*i,n[1]*e+n[3]*i,n[0]*-i+n[2]*e,n[1]*-i+n[3]*e,n[4],n[5]],this._originalRotate(t)})}function S(t){var e,i,n,r,o=1e3,s=t.width,a=t.height,c=s+1,l=new Uint8Array(c*(a+1)),h=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),u=s+7&-8,d=t.data,f=new Uint8Array(u*a),p=0;for(e=0,r=d.length;r>e;e++)for(var g=128,m=d[e];g>0;)f[p++]=m&g?0:255,g>>=1;var v=0;for(p=0,0!==f[p]&&(l[0]=1,++v),i=1;s>i;i++)f[p]!==f[p+1]&&(l[i]=f[p]?2:1,++v),p++;for(0!==f[p]&&(l[i]=2,++v),e=1;a>e;e++){p=e*u,n=e*c,f[p-u]!==f[p]&&(l[n]=f[p]?1:8,++v);var b=(f[p]?4:0)+(f[p-u]?8:0);for(i=1;s>i;i++)b=(b>>2)+(f[p+1]?4:0)+(f[p-u+1]?8:0),h[b]&&(l[n+i]=h[b],++v),p++;if(f[p-u]!==f[p]&&(l[n+i]=f[p]?2:4,++v),v>o)return null}for(p=u*(a-1),n=e*c,0!==f[p]&&(l[n]=8,++v),i=1;s>i;i++)f[p]!==f[p+1]&&(l[n+i]=f[p]?4:8,++v),p++;if(0!==f[p]&&(l[n+i]=4,++v),v>o)return null;var y=new Int32Array([0,c,-1,0,-c,0,0,0,1]),x=[];for(e=0;v&&a>=e;e++){for(var w=e*c,C=w+s;C>w&&!l[w];)w++;if(w!==C){var S,A=[w%c,e],k=l[w],_=w;do{var T=y[k];do w+=T;while(!l[w]);S=l[w],5!==S&&10!==S?(k=S,l[w]=0):(k=S&51*k>>4,l[w]&=k>>2|k<<2),A.push(w%c),A.push(w/c|0),--v}while(_!==w);x.push(A),--e}}var O=function(t){t.save(),t.scale(1/s,-1/a),t.translate(0,-a),t.beginPath();for(var e=0,i=x.length;i>e;e++){var n=x[e];t.moveTo(n[0],n[1]);for(var r=2,o=n.length;o>r;r+=2)t.lineTo(n[r],n[r+1])}t.fill(),t.beginPath(),t.restore()};return O}function A(t){var e=ge[t[0]];return e||i("Unknown IR type: "+t[0]),e.fromIR(t)}var k="undefined"==typeof window?this:window,_="undefined"==typeof window,T=[.001,0,0,.001,0,0],O={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},j={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};k.PDFJS||(k.PDFJS={}),k.PDFJS.pdfBug=!1,PDFJS.VERBOSITY_LEVELS={errors:0,warnings:1,infos:5};var E=PDFJS.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87},D=PDFJS.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"},I=PDFJS.UnsupportedManager=function(){var t=[];return{listen:function(e){t.push(e)},notify:function(i){e('Unsupported feature "'+i+'"');for(var n=0,r=t.length;r>n;n++)t[n](i)}}}();PDFJS.isValidUrl=s;var L=PDFJS.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},P=(function(){function t(t,e){this.name="PasswordException",this.message=t,this.code=e}return t.prototype=new Error,t.constructor=t,t}(),function(){function t(t,e){this.name="UnknownErrorException",this.message=t,this.details=e}return t.prototype=new Error,t.constructor=t,t}(),function(){function t(t){this.name="InvalidPDFException",this.message=t}return t.prototype=new Error,t.constructor=t,t}(),function(){function t(t){this.name="MissingPDFException",this.message=t}return t.prototype=new Error,t.constructor=t,t}(),function(){function t(t){this.message=t}return t.prototype=new Error,t.prototype.name="NotImplementedException",t.constructor=t,t}()),M=(function(){function t(t,e){this.begin=t,this.end=e,this.message="Missing data ["+t+", "+e+")"}return t.prototype=new Error,t.prototype.name="MissingDataException",t.constructor=t,t}(),function(){function t(t){this.message=t}return t.prototype=new Error,t.prototype.name="XRefParseException",t.constructor=t,t}(),[1,0,0,1,0,0]),B=PDFJS.Util=function(){function t(){}return t.makeCssRgb=function(t){return"rgb("+t[0]+","+t[1]+","+t[2]+")"},t.makeCssCmyk=function(e){var i=N.singletons.cmyk.getRgb(e,0);return t.makeCssRgb(i)},t.transform=function(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]},t.applyTransform=function(t,e){var i=t[0]*e[0]+t[1]*e[2]+e[4],n=t[0]*e[1]+t[1]*e[3]+e[5];return[i,n]},t.applyInverseTransform=function(t,e){var i=e[0]*e[3]-e[1]*e[2],n=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/i,r=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/i;return[n,r]},t.getAxialAlignedBoundingBox=function(e,i){var n=t.applyTransform(e,i),r=t.applyTransform(e.slice(2,4),i),o=t.applyTransform([e[0],e[3]],i),s=t.applyTransform([e[2],e[1]],i);return[Math.min(n[0],r[0],o[0],s[0]),Math.min(n[1],r[1],o[1],s[1]),Math.max(n[0],r[0],o[0],s[0]),Math.max(n[1],r[1],o[1],s[1])]},t.inverseTransform=function(t){var e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]},t.apply3dTransform=function(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2],t[3]*e[0]+t[4]*e[1]+t[5]*e[2],t[6]*e[0]+t[7]*e[1]+t[8]*e[2]]},t.singularValueDecompose2dScale=function(t){var e=[t[0],t[2],t[1],t[3]],i=t[0]*e[0]+t[1]*e[2],n=t[0]*e[1]+t[1]*e[3],r=t[2]*e[0]+t[3]*e[2],o=t[2]*e[1]+t[3]*e[3],s=(i+o)/2,a=Math.sqrt((i+o)*(i+o)-4*(i*o-r*n))/2,c=s+a||1,l=s-a||1;return[Math.sqrt(c),Math.sqrt(l)]},t.normalizeRect=function(t){var e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e},t.intersect=function(e,i){function n(t,e){return t-e}var r=[e[0],e[2],i[0],i[2]].sort(n),o=[e[1],e[3],i[1],i[3]].sort(n),s=[];return e=t.normalizeRect(e),i=t.normalizeRect(i),r[0]===e[0]&&r[1]===i[0]||r[0]===i[0]&&r[1]===e[0]?(s[0]=r[1],s[2]=r[2],o[0]===e[1]&&o[1]===i[1]||o[0]===i[1]&&o[1]===e[1]?(s[1]=o[1],s[3]=o[2],s):!1):!1},t.sign=function(t){return 0>t?-1:1},t.concatenateToArray=function(t,e){Array.prototype.push.apply(t,e)},t.prependToArray=function(t,e){Array.prototype.unshift.apply(t,e)},t.extendObj=function(t,e){for(var i in e)t[i]=e[i]},t.getInheritableProperty=function(t,e){for(;t&&!t.has(e);)t=t.get("Parent");return t?t.get(e):null},t.inherit=function(t,e,i){t.prototype=Object.create(e.prototype),t.prototype.constructor=t;for(var n in i)t.prototype[n]=i[n]},t.loadScript=function(t,e){var i=document.createElement("script"),n=!1;i.setAttribute("src",t),e&&(i.onload=function(){n||e(),n=!0}),document.getElementsByTagName("head")[0].appendChild(i)},t}(),R=(PDFJS.PageViewport=function(){function t(t,e,i,n,r,o){this.viewBox=t,this.scale=e,this.rotation=i,this.offsetX=n,this.offsetY=r;var s,a,c,l,h=(t[2]+t[0])/2,u=(t[3]+t[1])/2;switch(i%=360,i=0>i?i+360:i){case 180:s=-1,a=0,c=0,l=1;break;case 90:s=0,a=1,c=1,l=0;break;case 270:s=0,a=-1,c=-1,l=0;break;default:s=1,a=0,c=0,l=-1}o&&(c=-c,l=-l);var d,f,p,g;0===s?(d=Math.abs(u-t[1])*e+n,f=Math.abs(h-t[0])*e+r,p=Math.abs(t[3]-t[1])*e,g=Math.abs(t[2]-t[0])*e):(d=Math.abs(h-t[0])*e+n,f=Math.abs(u-t[1])*e+r,p=Math.abs(t[2]-t[0])*e,g=Math.abs(t[3]-t[1])*e),this.transform=[s*e,a*e,c*e,l*e,d-s*e*h-c*e*u,f-a*e*h-l*e*u],this.width=p,this.height=g,this.fontScale=e}return t.prototype={clone:function(e){e=e||{};var i="scale"in e?e.scale:this.scale,n="rotation"in e?e.rotation:this.rotation;return new t(this.viewBox.slice(),i,n,this.offsetX,this.offsetY,e.dontFlip)},convertToViewportPoint:function(t,e){return B.applyTransform([t,e],this.transform)},convertToViewportRectangle:function(t){var e=B.applyTransform([t[0],t[1]],this.transform),i=B.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],i[0],i[1]]},convertToPdfPoint:function(t,e){return B.applyInverseTransform([t,e],this.transform)}},t}(),[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364]),F=PDFJS.LegacyPromise=function(){return function(){var t,e,i=new Promise(function(i,n){t=i,e=n});return i.resolve=t,i.reject=e,i}}();!function(){function t(t){this._status=i,this._handlers=[],t.call(this,this._resolve.bind(this),this._reject.bind(this))}if(k.Promise)return"function"!=typeof k.Promise.all&&(k.Promise.all=function(t){var e,i,n=0,r=[],o=new k.Promise(function(t,n){e=t,i=n});return t.forEach(function(t,o){n++,t.then(function(t){r[o]=t,n--,0===n&&e(r)},i)}),0===n&&e(r),o}),void("function"!=typeof k.Promise.resolve&&(k.Promise.resolve=function(t){return new k.Promise(function(e){e(t)})}));var i=0,n=1,r=2,o=500,s={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(t){t._status!=i&&(this.handlers=this.handlers.concat(t._handlers),t._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var t=1,e=Date.now()+t;this.handlers.length>0;){var i=this.handlers.shift(),o=i.thisPromise._status,s=i.thisPromise._value;try{o===n?"function"==typeof i.onResolve&&(s=i.onResolve(s)):"function"==typeof i.onReject&&(s=i.onReject(s),o=n,i.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(i.thisPromise))}catch(a){o=r,s=a}if(i.nextPromise._updateStatus(o,s),Date.now()>=e)break}return this.handlers.length>0?void setTimeout(this.runHandlers.bind(this),0):void(this.running=!1)},addUnhandledRejection:function(t){this.unhandledRejections.push({promise:t,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(t){t._unhandledRejection=!1;for(var e=0;e<this.unhandledRejections.length;e++)this.unhandledRejections[e].promise===t&&(this.unhandledRejections.splice(e),e--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var t=Date.now(),i=0;i<this.unhandledRejections.length;i++)if(t-this.unhandledRejections[i].time>o){var n=this.unhandledRejections[i].promise._value,r="Unhandled rejection: "+n;n.stack&&(r+="\n"+n.stack),e(r),this.unhandledRejections.splice(i),i--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),o))}};t.all=function(e){function i(t){s._status!==r&&(c=[],o(t))}var n,o,s=new t(function(t,e){n=t,o=e}),a=e.length,c=[];if(0===a)return n(c),s;for(var l=0,h=e.length;h>l;++l){var u=e[l],d=function(t){return function(e){s._status!==r&&(c[t]=e,a--,0===a&&n(c))}}(l);t.isPromise(u)?u.then(d,i):d(u)}return s},t.isPromise=function(t){return t&&"function"==typeof t.then},t.resolve=function(e){return new t(function(t){t(e)})},t.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(e,i){if(this._status!==n&&this._status!==r){if(e==n&&t.isPromise(i))return void i.then(this._updateStatus.bind(this,n),this._updateStatus.bind(this,r));this._status=e,this._value=i,e===r&&0===this._handlers.length&&(this._unhandledRejection=!0,s.addUnhandledRejection(this)),s.scheduleHandlers(this)}},_resolve:function(t){this._updateStatus(n,t)},_reject:function(t){this._updateStatus(r,t)},then:function(e,i){var n=new t(function(t,e){this.resolve=e,this.reject=e});return this._handlers.push({thisPromise:this,onResolve:e,onReject:i,nextPromise:n}),s.scheduleHandlers(this),n}},k.Promise=t}();var $=function(){function t(t,e,i){for(;t.length<i;)t+=e;return t}function i(){this.started={},this.times=[],this.enabled=!0}return i.prototype={time:function(t){this.enabled&&(t in this.started&&e("Timer is already running for "+t),this.started[t]=Date.now())},timeEnd:function(t){this.enabled&&(t in this.started||e("Timer has not been started for "+t),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t])},toString:function(){for(var e=this.times,i="",n=0,r=0,o=e.length;o>r;++r){var s=e[r].name;s.length>n&&(n=s.length)}for(var r=0,o=e.length;o>r;++r){var a=e[r],c=a.end-a.start;i+=t(a.name," ",n)+" "+c+"ms\n"}return i}},i}();PDFJS.createBlob=function(t,e){if("undefined"!=typeof Blob)return new Blob([t],{type:e});var i=new MozBlobBuilder;return i.append(t),i.getBlob(e)},PDFJS.createObjectURL=function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return function(e,i){if(!PDFJS.disableCreateObjectURL&&"undefined"!=typeof URL&&URL.createObjectURL){var n=PDFJS.createBlob(e,i);return URL.createObjectURL(n)}for(var r="data:"+i+";base64,",o=0,s=e.length;s>o;o+=3){var a=255&e[o],c=255&e[o+1],l=255&e[o+2],h=a>>2,u=(3&a)<<4|c>>4,d=s>o+1?(15&c)<<2|l>>6:64,f=s>o+2?63&l:64;r+=t[h]+t[u]+t[d]+t[f]}return r}}(),y.prototype={on:function(t,e,n){var r=this.actionHandler;r[t]&&i('There is already an actionName called "'+t+'"'),r[t]=[e,n]},send:function(t,e,i,n){var r={action:t,data:e};if(i){var o=this.callbackIndex++;this.callbacks[o]=i,r.callbackId=o}n&&this.postMessageTransfers?this.comObj.postMessage(r,n):this.comObj.postMessage(r)}};var N=function(){function t(){i("should not call ColorSpace constructor")}return t.prototype={getRgb:function(t,e){var i=new Uint8Array(3);return this.getRgbItem(t,e,i,0),i},getRgbItem:function(){i("Should not call ColorSpace.getRgbItem")},getRgbBuffer:function(){i("Should not call ColorSpace.getRgbBuffer")},getOutputLength:function(){i("Should not call ColorSpace.getOutputLength")},isPassthrough:function(){return!1},fillRgb:function(t,e,i,n,r,o,s,a,c){var l=e*i,h=null,u=1<<s,d=i!=r||e!=n;if(this.isPassthrough(s))h=a;else if(1===this.numComps&&l>u&&"DeviceGray"!==this.name&&"DeviceRGB"!==this.name){for(var f=8>=s?new Uint8Array(u):new Uint16Array(u),p=0;u>p;p++)f[p]=p;var g=new Uint8Array(3*u);if(this.getRgbBuffer(f,0,u,g,0,s,0),d){h=new Uint8Array(3*l);for(var m=0,p=0;l>p;++p){var v=3*a[p];h[m++]=g[v],h[m++]=g[v+1],h[m++]=g[v+2]}}else for(var b=0,p=0;l>p;++p){var v=3*a[p];t[b++]=g[v],t[b++]=g[v+1],t[b++]=g[v+2],b+=c}}else d?(h=new Uint8Array(3*l),this.getRgbBuffer(a,0,l,h,0,s,0)):this.getRgbBuffer(a,0,n*o,t,0,s,c);if(h){d&&(h=PDFImage.resize(h,s,3,e,i,n,r));for(var m=0,b=0,p=0,y=n*o;y>p;p++)t[b++]=h[m++],t[b++]=h[m++],t[b++]=h[m++],b+=c}},usesZeroToOneRange:!0},t.parse=function(e,i,n){var r=t.parseToIR(e,i,n);return r instanceof z?r:t.fromIR(r)},t.fromIR=function(e){var n=m(e)?e[0]:e;switch(n){case"DeviceGrayCS":return this.singletons.gray;case"DeviceRgbCS":return this.singletons.rgb;case"DeviceCmykCS":return this.singletons.cmyk;case"CalGrayCS":var r=e[1].WhitePoint,o=e[1].BlackPoint,s=e[1].Gamma;return new U(r,o,s);case"PatternCS":var a=e[1];return a&&(a=t.fromIR(a)),new W(a);case"IndexedCS":var c=e[1],l=e[2],h=e[3];return new q(t.fromIR(c),l,h);case"AlternateCS":var u=e[1],d=e[2],f=e[3];return new z(u,t.fromIR(d),V.fromIR(f));case"LabCS":var r=e[1].WhitePoint,o=e[1].BlackPoint,p=e[1].Range;return new G(r,o,p);default:i("Unkown name "+n)}return null},t.parseToIR=function(e,n,r){if(p(e)){var o=r.get("ColorSpace");if(g(o)){var s=o.get(e.name);s&&(e=s)}}e=n.fetchIfRef(e);var a;if(p(e))switch(a=e.name,this.mode=a,a){case"DeviceGray":case"G":return"DeviceGrayCS";case"DeviceRGB":case"RGB":return"DeviceRgbCS";case"DeviceCMYK":case"CMYK":return"DeviceCmykCS";case"Pattern":return["PatternCS",null];default:i("unrecognized colorspace "+a)}else if(m(e))switch(a=e[0].name,this.mode=a,a){case"DeviceGray":case"G":return"DeviceGrayCS";case"DeviceRGB":case"RGB":return"DeviceRgbCS";case"DeviceCMYK":case"CMYK":return"DeviceCmykCS";case"CalGray":var c=e[1].getAll();return["CalGrayCS",c];case"CalRGB":return"DeviceRgbCS";case"ICCBased":var l=n.fetchIfRef(e[1]),h=l.dict,u=h.get("N");if(1==u)return"DeviceGrayCS";if(3==u)return"DeviceRgbCS";if(4==u)return"DeviceCmykCS";break;case"Pattern":var d=e[1];return d&&(d=t.parseToIR(d,n,r)),["PatternCS",d];case"Indexed":case"I":var f=t.parseToIR(e[1],n,r),b=e[2]+1,y=n.fetchIfRef(e[3]);return v(y)&&(y=y.getBytes()),["IndexedCS",f,b,y];case"Separation":case"DeviceN":var x=e[1],u=1;p(x)?u=1:m(x)&&(u=x.length);var w=t.parseToIR(e[2],n,r),C=V.getIR(n,n.fetchIfRef(e[3]));return["AlternateCS",u,w,C];case"Lab":var c=e[1].getAll();return["LabCS",c];default:i('unimplemented color space object "'+a+'"')}else i('unrecognized color space object: "'+e+'"');return null},t.isDefaultDecode=function(t,i){if(!t)return!0;if(2*i!==t.length)return e("The decode map is not the correct length"),!0;for(var n=0,r=t.length;r>n;n+=2)if(0!==t[n]||1!=t[n+1])return!1;return!0},t.singletons={get gray(){return a(this,"gray",new H)},get rgb(){return a(this,"rgb",new X)},get cmyk(){return a(this,"cmyk",new Y)}},t}(),z=function(){function t(t,e,i){this.name="Alternate",this.numComps=t,this.defaultColor=new Float32Array(t);for(var n=0;t>n;++n)this.defaultColor[n]=1;this.base=e,this.tintFn=i}return t.prototype={getRgb:N.prototype.getRgb,getRgbItem:function(t,e,i,n){var r=(this.base.numComps,"subarray"in t?t.subarray(e,e+this.numComps):Array.prototype.slice.call(t,e,e+this.numComps)),o=this.tintFn(r);this.base.getRgbItem(o,0,i,n)},getRgbBuffer:function(t,e,i,n,r,o,s){for(var a=this.tintFn,c=this.base,l=1/((1<<o)-1),h=c.numComps,u=c.usesZeroToOneRange,d=(c.isPassthrough(8)||!u)&&0===s,f=d?r:0,p=d?n:new Uint8Array(h*i),g=this.numComps,m=new Float32Array(g),v=0;i>v;v++){for(var b=0;g>b;b++)m[b]=t[e++]*l;var y=a(m);if(u)for(var b=0;h>b;b++)p[f++]=255*y[b];else c.getRgbItem(y,0,p,f),f+=h}d||c.getRgbBuffer(p,0,i,n,r,8,s)},getOutputLength:function(t,e){return this.base.getOutputLength(t*this.base.numComps/this.numComps,e)},isPassthrough:N.prototype.isPassthrough,fillRgb:N.prototype.fillRgb,isDefaultDecode:function(t){return N.isDefaultDecode(t,this.numComps)},usesZeroToOneRange:!0},t}(),W=function(){function t(t){this.name="Pattern",this.base=t}return t.prototype={},t}(),q=function(){function t(t,e,n){this.name="Indexed",this.numComps=1,this.defaultColor=new Uint8Array([0]),this.base=t,this.highVal=e;var r,o=t.numComps,s=o*e;if(v(n)){r=new Uint8Array(s);var a=n.getBytes(s);r.set(a)}else if(f(n)){r=new Uint8Array(s);for(var c=0;s>c;++c)r[c]=n.charCodeAt(c)}else n instanceof Uint8Array||n instanceof Array?r=n:i("Unrecognized lookup table: "+n);this.lookup=r}return t.prototype={getRgb:N.prototype.getRgb,getRgbItem:function(t,e,i,n){var r=this.base.numComps,o=t[e]*r;this.base.getRgbItem(this.lookup,o,i,n)},getRgbBuffer:function(t,e,i,n,r,o,s){for(var a=this.base,c=a.numComps,l=a.getOutputLength(c,s),h=this.lookup,u=0;i>u;++u){var d=t[e++]*c;a.getRgbBuffer(h,d,1,n,r,8,s),r+=l}},getOutputLength:function(t,e){return this.base.getOutputLength(t*this.base.numComps,e)},isPassthrough:N.prototype.isPassthrough,fillRgb:N.prototype.fillRgb,isDefaultDecode:function(){return!0},usesZeroToOneRange:!0},t}(),H=function(){function t(){this.name="DeviceGray",this.numComps=1,this.defaultColor=new Float32Array([0])}return t.prototype={getRgb:N.prototype.getRgb,getRgbItem:function(t,e,i,n){var r=255*t[e]|0;r=0>r?0:r>255?255:r,i[n]=i[n+1]=i[n+2]=r},getRgbBuffer:function(t,e,i,n,r,o,s){for(var a=255/((1<<o)-1),c=e,l=r,h=0;i>h;++h){var u=a*t[c++]|0;n[l++]=u,n[l++]=u,n[l++]=u,l+=s}},getOutputLength:function(t,e){return t*(3+e)},isPassthrough:N.prototype.isPassthrough,fillRgb:N.prototype.fillRgb,isDefaultDecode:function(t){return N.isDefaultDecode(t,this.numComps)},usesZeroToOneRange:!0},t}(),X=function(){function t(){this.name="DeviceRGB",this.numComps=3,this.defaultColor=new Float32Array([0,0,0])}return t.prototype={getRgb:N.prototype.getRgb,getRgbItem:function(t,e,i,n){var r=255*t[e]|0,o=255*t[e+1]|0,s=255*t[e+2]|0;i[n]=0>r?0:r>255?255:r,i[n+1]=0>o?0:o>255?255:o,i[n+2]=0>s?0:s>255?255:s},getRgbBuffer:function(t,e,i,n,r,o,s){if(8===o&&0===s)return void n.set(t.subarray(e,e+3*i),r);for(var a=255/((1<<o)-1),c=e,l=r,h=0;i>h;++h)n[l++]=a*t[c++]|0,n[l++]=a*t[c++]|0,n[l++]=a*t[c++]|0,l+=s},getOutputLength:function(t,e){return t*(3+e)/3|0},isPassthrough:function(t){return 8==t},fillRgb:N.prototype.fillRgb,isDefaultDecode:function(t){return N.isDefaultDecode(t,this.numComps)},usesZeroToOneRange:!0},t}(),Y=function(){function t(t,e,i,n,r){var o=t[e+0]*i,s=t[e+1]*i,a=t[e+2]*i,c=t[e+3]*i,l=o*(-4.387332384609988*o+54.48615194189176*s+18.82290502165302*a+212.25662451639585*c+-285.2331026137004)+s*(1.7149763477362134*s-5.6096736904047315*a+-17.873870861415444*c-5.497006427196366)+a*(-2.5217340131683033*a-21.248923337353073*c+17.5119270841813)+c*(-21.86122147463605*c-189.48180835922747)+255,h=o*(8.841041422036149*o+60.118027045597366*s+6.871425592049007*a+31.159100130055922*c+-79.2970844816548)+s*(-15.310361306967817*s+17.575251261109482*a+131.35250912493976*c-190.9453302588951)+a*(4.444339102852739*a+9.8632861493405*c-24.86741582555878)+c*(-20.737325471181034*c-187.80453709719578)+255,u=o*(.8842522430003296*o+8.078677503112928*s+30.89978309703729*a-.23883238689178934*c+-14.183576799673286)+s*(10.49593273432072*s+63.02378494754052*a+50.606957656360734*c-112.23884253719248)+a*(.03296041114873217*a+115.60384449646641*c+-193.58209356861505)+c*(-22.33816807309886*c-180.12613974708367)+255;
n[r]=l>255?255:0>l?0:l,n[r+1]=h>255?255:0>h?0:h,n[r+2]=u>255?255:0>u?0:u}function e(){this.name="DeviceCMYK",this.numComps=4,this.defaultColor=new Float32Array([0,0,0,1])}return e.prototype={getRgb:N.prototype.getRgb,getRgbItem:function(e,i,n,r){t(e,i,1,n,r)},getRgbBuffer:function(e,i,n,r,o,s,a){for(var c=1/((1<<s)-1),l=0;n>l;l++)t(e,i,c,r,o),i+=4,o+=3+a},getOutputLength:function(t,e){return t/4*(3+e)|0},isPassthrough:N.prototype.isPassthrough,fillRgb:N.prototype.fillRgb,isDefaultDecode:function(t){return N.isDefaultDecode(t,this.numComps)},usesZeroToOneRange:!0},e}(),U=function(){function n(n,r,o){this.name="CalGray",this.numComps=1,this.defaultColor=new Float32Array([0]),n||i("WhitePoint missing - required for color space CalGray"),r=r||[0,0,0],o=o||1,this.XW=n[0],this.YW=n[1],this.ZW=n[2],this.XB=r[0],this.YB=r[1],this.ZB=r[2],this.G=o,(this.XW<0||this.ZW<0||1!==this.YW)&&i("Invalid WhitePoint components for "+this.name+", no fallback available"),(this.XB<0||this.YB<0||this.ZB<0)&&(t("Invalid BlackPoint for "+this.name+", falling back to default"),this.XB=this.YB=this.ZB=0),(0!==this.XB||0!==this.YB||0!==this.ZB)&&e(this.name+", BlackPoint: XB: "+this.XB+", YB: "+this.YB+", ZB: "+this.ZB+", only default values are supported."),this.G<1&&(t("Invalid Gamma: "+this.G+" for "+this.name+", falling back to default"),this.G=1)}function r(t,e,i,n,r,o){var s=e[i]*o,a=Math.pow(s,t.G),c=(t.XW*a,t.YW*a),l=(t.ZW*a,c),h=Math.max(116*Math.pow(l,1/3)-16,0);n[r]=255*h/100,n[r+1]=255*h/100,n[r+2]=255*h/100}return n.prototype={getRgb:N.prototype.getRgb,getRgbItem:function(t,e,i,n){r(this,t,e,i,n,1)},getRgbBuffer:function(t,e,i,n,o,s,a){for(var c=1/((1<<s)-1),l=0;i>l;++l)r(this,t,e,n,o,c),e+=1,o+=3+a},getOutputLength:function(t,e){return t*(3+e)},isPassthrough:N.prototype.isPassthrough,fillRgb:N.prototype.fillRgb,isDefaultDecode:function(t){return N.isDefaultDecode(t,this.numComps)},usesZeroToOneRange:!0},n}(),G=function(){function e(e,n,r){this.name="Lab",this.numComps=3,this.defaultColor=new Float32Array([0,0,0]),e||i("WhitePoint missing - required for color space Lab"),n=n||[0,0,0],r=r||[-100,100,-100,100],this.XW=e[0],this.YW=e[1],this.ZW=e[2],this.amin=r[0],this.amax=r[1],this.bmin=r[2],this.bmax=r[3],this.XB=n[0],this.YB=n[1],this.ZB=n[2],(this.XW<0||this.ZW<0||1!==this.YW)&&i("Invalid WhitePoint components, no fallback available"),(this.XB<0||this.YB<0||this.ZB<0)&&(t("Invalid BlackPoint, falling back to default"),this.XB=this.YB=this.ZB=0),(this.amin>this.amax||this.bmin>this.bmax)&&(t("Invalid Range, falling back to defaults"),this.amin=-100,this.amax=100,this.bmin=-100,this.bmax=100)}function n(t){return t>=6/29?t*t*t:108/841*(t-4/29)}function r(t,e,i,n){return i+t*(n-i)/e}function o(t,e,i,o,s,a){var c=e[i],l=e[i+1],h=e[i+2];o!==!1&&(c=r(c,o,0,100),l=r(l,o,t.amin,t.amax),h=r(h,o,t.bmin,t.bmax)),l=l>t.amax?t.amax:l<t.amin?t.amin:l,h=h>t.bmax?t.bmax:h<t.bmin?t.bmin:h;var u,d,f,p=(c+16)/116,g=p+l/500,m=p-h/200,v=t.XW*n(g),b=t.YW*n(p),y=t.ZW*n(m);t.ZW<1?(u=3.1339*v+-1.617*b+y*-.4906,d=v*-.9785+1.916*b+.0333*y,f=.072*v+b*-.229+1.4057*y):(u=3.2406*v+-1.5372*b+y*-.4986,d=v*-.9689+1.8758*b+.0415*y,f=.0557*v+b*-.204+1.057*y),s[a]=0>=u?0:u>=1?255:255*Math.sqrt(u)|0,s[a+1]=0>=d?0:d>=1?255:255*Math.sqrt(d)|0,s[a+2]=0>=f?0:f>=1?255:255*Math.sqrt(f)|0}return e.prototype={getRgb:N.prototype.getRgb,getRgbItem:function(t,e,i,n){o(this,t,e,!1,i,n)},getRgbBuffer:function(t,e,i,n,r,s,a){for(var c=(1<<s)-1,l=0;i>l;l++)o(this,t,e,c,n,r),e+=3,r+=3+a},getOutputLength:function(t,e){return t*(3+e)/3|0},isPassthrough:N.prototype.isPassthrough,isDefaultDecode:function(){return!0},usesZeroToOneRange:!1},e}(),V=function(){var e=0,n=2,r=3,o=4;return{getSampleArray:function(t,e,i,n){for(var r=1,o=0,s=t.length;s>o;o++)r*=t[o];r*=e;for(var a=[],c=0,l=0,h=1/(Math.pow(2,i)-1),u=n.getBytes((r*i+7)/8),d=0,o=0;r>o;o++){for(;i>c;)l<<=8,l|=u[d++],c+=8;c-=i,a.push((l>>c)*h),l&=(1<<c)-1}return a},getIR:function(t,e){var n=e.dict;n||(n=e);var r=[this.constructSampled,null,this.constructInterpolated,this.constructStiched,this.constructPostScript],o=n.get("FunctionType"),s=r[o];return s||i("Unknown type of function"),s.call(this,e,n,t)},fromIR:function(t){var i=t[0];switch(i){case e:return this.constructSampledFromIR(t);case n:return this.constructInterpolatedFromIR(t);case r:return this.constructStichedFromIR(t);default:return this.constructPostScriptFromIR(t)}},parse:function(t,e){var i=this.getIR(t,e);return this.fromIR(i)},constructSampled:function(n,r){function o(t){for(var e=t.length,i=(t.length/2,[]),n=0,r=0;e>r;r+=2)i[n]=[t[r],t[r+1]],++n;return i}var s=r.get("Domain"),a=r.get("Range");s&&a||i("No domain or range");var c=s.length/2,l=a.length/2;s=o(s),a=o(a);var h=r.get("Size"),u=r.get("BitsPerSample"),d=r.get("Order")||1;1!==d&&t("No support for cubic spline interpolation: "+d);var f=r.get("Encode");if(!f){f=[];for(var p=0;c>p;++p)f.push(0),f.push(h[p]-1)}f=o(f);var g=r.get("Decode");g=g?o(g):a;var m=this.getSampleArray(h,l,u,n);return[e,c,s,f,g,m,h,l,Math.pow(2,u)-1,a]},constructSampledFromIR:function(t){function e(t,e,i,n,r){return n+(t-e)*((r-n)/(i-e))}return function(n){var r=t[1],o=t[2],s=t[3],a=t[4],c=t[5],l=t[6],h=t[7],u=(t[8],t[9]);r!=n.length&&i("Incorrect number of arguments: "+r+" != "+n.length);for(var d=n,f=1<<r,p=new Float64Array(f),g=new Uint32Array(f),m=0;f>m;m++)p[m]=1;for(var v=h,b=1,y=0;r>y;++y){var x=o[y][0],w=o[y][1],C=Math.min(Math.max(d[y],x),w),S=e(C,x,w,s[y][0],s[y][1]),A=l[y];S=Math.min(Math.max(S,0),A-1);for(var k=A-1>S?Math.floor(S):S-1,_=k+1-S,T=S-k,O=k*v,j=O+v,m=0;f>m;m++)m&b?(p[m]*=T,g[m]+=j):(p[m]*=_,g[m]+=O);v*=A,b<<=1}for(var E=new Float64Array(h),m=0;h>m;++m){for(var D=0,y=0;f>y;y++)D+=c[g[y]+m]*p[y];D=e(D,0,1,a[m][0],a[m][1]),E[m]=Math.min(Math.max(D,u[m][0]),u[m][1])}return E}},constructInterpolated:function(t,e){var r=e.get("C0")||[0],o=e.get("C1")||[1],s=e.get("N");m(r)&&m(o)||i("Illegal dictionary for interpolated function");for(var a=r.length,c=[],l=0;a>l;++l)c.push(o[l]-r[l]);return[n,r,c,s]},constructInterpolatedFromIR:function(t){var e=t[1],i=t[2],n=t[3],r=i.length;return function(t){for(var o=1==n?t[0]:Math.pow(t[0],n),s=[],a=0;r>a;++a)s.push(e[a]+o*i[a]);return s}},constructStiched:function(t,e,n){var o=e.get("Domain");o||i("No domain");var s=o.length/2;1!=s&&i("Bad domain for stiched function");for(var a=e.get("Functions"),c=[],l=0,h=a.length;h>l;++l)c.push(V.getIR(n,n.fetchIfRef(a[l])));var u=e.get("Bounds"),d=e.get("Encode");return[r,o,u,d,c]},constructStichedFromIR:function(t){for(var e=t[1],i=t[2],n=t[3],r=t[4],o=[],s=0,a=r.length;a>s;s++)o.push(V.fromIR(r[s]));return function(t){for(var r=function(t,e,i){return t>i?t=i:e>t&&(t=e),t},s=r(t[0],e[0],e[1]),a=0,c=i.length;c>a&&!(s<i[a]);++a);var l=e[0];a>0&&(l=i[a-1]);var h=e[1];a<i.length&&(h=i[a]);var u=n[2*a],d=n[2*a+1],f=u+(s-l)*(d-u)/(h-l);return o[a]([f])}},constructPostScript:function(t,e){var n=e.get("Domain"),r=e.get("Range");n||i("No domain."),r||i("No range.");var s=new PostScriptLexer(t),a=new PostScriptParser(s),c=a.parse();return[o,n,r,c]},constructPostScriptFromIR:function(t){var e=t[1],i=t[2],n=t[3],r=i.length/2,o=new K(n),s=new Q;return function(t){for(var n=[],a=0,c=e.length/2;c>a;++a)n.push(t[a]);var l=n.join("_");if(s.has(l))return s.get(l);var h=o.execute(n),u=[];for(a=r-1;a>=0;--a){var d=h.pop(),f=2*a;d<i[f]?d=i[f]:d>i[f+1]&&(d=i[f+1]),u[a]=d}return s.set(l,u),u}}}}(),Q=function(){function t(){this.cache={},this.total=0}var e=1024;return t.prototype={has:function(t){return t in this.cache},get:function(t){return this.cache[t]},set:function(t,i){this.total<e&&(this.cache[t]=i,this.total++)}},t}(),J=function(){function t(t){this.stack=t||[]}var e=100;return t.prototype={push:function(t){this.stack.length>=e&&i("PostScript function stack overflow."),this.stack.push(t)},pop:function(){return this.stack.length<=0&&i("PostScript function stack underflow."),this.stack.pop()},copy:function(t){this.stack.length+t>=e&&i("PostScript function stack overflow.");for(var n=this.stack,r=n.length-t,o=t-1;o>=0;o--,r++)n.push(n[r])},index:function(t){this.push(this.stack[this.stack.length-t-1])},roll:function(t,e){var i,n,r,o=this.stack,s=o.length-t,a=o.length-1,c=s+(e-Math.floor(e/t)*t);for(i=s,n=a;n>i;i++,n--)r=o[i],o[i]=o[n],o[n]=r;for(i=s,n=c-1;n>i;i++,n--)r=o[i],o[i]=o[n],o[n]=r;for(i=c,n=a;n>i;i++,n--)r=o[i],o[i]=o[n],o[n]=r}},t}(),K=function(){function t(t){this.operators=t}return t.prototype={execute:function(t){for(var e,n,r,o=new J(t),s=0,a=this.operators,c=a.length;c>s;)if(e=a[s++],"number"!=typeof e)switch(e){case"jz":r=o.pop(),n=o.pop(),n||(s=r);break;case"j":n=o.pop(),s=n;break;case"abs":n=o.pop(),o.push(Math.abs(n));break;case"add":r=o.pop(),n=o.pop(),o.push(n+r);break;case"and":r=o.pop(),n=o.pop(),o.push(u(n)&&u(r)?n&&r:n&r);break;case"atan":n=o.pop(),o.push(Math.atan(n));break;case"bitshift":r=o.pop(),n=o.pop(),o.push(n>0?n<<r:n>>r);break;case"ceiling":n=o.pop(),o.push(Math.ceil(n));break;case"copy":n=o.pop(),o.copy(n);break;case"cos":n=o.pop(),o.push(Math.cos(n));break;case"cvi":n=0|o.pop(),o.push(n);break;case"cvr":break;case"div":r=o.pop(),n=o.pop(),o.push(n/r);break;case"dup":o.copy(1);break;case"eq":r=o.pop(),n=o.pop(),o.push(n==r);break;case"exch":o.roll(2,1);break;case"exp":r=o.pop(),n=o.pop(),o.push(Math.pow(n,r));break;case"false":o.push(!1);break;case"floor":n=o.pop(),o.push(Math.floor(n));break;case"ge":r=o.pop(),n=o.pop(),o.push(n>=r);break;case"gt":r=o.pop(),n=o.pop(),o.push(n>r);break;case"idiv":r=o.pop(),n=o.pop(),o.push(n/r|0);break;case"index":n=o.pop(),o.index(n);break;case"le":r=o.pop(),n=o.pop(),o.push(r>=n);break;case"ln":n=o.pop(),o.push(Math.log(n));break;case"log":n=o.pop(),o.push(Math.log(n)/Math.LN10);break;case"lt":r=o.pop(),n=o.pop(),o.push(r>n);break;case"mod":r=o.pop(),n=o.pop(),o.push(n%r);break;case"mul":r=o.pop(),n=o.pop(),o.push(n*r);break;case"ne":r=o.pop(),n=o.pop(),o.push(n!=r);break;case"neg":n=o.pop(),o.push(-r);break;case"not":n=o.pop(),o.push(u(n)&&u(r)?n&&r:n&r);break;case"or":r=o.pop(),n=o.pop(),o.push(u(n)&&u(r)?n||r:n|r);break;case"pop":o.pop();break;case"roll":r=o.pop(),n=o.pop(),o.roll(n,r);break;case"round":n=o.pop(),o.push(Math.round(n));break;case"sin":n=o.pop(),o.push(Math.sin(n));break;case"sqrt":n=o.pop(),o.push(Math.sqrt(n));break;case"sub":r=o.pop(),n=o.pop(),o.push(n-r);break;case"true":o.push(!0);break;case"truncate":n=o.pop(),n=0>n?Math.ceil(n):Math.floor(n),o.push(n);break;case"xor":r=o.pop(),n=o.pop(),o.push(u(n)&&u(r)?n!=r:n^r);break;default:i("Unknown operator "+e)}else o.push(e);return o.stack}},t}(),Z=function(){function t(t,e,i){var n=B.getAxialAlignedBoundingBox(e,i),r=n[0],o=n[1],s=n[2],a=n[3];if(r===s||o===a)return[1,0,0,1,t[0],t[1]];var c=(t[2]-t[0])/(s-r),l=(t[3]-t[1])/(a-o);return[c,0,0,l,t[0]-r*c,t[1]-o*l]}function i(t){var e=t.get("AP");if(g(e)){var i,n=e.get("N");if(g(n)){var r=t.get("AS");r&&n.has(r.name)&&(i=n.get(r.name))}else i=n;return i}}function n(t){if(t.data)return void(this.data=t.data);var e=t.dict,n=this.data={};n.subtype=e.get("Subtype").name;var r=e.get("Rect");n.rect=B.normalizeRect(r),n.annotationFlags=e.get("F");var o=e.get("C");if(n.color=m(o)&&3===o.length?o:[0,0,0],e.has("BS")){var s=e.get("BS");n.borderWidth=s.has("W")?s.get("W"):1}else{var a=e.get("Border")||[0,0,1];n.borderWidth=a[2]||0;var c=a[3];if(n.borderWidth>0&&c&&m(c)){var l=c.length;if(l>0){for(var h=!1,u=0,d=0;l>d;d++){if(!(+c[d]>=0)){h=!0;break}c[d]>0&&u++}(h||0===u)&&(n.borderWidth=0)}}}this.appearance=i(e),n.hasAppearance=!!this.appearance}return n.prototype={getData:function(){return this.data},hasHtml:function(){return!1},getHtmlElement:function(){throw new P("getHtmlElement() should be implemented in subclass")},getEmptyContainer:function(t,e){r(!_,"getEmptyContainer() should be called from main thread"),e=e||this.data.rect;var i=document.createElement(t);return i.style.width=Math.ceil(e[2]-e[0])+"px",i.style.height=Math.ceil(e[3]-e[1])+"px",i},isViewable:function(){var t=this.data;return!(!t||t.annotationFlags&&34&t.annotationFlags||!t.rect)},loadResources:function(t){var e=new F;return this.appearance.dict.getAsync("Resources").then(function(i){if(!i)return void e.resolve();var n=new ObjectLoader(i.map,t,i.xref);n.load().then(function(){e.resolve(i)})}.bind(this)),e},getOperatorList:function(e){var i=new F;if(!this.appearance)return i.resolve(new OperatorList),i;{var n=this.data,r=this.appearance.dict,o=this.loadResources(["ExtGState","ColorSpace","Pattern","Shading","XObject","Font"]),s=r.get("BBox")||[0,0,1,1],a=r.get("Matrix")||[1,0,0,1,0,0],c=t(n.rect,s,a);n.border}return o.then(function(t){var r=new OperatorList;r.addOp(E.beginAnnotation,[n.rect,c,a]),e.getOperatorList(this.appearance,t,r),r.addOp(E.endAnnotation,[]),i.resolve(r),this.appearance.reset()}.bind(this)),i}},n.getConstructor=function(t,e){if(t){if("Link"===t)return ne;if("Text"===t)return ie;if("Widget"===t){if(!e)return;return"Tx"===e?ee:te}return n}},n.fromData=function(t){var e=t.subtype,i=t.fieldType,r=n.getConstructor(e,i);return r?new r({data:t}):void 0},n.fromRef=function(t,i){var r=t.fetchIfRef(i);if(g(r)){var o=r.get("Subtype");if(o=p(o)?o.name:""){var s=B.getInheritableProperty(r,"FT");s=p(s)?s.name:"";var a=n.getConstructor(o,s);if(a){var c={dict:r,ref:i},l=new a(c);return l.isViewable()?l:void e("unimplemented annotation type: "+o)}}}},n.appendToOperatorList=function(t,e,i,n){function r(t){o.reject(t)}for(var o=new F,s=[],a=0,c=t.length;c>a;++a)s.push(t[a].getOperatorList(n));return Promise.all(s).then(function(t){e.addOp(E.beginAnnotations,[]);for(var i=0,n=t.length;n>i;++i){var r=t[i];e.addOpList(r)}e.addOp(E.endAnnotations,[]),o.resolve()},r),o},n}();PDFJS.Annotation=Z;var te=function(){function t(t){if(Z.call(this,t),!t.data){var e=t.dict,i=this.data;i.fieldValue=h(B.getInheritableProperty(e,"V")||""),i.alternativeText=h(e.get("TU")||""),i.defaultAppearance=B.getInheritableProperty(e,"DA")||"";var n=B.getInheritableProperty(e,"FT");i.fieldType=p(n)?n.name:"",i.fieldFlags=B.getInheritableProperty(e,"Ff")||0,this.fieldResources=B.getInheritableProperty(e,"DR")||new Dict;for(var r=[],o=e,s=t.ref;o;){var a=o.get("Parent"),c=o.getRaw("Parent"),l=o.get("T");if(l)r.unshift(h(l));else{var u,d,f=a.get("Kids");for(u=0,d=f.length;d>u;u++){var g=f[u];if(g.num==s.num&&g.gen==s.gen)break}r.unshift("`"+u)}o=a,s=c}i.fullName=r.join(".")}}var i=Z.prototype;return B.inherit(t,Z,{isViewable:function(){return"Sig"===this.data.fieldType?(e("unimplemented annotation type: Widget signature"),!1):i.isViewable.call(this)}}),t}(),ee=function(){function t(t){te.call(this,t),t.data||(this.data.textAlignment=B.getInheritableProperty(t.dict,"Q"))}function e(t,e,i){var n=t.style;if(n.fontSize=e.fontSize+"px",n.direction=e.fontDirection<0?"rtl":"ltr",i){n.fontWeight=i.black?i.bold?"bolder":"bold":i.bold?"bold":"normal",n.fontStyle=i.italic?"italic":"normal";var r=i.loadedName,o=r?'"'+r+'", ':"",s=i.fallbackName||"Helvetica, sans-serif";n.fontFamily=o+s}}te.prototype;return B.inherit(t,te,{hasHtml:function(){return!this.data.hasAppearance&&!!this.data.fieldValue},getHtmlElement:function(t){r(!_,"getHtmlElement() shall be called from main thread");var i=this.data,n=this.getEmptyContainer("div");n.style.display="table";var o=document.createElement("div");o.textContent=i.fieldValue;var s=i.textAlignment;o.style.textAlign=["left","center","right"][s],o.style.verticalAlign="middle",o.style.display="table-cell";{var a=i.fontRefName?t.getData(i.fontRefName):null;e(o,i,a)}return n.appendChild(o),n},getOperatorList:function(t){if(this.appearance)return Z.prototype.getOperatorList.call(this,t);var e=new F,i=new OperatorList,n=this.data,r=n.defaultAppearance;if(!r)return e.resolve(i),e;var o=new Stream(l(r));t.getOperatorList(o,this.fieldResources,i);var s=i.fnArray,a=i.argsArray,c=[];n.rgb=[0,0,0];for(var h=0,u=c.length;u>h;++h){var d=s[h],f=a[h];if(d===E.setFont){n.fontRefName=f[0];var p=f[1];0>p?(n.fontDirection=-1,n.fontSize=-p):(n.fontDirection=1,n.fontSize=p)}else if(d===E.setFillRGBColor)n.rgb=f;else if(d===E.setFillGray){var g=255*f[0];n.rgb=[g,g,g]}}return e.resolve(i),e}}),t}(),ie=function(){function t(t){if(Z.call(this,t),!t.data){var e=t.dict,i=this.data,n=e.get("Contents"),r=e.get("T");i.content=h(n||""),i.title=h(r||""),i.name=e.has("Name")?e.get("Name").name:"Note"}}var e=10;return B.inherit(t,Z,{getOperatorList:function(){var t=new F;return t.resolve(new OperatorList),t},hasHtml:function(){return!0},getHtmlElement:function(){r(!_,"getHtmlElement() shall be called from main thread");var t=this.data,i=t.rect;i[3]-i[1]<e&&(i[3]=i[1]+e),i[2]-i[0]<e&&(i[2]=i[0]+(i[3]-i[1]));var n=this.getEmptyContainer("section",i);n.className="annotText";var o=document.createElement("img");o.style.height=n.style.height;var s=t.name;o.src=PDFJS.imageResourcesPath+"annotation-"+s.toLowerCase()+".svg",o.alt="[{{type}} Annotation]",o.dataset.l10nId="text_annotation_type",o.dataset.l10nArgs=JSON.stringify({type:s});var a=document.createElement("div");a.setAttribute("hidden",!0);var c=document.createElement("h1"),l=document.createElement("p");if(a.style.left=Math.floor(i[2]-i[0])+"px",a.style.top="0px",c.textContent=t.title,t.content||t.title){for(var h=document.createElement("span"),u=t.content.split(/(?:\r\n?|\n)/),d=0,f=u.length;f>d;++d){var p=u[d];h.appendChild(document.createTextNode(p)),f-1>d&&h.appendChild(document.createElement("br"))}l.appendChild(h);var g=function(){n.style.zIndex+=1,a.removeAttribute("hidden")},m=function(t){(t.toElement||t.relatedTarget)&&(n.style.zIndex-=1,a.setAttribute("hidden",!0))};a.addEventListener("mouseover",g,!1),a.addEventListener("mouseout",m,!1),o.addEventListener("mouseover",g,!1),o.addEventListener("mouseout",m,!1)}else a.setAttribute("hidden",!0);return a.appendChild(c),a.appendChild(l),n.appendChild(o),n.appendChild(a),n}}),t}(),ne=function(){function t(t){if(Z.call(this,t),!t.data){var n=t.dict,r=this.data,o=n.get("A");if(o){var a=o.get("S").name;if("URI"===a){var c=o.get("URI");p(c)?c="/"+c.name:c&&(c=i(c)),s(c,!1)||(c=""),r.url=c}else if("GoTo"===a)r.dest=o.get("D");else if("GoToR"===a){var l=o.get("F");g(l)&&(c=l.get("F")||""),s(c,!1)||(c=""),r.url=c,r.dest=o.get("D")}else"Named"===a?r.action=o.get("N").name:e("unrecognized link type: "+a)}else if(n.has("Dest")){var h=n.get("Dest");r.dest=p(h)?h.name:h}}}function i(t){return t&&0===t.indexOf("www.")?"http://"+t:t}return B.inherit(t,Z,{hasOperatorList:function(){return!1},hasHtml:function(){return!0},getHtmlElement:function(){var t=this.data.rect,e=document.createElement("a"),i=this.data.borderWidth;e.style.borderWidth=i+"px";for(var n=this.data.color,r=[],o=0;3>o;++o)r[o]=Math.round(255*n[o]);e.style.borderColor=B.makeCssRgb(r),e.style.borderStyle="solid";var s=t[2]-t[0]-2*i,a=t[3]-t[1]-2*i;return e.style.width=s+"px",e.style.height=a+"px",e.href=this.data.url||"",e}}),t}();PDFJS.maxImageSize=void 0===PDFJS.maxImageSize?-1:PDFJS.maxImageSize,PDFJS.disableFontFace=void 0===PDFJS.disableFontFace?!1:PDFJS.disableFontFace,PDFJS.imageResourcesPath=void 0===PDFJS.imageResourcesPath?"":PDFJS.imageResourcesPath,PDFJS.disableWorker=void 0===PDFJS.disableWorker?!1:PDFJS.disableWorker,PDFJS.workerSrc=void 0===PDFJS.workerSrc?null:PDFJS.workerSrc,PDFJS.disableRange=void 0===PDFJS.disableRange?!1:PDFJS.disableRange,PDFJS.disableAutoFetch=void 0===PDFJS.disableAutoFetch?!1:PDFJS.disableAutoFetch,PDFJS.pdfBug=void 0===PDFJS.pdfBug?!1:PDFJS.pdfBug,PDFJS.postMessageTransfers=void 0===PDFJS.postMessageTransfers?!0:PDFJS.postMessageTransfers,PDFJS.disableCreateObjectURL=void 0===PDFJS.disableCreateObjectURL?!1:PDFJS.disableCreateObjectURL,PDFJS.verbosity=void 0===PDFJS.verbosity?PDFJS.VERBOSITY_LEVELS.warnings:PDFJS.verbosity,PDFJS.getDocument=function(t,e,n,r){var s,a,c;"string"==typeof t?t={url:t}:b(t)?t={data:t}:"object"!=typeof t&&i("Invalid parameter in getDocument, need either Uint8Array, string or a parameter object"),t.url||t.data||i("Invalid parameter array, need either .data or .url");var l={};for(var h in t)l[h]="url"!==h||"undefined"==typeof window?t[h]:o(window.location.href,t[h]);return s=new PDFJS.LegacyPromise,a=new PDFJS.LegacyPromise,c=new se(s,a,e,r),s.then(function(){c.passwordCallback=n,c.fetchDocument(l)}),a};var re=function(){function t(t,e){this.pdfInfo=t,this.transport=e}return t.prototype={get numPages(){return this.pdfInfo.numPages},get fingerprint(){return this.pdfInfo.fingerprint},getPage:function(t){return this.transport.getPage(t)},getPageIndex:function(t){return this.transport.getPageIndex(t)},getDestinations:function(){return this.transport.getDestinations()},getJavaScript:function(){var t=new PDFJS.LegacyPromise,e=this.pdfInfo.javaScript;return t.resolve(e),t},getOutline:function(){var t=new PDFJS.LegacyPromise,e=this.pdfInfo.outline;return t.resolve(e),t},getMetadata:function(){var t=new PDFJS.LegacyPromise,e=this.pdfInfo.info,i=this.pdfInfo.metadata;return t.resolve({info:e,metadata:i?new PDFJS.Metadata(i):null}),t},getData:function(){var t=new PDFJS.LegacyPromise;return this.transport.getData(t),t},getDownloadInfo:function(){return this.transport.downloadInfoPromise},cleanup:function(){this.transport.startCleanup()},destroy:function(){this.transport.destroy()}},t}(),oe=function(){function t(t,e){this.pageInfo=t,this.transport=e,this.stats=new $,this.stats.enabled=!!k.PDFJS.enableStats,this.commonObjs=e.commonObjs,this.objs=new ae,this.receivingOperatorList=!1,this.cleanupAfterRender=!1,this.pendingDestroy=!1,this.renderTasks=[]}return t.prototype={get pageNumber(){return this.pageInfo.pageIndex+1},get rotate(){return this.pageInfo.rotate},get ref(){return this.pageInfo.ref},get view(){return this.pageInfo.view},getViewport:function(t,e){return arguments.length<2&&(e=this.rotate),new PDFJS.PageViewport(this.view,t,e,0,0)},getAnnotations:function(){if(this.annotationsPromise)return this.annotationsPromise;var t=new PDFJS.LegacyPromise;return this.annotationsPromise=t,this.transport.getAnnotations(this.pageInfo.pageIndex),t},render:function(t){function e(t){var e=o.renderTasks.indexOf(n);e>=0&&o.renderTasks.splice(e,1),o.cleanupAfterRender&&(o.pendingDestroy=!0),o._tryDestroy(),t?r.promise.reject(t):r.promise.resolve(),i.timeEnd("Rendering"),i.timeEnd("Overall")}var i=this.stats;i.time("Overall"),this.pendingDestroy=!1,this.displayReadyPromise||(this.receivingOperatorList=!0,this.displayReadyPromise=new F,this.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this.stats.time("Page Request"),this.transport.messageHandler.send("RenderPageRequest",{pageIndex:this.pageNumber-1}));var n=new le(e,t,this.objs,this.commonObjs,this.operatorList,this.pageNumber);this.renderTasks.push(n);var r=new ce(n),o=this;return this.displayReadyPromise.then(function(t){return o.pendingDestroy?void e():(i.time("Rendering"),n.initalizeGraphics(t),void n.operatorListChanged())},function(t){e(t)}),r},getTextContent:function(){var t=new PDFJS.LegacyPromise;return this.transport.messageHandler.send("GetTextContent",{pageIndex:this.pageNumber-1},function(e){t.resolve(e)}),t},destroy:function(){this.pendingDestroy=!0,this._tryDestroy()},_tryDestroy:function(){this.pendingDestroy&&0===this.renderTasks.length&&!this.receivingOperatorList&&(delete this.operatorList,delete this.displayReadyPromise,delete this.annotationsPromise,this.objs.clear(),this.pendingDestroy=!1)},_startRenderPage:function(t){this.displayReadyPromise.resolve(t)},_renderPageChunk:function(t){for(var e=0,i=t.length;i>e;e++)this.operatorList.fnArray.push(t.fnArray[e]),this.operatorList.argsArray.push(t.argsArray[e]);this.operatorList.lastChunk=t.lastChunk;for(var e=0;e<this.renderTasks.length;e++)this.renderTasks[e].operatorListChanged();t.lastChunk&&(this.receivingOperatorList=!1,this._tryDestroy())}},t}(),se=function(){function n(e,n,r,o){if(this.pdfDataRangeTransport=r,this.workerReadyPromise=n,this.progressCallback=o,this.commonObjs=new ae,this.pageCache=[],this.pagePromises=[],this.downloadInfoPromise=new PDFJS.LegacyPromise,this.passwordCallback=null,!k.PDFJS.disableWorker&&"undefined"!=typeof Worker){var s=PDFJS.workerSrc;s||i("No PDFJS.workerSrc specified");try{var a=new Worker(s),c=new y("main",a);this.messageHandler=c,c.on("test",function(t){var i=t&&t.supportTypedArray;i?(this.worker=a,t.supportTransfers||(PDFJS.postMessageTransfers=!1),this.setupMessageHandler(c),e.resolve()):(k.PDFJS.disableWorker=!0,this.loadFakeWorkerFiles().then(function(){this.setupFakeWorker(),e.resolve()}.bind(this)))}.bind(this));var l=new Uint8Array([PDFJS.postMessageTransfers?255:0]);try{c.send("test",l,null,[l.buffer])}catch(h){t("Cannot use postMessage transfers"),l[0]=0,c.send("test",l)}return}catch(u){t("The worker has been disabled.")}}k.PDFJS.disableWorker=!0,this.loadFakeWorkerFiles().then(function(){this.setupFakeWorker(),e.resolve()}.bind(this))}return n.prototype={destroy:function(){this.pageCache=[],this.pagePromises=[];var t=this;this.messageHandler.send("Terminate",null,function(){be.clear(),t.worker&&t.worker.terminate()})},loadFakeWorkerFiles:function(){return PDFJS.fakeWorkerFilesLoadedPromise||(PDFJS.fakeWorkerFilesLoadedPromise=new F,B.loadScript(PDFJS.workerSrc)),PDFJS.fakeWorkerFilesLoadedPromise},setupFakeWorker:function(){e("Setting up fake worker.");var t={postMessage:function(e){t.onmessage({data:e})},terminate:function(){}},i=new y("main",t);this.setupMessageHandler(i),PDFJS.WorkerMessageHandler.setup(i)},setupMessageHandler:function(t){function n(e){t.send("UpdatePassword",e)}this.messageHandler=t;var r=this.pdfDataRangeTransport;r&&(r.addRangeListener(function(e,i){t.send("OnDataRange",{begin:e,chunk:i})}),r.addProgressListener(function(e){t.send("OnDataProgress",{loaded:e})}),t.on("RequestDataRange",function(t){r.requestDataRange(t.begin,t.end)},this)),t.on("GetDoc",function(t){var e=t.pdfInfo;this.numPages=t.pdfInfo.numPages;var i=new re(e,this);this.pdfDocument=i,this.workerReadyPromise.resolve(i)},this),t.on("NeedPassword",function(t){return this.passwordCallback?this.passwordCallback(n,L.NEED_PASSWORD):void this.workerReadyPromise.reject(t.exception.message,t.exception)},this),t.on("IncorrectPassword",function(t){return this.passwordCallback?this.passwordCallback(n,L.INCORRECT_PASSWORD):void this.workerReadyPromise.reject(t.exception.message,t.exception)},this),t.on("InvalidPDF",function(t){this.workerReadyPromise.reject(t.exception.name,t.exception)},this),t.on("MissingPDF",function(t){this.workerReadyPromise.reject(t.exception.message,t.exception)},this),t.on("UnknownError",function(t){this.workerReadyPromise.reject(t.exception.message,t.exception)},this),t.on("DataLoaded",function(t){this.downloadInfoPromise.resolve(t)},this),t.on("GetPage",function(t){var e=t.pageInfo,i=new oe(e,this);this.pageCache[e.pageIndex]=i;var n=this.pagePromises[e.pageIndex];n.resolve(i)},this),t.on("GetAnnotations",function(t){var e=t.annotations,i=this.pageCache[t.pageIndex].annotationsPromise;i.resolve(e)},this),t.on("StartRenderPage",function(t){var e=this.pageCache[t.pageIndex];e.stats.timeEnd("Page Request"),e._startRenderPage(t.transparency)},this),t.on("RenderPageChunk",function(t){var e=this.pageCache[t.pageIndex];e._renderPageChunk(t.operatorList)},this),t.on("commonobj",function(t){var i=t[0],n=t[1];if(!this.commonObjs.hasData(i))switch(n){case"Font":var r,o=t[2];if("error"in o){var s=o.error;e("Error during font loading: "+s),this.commonObjs.resolve(i,s);break}r=new ye(o),be.bind([r],function(){this.commonObjs.resolve(i,r)}.bind(this));break;case"FontPath":this.commonObjs.resolve(i,t[2]);break;default:s("Got unknown common object type "+n)}},this),t.on("obj",function(t){var e=t[0],n=t[1],r=t[2],o=this.pageCache[n];if(!o.objs.hasData(e))switch(r){case"JpegStream":var s=t[3];x(e,s,o.objs);break;case"Image":var s=t[3];o.objs.resolve(e,s);var a=8e6;"data"in s&&s.data.length>a&&(o.cleanupAfterRender=!0);break;default:i("Got unknown object type "+r)}},this),t.on("DocProgress",function(t){this.progressCallback&&this.progressCallback({loaded:t.loaded,total:t.total})},this),t.on("DocError",function(t){this.workerReadyPromise.reject(t)},this),t.on("PageError",function(t){var e=this.pageCache[t.pageNum-1];e.displayReadyPromise?e.displayReadyPromise.reject(t.error):i(t.error)},this),t.on("JpegDecode",function(t,e){var n=t[0],r=t[1];3!=r&&1!=r&&i("Only 3 component or 1 component can be returned");var o=new Image;o.onload=function(){var t=o.width,i=o.height,n=t*i,s=4*n,a=new Uint8Array(n*r),c=w(t,i),l=c.getContext("2d");l.drawImage(o,0,0);var h=l.getImageData(0,0,t,i).data;if(3==r)for(var u=0,d=0;s>u;u+=4,d+=3)a[d]=h[u],a[d+1]=h[u+1],a[d+2]=h[u+2];else if(1==r)for(var u=0,d=0;s>u;u+=4,d++)a[d]=h[u];e.resolve({data:a,width:t,height:i})}.bind(this),o.src=n})},fetchDocument:function(t){t.disableAutoFetch=PDFJS.disableAutoFetch,t.chunkedViewerLoading=!!this.pdfDataRangeTransport,this.messageHandler.send("GetDocRequest",{source:t,disableRange:PDFJS.disableRange,maxImageSize:PDFJS.maxImageSize,disableFontFace:PDFJS.disableFontFace,disableCreateObjectURL:PDFJS.disableCreateObjectURL,verbosity:PDFJS.verbosity})},getData:function(t){this.messageHandler.send("GetData",null,function(e){t.resolve(e)})},getPage:function(t,e){if(0>=t||t>this.numPages||(0|t)!==t){var i=new PDFJS.LegacyPromise;return i.reject(new Error("Invalid page request")),i}var n=t-1;if(n in this.pagePromises)return this.pagePromises[n];var e=new PDFJS.LegacyPromise;return this.pagePromises[n]=e,this.messageHandler.send("GetPageRequest",{pageIndex:n}),e},getPageIndex:function(t){var e=new PDFJS.LegacyPromise;return this.messageHandler.send("GetPageIndex",{ref:t},function(t){e.resolve(t)}),e},getAnnotations:function(t){this.messageHandler.send("GetAnnotationsRequest",{pageIndex:t})},getDestinations:function(){var t=new PDFJS.LegacyPromise;return this.messageHandler.send("GetDestinations",null,function(e){t.resolve(e)}),t},startCleanup:function(){this.messageHandler.send("Cleanup",null,function(){for(var t=0,e=this.pageCache.length;e>t;t++){var i=this.pageCache[t];i&&i.destroy()}this.commonObjs.clear(),be.clear()}.bind(this))}},n}(),ae=function(){function t(){this.objs={}}return t.prototype={ensureObj:function(t){if(this.objs[t])return this.objs[t];var e={promise:new F,data:null,resolved:!1};return this.objs[t]=e,e},get:function(t,e){if(e)return this.ensureObj(t).promise.then(e),null;var n=this.objs[t];return n&&n.resolved||i("Requesting object that isn't resolved yet "+t),n.data},resolve:function(t,e){var i=this.ensureObj(t);i.resolved=!0,i.data=e,i.promise.resolve(e)},isResolved:function(t){var e=this.objs;return e[t]?e[t].resolved:!1},hasData:function(t){return this.isResolved(t)},getData:function(t){var e=this.objs;return e[t]&&e[t].resolved?e[t].data:null},clear:function(){this.objs={}}},t}(),ce=function(){function t(t){this.internalRenderTask=t,this.promise=new PDFJS.LegacyPromise}return t.prototype={cancel:function(){this.internalRenderTask.cancel(),this.promise.reject(new Error("Rendering is cancelled"))}},t}(),le=function(){function t(t,e,i,n,r,o){this.callback=t,this.params=e,this.objs=i,this.commonObjs=n,this.operatorListIdx=null,this.operatorList=r,this.pageNumber=o,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this.cancelled=!1}return t.prototype={initalizeGraphics:function(t){if(!this.cancelled){PDFJS.pdfBug&&"StepperManager"in k&&k.StepperManager.enabled&&(this.stepper=k.StepperManager.create(this.pageNumber-1),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());var e=this.params;this.gfx=new pe(e.canvasContext,this.commonObjs,this.objs,e.textLayer,e.imageLayer),this.gfx.beginDrawing(e.viewport,t),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}},cancel:function(){this.running=!1,this.cancelled=!0,this.callback("cancelled")},operatorListChanged:function(){return this.graphicsReady?(this.stepper&&this.stepper.updateOperatorList(this.operatorList),void(this.running||this._continue())):void(this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continue.bind(this)))},_continue:function(){this.running=!0,this.cancelled||(this.params.continueCallback?this.params.continueCallback(this._next.bind(this)):this._next())
},_next:function(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continue.bind(this),this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this.callback())))}},t}(),he=(PDFJS.Metadata=function(){function t(t){return t.replace(/>\\376\\377([^<]+)/g,function(t,e){for(var i=e.replace(/\\([0-3])([0-7])([0-7])/g,function(t,e,i,n){return String.fromCharCode(64*e+8*i+1*n)}),n="",r=0;r<i.length;r+=2){var o=256*i.charCodeAt(r)+i.charCodeAt(r+1);n+="&#x"+(65536+o).toString(16).substring(1)+";"}return">"+n})}function e(e){if("string"==typeof e){e=t(e);var n=new DOMParser;e=n.parseFromString(e,"application/xml")}else e instanceof Document||i("Metadata: Invalid metadata object");this.metaDocument=e,this.metadata={},this.parse()}return e.prototype={parse:function(){var t=this.metaDocument,e=t.documentElement;if("rdf:rdf"!==e.nodeName.toLowerCase())for(e=e.firstChild;e&&"rdf:rdf"!==e.nodeName.toLowerCase();)e=e.nextSibling;var i=e?e.nodeName.toLowerCase():null;if(e&&"rdf:rdf"===i&&e.hasChildNodes()){var n,r,o,s,a,c,l,h=e.childNodes;for(s=0,c=h.length;c>s;s++)if(n=h[s],"rdf:description"===n.nodeName.toLowerCase())for(a=0,l=n.childNodes.length;l>a;a++)"#text"!==n.childNodes[a].nodeName.toLowerCase()&&(r=n.childNodes[a],o=r.nodeName.toLowerCase(),this.metadata[o]=r.textContent.trim())}},get:function(t){return this.metadata[t]||null},has:function(t){return"undefined"!=typeof this.metadata[t]}},e}(),16),ue=!0,de=function(){var t={};return{getCanvas:function(e,i,n,r){var o;if(e in t)o=t[e],o.canvas.width=i,o.canvas.height=n,o.context.setTransform(1,0,0,1,0,0);else{var s=w(i,n),a=s.getContext("2d");r&&C(a),t[e]=o={canvas:s,context:a}}return o},clear:function(){t={}}}}(),fe=function(){function t(t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=M,this.fontMatrix=T,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=O.FILL,this.textRise=0,this.fillColorSpace=N.singletons.gray,this.fillColorSpaceObj=null,this.strokeColorSpace=N.singletons.gray,this.strokeColorSpaceObj=null,this.fillColorObj=null,this.strokeColorObj=null,this.fillColor="#000000",this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.old=t}return t.prototype={clone:function(){return Object.create(this)},setCurrentPoint:function(t,e){this.x=t,this.y=e}},t}(),pe=function(){function n(t,e,i,n,r){this.ctx=t,this.current=new fe,this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=i,this.textLayer=n,this.imageLayer=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,t&&C(t)}function o(t,e){if("undefined"!=typeof ImageData&&e instanceof ImageData)return void t.putImageData(e,0,0);var n=e.height,r=e.width,o=16,s=n/o,a=Math.floor(s),c=Math.ceil(s),l=n-a*o,h=t.createImageData(r,o),u=0,d=e.data,f=h.data;if(e.kind===j.GRAYSCALE_1BPP){for(var p=f.length,g=d.byteLength,m=3;p>m;m+=4)f[m]=255;for(var m=0;c>m;m++){for(var v=a>m?o:l,b=0,y=0;v>y;y++)for(var x=0,w=0,C=0;r>C;C++,b+=4){if(0===x){if(u>=g)break;w=d[u++],x=128}w&x?(f[b]=255,f[b+1]=255,f[b+2]=255):(f[b]=0,f[b+1]=0,f[b+2]=0),x>>=1}if(p>b){b+=3;do f[b]=0,b+=4;while(p>b)}t.putImageData(h,0,m*o)}}else if(e.kind===j.RGBA_32BPP)for(var S=("set"in f&&"subarray"in d),m=0;c>m;m++){var v=a>m?o:l,A=e.width*v*4;if(S)f.set(d.subarray(u,u+A)),u+=A;else for(var y=0;A>y;y++)f[y]=d[u++];t.putImageData(h,0,m*o)}else if(e.kind===j.RGB_24BPP)for(var m=0;c>m;m++){for(var v=a>m?o:l,A=e.width*v*3,b=0,y=0;A>y;y+=3)f[b++]=d[u++],f[b++]=d[u++],f[b++]=d[u++],f[b++]=255;t.putImageData(h,0,m*o)}else i("bad image kind: "+e.kind)}function s(t,e){for(var i=e.height,n=e.width,r=16,o=i/r,s=Math.floor(o),a=Math.ceil(o),c=i-s*r,l=t.createImageData(n,r),h=0,u=e.data,d=l.data,f=0;a>f;f++){for(var p=s>f?r:c,g=3,m=0;p>m;m++)for(var v=0,b=0;n>b;b++){if(!v){var y=u[h++];v=128}d[g]=y&v?0:255,g+=4,v>>=1}t.putImageData(l,0,f*r)}}function c(t,e){for(var i=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"],n=0,r=i.length;r>n;n++){var o=i[n];o in t&&(e[o]=t[o])}"setLineDash"in t?(e.setLineDash(t.getLineDash()),e.lineDashOffset=t.lineDashOffset):"mozDash"in t&&(e.mozDash=t.mozDash,e.mozDashOffset=t.mozDashOffset)}function l(t,e,i){var n,r=e.canvas,o=e.context,s=r.width,a=r.height;if(e.backdrop){var c=e.colorSpace||N.singletons.rgb,l=c.getRgb(e.backdrop,0);n=function(t,e,i,n){for(var r=n.length,o=3;r>o;o+=4){var s=n[o]/255;if(0===s)n[o-3]=t,n[o-2]=e,n[o-1]=i;else if(1>s){var a=1-s;n[o-3]=n[o-3]*s+t*a|0,n[o-2]=n[o-2]*s+e*a|0,n[o-1]=n[o-1]*s+i*a|0}}}.bind(null,l[0],l[1],l[2])}else n=function(){};var h;h="Luminosity"===e.subtype?function(t,e){for(var i=t.length,n=3;i>n;n+=4){var r=77*t[n-3]+152*t[n-2]+28*t[n-1]|0;e[n]=e[n]*r>>16}}:function(t,e){for(var i=t.length,n=3;i>n;n+=4){var r=t[n];e[n]=e[n]*r/255|0}};for(var u=16,d=0;a>d;d+=u){var f=Math.min(u,a-d),p=o.getImageData(0,d,s,f),g=i.getImageData(0,d,s,f);n(p.data),h(p.data,g.data),o.putImageData(g,0,d)}t.setTransform(1,0,0,1,0,0),t.drawImage(r,e.offsetX,e.offsetY)}var h=15,u=["butt","round","square"],f=["miter","round","bevel"],p={},g={};n.prototype={beginDrawing:function(t,e){var i=this.ctx.canvas.width,n=this.ctx.canvas.height;e?this.ctx.clearRect(0,0,i,n):(this.ctx.mozOpaque=!0,this.ctx.save(),this.ctx.fillStyle="rgb(255, 255, 255)",this.ctx.fillRect(0,0,i,n),this.ctx.restore());var r=t.transform;this.ctx.save(),this.ctx.transform.apply(this.ctx,r),this.baseTransform=this.ctx.mozCurrentTransform.slice(),this.textLayer&&this.textLayer.beginLayout(),this.imageLayer&&this.imageLayer.beginLayout()},executeOperatorList:function(t,e,i,n){var r=t.argsArray,o=t.fnArray,s=e||0,a=r.length;if(a==s)return s;for(var c,l=Date.now()+h,u=this.commonObjs,d=this.objs,f=Promise.resolve();;){if(n&&s===n.nextBreakPoint)return n.breakIt(s,i),s;if(c=o[s],c!==E.dependency)this[c].apply(this,r[s]);else for(var p=r[s],g=0,m=p.length;m>g;g++){var v=p[g],b="g_"==v.substring(0,2);if(!b&&!d.isResolved(v))return d.get(v,i),s;if(b&&!u.isResolved(v))return u.get(v,i),s}if(s++,s==a)return s;if(i&&Date.now()>l)return f.then(i),s}},endDrawing:function(){this.ctx.restore(),de.clear(),this.textLayer&&this.textLayer.endLayout(),this.imageLayer&&this.imageLayer.endLayout()},setLineWidth:function(t){this.current.lineWidth=t,this.ctx.lineWidth=t},setLineCap:function(t){this.ctx.lineCap=u[t]},setLineJoin:function(t){this.ctx.lineJoin=f[t]},setMiterLimit:function(t){this.ctx.miterLimit=t},setDash:function(t,e){var i=this.ctx;"setLineDash"in i?(i.setLineDash(t),i.lineDashOffset=e):(i.mozDash=t,i.mozDashOffset=e)},setRenderingIntent:function(){},setFlatness:function(){},setGState:function(t){for(var i=0,n=t.length;n>i;i++){var r=t[i],o=r[0],s=r[1];switch(o){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=r[1];break;case"ca":this.current.fillAlpha=r[1],this.ctx.globalAlpha=r[1];break;case"BM":if(s&&s.name&&"Normal"!==s.name){var a=s.name.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()}).substring(1);this.ctx.globalCompositeOperation=a,this.ctx.globalCompositeOperation!==a&&e('globalCompositeOperation "'+a+'" is not supported')}else this.ctx.globalCompositeOperation="source-over";break;case"SMask":this.current.activeSMask&&this.endSMaskGroup(),this.current.activeSMask=s?this.tempSMask:null,this.current.activeSMask&&this.beginSMaskGroup(),this.tempSMask=null}}},beginSMaskGroup:function(){var t=this.current.activeSMask,e=t.canvas.width,i=t.canvas.height,n="smaskGroupAt"+this.groupLevel,r=de.getCanvas(n,e,i,!0),o=this.ctx,s=o.mozCurrentTransform;this.ctx.save();var a=r.context;a.translate(-t.offsetX,-t.offsetY),a.transform.apply(a,s),c(o,a),this.ctx=a,this.setGState([["BM","Normal"],["ca",1],["CA",1]]),this.groupStack.push(o),this.groupLevel++},endSMaskGroup:function(){var t=this.ctx;this.groupLevel--,this.ctx=this.groupStack.pop(),l(this.ctx,this.current.activeSMask,t),this.ctx.restore()},save:function(){this.ctx.save();var t=this.current;this.stateStack.push(t),this.current=t.clone(),this.current.activeSMask&&(this.current.activeSMask=null)},restore:function(){var t=this.stateStack.pop();t&&(this.current.activeSMask&&this.endSMaskGroup(),this.current=t,this.ctx.restore())},transform:function(t,e,i,n,r,o){this.ctx.transform(t,e,i,n,r,o)},moveTo:function(t,e){this.ctx.moveTo(t,e),this.current.setCurrentPoint(t,e)},lineTo:function(t,e){this.ctx.lineTo(t,e),this.current.setCurrentPoint(t,e)},curveTo:function(t,e,i,n,r,o){this.ctx.bezierCurveTo(t,e,i,n,r,o),this.current.setCurrentPoint(r,o)},curveTo2:function(t,e,i,n){var r=this.current;this.ctx.bezierCurveTo(r.x,r.y,t,e,i,n),r.setCurrentPoint(i,n)},curveTo3:function(t,e,i,n){this.curveTo(t,e,i,n,i,n),this.current.setCurrentPoint(i,n)},closePath:function(){this.ctx.closePath()},rectangle:function(t,e,i,n){this.ctx.rect(t,e,i,n)},stroke:function(t){t="undefined"!=typeof t?t:!0;var e=this.ctx,i=this.current.strokeColor;0===this.current.lineWidth&&(e.lineWidth=this.getSinglePixelWidth()),e.globalAlpha=this.current.strokeAlpha,i&&i.hasOwnProperty("type")&&"Pattern"===i.type?(e.save(),e.strokeStyle=i.getPattern(e,this),e.stroke(),e.restore()):e.stroke(),t&&this.consumePath(),e.globalAlpha=this.current.fillAlpha},closeStroke:function(){this.closePath(),this.stroke()},fill:function(t){t="undefined"!=typeof t?t:!0;var e=this.ctx,i=this.current.fillColor,n=!1;if(i&&i.hasOwnProperty("type")&&"Pattern"===i.type&&(e.save(),e.fillStyle=i.getPattern(e,this),n=!0),this.pendingEOFill){if("mozFillRule"in this.ctx)this.ctx.mozFillRule="evenodd",this.ctx.fill(),this.ctx.mozFillRule="nonzero";else try{this.ctx.fill("evenodd")}catch(r){this.ctx.fill()}this.pendingEOFill=!1}else this.ctx.fill();n&&e.restore(),t&&this.consumePath()},eoFill:function(){this.pendingEOFill=!0,this.fill()},fillStroke:function(){this.fill(!1),this.stroke(!1),this.consumePath()},eoFillStroke:function(){this.pendingEOFill=!0,this.fillStroke()},closeFillStroke:function(){this.closePath(),this.fillStroke()},closeEOFillStroke:function(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()},endPath:function(){this.consumePath()},clip:function(){this.pendingClip=p},eoClip:function(){this.pendingClip=g},beginText:function(){this.current.textMatrix=M,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0},endText:function(){if(!("pendingTextPaths"in this))return void this.ctx.beginPath();var t=this.pendingTextPaths,e=this.ctx;e.save(),e.beginPath();for(var i=0;i<t.length;i++){var n=t[i];e.setTransform.apply(e,n.transform),e.translate(n.x,n.y),n.addToPath(e,n.fontSize)}e.restore(),e.clip(),e.beginPath(),delete this.pendingTextPaths},setCharSpacing:function(t){this.current.charSpacing=t},setWordSpacing:function(t){this.current.wordSpacing=t},setHScale:function(t){this.current.textHScale=t/100},setLeading:function(t){this.current.leading=-t},setFont:function(t,n){var r=this.commonObjs.get(t),o=this.current;if(r||i("Can't find font for "+t),o.fontMatrix=r.fontMatrix?r.fontMatrix:T,(0===o.fontMatrix[0]||0===o.fontMatrix[3])&&e("Invalid font matrix for font "+t),0>n?(n=-n,o.fontDirection=-1):o.fontDirection=1,this.current.font=r,this.current.fontSize=n,!r.coded){var s=r.loadedName||"sans-serif",a=r.black?r.bold?"bolder":"bold":r.bold?"bold":"normal",c=r.italic?"italic":"normal",l='"'+s+'", '+r.fallbackName,h=n>=he?n:he;this.current.fontSizeScale=h!=he?1:n/he;var u=c+" "+a+" "+h+"px "+l;this.ctx.font=u}},setTextRenderingMode:function(t){this.current.textRenderingMode=t},setTextRise:function(t){this.current.textRise=t},moveText:function(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e},setLeadingMoveText:function(t,e){this.setLeading(-e),this.moveText(t,e)},setTextMatrix:function(t,e,i,n,r,o){this.current.textMatrix=[t,e,i,n,r,o],this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0},nextLine:function(){this.moveText(0,this.current.leading)},applyTextTransforms:function(){var t=this.ctx,e=this.current;t.transform.apply(t,e.textMatrix),t.translate(e.x,e.y+e.textRise),e.fontDirection>0?t.scale(e.textHScale,-1):t.scale(-e.textHScale,1)},createTextGeometry:function(){var t={},e=this.ctx,i=this.current.font,n=e.mozCurrentTransform,r=n[0],o=n[1],s=n[2],a=n[3],c=n[4],l=n[5],h=r>=0?Math.sqrt(r*r+o*o):-Math.sqrt(r*r+o*o),u=a>=0?Math.sqrt(s*s+a*a):-Math.sqrt(s*s+a*a),d=Math.atan2(o,r),f=c,p=l;return t.x=f,t.y=p,t.hScale=h,t.vScale=u,t.angle=d,t.spaceWidth=i.spaceWidth,t.fontName=i.loadedName,t.fontFamily=i.fallbackName,t.fontSize=this.current.fontSize,t.ascent=i.ascent,t.descent=i.descent,t},paintChar:function(t,e,i){var n,r=this.ctx,o=this.current,s=o.font,a=o.fontSize/o.fontSizeScale,c=o.textRenderingMode,l=c&O.FILL_STROKE_MASK,h=!!(c&O.ADD_TO_PATH_FLAG);if((s.disableFontFace||h)&&(n=s.getPathGenerator(this.commonObjs,t)),s.disableFontFace?(r.save(),r.translate(e,i),r.beginPath(),n(r,a),(l===O.FILL||l===O.FILL_STROKE)&&r.fill(),(l===O.STROKE||l===O.FILL_STROKE)&&r.stroke(),r.restore()):((l===O.FILL||l===O.FILL_STROKE)&&r.fillText(t,e,i),(l===O.STROKE||l===O.FILL_STROKE)&&r.strokeText(t,e,i)),h){var u=this.pendingTextPaths||(this.pendingTextPaths=[]);u.push({transform:r.mozCurrentTransform,x:e,y:i,fontSize:a,addToPath:n})}},get isFontSubpixelAAEnabled(){var t=document.createElement("canvas").getContext("2d");t.scale(1.5,1),t.fillText("I",0,10);for(var e=t.getImageData(0,0,10,10).data,i=!1,n=3;n<e.length;n+=4)if(e[n]>0&&e[n]<255){i=!0;break}return a(this,"isFontSubpixelAAEnabled",i)},showText:function(t,e){var i,n=this.ctx,r=this.current,o=r.font,s=r.fontSize,a=r.fontSizeScale,c=r.charSpacing,l=r.wordSpacing,h=r.textHScale*r.fontDirection,u=r.fontMatrix||T,d=t.length,f=this.textLayer,p=f&&!e?!0:!1,g=0,m=o.vertical,v=o.defaultVMetrics;if(o.coded){n.save(),n.transform.apply(n,r.textMatrix),n.translate(r.x,r.y),n.scale(h,1),p&&(this.save(),n.scale(1,-1),i=this.createTextGeometry(),this.restore());for(var b=0;d>b;++b){var y=t[b];if(null!==y){this.processingType3=y,this.save(),n.scale(s,s),n.transform.apply(n,u),this.executeOperatorList(y.operatorList),this.restore();var x=B.applyTransform([y.width,0],u),w=(x[0]*s+c)*r.fontDirection;n.translate(w,0),r.x+=w*h,g+=w}else this.ctx.translate(l,0),r.x+=l*h}n.restore(),this.processingType3=null}else{n.save(),this.applyTextTransforms();var C=r.lineWidth,S=r.textMatrix[0],A=r.textMatrix[1],k=Math.sqrt(S*S+A*A);0===k||0===C?C=this.getSinglePixelWidth():C/=k,p&&(i=this.createTextGeometry()),1!=a&&(n.scale(a,a),C/=a),n.lineWidth=C;for(var _=0,b=0;d>b;++b){var y=t[b];if(null!==y){var O=!1,j=y.fontChar,E=y.vmetric||v;if(m){var D=y.vmetric?E[1]:.5*y.width;D=-D*s*r.fontMatrix[0];var I=E[2]*s*r.fontMatrix[0]}var L,P,M,R,w=E?-E[0]:y.width,F=w*s*r.fontMatrix[0]+c*r.fontDirection,$=y.accent;if(!y.disabled){if(m?(L=D/a,P=(_+I)/a):(L=_/a,P=0),o.remeasure&&w>0&&this.isFontSubpixelAAEnabled){var N=1e3*n.measureText(j).width/r.fontSize*r.fontSizeScale,z=w/N;O=!0,n.save(),n.scale(z,1),L/=z,$&&(M/=z)}this.paintChar(j,L,P),$&&(M=L+$.offset.x/a,R=P-$.offset.y/a,this.paintChar($.fontChar,M,R))}_+=F,g+=F,O&&n.restore()}else _+=r.fontDirection*l}m?r.y-=_*h:r.x+=_*h,n.restore()}if(p){if(i.canvasWidth=g,m){var W=Math.PI/2;i.angle+=W}this.textLayer.appendText(i)}return g},showSpacedText:function(t){var e,i=this.ctx,n=this.current,r=n.font,o=n.fontSize,s=.001*n.textHScale*n.fontDirection,a=t.length,c=this.textLayer,l=0,h=c?!0:!1,u=r.vertical,f=0;h&&(i.save(),this.applyTextTransforms(),e=this.createTextGeometry(),i.restore());for(var p=0;a>p;++p){var g=t[p];if(d(g)){var m=-g*o*s;u?n.y+=m:n.x+=m,h&&(f+=m)}else{var v=this.showText(g,!0);h&&(l+=f+v,f=0)}}if(h){if(e.canvasWidth=l,u){var b=Math.PI/2;e.angle+=b}this.textLayer.appendText(e)}},nextLineShowText:function(t){this.nextLine(),this.showText(t)},nextLineSetSpacingShowText:function(t,e,i){this.setWordSpacing(t),this.setCharSpacing(e),this.nextLineShowText(i)},setCharWidth:function(){},setCharWidthAndBounds:function(t,e,i,n,r,o){this.rectangle(i,n,r-i,o-n),this.clip(),this.endPath()},setStrokeColorSpace:function(t){this.current.strokeColorSpace=N.fromIR(t)},setFillColorSpace:function(t){this.current.fillColorSpace=N.fromIR(t)},setStrokeColor:function(){var t=this.current.strokeColorSpace,e=t.getRgb(arguments,0),i=B.makeCssRgb(e);this.ctx.strokeStyle=i,this.current.strokeColor=i},getColorN_Pattern:function(t,e){if("TilingPattern"==t[0]){var i,n=t[1],r=e.base;if(r){{r.numComps}i=r.getRgb(n,0)}var o=new ve(t,i,this.ctx,this.objs,this.commonObjs,this.baseTransform)}else var o=A(t);return o},setStrokeColorN:function(){var t=this.current.strokeColorSpace;"Pattern"==t.name?this.current.strokeColor=this.getColorN_Pattern(arguments,t):this.setStrokeColor.apply(this,arguments)},setFillColor:function(){var t=this.current.fillColorSpace,e=t.getRgb(arguments,0),i=B.makeCssRgb(e);this.ctx.fillStyle=i,this.current.fillColor=i},setFillColorN:function(){var t=this.current.fillColorSpace;"Pattern"==t.name?this.current.fillColor=this.getColorN_Pattern(arguments,t):this.setFillColor.apply(this,arguments)},setStrokeGray:function(){this.current.strokeColorSpace=N.singletons.gray;var t=this.current.strokeColorSpace.getRgb(arguments,0),e=B.makeCssRgb(t);this.ctx.strokeStyle=e,this.current.strokeColor=e},setFillGray:function(){this.current.fillColorSpace=N.singletons.gray;var t=this.current.fillColorSpace.getRgb(arguments,0),e=B.makeCssRgb(t);this.ctx.fillStyle=e,this.current.fillColor=e},setStrokeRGBColor:function(){this.current.strokeColorSpace=N.singletons.rgb;var t=this.current.strokeColorSpace.getRgb(arguments,0),e=B.makeCssRgb(t);this.ctx.strokeStyle=e,this.current.strokeColor=e},setFillRGBColor:function(){this.current.fillColorSpace=N.singletons.rgb;var t=this.current.fillColorSpace.getRgb(arguments,0),e=B.makeCssRgb(t);this.ctx.fillStyle=e,this.current.fillColor=e},setStrokeCMYKColor:function(){this.current.strokeColorSpace=N.singletons.cmyk;var t=B.makeCssCmyk(arguments);this.ctx.strokeStyle=t,this.current.strokeColor=t},setFillCMYKColor:function(){this.current.fillColorSpace=N.singletons.cmyk;var t=B.makeCssCmyk(arguments);this.ctx.fillStyle=t,this.current.fillColor=t},shadingFill:function(t){var e=this.ctx;this.save();var i=A(t);e.fillStyle=i.getPattern(e,this,!0);var n=e.mozCurrentTransformInverse;if(n){var r=e.canvas,o=r.width,s=r.height,a=B.applyTransform([0,0],n),c=B.applyTransform([0,s],n),l=B.applyTransform([o,0],n),h=B.applyTransform([o,s],n),u=Math.min(a[0],c[0],l[0],h[0]),d=Math.min(a[1],c[1],l[1],h[1]),f=Math.max(a[0],c[0],l[0],h[0]),p=Math.max(a[1],c[1],l[1],h[1]);this.ctx.fillRect(u,d,f-u,p-d)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.restore()},beginInlineImage:function(){i("Should not call beginInlineImage")},beginImageData:function(){i("Should not call beginImageData")},paintFormXObjectBegin:function(t,e){if(this.save(),this.baseTransformStack.push(this.baseTransform),t&&m(t)&&6==t.length&&this.transform.apply(this,t),this.baseTransform=this.ctx.mozCurrentTransform,e&&m(e)&&4==e.length){var i=e[2]-e[0],n=e[3]-e[1];this.rectangle(e[0],e[1],i,n),this.clip(),this.endPath()}},paintFormXObjectEnd:function(){this.restore(),this.baseTransform=this.baseTransformStack.pop()},beginGroup:function(i){this.save();var n=this.ctx;i.isolated||t("TODO: Support non-isolated groups."),i.knockout&&e("Knockout groups not supported.");var o=n.mozCurrentTransform;i.matrix&&n.transform.apply(n,i.matrix),r(i.bbox,"Bounding box is required.");var s=B.getAxialAlignedBoundingBox(i.bbox,n.mozCurrentTransform),a=[0,0,n.canvas.width,n.canvas.height];s=B.intersect(s,a)||[0,0,0,0];var l=Math.max(Math.ceil(s[2]-s[0]),1),h=Math.max(Math.ceil(s[3]-s[1]),1),u="groupAt"+this.groupLevel;i.smask&&(u+="_smask_"+this.smaskCounter++%2);var d=de.getCanvas(u,l,h,!0),f=d.context,p=s[0],g=s[1];f.translate(-p,-g),f.transform.apply(f,o),i.smask?this.smaskStack.push({canvas:d.canvas,context:f,offsetX:p,offsetY:g,subtype:i.smask.subtype,backdrop:i.smask.backdrop,colorSpace:i.colorSpace&&N.fromIR(i.colorSpace)}):(n.setTransform(1,0,0,1,0,0),n.translate(p,g)),c(n,f),this.ctx=f,this.setGState([["BM","Normal"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++},endGroup:function(t){this.groupLevel--;var e=this.ctx;this.ctx=this.groupStack.pop(),"imageSmoothingEnabled"in this.ctx?this.ctx.imageSmoothingEnabled=!1:this.ctx.mozImageSmoothingEnabled=!1,t.smask?this.tempSMask=this.smaskStack.pop():this.ctx.drawImage(e.canvas,0,0),this.restore()},beginAnnotations:function(){this.save(),this.current=new fe},endAnnotations:function(){this.restore()},beginAnnotation:function(t,e,i){if(this.save(),t&&m(t)&&4==t.length){var n=t[2]-t[0],r=t[3]-t[1];this.rectangle(t[0],t[1],n,r),this.clip(),this.endPath()}this.transform.apply(this,e),this.transform.apply(this,i)},endAnnotation:function(){this.restore()},paintJpegXObject:function(t,e,n){var r=this.objs.get(t);r||i("Dependent image isn't ready yet"),this.save();var o=this.ctx;if(o.scale(1/e,-1/n),o.drawImage(r,0,0,r.width,r.height,0,-n,e,n),this.imageLayer){var s=o.mozCurrentTransformInverse,a=this.getCanvasPosition(0,0);this.imageLayer.appendImage({objId:t,left:a[0],top:a[1],width:e/s[0],height:n/s[3]})}this.restore()},paintImageMaskXObject:function(t){var e=this.ctx,i=t.width,n=t.height,r=this.processingType3;if(ue&&r&&!("compiled"in r)){var o=1e3;r.compiled=o>=i&&o>=n?S({data:t.data,width:i,height:n}):null}if(r&&r.compiled)return void r.compiled(e);var a=de.getCanvas("maskCanvas",i,n),c=a.context;c.save(),s(c,t),c.globalCompositeOperation="source-in";var l=this.current.fillColor;c.fillStyle=l&&l.hasOwnProperty("type")&&"Pattern"===l.type?l.getPattern(c,this):l,c.fillRect(0,0,i,n),c.restore(),this.paintInlineImageXObject(a.canvas)},paintImageMaskXObjectGroup:function(t){for(var e=this.ctx,i=0,n=t.length;n>i;i++){var r=t[i],o=r.width,a=r.height,c=de.getCanvas("maskCanvas",o,a),l=c.context;l.save(),s(l,r),l.globalCompositeOperation="source-in";var h=this.current.fillColor;l.fillStyle=h&&h.hasOwnProperty("type")&&"Pattern"===h.type?h.getPattern(l,this):h,l.fillRect(0,0,o,a),l.restore(),e.save(),e.transform.apply(e,r.transform),e.scale(1,-1),e.drawImage(c.canvas,0,0,o,a,0,-1,1,1),e.restore()}},paintImageXObject:function(t){var e=this.objs.get(t);e||i("Dependent image isn't ready yet"),this.paintInlineImageXObject(e)},paintInlineImageXObject:function(t){var e=t.width,i=t.height,n=this.ctx;this.save(),n.scale(1/e,-1/i);var r,s=n.mozCurrentTransformInverse,a=s[0],c=s[1],l=Math.max(Math.sqrt(a*a+c*c),1),h=s[2],u=s[3],d=Math.max(Math.sqrt(h*h+u*u),1);if(t instanceof HTMLElement||!t.data)r=t;else{var f=de.getCanvas("inlineImage",e,i),p=f.context;o(p,t),r=f.canvas}for(var g=e,m=i,v="prescale1";l>2&&g>1||d>2&&m>1;){var b=g,y=m;l>2&&g>1&&(b=Math.ceil(g/2),l/=g/b),d>2&&m>1&&(y=Math.ceil(m/2),d/=m/y);var f=de.getCanvas(v,b,y);p=f.context,p.clearRect(0,0,b,y),p.drawImage(r,0,0,g,m,0,0,b,y),r=f.canvas,g=b,m=y,v="prescale1"===v?"prescale2":"prescale1"}if(n.drawImage(r,0,0,g,m,0,-i,e,i),this.imageLayer){var x=this.getCanvasPosition(0,-i);this.imageLayer.appendImage({imgData:t,left:x[0],top:x[1],width:e/s[0],height:i/s[3]})}this.restore()},paintInlineImageXObjectGroup:function(t,e){var i=this.ctx,n=t.width,r=t.height,s=de.getCanvas("inlineImage",n,r),a=s.context;o(a,t);for(var c=0,l=e.length;l>c;c++){var h=e[c];if(i.save(),i.transform.apply(i,h.transform),i.scale(1,-1),i.drawImage(s.canvas,h.x,h.y,h.w,h.h,0,-1,1,1),this.imageLayer){var u=this.getCanvasPosition(h.x,h.y);this.imageLayer.appendImage({imgData:t,left:u[0],top:u[1],width:n,height:r})}i.restore()}},markPoint:function(){},markPointProps:function(){},beginMarkedContent:function(){},beginMarkedContentProps:function(){},endMarkedContent:function(){},beginCompat:function(){},endCompat:function(){},consumePath:function(){if(this.pendingClip){if(this.pendingClip==g)if("mozFillRule"in this.ctx)this.ctx.mozFillRule="evenodd",this.ctx.clip(),this.ctx.mozFillRule="nonzero";else try{this.ctx.clip("evenodd")}catch(t){this.ctx.clip()}else this.ctx.clip();this.pendingClip=null}this.ctx.beginPath()},getSinglePixelWidth:function(){var t=this.ctx.mozCurrentTransformInverse;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1],t[2]*t[2]+t[3]*t[3]))},getCanvasPosition:function(t,e){var i=this.ctx.mozCurrentTransform;return[i[0]*t+i[2]*e+i[4],i[1]*t+i[3]*e+i[5]]}};for(var v in E)n.prototype[E[v]]=n.prototype[v];return n}(),ge={};ge.RadialAxial={fromIR:function(t){var e=t[1],i=t[2],n=t[3],r=t[4],o=t[5],s=t[6];return{type:"Pattern",getPattern:function(t){var a;"axial"===e?a=t.createLinearGradient(n[0],n[1],r[0],r[1]):"radial"===e&&(a=t.createRadialGradient(n[0],n[1],o,r[0],r[1],s));for(var c=0,l=i.length;l>c;++c){var h=i[c];a.addColorStop(h[0],h[1])}return a}}}};var me=function(){function t(t,e,i,n,r,o,s,a){var c,l=e.coords,h=e.colors,u=t.data,d=4*t.width;l[2*i+1]>l[2*n+1]&&(c=i,i=n,n=c,c=o,o=s,s=c),l[2*n+1]>l[2*r+1]&&(c=n,n=r,r=c,c=s,s=a,a=c),l[2*i+1]>l[2*n+1]&&(c=i,i=n,n=c,c=o,o=s,s=c);var f=(l[2*i]+e.offsetX)*e.scaleX,p=(l[2*i+1]+e.offsetY)*e.scaleY,g=(l[2*n]+e.offsetX)*e.scaleX,m=(l[2*n+1]+e.offsetY)*e.scaleY,v=(l[2*r]+e.offsetX)*e.scaleX,b=(l[2*r+1]+e.offsetY)*e.scaleY;if(!(p>=b))for(var y,x,w,C,S,A,k,_,T,O=3*o,j=3*s,E=3*a,D=h[O],I=h[O+1],L=h[O+2],P=h[j],M=h[j+1],B=h[j+2],R=h[E],F=h[E+1],$=h[E+2],N=Math.round(p),z=Math.round(b),W=N;z>=W;W++){m>W?(T=p>W?0:p===m?1:(p-W)/(p-m),y=f-(f-g)*T,x=D-(D-P)*T,w=I-(I-M)*T,C=L-(L-B)*T):(T=W>b?1:m===b?0:(m-W)/(m-b),y=g-(g-v)*T,x=P-(P-R)*T,w=M-(M-F)*T,C=B-(B-$)*T),T=p>W?0:W>b?1:(p-W)/(p-b),S=f-(f-v)*T,A=D-(D-R)*T,k=I-(I-F)*T,_=L-(L-$)*T;for(var q=Math.round(Math.min(y,S)),H=Math.round(Math.max(y,S)),X=d*W+4*q,Y=q;H>=Y;Y++)T=(y-Y)/(y-S),T=0>T?0:T>1?1:T,u[X++]=x-(x-A)*T|0,u[X++]=w-(w-k)*T|0,u[X++]=C-(C-_)*T|0,u[X++]=255}}function e(e,n,r){var o=n.coords,s=n.colors;switch(n.type){case"lattice":for(var a=n.verticesPerRow,c=Math.floor(o.length/a)-1,l=a-1,h=0;c>h;h++)for(var u=h*a,d=0;l>d;d++,u++)t(e,r,o[u],o[u+1],o[u+a],s[u],s[u+1],s[u+a]),t(e,r,o[u+a+1],o[u+1],o[u+a],s[u+a+1],s[u+1],s[u+a]);break;case"triangles":for(var h=0,f=o.length;f>h;h+=3)t(e,r,o[h],o[h+1],o[h+2],s[h],s[h+1],s[h+2]);break;default:i("illigal figure")}}function n(t,i,n,r,o,s){var a=1.1,c=3e3,l=t[2]-t[0],h=t[3]-t[1],u=Math.min(Math.ceil(Math.abs(l*i[0]*a)),c),d=Math.min(Math.ceil(Math.abs(h*i[1]*a)),c),f=u/l,p=d/h,g=de.getCanvas("mesh",u,d,!1),m=g.context;s&&(m.fillStyle=makeCssRgb(s),m.fillRect(0,0,u,d));for(var v={coords:n,colors:r,offsetX:-t[0],offsetY:-t[1],scaleX:f,scaleY:p},b=m.getImageData(0,0,u,d),y=0;y<o.length;y++)e(b,o[y],v);return m.putImageData(b,0,0),{canvas:g.canvas,scaleX:1/f,scaleY:1/p}}return n}();ge.Mesh={fromIR:function(t){var e=(t[1],t[2]),i=t[3],n=t[4],r=t[5],o=t[6],s=(t[7],t[8]);return{type:"Pattern",getPattern:function(t,a,c){var l;if(c)l=B.singularValueDecompose2dScale(t.mozCurrentTransform);else{var h=B.singularValueDecompose2dScale(o),u=B.singularValueDecompose2dScale(a.baseTransform);l=[h[0]*u[0],h[1]*u[1]]}var d=me(r,l,e,i,n,c?null:s);return c||(t.setTransform.apply(t,a.baseTransform),o&&t.transform.apply(t,o)),t.translate(r[0],r[1]),t.scale(d.scaleX,d.scaleY),t.createPattern(d.canvas,"no-repeat")}}}},ge.Dummy={fromIR:function(){return{type:"Pattern",getPattern:function(){return"hotpink"}}}};var ve=function(){function e(t,e,i,n,r,o){this.name=t[1][0].name,this.operatorList=t[2],this.matrix=t[3]||[1,0,0,1,0,0],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=e,this.objs=n,this.commonObjs=r,this.baseTransform=o,this.type="Pattern",this.ctx=i}var n={COLORED:1,UNCOLORED:2},r=3e3;return e.prototype={createPatternCanvas:function(e){{var i=this.operatorList,n=this.bbox,o=this.xstep,s=this.ystep,a=this.paintType,c=this.tilingType,l=this.color,h=this.objs,u=this.commonObjs;this.ctx}t("TilingType: "+c);var d=n[0],f=n[1],p=n[2],g=n[3],m=[d,f],v=[d+o,f+s],b=v[0]-m[0],y=v[1]-m[1],x=B.singularValueDecompose2dScale(this.matrix),w=B.singularValueDecompose2dScale(this.baseTransform),C=[x[0]*w[0],x[1]*w[1]];b=Math.min(Math.ceil(Math.abs(b*C[0])),r),y=Math.min(Math.ceil(Math.abs(y*C[1])),r);var S=de.getCanvas("pattern",b,y,!0),A=S.context,k=new pe(A,u,h);k.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(A,a,l),this.setScale(b,y,o,s),this.transformToScale(k);var _=[1,0,0,1,-m[0],-m[1]];return k.transform.apply(k,_),this.clipBbox(k,n,d,f,p,g),k.executeOperatorList(i),S.canvas},setScale:function(t,e,i,n){this.scale=[t/i,e/n]},transformToScale:function(t){var e=this.scale,i=[e[0],0,0,e[1],0,0];t.transform.apply(t,i)},scaleToContext:function(){var t=this.scale;this.ctx.scale(1/t[0],1/t[1])},clipBbox:function(t,e,i,n,r,o){if(e&&m(e)&&4==e.length){var s=r-i,a=o-n;t.rectangle(i,n,s,a),t.clip(),t.endPath()}},setFillAndStrokeStyleToContext:function(t,e,r){switch(e){case n.COLORED:var o=this.ctx;t.fillStyle=o.fillStyle,t.strokeStyle=o.strokeStyle;break;case n.UNCOLORED:var s=N.singletons.rgb.getRgb(r,0),a=B.makeCssRgb(s);t.fillStyle=a,t.strokeStyle=a;break;default:i("Unsupported paint type: "+e)}},getPattern:function(t,e){var i=this.createPatternCanvas(e),t=this.ctx;return t.setTransform.apply(t,this.baseTransform),t.transform.apply(t,this.matrix),this.scaleToContext(),t.createPattern(i,"repeat")}},e}();PDFJS.disableFontFace=!1;var be={insertRule:function(t){var e=document.getElementById("PDFJS_FONT_STYLE_TAG");e||(e=document.createElement("style"),e.id="PDFJS_FONT_STYLE_TAG",document.documentElement.getElementsByTagName("head")[0].appendChild(e));var i=e.sheet;i.insertRule(t,i.cssRules.length)},clear:function(){var t=document.getElementById("PDFJS_FONT_STYLE_TAG");t&&t.parentNode.removeChild(t)},get loadTestFont(){return a(this,"loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))},loadTestFontId:0,loadingContext:{requests:[],nextRequestId:0},isSyncFontLoadingSupported:function(){if(_)return!1;var t=window.navigator.userAgent,e=/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(t);return e&&e[1]>=14?!0:!1}(),bind:function(t,e){r(!_,"bind() shall be called from main thread");
for(var i=[],n=[],o=0,s=t.length;s>o;o++){var a=t[o];if(!a.attached&&a.loading!==!1){a.attached=!0;var c=a.bindDOM();c&&(i.push(c),n.push(a))}}var l=be.queueLoadingCallback(e);i.length>0&&!this.isSyncFontLoadingSupported?be.prepareFontLoadEvent(i,n,l):l.complete()},queueLoadingCallback:function(t){function e(){for(r(!o.end,"completeRequest() cannot be called twice"),o.end=Date.now();i.requests.length>0&&i.requests[0].end;){var t=i.requests.shift();setTimeout(t.callback,0)}}var i=be.loadingContext,n="pdfjs-font-loading-"+i.nextRequestId++,o={id:n,complete:e,callback:t,started:Date.now()};return i.requests.push(o),o},prepareFontLoadEvent:function(t,i,n){function r(t,e){return t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|255&t.charCodeAt(e+3)}function o(t){return String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t)}function s(t,e,i,n){var r=p.substr(0,e),o=p.substr(e+i);return r+n+o}function a(t,i){if(d++,d>30)return e("Load test font never loaded."),void i();u.font="30px "+t,u.fillText(".",0,20);var n=u.getImageData(0,0,1,1);return n.data[3]>0?void i():void setTimeout(a.bind(null,t,i))}var c,l,h=document.createElement("canvas");h.width=1,h.height=1;var u=h.getContext("2d"),d=0,f="lt"+Date.now()+this.loadTestFontId++,p=this.loadTestFont,g=976;p=s(p,g,f.length,f);var m=16,v=1482184792,b=r(p,m);for(c=0,l=f.length-3;l>c;c+=4)b=b-v+r(f,c)|0;c<f.length&&(b=b-v+r(f+"XXX",c)|0),p=s(p,m,4,o(b));var y="url(data:font/opentype;base64,"+btoa(p)+");",x='@font-face { font-family:"'+f+'";src:'+y+"}";be.insertRule(x);var w=[];for(c=0,l=i.length;l>c;c++)w.push(i[c].loadedName);w.push(f);var C=document.createElement("div");for(C.setAttribute("style","visibility: hidden;width: 10px; height: 10px;position: absolute; top: 0px; left: 0px;"),c=0,l=w.length;l>c;++c){var S=document.createElement("span");S.textContent="Hi",S.style.fontFamily=w[c],C.appendChild(S)}document.body.appendChild(C),a(f,function(){document.body.removeChild(C),n.complete()})}},ye=function(){function t(){if(this.compiledGlyphs={},1!==arguments.length);else{var t=arguments[0];for(var e in t)this[e]=t[e]}}return t.prototype={bindDOM:function(){if(!this.data)return null;if(PDFJS.disableFontFace)return this.disableFontFace=!0,null;var t=c(this.data),e=this.loadedName,i="url(data:"+this.mimetype+";base64,"+window.btoa(t)+");",n='@font-face { font-family:"'+e+'";src:'+i+"}";return be.insertRule(n),PDFJS.pdfBug&&"FontInspector"in k&&k.FontInspector.enabled&&k.FontInspector.fontAdded(this,i),n},getPathGenerator:function(t,e){if(!(e in this.compiledGlyphs)){var i=t.get(this.loadedName+"_path_"+e);this.compiledGlyphs[e]=new Function("c","size",i)}return this.compiledGlyphs[e]}},t}()}.call("undefined"==typeof window?this:window),PDFJS.workerSrc||"undefined"==typeof document||(PDFJS.workerSrc=function(){var t=document.body||document.getElementsByTagName("head")[0],e=t.lastChild.src;return e&&e.replace(/\.js$/i,".worker.js")}()),define("pdfjs",function(){});var io="undefined"==typeof module?{}:module.exports;!function(){!function(t,e){var i=t;i.version="0.9.16",i.protocol=1,i.transports=[],i.j=[],i.sockets={},i.connect=function(t,n){var r,o,s=i.util.parseUri(t);e&&e.location&&(s.protocol=s.protocol||e.location.protocol.slice(0,-1),s.host=s.host||(e.document?e.document.domain:e.location.hostname),s.port=s.port||e.location.port),r=i.util.uniqueUri(s);var a={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return i.util.merge(a,n),(a["force new connection"]||!i.sockets[r])&&(o=new i.Socket(a)),!a["force new connection"]&&o&&(i.sockets[r]=o),o=o||i.sockets[r],o.of(s.path.length>1?s.path:"")}}("object"==typeof module?module.exports:this.io={},this),function(t,e){var i=t.util={},n=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];i.parseUri=function(t){for(var e=n.exec(t||""),i={},o=14;o--;)i[r[o]]=e[o]||"";return i},i.uniqueUri=function(t){var i=t.protocol,n=t.host,r=t.port;return"document"in e?(n=n||document.domain,r=r||("https"==i&&"https:"!==document.location.protocol?443:document.location.port)):(n=n||"localhost",r||"https"!=i||(r=443)),(i||"http")+"://"+n+":"+(r||80)},i.query=function(t,e){var n=i.chunkQuery(t||""),r=[];i.merge(n,i.chunkQuery(e||""));for(var o in n)n.hasOwnProperty(o)&&r.push(o+"="+n[o]);return r.length?"?"+r.join("&"):""},i.chunkQuery=function(t){for(var e,i={},n=t.split("&"),r=0,o=n.length;o>r;++r)e=n[r].split("="),e[0]&&(i[e[0]]=e[1]);return i};var o=!1;i.load=function(t){return"document"in e&&"complete"===document.readyState||o?t():void i.on(e,"load",t,!1)},i.on=function(t,e,i,n){t.attachEvent?t.attachEvent("on"+e,i):t.addEventListener&&t.addEventListener(e,i,n)},i.request=function(t){if(t&&"undefined"!=typeof XDomainRequest&&!i.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!t||i.ua.hasCORS))return new XMLHttpRequest;if(!t)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&i.load(function(){o=!0}),i.defer=function(t){return i.ua.webkit&&"undefined"==typeof importScripts?void i.load(function(){setTimeout(t,100)}):t()},i.merge=function(t,e,n,r){var o,s=r||[],a="undefined"==typeof n?2:n;for(o in e)e.hasOwnProperty(o)&&i.indexOf(s,o)<0&&("object"==typeof t[o]&&a?i.merge(t[o],e[o],a-1,s):(t[o]=e[o],s.push(e[o])));return t},i.mixin=function(t,e){i.merge(t.prototype,e.prototype)},i.inherit=function(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i},i.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},i.intersect=function(t,e){for(var n=[],r=t.length>e.length?t:e,o=t.length>e.length?e:t,s=0,a=o.length;a>s;s++)~i.indexOf(r,o[s])&&n.push(o[s]);return n},i.indexOf=function(t,e,i){for(var n=t.length,i=0>i?0>i+n?0:i+n:i||0;n>i&&t[i]!==e;i++);return i>=n?-1:i},i.toArray=function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(t[i]);return e},i.ua={},i.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var t=new XMLHttpRequest}catch(e){return!1}return void 0!=t.withCredentials}(),i.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),i.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(t,e){function i(){}t.EventEmitter=i,i.prototype.on=function(t,i){return this.$events||(this.$events={}),this.$events[t]?e.util.isArray(this.$events[t])?this.$events[t].push(i):this.$events[t]=[this.$events[t],i]:this.$events[t]=i,this},i.prototype.addListener=i.prototype.on,i.prototype.once=function(t,e){function i(){n.removeListener(t,i),e.apply(this,arguments)}var n=this;return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,i){if(this.$events&&this.$events[t]){var n=this.$events[t];if(e.util.isArray(n)){for(var r=-1,o=0,s=n.length;s>o;o++)if(n[o]===i||n[o].listener&&n[o].listener===i){r=o;break}if(0>r)return this;n.splice(r,1),n.length||delete this.$events[t]}else(n===i||n.listener&&n.listener===i)&&delete this.$events[t]}return this},i.prototype.removeAllListeners=function(t){return void 0===t?(this.$events={},this):(this.$events&&this.$events[t]&&(this.$events[t]=null),this)},i.prototype.listeners=function(t){return this.$events||(this.$events={}),this.$events[t]||(this.$events[t]=[]),e.util.isArray(this.$events[t])||(this.$events[t]=[this.$events[t]]),this.$events[t]},i.prototype.emit=function(t){if(!this.$events)return!1;var i=this.$events[t];if(!i)return!1;var n=Array.prototype.slice.call(arguments,1);if("function"==typeof i)i.apply(this,n);else{if(!e.util.isArray(i))return!1;for(var r=i.slice(),o=0,s=r.length;s>o;o++)r[o].apply(this,n)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){function f(t){return 10>t?"0"+t:t}function date(t){return isFinite(t.valueOf())?t.getUTCFullYear()+"-"+f(t.getUTCMonth()+1)+"-"+f(t.getUTCDate())+"T"+f(t.getUTCHours())+":"+f(t.getUTCMinutes())+":"+f(t.getUTCSeconds())+"Z":null}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,n,r,o,s,a=gap,c=e[t];switch(c instanceof Date&&(c=date(t)),"function"==typeof rep&&(c=rep.call(e,t,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,i=0;o>i;i+=1)s[i]=str(i,c)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(o=rep.length,i=0;o>i;i+=1)"string"==typeof rep[i]&&(n=rep[i],r=str(n,c),r&&s.push(quote(n)+(gap?": ":":")+r));else for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(r=str(n,c),r&&s.push(quote(n)+(gap?": ":":")+r));return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,r}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(t,e,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;i>n;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})},JSON.parse=function(text,reviver){function walk(t,e){var i,n,r=t[e];if(r&&"object"==typeof r)for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n=walk(r,i),void 0!==n?r[i]=n:delete r[i]);return reviver.call(t,e,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(t,e){var i=t.parser={},n=i.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],r=i.reasons=["transport not supported","client not handshaken","unauthorized"],o=i.advice=["reconnect"],s=e.JSON,a=e.util.indexOf;i.encodePacket=function(t){var e=a(n,t.type),i=t.id||"",c=t.endpoint||"",l=t.ack,h=null;switch(t.type){case"error":var u=t.reason?a(r,t.reason):"",d=t.advice?a(o,t.advice):"";(""!==u||""!==d)&&(h=u+(""!==d?"+"+d:""));break;case"message":""!==t.data&&(h=t.data);break;case"event":var f={name:t.name};t.args&&t.args.length&&(f.args=t.args),h=s.stringify(f);break;case"json":h=s.stringify(t.data);break;case"connect":t.qs&&(h=t.qs);break;case"ack":h=t.ackId+(t.args&&t.args.length?"+"+s.stringify(t.args):"")}var p=[e,i+("data"==l?"+":""),c];return null!==h&&void 0!==h&&p.push(h),p.join(":")},i.encodePayload=function(t){var e="";if(1==t.length)return t[0];for(var i=0,n=t.length;n>i;i++){var r=t[i];e+="�"+r.length+"�"+t[i]}return e};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;i.decodePacket=function(t){var e=t.match(c);if(!e)return{};var i=e[2]||"",t=e[5]||"",a={type:n[e[1]],endpoint:e[4]||""};switch(i&&(a.id=i,a.ack=e[3]?"data":!0),a.type){case"error":var e=t.split("+");a.reason=r[e[0]]||"",a.advice=o[e[1]]||"";break;case"message":a.data=t||"";break;case"event":try{var l=s.parse(t);a.name=l.name,a.args=l.args}catch(h){}a.args=a.args||[];break;case"json":try{a.data=s.parse(t)}catch(h){}break;case"connect":a.qs=t||"";break;case"ack":var e=t.match(/^([0-9]+)(\+)?(.*)/);if(e&&(a.ackId=e[1],a.args=[],e[3]))try{a.args=e[3]?s.parse(e[3]):[]}catch(h){}break;case"disconnect":case"heartbeat":}return a},i.decodePayload=function(t){if("�"==t.charAt(0)){for(var e=[],n=1,r="";n<t.length;n++)"�"==t.charAt(n)?(e.push(i.decodePacket(t.substr(n+1).substr(0,r))),n+=Number(r)+1,r=""):r+=t.charAt(n);return e}return[i.decodePacket(t)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e){function i(t,e){this.socket=t,this.sessid=e}t.Transport=i,e.util.mixin(i,e.EventEmitter),i.prototype.heartbeats=function(){return!0},i.prototype.onData=function(t){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==t){var i=e.parser.decodePayload(t);if(i&&i.length)for(var n=0,r=i.length;r>n;n++)this.onPacket(i[n])}return this},i.prototype.onPacket=function(t){return this.socket.setHeartbeatTimeout(),"heartbeat"==t.type?this.onHeartbeat():("connect"==t.type&&""==t.endpoint&&this.onConnect(),"error"==t.type&&"reconnect"==t.advice&&(this.isOpen=!1),this.socket.onPacket(t),this)},i.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var t=this;this.closeTimeout=setTimeout(function(){t.onDisconnect()},this.socket.closeTimeout)}},i.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},i.prototype.onConnect=function(){return this.socket.onConnect(),this},i.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},i.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},i.prototype.packet=function(t){this.send(e.parser.encodePacket(t))},i.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},i.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},i.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},i.prototype.prepareUrl=function(){var t=this.socket.options;return this.scheme()+"://"+t.host+":"+t.port+"/"+t.resource+"/"+e.protocol+"/"+this.name+"/"+this.sessid},i.prototype.ready=function(t,e){e.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e,i){function n(t){if(this.options={port:80,secure:!1,document:"document"in i?document:!1,resource:"socket.io",transports:e.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},e.util.merge(this.options,t),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||e.util.ua.hasCORS)){var n=this;e.util.on(i,"beforeunload",function(){n.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function r(){}t.Socket=n,e.util.mixin(n,e.EventEmitter),n.prototype.of=function(t){return this.namespaces[t]||(this.namespaces[t]=new e.SocketNamespace(this,t),""!==t&&this.namespaces[t].packet({type:"connect"})),this.namespaces[t]},n.prototype.publish=function(){this.emit.apply(this,arguments);var t;for(var e in this.namespaces)this.namespaces.hasOwnProperty(e)&&(t=this.of(e),t.$emit.apply(t,arguments))},n.prototype.handshake=function(t){function i(e){e instanceof Error?(n.connecting=!1,n.onError(e.message)):t.apply(null,e.split(":"))}var n=this,o=this.options,s=["http"+(o.secure?"s":"")+":/",o.host+":"+o.port,o.resource,e.protocol,e.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!e.util.ua.hasCORS){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+e.j.length,a.parentNode.insertBefore(c,a),e.j.push(function(t){i(t),c.parentNode.removeChild(c)})}else{var l=e.util.request();l.open("GET",s,!0),this.isXDomain()&&(l.withCredentials=!0),l.onreadystatechange=function(){4==l.readyState&&(l.onreadystatechange=r,200==l.status?i(l.responseText):403==l.status?n.onError(l.responseText):(n.connecting=!1,!n.reconnecting&&n.onError(l.responseText)))},l.send(null)}},n.prototype.getTransport=function(t){for(var i,n=t||this.transports,r=0;i=n[r];r++)if(e.Transport[i]&&e.Transport[i].check(this)&&(!this.isXDomain()||e.Transport[i].xdomainCheck(this)))return new e.Transport[i](this,this.sessionid);return null},n.prototype.connect=function(t){if(this.connecting)return this;var i=this;return i.connecting=!0,this.handshake(function(n,r,o,s){function a(t){return i.transport&&i.transport.clearTimeouts(),i.transport=i.getTransport(t),i.transport?void i.transport.ready(i,function(){i.connecting=!0,i.publish("connecting",i.transport.name),i.transport.open(),i.options["connect timeout"]&&(i.connectTimeoutTimer=setTimeout(function(){if(!i.connected&&(i.connecting=!1,i.options["try multiple transports"])){for(var t=i.transports;t.length>0&&t.splice(0,1)[0]!=i.transport.name;);t.length?a(t):i.publish("connect_failed")}},i.options["connect timeout"]))}):i.publish("connect_failed")}i.sessionid=n,i.closeTimeout=1e3*o,i.heartbeatTimeout=1e3*r,i.transports||(i.transports=i.origTransports=s?e.util.intersect(s.split(","),i.options.transports):i.options.transports),i.setHeartbeatTimeout(),a(i.transports),i.once("connect",function(){clearTimeout(i.connectTimeoutTimer),t&&"function"==typeof t&&t()})}),this},n.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var t=this;this.heartbeatTimeoutTimer=setTimeout(function(){t.transport.onClose()},this.heartbeatTimeout)}},n.prototype.packet=function(t){return this.connected&&!this.doBuffer?this.transport.packet(t):this.buffer.push(t),this},n.prototype.setBuffer=function(t){this.doBuffer=t,!t&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},n.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},n.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},n.prototype.disconnectSync=function(){var t=e.util.request(),i=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,e.protocol,"",this.sessionid].join("/")+"/?disconnect=1";t.open("GET",i,!1),t.send(null),this.onDisconnect("booted")},n.prototype.isXDomain=function(){var t=i.location.port||("https:"==i.location.protocol?443:80);return this.options.host!==i.location.hostname||this.options.port!=t},n.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},n.prototype.onOpen=function(){this.open=!0},n.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},n.prototype.onPacket=function(t){this.of(t.endpoint).onPacket(t)},n.prototype.onError=function(t){t&&t.advice&&"reconnect"===t.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",t&&t.reason?t.reason:t)},n.prototype.onDisconnect=function(t){var e=this.connected,i=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(e||i)&&(this.transport.close(),this.transport.clearTimeouts(),e&&(this.publish("disconnect",t),"booted"!=t&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},n.prototype.reconnect=function(){function t(){if(i.connected){for(var t in i.namespaces)i.namespaces.hasOwnProperty(t)&&""!==t&&i.namespaces[t].packet({type:"connect"});i.publish("reconnect",i.transport.name,i.reconnectionAttempts)}clearTimeout(i.reconnectionTimer),i.removeListener("connect_failed",e),i.removeListener("connect",e),i.reconnecting=!1,delete i.reconnectionAttempts,delete i.reconnectionDelay,delete i.reconnectionTimer,delete i.redoTransports,i.options["try multiple transports"]=r}function e(){return i.reconnecting?i.connected?t():i.connecting&&i.reconnecting?i.reconnectionTimer=setTimeout(e,1e3):void(i.reconnectionAttempts++>=n?i.redoTransports?(i.publish("reconnect_failed"),t()):(i.on("connect_failed",e),i.options["try multiple transports"]=!0,i.transports=i.origTransports,i.transport=i.getTransport(),i.redoTransports=!0,i.connect()):(i.reconnectionDelay<o&&(i.reconnectionDelay*=2),i.connect(),i.publish("reconnecting",i.reconnectionDelay,i.reconnectionAttempts),i.reconnectionTimer=setTimeout(e,i.reconnectionDelay))):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var i=this,n=this.options["max reconnection attempts"],r=this.options["try multiple transports"],o=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(e,this.reconnectionDelay),this.on("connect",e)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e){function i(t,e){this.socket=t,this.name=e||"",this.flags={},this.json=new n(this,"json"),this.ackPackets=0,this.acks={}}function n(t,e){this.namespace=t,this.name=e}t.SocketNamespace=i,e.util.mixin(i,e.EventEmitter),i.prototype.$emit=e.EventEmitter.prototype.emit,i.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},i.prototype.packet=function(t){return t.endpoint=this.name,this.socket.packet(t),this.flags={},this},i.prototype.send=function(t,e){var i={type:this.flags.json?"json":"message",data:t};return"function"==typeof e&&(i.id=++this.ackPackets,i.ack=!0,this.acks[i.id]=e),this.packet(i)},i.prototype.emit=function(t){var e=Array.prototype.slice.call(arguments,1),i=e[e.length-1],n={type:"event",name:t};return"function"==typeof i&&(n.id=++this.ackPackets,n.ack="data",this.acks[n.id]=i,e=e.slice(0,e.length-1)),n.args=e,this.packet(n)},i.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},i.prototype.onPacket=function(t){function i(){n.packet({type:"ack",args:e.util.toArray(arguments),ackId:t.id})}var n=this;switch(t.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(t.reason||"booted"):this.$emit("disconnect",t.reason);break;case"message":case"json":var r=["message",t.data];"data"==t.ack?r.push(i):t.ack&&this.packet({type:"ack",ackId:t.id}),this.$emit.apply(this,r);break;case"event":var r=[t.name].concat(t.args);"data"==t.ack&&r.push(i),this.$emit.apply(this,r);break;case"ack":this.acks[t.ackId]&&(this.acks[t.ackId].apply(this,t.args),delete this.acks[t.ackId]);break;case"error":t.advice?this.socket.onError(t):"unauthorized"==t.reason?this.$emit("connect_failed",t.reason):this.$emit("error",t.reason)}},n.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},n.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e,i){function n(){e.Transport.apply(this,arguments)}t.websocket=n,e.util.inherit(n,e.Transport),n.prototype.name="websocket",n.prototype.open=function(){var t,n=e.util.query(this.socket.options.query),r=this;return t||(t=i.MozWebSocket||i.WebSocket),this.websocket=new t(this.prepareUrl()+n),this.websocket.onopen=function(){r.onOpen(),r.socket.setBuffer(!1)},this.websocket.onmessage=function(t){r.onData(t.data)},this.websocket.onclose=function(){r.onClose(),r.socket.setBuffer(!0)},this.websocket.onerror=function(t){r.onError(t)},this},n.prototype.send=e.util.ua.iDevice?function(t){var e=this;return setTimeout(function(){e.websocket.send(t)},0),this}:function(t){return this.websocket.send(t),this},n.prototype.payload=function(t){for(var e=0,i=t.length;i>e;e++)this.packet(t[e]);return this},n.prototype.close=function(){return this.websocket.close(),this},n.prototype.onError=function(t){this.socket.onError(t)},n.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},n.check=function(){return"WebSocket"in i&&!("__addTask"in WebSocket)||"MozWebSocket"in i},n.xdomainCheck=function(){return!0},e.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e,i){function n(t){t&&(e.Transport.apply(this,arguments),this.sendBuffer=[])}function r(){}t.XHR=n,e.util.inherit(n,e.Transport),n.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},n.prototype.payload=function(t){for(var i=[],n=0,r=t.length;r>n;n++)i.push(e.parser.encodePacket(t[n]));this.send(e.parser.encodePayload(i))},n.prototype.send=function(t){return this.post(t),this},n.prototype.post=function(t){function e(){4==this.readyState&&(this.onreadystatechange=r,o.posting=!1,200==this.status?o.socket.setBuffer(!1):o.onClose())}function n(){this.onload=r,o.socket.setBuffer(!1)}var o=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),i.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=n:this.sendXHR.onreadystatechange=e,this.sendXHR.send(t)},n.prototype.close=function(){return this.onClose(),this},n.prototype.request=function(t){var i=e.util.request(this.socket.isXDomain()),n=e.util.query(this.socket.options.query,"t="+ +new Date);if(i.open(t||"GET",this.prepareUrl()+n,!0),"POST"==t)try{i.setRequestHeader?i.setRequestHeader("Content-type","text/plain;charset=UTF-8"):i.contentType="text/plain"}catch(r){}return i},n.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},n.check=function(t,n){try{var r=e.util.request(n),o=i.XDomainRequest&&r instanceof XDomainRequest,s=t&&t.options&&t.options.secure?"https:":"http:",a=i.location&&s!=i.location.protocol;if(r&&(!o||!a))return!0}catch(c){}return!1},n.xdomainCheck=function(t){return n.check(t,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e){function i(){e.Transport.XHR.apply(this,arguments)}t.htmlfile=i,e.util.inherit(i,e.Transport.XHR),i.prototype.name="htmlfile",i.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var t=this.doc.createElement("div");t.className="socketio",this.doc.body.appendChild(t),this.iframe=this.doc.createElement("iframe"),t.appendChild(this.iframe);var i=this,n=e.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+n,e.util.on(window,"unload",function(){i.destroy()})},i.prototype._=function(t,e){t=t.replace(/\\\//g,"/"),this.onData(t);try{var i=e.getElementsByTagName("script")[0];i.parentNode.removeChild(i)}catch(n){}},i.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(t){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},i.prototype.close=function(){return this.destroy(),e.Transport.XHR.prototype.close.call(this)},i.check=function(t){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{var i=new(window[["Active"].concat("Object").join("X")])("htmlfile");return i&&e.Transport.XHR.check(t)}catch(n){}return!1},i.xdomainCheck=function(){return!1},e.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(t,e,i){function n(){e.Transport.XHR.apply(this,arguments)}function r(){}t["xhr-polling"]=n,e.util.inherit(n,e.Transport.XHR),e.util.merge(n,e.Transport.XHR),n.prototype.name="xhr-polling",n.prototype.heartbeats=function(){return!1},n.prototype.open=function(){var t=this;return e.Transport.XHR.prototype.open.call(t),!1},n.prototype.get=function(){function t(){4==this.readyState&&(this.onreadystatechange=r,200==this.status?(o.onData(this.responseText),o.get()):o.onClose())}function e(){this.onload=r,this.onerror=r,o.retryCounter=1,o.onData(this.responseText),o.get()}function n(){o.retryCounter++,!o.retryCounter||o.retryCounter>3?o.onClose():o.get()}if(this.isOpen){var o=this;this.xhr=this.request(),i.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=e,this.xhr.onerror=n):this.xhr.onreadystatechange=t,this.xhr.send(null)}},n.prototype.onClose=function(){if(e.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=r;try{this.xhr.abort()}catch(t){}this.xhr=null}},n.prototype.ready=function(t,i){var n=this;e.util.defer(function(){i.call(n)})},e.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(t,e,i){function n(){e.Transport["xhr-polling"].apply(this,arguments),this.index=e.j.length;var t=this;e.j.push(function(e){t._(e)})}var r=i.document&&"MozAppearance"in i.document.documentElement.style;t["jsonp-polling"]=n,e.util.inherit(n,e.Transport["xhr-polling"]),n.prototype.name="jsonp-polling",n.prototype.post=function(t){function i(){n(),r.socket.setBuffer(!1)}function n(){r.iframe&&r.form.removeChild(r.iframe);try{s=document.createElement('<iframe name="'+r.iframeId+'">')}catch(t){s=document.createElement("iframe"),s.name=r.iframeId}s.id=r.iframeId,r.form.appendChild(s),r.iframe=s}var r=this,o=e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var s,a=document.createElement("form"),c=document.createElement("textarea"),l=this.iframeId="socketio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="0px",a.style.left="0px",a.style.display="none",a.target=l,a.method="POST",a.setAttribute("accept-charset","utf-8"),c.name="d",a.appendChild(c),document.body.appendChild(a),this.form=a,this.area=c}this.form.action=this.prepareUrl()+o,n(),this.area.value=e.JSON.stringify(t);try{this.form.submit()}catch(h){}this.iframe.attachEvent?s.onreadystatechange=function(){"complete"==r.iframe.readyState&&i()}:this.iframe.onload=i,this.socket.setBuffer(!0)},n.prototype.get=function(){var t=this,i=document.createElement("script"),n=e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),i.async=!0,i.src=this.prepareUrl()+n,i.onerror=function(){t.onClose()};var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(i,o),this.script=i,r&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},n.prototype._=function(t){return this.onData(t),this.isOpen&&this.get(),this},n.prototype.ready=function(t,i){var n=this;return r?void e.util.load(function(){i.call(n)}):i.call(this)},n.check=function(){return"document"in i},n.xdomainCheck=function(){return!0},e.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define("socket.io",[],function(){return io})}();var fabric=fabric||{version:"1.4.4"};"undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow()),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"];
var Cufon=function(){function t(t){var e=this.face=t.face;this.glyphs=t.glyphs,this.w=t.w,this.baseSize=parseInt(e["units-per-em"],10),this.family=e["font-family"].toLowerCase(),this.weight=e["font-weight"],this.style=e["font-style"]||"normal",this.viewBox=function(){var t=e.bbox.split(/\s+/),i={minX:parseInt(t[0],10),minY:parseInt(t[1],10),maxX:parseInt(t[2],10),maxY:parseInt(t[3],10)};return i.width=i.maxX-i.minX,i.height=i.maxY-i.minY,i.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")},i}(),this.ascent=-parseInt(e.ascent,10),this.descent=-parseInt(e.descent,10),this.height=-this.ascent+this.descent}function e(){var t={},e={oblique:"italic",italic:"oblique"};this.add=function(e){(t[e.style]||(t[e.style]={}))[e.weight]=e},this.get=function(i,n){var r=t[i]||t[e[i]]||t.normal||t.italic||t.oblique;if(!r)return null;if(n={normal:400,bold:700}[n]||parseInt(n,10),r[n])return r[n];var o,s,a={1:1,99:0}[n%100],c=[];void 0===a&&(a=n>400),500==n&&(n=400);for(var l in r)l=parseInt(l,10),(!o||o>l)&&(o=l),(!s||l>s)&&(s=l),c.push(l);return o>n&&(n=o),n>s&&(n=s),c.sort(function(t,e){return(a?t>n&&e>n?e>t:t>e:n>t&&n>e?t>e:e>t)?-1:1}),r[c[0]]}}function i(){function t(t,e){return t.contains?t.contains(e):16&t.compareDocumentPosition(e)}function e(e){var i=e.relatedTarget;i&&!t(this,i)&&n(this)}function i(){n(this)}function n(t){setTimeout(function(){f.replace(t,v.get(t).options,!0)},10)}this.attach=function(t){void 0===t.onmouseenter?(o(t,"mouseover",e),o(t,"mouseout",e)):(o(t,"mouseenter",i),o(t,"mouseleave",i))}}function n(){function t(t){return t.cufid||(t.cufid=++i)}var e={},i=0;this.get=function(i){var n=t(i);return e[n]||(e[n]={})}}function r(t){var e={},i={};this.get=function(i){return void 0!=e[i]?e[i]:t[i]},this.getSize=function(t,e){return i[t]||(i[t]=new g.Size(this.get(t),e))},this.extend=function(t){for(var i in t)e[i]=t[i];return this}}function o(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,function(){return i.call(t,fabric.window.event)})}function s(t,e){var i=v.get(t);return i.options?t:(e.hover&&e.hoverables[t.nodeName.toLowerCase()]&&b.attach(t),i.options=e,t)}function a(t){var e={};return function(i){return e.hasOwnProperty(i)||(e[i]=t.apply(null,arguments)),e[i]}}function c(t,e){e||(e=g.getStyle(t));for(var i,n=g.quotedList(e.get("fontFamily").toLowerCase()),r=0,o=n.length;o>r;++r)if(i=n[r],w[i])return w[i].get(e.get("fontStyle"),e.get("fontWeight"));return null}function l(t){return fabric.document.getElementsByTagName(t)}function h(){for(var t,e={},i=0,n=arguments.length;n>i;++i)for(t in arguments[i])e[t]=arguments[i][t];return e}function u(t,e,i,n,r,o){var s=n.separate;if("none"==s)return x[n.engine].apply(null,arguments);var a,c=fabric.document.createDocumentFragment(),l=e.split(S[s]),h="words"==s;h&&m&&(/^\s/.test(e)&&l.unshift(""),/\s$/.test(e)&&l.push(""));for(var u=0,d=l.length;d>u;++u)a=x[n.engine](t,h?g.textAlign(l[u],i,u,d):l[u],i,n,r,o,d-1>u),a&&c.appendChild(a);return c}function d(t,e){for(var i,n,r,o,a=s(t,e).firstChild;a;a=r){if(r=a.nextSibling,o=!1,1==a.nodeType){if(!a.firstChild)continue;if(!/cufon/.test(a.className)){arguments.callee(a,e);continue}o=!0}if(n||(n=g.getStyle(t).extend(e)),i||(i=c(t,n)),i)if(o)x[e.engine](i,null,n,e,a,t);else{var l=a.data;if("undefined"!=typeof G_vmlCanvasManager&&(l=l.replace(/\r/g,"\n")),""!==l){var h=u(i,l,n,e,a,t);h?a.parentNode.replaceChild(h,a):a.parentNode.removeChild(a)}}}}var f=function(){return f.replace.apply(null,arguments)},p=f.DOM={ready:function(){var t=!1,e={loaded:1,complete:1},i=[],n=function(){if(!t){t=!0;for(var e;e=i.shift();e());}};return fabric.document.addEventListener&&(fabric.document.addEventListener("DOMContentLoaded",n,!1),fabric.window.addEventListener("pageshow",n,!1)),!fabric.window.opera&&fabric.document.readyState&&function(){e[fabric.document.readyState]?n():setTimeout(arguments.callee,10)}(),fabric.document.readyState&&fabric.document.createStyleSheet&&function(){try{fabric.document.body.doScroll("left"),n()}catch(t){setTimeout(arguments.callee,1)}}(),o(fabric.window,"load",n),function(e){arguments.length?t?e():i.push(e):n()}}()},g=f.CSS={Size:function(t,e){this.value=parseFloat(t),this.unit=String(t).match(/[a-z%]*$/)[0]||"px",this.convert=function(t){return t/e*this.value},this.convertFrom=function(t){return t/this.value*e},this.toString=function(){return this.value+this.unit}},getStyle:function(t){return new r(t.style)},quotedList:a(function(t){for(var e,i=[],n=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g;e=n.exec(t);)i.push(e[3]||e[1]);return i}),ready:function(){var t=!1,e=[],i=function(){t=!0;for(var i;i=e.shift();i());},n=Object.prototype.propertyIsEnumerable?l("style"):{length:0},r=l("link");return p.ready(function(){for(var t,e=0,o=0,s=r.length;t=r[o],s>o;++o)t.disabled||"stylesheet"!=t.rel.toLowerCase()||++e;fabric.document.styleSheets.length>=n.length+e?i():setTimeout(arguments.callee,10)}),function(i){t?i():e.push(i)}}(),supports:function(t,e){var i=fabric.document.createElement("span").style;return void 0===i[t]?!1:(i[t]=e,i[t]===e)},textAlign:function(t,e,i,n){return"right"==e.get("textAlign")?i>0&&(t=" "+t):n-1>i&&(t+=" "),t},textDecoration:function(t,e){e||(e=this.getStyle(t));for(var i={underline:null,overline:null,"line-through":null},n=t;n.parentNode&&1==n.parentNode.nodeType;){var r=!0;for(var o in i)i[o]||(-1!=e.get("textDecoration").indexOf(o)&&(i[o]=e.get("color")),r=!1);if(r)break;e=this.getStyle(n=n.parentNode)}return i},textShadow:a(function(t){if("none"==t)return null;for(var e,i=[],n={},r=0,o=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/gi;e=o.exec(t);)","==e[0]?(i.push(n),n={},r=0):e[1]?n.color=e[1]:n[["offX","offY","blur"][r++]]=e[2];return i.push(n),i}),color:a(function(t){var e={};return e.color=t.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(t,i,n){return e.opacity=parseFloat(n),"rgb("+i+")"}),e}),textTransform:function(t,e){return t[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[e.get("textTransform")]||"toString"]()}},m=0==" ".split(/\s+/).length,v=new n,b=new i,y=[],x={},w={},C={engine:null,hover:!1,hoverables:{a:!0},printable:!0,selector:fabric.window.Sizzle||fabric.window.jQuery&&function(t){return jQuery(t)}||fabric.window.dojo&&dojo.query||fabric.window.$$&&function(t){return $$(t)}||fabric.window.$&&function(t){return $(t)}||fabric.document.querySelectorAll&&function(t){return fabric.document.querySelectorAll(t)}||l,separate:"words",textShadow:"none"},S={words:/\s+/,characters:""};return f.now=function(){return p.ready(),f},f.refresh=function(){for(var t=y.splice(0,y.length),e=0,i=t.length;i>e;++e)f.replace.apply(null,t[e]);return f},f.registerEngine=function(t,e){return e?(x[t]=e,f.set("engine",t)):f},f.registerFont=function(i){var n=new t(i),r=n.family;return w[r]||(w[r]=new e),w[r].add(n),f.set("fontFamily",'"'+r+'"')},f.replace=function(t,e,i){return e=h(C,e),e.engine?("string"==typeof e.textShadow&&e.textShadow&&(e.textShadow=g.textShadow(e.textShadow)),i||y.push(arguments),(t.nodeType||"string"==typeof t)&&(t=[t]),g.ready(function(){for(var i=0,n=t.length;n>i;++i){var r=t[i];"string"==typeof r?f.replace(e.selector(r),e,!0):d(r,e)}}),f):f},f.replaceElement=function(t,e){return e=h(C,e),"string"==typeof e.textShadow&&e.textShadow&&(e.textShadow=g.textShadow(e.textShadow)),d(t,e)},f.engines=x,f.fonts=w,f.getOptions=function(){return h(C)},f.set=function(t,e){return C[t]=e,f},f}();if(Cufon.registerEngine("canvas",function(){function t(t,e){var i,n=0,r=0,o=[],s=/([mrvxe])([^a-z]*)/g;t:for(var a=0;i=s.exec(t);++a){var c=i[2].split(",");switch(i[1]){case"v":o[a]={m:"bezierCurveTo",a:[n+~~c[0],r+~~c[1],n+~~c[2],r+~~c[3],n+=~~c[4],r+=~~c[5]]};break;case"r":o[a]={m:"lineTo",a:[n+=~~c[0],r+=~~c[1]]};break;case"m":o[a]={m:"moveTo",a:[n=~~c[0],r=~~c[1]]};break;case"x":o[a]={m:"closePath",a:[]};break;case"e":break t}e[o[a].m].apply(e,o[a].a)}return o}function e(t,e){for(var i=0,n=t.length;n>i;++i){var r=t[i];e[r.m].apply(e,r.a)}}var i=Cufon.CSS.supports("display","inline-block"),n=!i&&("BackCompat"==fabric.document.compatMode||/frameset|transitional/i.test(fabric.document.doctype.publicId)),r=fabric.document.createElement("style");r.type="text/css";var o=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(n?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+(i?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{r.appendChild(o)}catch(s){r.setAttribute("type","text/css"),r.styleSheet.cssText=o.data}return fabric.document.getElementsByTagName("head")[0].appendChild(r),function(n,r,o,s,a){function c(){X.save();var t=0,e=0,i=[{left:0}];s.backgroundColor&&(X.save(),X.fillStyle=s.backgroundColor,X.translate(0,n.ascent),X.fillRect(0,0,_+10,(-n.ascent+n.descent)*j),X.restore()),"right"===s.textAlign?(X.translate(I[e],0),i[0].left=I[e]*Y):"center"===s.textAlign&&(X.translate(I[e]/2,0),i[0].left=I[e]/2*Y);for(var r=0,o=k.length;o>r;++r)if("\n"!==k[r]){var a=n.glyphs[k[r]]||n.missingGlyph;if(a){var c=Number(a.w||n.w)+f;s.textBackgroundColor&&(X.save(),X.fillStyle=s.textBackgroundColor,X.translate(0,n.ascent),X.fillRect(0,0,c+10,-n.ascent+n.descent),X.restore()),X.translate(c,0),t+=c,r==o-1&&(i[i.length-1].width=t*Y,i[i.length-1].height=(-n.ascent+n.descent)*Y)}}else{e++;var l=-n.ascent-n.ascent/5*s.lineHeight,h=i[i.length-1],u={left:0};h.width=t*Y,h.height=(-n.ascent+n.descent)*Y,"right"===s.textAlign?(X.translate(-_,l),X.translate(I[e],0),u.left=I[e]*Y):"center"===s.textAlign?(X.translate(-t-I[e-1]/2,l),X.translate(I[e]/2,0),u.left=I[e]/2*Y):X.translate(-t,l),i.push(u),t=0}X.restore(),Cufon.textOptions.boundaries=i}function l(i){X.fillStyle=i||Cufon.textOptions.color||o.get("color");var r=0,a=0;"right"===s.textAlign?X.translate(I[a],0):"center"===s.textAlign&&X.translate(I[a]/2,0);for(var c=0,l=k.length;l>c;++c)if("\n"!==k[c]){var h=n.glyphs[k[c]]||n.missingGlyph;if(h){var u=Number(h.w||n.w)+f;G&&(X.save(),X.strokeStyle=X.fillStyle,X.lineWidth+=X.lineWidth,X.beginPath(),G.underline&&(X.moveTo(0,-n.face["underline-position"]+.5),X.lineTo(u,-n.face["underline-position"]+.5)),G.overline&&(X.moveTo(0,n.ascent+.5),X.lineTo(u,n.ascent+.5)),G["line-through"]&&(X.moveTo(0,-n.descent+.5),X.lineTo(u,-n.descent+.5)),X.stroke(),X.restore()),V&&(X.save(),X.transform(1,0,-.25,1,0,0)),X.beginPath(),h.d&&(h.code?e(h.code,X):h.code=t("m"+h.d,X)),X.fill(),s.strokeStyle&&(X.closePath(),X.save(),X.lineWidth=s.strokeWidth,X.strokeStyle=s.strokeStyle,X.stroke(),X.restore()),V&&X.restore(),X.translate(u,0),r+=u}}else{a++;var d=-n.ascent-n.ascent/5*s.lineHeight;"right"===s.textAlign?(X.translate(-_,d),X.translate(I[a],0)):"center"===s.textAlign?(X.translate(-r-I[a-1]/2,d),X.translate(I[a]/2,0)):X.translate(-r,d),r=0}}var h=null===r,u=n.viewBox,d=o.getSize("fontSize",n.baseSize),f=o.get("letterSpacing");f="normal"==f?0:d.convertFrom(parseInt(f,10));var p=0,g=0,m=0,v=0,b=s.textShadow,y=[];if(Cufon.textOptions.shadowOffsets=[],Cufon.textOptions.shadows=null,b){Cufon.textOptions.shadows=b;for(var x=0,w=b.length;w>x;++x){var C=b[x],S=d.convertFrom(parseFloat(C.offX)),A=d.convertFrom(parseFloat(C.offY));y[x]=[S,A]}}for(var k=Cufon.CSS.textTransform(h?a.alt:r,o).split(""),_=0,T=null,O=0,j=1,E=[],x=0,w=k.length;w>x;++x)if("\n"!==k[x]){var D=n.glyphs[k[x]]||n.missingGlyph;D&&(_+=T=Number(D.w||n.w)+f)}else j++,_>O&&(O=_),E.push(_),_=0;E.push(_),_=Math.max(O,_);for(var I=[],x=E.length;x--;)I[x]=_-E[x];if(null===T)return null;g+=u.width-T,v+=u.minX;var L,P;if(h)L=a,P=a.firstChild;else if(L=fabric.document.createElement("span"),L.className="cufon cufon-canvas",L.alt=r,P=fabric.document.createElement("canvas"),L.appendChild(P),s.printable){var M=fabric.document.createElement("span");M.className="cufon-alt",M.appendChild(fabric.document.createTextNode(r)),L.appendChild(M)}var B=L.style,R=P.style||{},F=d.convert(u.height-p+m),$=Math.ceil(F),N=$/F;P.width=Math.ceil(d.convert(_+g-v)*N),P.height=$,p+=u.minY,R.top=Math.round(d.convert(p-n.ascent))+"px",R.left=Math.round(d.convert(v))+"px";var z=Math.ceil(d.convert(_*N)),W=z+"px",q=d.convert(n.height),H=(s.lineHeight-1)*d.convert(-n.ascent/5)*(j-1);Cufon.textOptions.width=z,Cufon.textOptions.height=q*j+H,Cufon.textOptions.lines=j,Cufon.textOptions.totalLineHeight=H,i?(B.width=W,B.height=q+"px"):(B.paddingLeft=W,B.paddingBottom=q-1+"px");var X=Cufon.textOptions.context||P.getContext("2d"),Y=$/u.height;Cufon.textOptions.fontAscent=n.ascent*Y,Cufon.textOptions.boundaries=null;for(var U=Cufon.textOptions.shadowOffsets,x=y.length;x--;)U[x]=[y[x][0]*Y,y[x][1]*Y];X.save(),X.scale(Y,Y),X.translate(-v-1/Y*P.width/2+(Cufon.fonts[n.family].offsetLeft||0),-p-Cufon.textOptions.height/Y/2+(Cufon.fonts[n.family].offsetTop||0)),X.lineWidth=n.face["underline-thickness"],X.save();var G=Cufon.getTextDecoration(s),V="italic"===s.fontStyle;if(X.save(),c(),b)for(var x=0,w=b.length;w>x;++x){var C=b[x];X.save(),X.translate.apply(X,y[x]),l(C.color),X.restore()}return l(),X.restore(),X.restore(),X.restore(),L}}()),Cufon.registerEngine("vml",function(){function t(t,i){return e(t,/(?:em|ex|%)$/i.test(i)?"1em":i)}function e(t,e){if(/px$/i.test(e))return parseFloat(e);var i=t.style.left,n=t.runtimeStyle.left;t.runtimeStyle.left=t.currentStyle.left,t.style.left=e;var r=t.style.pixelLeft;return t.style.left=i,t.runtimeStyle.left=n,r}if(fabric.document.namespaces){var i=fabric.document.createElement("canvas");if(!(i&&i.getContext&&i.getContext.apply)){null==fabric.document.namespaces.cvml&&fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml");var n=fabric.document.createElement("cvml:shape");if(n.style.behavior="url(#default#VML)",n.coordsize)return n=null,fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>'),function(i,n,r,o,s,a,c){var l=null===n;l&&(n=s.alt);var h=i.viewBox,u=r.computedFontSize||(r.computedFontSize=new Cufon.CSS.Size(t(a,r.get("fontSize"))+"px",i.baseSize)),d=r.computedLSpacing;void 0==d&&(d=r.get("letterSpacing"),r.computedLSpacing=d="normal"==d?0:~~u.convertFrom(e(a,d)));var f,p;if(l)f=s,p=s.firstChild;else{if(f=fabric.document.createElement("span"),f.className="cufon cufon-vml",f.alt=n,p=fabric.document.createElement("span"),p.className="cufon-vml-canvas",f.appendChild(p),o.printable){var g=fabric.document.createElement("span");g.className="cufon-alt",g.appendChild(fabric.document.createTextNode(n)),f.appendChild(g)}c||f.appendChild(fabric.document.createElement("cvml:shape"))}var m=f.style,v=p.style,b=u.convert(h.height),y=Math.ceil(b),x=y/b,w=h.minX,C=h.minY;v.height=y,v.top=Math.round(u.convert(C-i.ascent)),v.left=Math.round(u.convert(w)),m.height=u.convert(i.height)+"px";for(var S,A,k=(Cufon.getTextDecoration(o),r.get("color")),_=Cufon.CSS.textTransform(n,r).split(""),T=0,O=0,j=null,E=o.textShadow,D=0,I=0,L=_.length;L>D;++D)S=i.glyphs[_[D]]||i.missingGlyph,S&&(T+=j=~~(S.w||i.w)+d);if(null===j)return null;var P,M=-w+T+(h.width-j),B=u.convert(M*x),R=Math.round(B),F=M+","+h.height,$="r"+F+"nsnf";for(D=0;L>D;++D)if(S=i.glyphs[_[D]]||i.missingGlyph){l?(A=p.childNodes[I],A.firstChild&&A.removeChild(A.firstChild)):(A=fabric.document.createElement("cvml:shape"),p.appendChild(A)),A.stroked="f",A.coordsize=F,A.coordorigin=P=w-O+","+C,A.path=(S.d?"m"+S.d+"xe":"")+"m"+P+$,A.fillcolor=k;var N=A.style;if(N.width=R,N.height=y,E){var z,W=E[0],q=E[1],H=Cufon.CSS.color(W.color),X=fabric.document.createElement("cvml:shadow");X.on="t",X.color=H.color,X.offset=W.offX+","+W.offY,q&&(z=Cufon.CSS.color(q.color),X.type="double",X.color2=z.color,X.offset2=q.offX+","+q.offY),X.opacity=H.opacity||z&&z.opacity||1,A.appendChild(X)}O+=~~(S.w||i.w)+d,++I}return m.width=Math.max(Math.ceil(u.convert(T*x)),0),f}}}}()),Cufon.getTextDecoration=function(t){return{underline:"underline"===t.textDecoration,overline:"overline"===t.textDecoration,"line-through":"line-through"===t.textDecoration}},"undefined"!=typeof exports&&(exports.Cufon=Cufon),"object"!=typeof JSON&&(JSON={}),function(){function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,n,r,o,s,a=gap,c=e[t];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(t)),"function"==typeof rep&&(c=rep.call(e,t,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,i=0;o>i;i+=1)s[i]=str(i,c)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(o=rep.length,i=0;o>i;i+=1)"string"==typeof rep[i]&&(n=rep[i],r=str(n,c),r&&s.push(quote(n)+(gap?": ":":")+r));else for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(r=str(n,c),r&&s.push(quote(n)+(gap?": ":":")+r));return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx,escapable,gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;i>n;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(t,e){var i,n,r=t[e];if(r&&"object"==typeof r)for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n=walk(r,i),void 0!==n?r[i]=n:delete r[i]);return reviver.call(t,e,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){function t(t,e){this.__eventListeners[t]&&(e?fabric.util.removeFromArray(this.__eventListeners[t],e):this.__eventListeners[t].length=0)}function e(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}function i(e,i){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"==typeof arguments[0])for(var n in e)t.call(this,n,e[n]);else t.call(this,e,i);return this}}function n(t,e){if(this.__eventListeners){var i=this.__eventListeners[t];if(i){for(var n=0,r=i.length;r>n;n++)i[n].call(this,e||{});return this}}}fabric.Observable={observe:e,stopObserving:i,fire:n,on:e,off:i,trigger:n}}(),fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var t=0,e=arguments.length;e>t;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(t,e,i){var n=this.getObjects();return i?n[e]=t:n.splice(e,0,t),this._onObjectAdded(t),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var t,e=this.getObjects(),i=0,n=arguments.length;n>i;i++)t=e.indexOf(arguments[i]),-1!==t&&(e.splice(t,1),this._onObjectRemoved(arguments[i]));return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),n=i.length;n--;)t.call(e,i[n],n,i);return this},getObjects:function(t){return"undefined"==typeof t?this._objects:this._objects.filter(function(e){return e.type===t})},item:function(t){return this.getObjects()[t]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(t){return this.getObjects().indexOf(t)>-1},complexity:function(){return this.getObjects().reduce(function(t,e){return t+=e.complexity?e.complexity():0},0)}},function(t){var e=Math.sqrt,i=Math.atan2,n=Math.PI/180;fabric.util={removeFromArray:function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*n},radiansToDegrees:function(t){return t/n},rotatePoint:function(t,e,i){var n=Math.sin(i),r=Math.cos(i);t.subtractEquals(e);var o=t.x*r-t.y*n,s=t.x*n+t.y*r;return new fabric.Point(o,s).addEquals(e)},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},falseFunction:function(){return!1},getKlass:function(t,e){return t=fabric.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),fabric.util.resolveNamespace(e)[t]},resolveNamespace:function(e){if(!e)return fabric;for(var i=e.split("."),n=i.length,r=t||fabric.window,o=0;n>o;++o)r=r[i[o]];return r},loadImage:function(t,e,i,n){if(!t)return void(e&&e.call(i,t));var r=fabric.util.createImage();r.onload=function(){e&&e.call(i,r),r=r.onload=r.onerror=null},r.onerror=function(){fabric.log("Error loading "+r.src),e&&e.call(i,null,!0),r=r.onload=r.onerror=null},0!==t.indexOf("data")&&"undefined"!=typeof n&&(r.crossOrigin=n),r.src=t},enlivenObjects:function(t,e,i,n){function r(){++s===a&&e&&e(o)}t=t||[];var o=[],s=0,a=t.length;return a?void t.forEach(function(t,e){if(!t||!t.type)return void r();var s=fabric.util.getKlass(t.type,i);s.async?s.fromObject(t,function(i,s){s||(o[e]=i,n&&n(t,o[e])),r()}):(o[e]=s.fromObject(t),n&&n(t,o[e]),r())}):void(e&&e(o))},groupSVGElements:function(t,e,i){var n;return n=t.length>1?new fabric.PathGroup(t,e):t[0],"undefined"!=typeof i&&n.setSourcePath(i),n},populateWithProperties:function(t,e,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var n=0,r=i.length;r>n;n++)i[n]in t&&(e[i[n]]=t[i[n]])},drawDashedLine:function(t,n,r,o,s,a){var c=o-n,l=s-r,h=e(c*c+l*l),u=i(l,c),d=a.length,f=0,p=!0;for(t.save(),t.translate(n,r),t.moveTo(0,0),t.rotate(u),n=0;h>n;)n+=a[f++%d],n>h&&(n=h),t[p?"lineTo":"moveTo"](n,0),p=!p;t.restore()},createCanvasElement:function(t){return t||(t=fabric.document.createElement("canvas")),t.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(t),t},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(t){for(var e=t.prototype,i=e.stateProperties.length;i--;){var n=e.stateProperties[i],r=n.charAt(0).toUpperCase()+n.slice(1),o="set"+r,s="get"+r;e[s]||(e[s]=function(t){return new Function('return this.get("'+t+'")')}(n)),e[o]||(e[o]=function(t){return new Function("value",'return this.set("'+t+'", value)')}(n))}},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(t,e){for(var i=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]],n=[[e[0],e[2],e[4]],[e[1],e[3],e[5]],[0,0,1]],r=[],o=0;3>o;o++){r[o]=[];for(var s=0;3>s;s++){for(var a=0,c=0;3>c;c++)a+=i[o][c]*n[c][s];r[o][s]=a}}return[r[0][0],r[1][0],r[0][1],r[1][1],r[0][2],r[1][2]]},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},normalizePoints:function(t,e){var i=fabric.util.array.min(t,"x"),n=fabric.util.array.min(t,"y");i=0>i?i:0,n=0>i?n:0;for(var r=0,o=t.length;o>r;r++)t[r].x-=e.width/2+i||0,t[r].y-=e.height/2+n||0},isTransparent:function(t,e,i,n){n>0&&(e>n?e-=n:e=0,i>n?i-=n:i=0);for(var r=!0,o=t.getImageData(e,i,2*n||1,2*n||1),s=3,a=o.data.length;a>s;s+=4){var c=o.data[s];if(r=0>=c,r===!1)break}return o=null,r}}}("undefined"!=typeof exports?exports:this),function(){function t(t,i,o,a,c,l,h,u,d){if(n=s.call(arguments),r[n])return r[n];var f=e(h,o,a,u,d,t,i),p=(f.x1-f.x0)*(f.x1-f.x0)+(f.y1-f.y0)*(f.y1-f.y0),g=1/p-.25;0>g&&(g=0);var m=Math.sqrt(g);l===c&&(m=-m);var v=.5*(f.x0+f.x1)-m*(f.y1-f.y0),b=.5*(f.y0+f.y1)+m*(f.x1-f.x0),y=Math.atan2(f.y0-b,f.x0-v),x=Math.atan2(f.y1-b,f.x1-v),w=x-y;0>w&&1===l?w+=2*Math.PI:w>0&&0===l&&(w-=2*Math.PI);for(var C=Math.ceil(Math.abs(w/(.5*Math.PI+.001))),S=[],A=0;C>A;A++){var k=y+A*w/C,_=y+(A+1)*w/C;S[A]=[v,b,k,_,o,a,f.sinTh,f.cosTh]}return r[n]=S,S}function e(t,e,i,n,r,o,s){var a=t*(Math.PI/180),c=Math.sin(a),l=Math.cos(a);e=Math.abs(e),i=Math.abs(i);var h=l*(n-o)*.5+c*(r-s)*.5,u=l*(r-s)*.5-c*(n-o)*.5,d=h*h/(e*e)+u*u/(i*i);d>1&&(d=Math.sqrt(d),e*=d,i*=d);var f=l/e,p=c/e,g=-c/i,m=l/i;return{x0:f*n+p*r,y0:g*n+m*r,x1:f*o+p*s,y1:g*o+m*s,sinTh:c,cosTh:l}}function i(t,e,i,r,a,c,l,h){if(n=s.call(arguments),o[n])return o[n];var u=h*a,d=-l*c,f=l*a,p=h*c,g=.5*(r-i),m=8/3*Math.sin(.5*g)*Math.sin(.5*g)/Math.sin(g),v=t+Math.cos(i)-m*Math.sin(i),b=e+Math.sin(i)+m*Math.cos(i),y=t+Math.cos(r),x=e+Math.sin(r),w=y+m*Math.sin(r),C=x-m*Math.cos(r);return o[n]=[u*v+d*b,f*v+p*b,u*w+d*C,f*w+p*C,u*y+d*x,f*y+p*x],o[n]}var n,r={},o={},s=Array.prototype.join;fabric.util.drawArc=function(e,n,r,o){for(var s=o[0],a=o[1],c=o[2],l=o[3],h=o[4],u=o[5],d=o[6],f=t(u,d,s,a,l,h,c,n,r),p=0;p<f.length;p++){var g=i.apply(this,f[p]);e.bezierCurveTo.apply(e,g)}}}(),function(){function t(t,e){for(var i=r.call(arguments,2),n=[],o=0,s=t.length;s>o;o++)n[o]=i.length?t[o][e].apply(t[o],i):t[o][e].call(t[o]);return n}function e(t,e){return n(t,e,function(t,e){return t>=e})}function i(t,e){return n(t,e,function(t,e){return e>t})}function n(t,e,i){if(t&&0!==t.length){var n=t.length-1,r=e?t[n][e]:t[n];if(e)for(;n--;)i(t[n][e],r)&&(r=t[n][e]);else for(;n--;)i(t[n],r)&&(r=t[n]);return r}}var r=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0===i)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&n!==Number.POSITIVE_INFINITY&&n!==Number.NEGATIVE_INFINITY&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=i)return-1;for(var r=n>=0?n:Math.max(i-Math.abs(n),0);i>r;r++)if(r in e&&e[r]===t)return r;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var i=0,n=this.length>>>0;n>i;i++)i in this&&t.call(e,this[i],i,this)}),Array.prototype.map||(Array.prototype.map=function(t,e){for(var i=[],n=0,r=this.length>>>0;r>n;n++)n in this&&(i[n]=t.call(e,this[n],n,this));return i}),Array.prototype.every||(Array.prototype.every=function(t,e){for(var i=0,n=this.length>>>0;n>i;i++)if(i in this&&!t.call(e,this[i],i,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t,e){for(var i=0,n=this.length>>>0;n>i;i++)if(i in this&&t.call(e,this[i],i,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(t,e){for(var i,n=[],r=0,o=this.length>>>0;o>r;r++)r in this&&(i=this[r],t.call(e,i,r,this)&&n.push(i));return n}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var e,i=this.length>>>0,n=0;if(arguments.length>1)e=arguments[1];else for(;;){if(n in this){e=this[n++];break}if(++n>=i)throw new TypeError}for(;i>n;n++)n in this&&(e=t.call(null,e,this[n],n,this));return e}),fabric.util.array={invoke:t,min:i,max:e}}(),function(){function t(t,e){for(var i in e)t[i]=e[i];return t}function e(e){return t({},e)}fabric.util.object={extend:t,clone:e}}(),function(){function t(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})}function e(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())}function i(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:t,capitalize:e,escapeXml:i}}(),function(){var t=Array.prototype.slice,e=Function.prototype.apply,i=function(){};Function.prototype.bind||(Function.prototype.bind=function(n){var r,o=this,s=t.call(arguments,1);return r=s.length?function(){return e.call(o,this instanceof i?this:n,s.concat(t.call(arguments)))}:function(){return e.call(o,this instanceof i?this:n,arguments)},i.prototype=this.prototype,r.prototype=new i,r})}(),function(){function t(){}function e(t){var e=this.constructor.superclass.prototype[t];return arguments.length>1?e.apply(this,n.call(arguments,1)):e.call(this)}function i(){function i(){this.initialize.apply(this,arguments)}var o=null,a=n.call(arguments,0);"function"==typeof a[0]&&(o=a.shift()),i.superclass=o,i.subclasses=[],o&&(t.prototype=o.prototype,i.prototype=new t,o.subclasses.push(i));for(var c=0,l=a.length;l>c;c++)s(i,a[c],o);return i.prototype.initialize||(i.prototype.initialize=r),i.prototype.constructor=i,i.prototype.callSuper=e,i}var n=Array.prototype.slice,r=function(){},o=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),s=function(t,e,i){for(var n in e)t.prototype[n]=n in t.prototype&&"function"==typeof t.prototype[n]&&(e[n]+"").indexOf("callSuper")>-1?function(t){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var r=e[t].apply(this,arguments);return this.constructor.superclass=n,"initialize"!==t?r:void 0}}(n):e[n],o&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};fabric.util.createClass=i}(),function(){function t(t){var e,i,n=Array.prototype.slice.call(arguments,1),r=n.length;for(i=0;r>i;i++)if(e=typeof t[n[i]],!/^(?:function|object|unknown)$/.test(e))return!1;return!0}function e(t,e){return{handler:e,wrappedHandler:i(t,e)}}function i(t,e){return function(i){e.call(s(t),i||fabric.window.event)}}function n(t,e){return function(i){if(g[t]&&g[t][e])for(var n=g[t][e],r=0,o=n.length;o>r;r++)n[r].call(this,i||fabric.window.event)}}function r(t,e){t||(t=fabric.window.event);var i=t.target||(typeof t.srcElement!==c?t.srcElement:null),n=fabric.util.getScrollLeftTop(i,e);return{x:m(t)+n.left,y:v(t)+n.top}}function o(t,e,i){var n="touchend"===t.type?"changedTouches":"touches";return t[n]&&t[n][0]?t[n][0][e]-(t[n][0][e]-t[n][0][i])||t[i]:t[i]}var s,a,c="unknown",l=function(){var t=0;return function(e){return e.__uniqueID||(e.__uniqueID="uniqueID__"+t++)}}();!function(){var t={};s=function(e){return t[e]},a=function(e,i){t[e]=i}}();var h,u,d=t(fabric.document.documentElement,"addEventListener","removeEventListener")&&t(fabric.window,"addEventListener","removeEventListener"),f=t(fabric.document.documentElement,"attachEvent","detachEvent")&&t(fabric.window,"attachEvent","detachEvent"),p={},g={};d?(h=function(t,e,i){t.addEventListener(e,i,!1)},u=function(t,e,i){t.removeEventListener(e,i,!1)
}):f?(h=function(t,i,n){var r=l(t);a(r,t),p[r]||(p[r]={}),p[r][i]||(p[r][i]=[]);var o=e(r,n);p[r][i].push(o),t.attachEvent("on"+i,o.wrappedHandler)},u=function(t,e,i){var n,r=l(t);if(p[r]&&p[r][e])for(var o=0,s=p[r][e].length;s>o;o++)n=p[r][e][o],n&&n.handler===i&&(t.detachEvent("on"+e,n.wrappedHandler),p[r][e][o]=null)}):(h=function(t,e,i){var r=l(t);if(g[r]||(g[r]={}),!g[r][e]){g[r][e]=[];var o=t["on"+e];o&&g[r][e].push(o),t["on"+e]=n(r,e)}g[r][e].push(i)},u=function(t,e,i){var n=l(t);if(g[n]&&g[n][e])for(var r=g[n][e],o=0,s=r.length;s>o;o++)r[o]===i&&r.splice(o,1)}),fabric.util.addListener=h,fabric.util.removeListener=u;var m=function(t){return typeof t.clientX!==c?t.clientX:0},v=function(t){return typeof t.clientY!==c?t.clientY:0};fabric.isTouchSupported&&(m=function(t){return o(t,"pageX","clientX")},v=function(t){return o(t,"pageY","clientY")}),fabric.util.getPointer=r,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function t(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,e.indexOf("opacity")>-1?o(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var n in e)if("opacity"===n)o(t,e[n]);else{var r="float"===n||"cssFloat"===n?"undefined"==typeof i.styleFloat?"cssFloat":"styleFloat":n;i[r]=e[n]}return t}var e=fabric.document.createElement("div"),i="string"==typeof e.style.opacity,n="string"==typeof e.style.filter,r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,o=function(t){return t};i?o=function(t,e){return t.style.opacity=e,t}:n&&(o=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),r.test(i.filter)?(e=e>=.9999?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(r,e)):i.filter+=" alpha(opacity="+100*e+")",t}),fabric.util.setStyle=t}(),function(){function t(t){return"string"==typeof t?fabric.document.getElementById(t):t}function e(t,e){var i=fabric.document.createElement(t);for(var n in e)"class"===n?i.className=e[n]:"for"===n?i.htmlFor=e[n]:i.setAttribute(n,e[n]);return i}function i(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)}function n(t,i,n){return"string"==typeof i&&(i=e(i,n)),t.parentNode&&t.parentNode.replaceChild(i,t),i.appendChild(t),i}function r(t,e){var i,n,r=0,o=0,s=fabric.document.documentElement,a=fabric.document.body||{scrollLeft:0,scrollTop:0};for(n=t;t&&t.parentNode&&!i;)t=t.parentNode,t!==fabric.document&&"fixed"===fabric.util.getElementStyle(t,"position")&&(i=t),t!==fabric.document&&n!==e&&"absolute"===fabric.util.getElementStyle(t,"position")?(r=0,o=0):t===fabric.document?(r=a.scrollLeft||s.scrollLeft||0,o=a.scrollTop||s.scrollTop||0):(r+=t.scrollLeft||0,o+=t.scrollTop||0);return{left:r,top:o}}function o(t){var e,i,n=t&&t.ownerDocument,r={left:0,top:0},o={left:0,top:0},s={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!n)return{left:0,top:0};for(var a in s)o[s[a]]+=parseInt(h(t,a),10)||0;return e=n.documentElement,"undefined"!=typeof t.getBoundingClientRect&&(r=t.getBoundingClientRect()),i=fabric.util.getScrollLeftTop(t,null),{left:r.left+i.left-(e.clientLeft||0)+o.left,top:r.top+i.top-(e.clientTop||0)+o.top}}var s,a=Array.prototype.slice,c=function(t){return a.call(t,0)};try{s=c(fabric.document.childNodes)instanceof Array}catch(l){}s||(c=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e});var h;h=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(t,e){return fabric.document.defaultView.getComputedStyle(t,null)[e]}:function(t,e){var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),i},function(){function t(t){return"undefined"!=typeof t.onselectstart&&(t.onselectstart=fabric.util.falseFunction),n?t.style[n]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t}function e(t){return"undefined"!=typeof t.onselectstart&&(t.onselectstart=null),n?t.style[n]="":"string"==typeof t.unselectable&&(t.unselectable=""),t}var i=fabric.document.documentElement.style,n="userSelect"in i?"userSelect":"MozUserSelect"in i?"MozUserSelect":"WebkitUserSelect"in i?"WebkitUserSelect":"KhtmlUserSelect"in i?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=t,fabric.util.makeElementSelectable=e}(),function(){function t(t,e){var i=fabric.document.getElementsByTagName("head")[0],n=fabric.document.createElement("script"),r=!0;n.onload=n.onreadystatechange=function(t){if(r){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;r=!1,e(t||fabric.window.event),n=n.onload=n.onreadystatechange=null}},n.src=t,i.appendChild(n)}fabric.util.getScript=t}(),fabric.util.getById=t,fabric.util.toArray=c,fabric.util.makeElement=e,fabric.util.addClass=i,fabric.util.wrapElement=n,fabric.util.getScrollLeftTop=r,fabric.util.getElementOffset=o,fabric.util.getElementStyle=h}(),function(){function t(t,e){return t+(/\?/.test(t)?"&":"?")+e}function e(){}function i(i,r){r||(r={});var o,s=r.method?r.method.toUpperCase():"GET",a=r.onComplete||function(){},c=n();return c.onreadystatechange=function(){4===c.readyState&&(a(c),c.onreadystatechange=e)},"GET"===s&&(o=null,"string"==typeof r.parameters&&(i=t(i,r.parameters))),c.open(s,i,!0),("POST"===s||"PUT"===s)&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(o),c}var n=function(){for(var t=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],e=t.length;e--;)try{var i=t[e]();if(i)return t[e]}catch(n){}}();fabric.util.request=i}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(t){"undefined"!=typeof console[t]&&console[t].apply&&(fabric[t]=function(){return console[t].apply(console,arguments)})}),function(){function t(t){e(function(i){t||(t={});var n,r=i||+new Date,o=t.duration||500,s=r+o,a=t.onChange||function(){},c=t.abort||function(){return!1},l=t.easing||function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},h="startValue"in t?t.startValue:0,u="endValue"in t?t.endValue:100,d=t.byValue||u-h;t.onStart&&t.onStart(),function f(i){n=i||+new Date;var u=n>s?o:n-r;return c()?void(t.onComplete&&t.onComplete()):(a(l(u,h,d,o)),n>s?void(t.onComplete&&t.onComplete()):void e(f))}(r)})}function e(){return i.apply(fabric.window,arguments)}var i=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(t){fabric.window.setTimeout(t,1e3/60)};fabric.util.animate=t,fabric.util.requestAnimFrame=e}(),function(){function t(t,e,i,n){return t<Math.abs(e)?(t=e,n=i/4):n=i/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:i,s:n}}function e(t,e,i){return t.a*Math.pow(2,10*(e-=1))*Math.sin(2*(e*i-t.s)*Math.PI/t.p)}function i(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e}function n(t,e,i,n){return t/=n/2,1>t?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e}function r(t,e,i,n){return i*(t/=n)*t*t*t+e}function o(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e}function s(t,e,i,n){return t/=n/2,1>t?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e}function a(t,e,i,n){return i*(t/=n)*t*t*t*t+e}function c(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e}function l(t,e,i,n){return t/=n/2,1>t?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e}function h(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e}function u(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e}function d(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e}function f(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e}function p(t,e,i,n){return t===n?e+i:i*(-Math.pow(2,-10*t/n)+1)+e}function g(t,e,i,n){return 0===t?e:t===n?e+i:(t/=n/2,1>t?i/2*Math.pow(2,10*(t-1))+e:i/2*(-Math.pow(2,-10*--t)+2)+e)}function m(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e}function v(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e}function b(t,e,i,n){return t/=n/2,1>t?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e}function y(i,n,r,o){var s=1.70158,a=0,c=r;if(0===i)return n;if(i/=o,1===i)return n+r;a||(a=.3*o);var l=t(c,r,a,s);return-e(l,i,o)+n}function x(e,i,n,r){var o=1.70158,s=0,a=n;if(0===e)return i;if(e/=r,1===e)return i+n;s||(s=.3*r);var c=t(a,n,s,o);return c.a*Math.pow(2,-10*e)*Math.sin(2*(e*r-c.s)*Math.PI/c.p)+c.c+i}function w(i,n,r,o){var s=1.70158,a=0,c=r;if(0===i)return n;if(i/=o/2,2===i)return n+r;a||(a=.3*o*1.5);var l=t(c,r,a,s);return 1>i?-.5*e(l,i,o)+n:l.a*Math.pow(2,-10*(i-=1))*Math.sin(2*(i*o-l.s)*Math.PI/l.p)*.5+l.c+n}function C(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e}function S(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e}function A(t,e,i,n,r){return void 0===r&&(r=1.70158),t/=n/2,1>t?i/2*t*t*(((r*=1.525)+1)*t-r)+e:i/2*((t-=2)*t*(((r*=1.525)+1)*t+r)+2)+e}function k(t,e,i,n){return i-_(n-t,0,i,n)+e}function _(t,e,i,n){return(t/=n)<1/2.75?7.5625*i*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}function T(t,e,i,n){return n/2>t?.5*k(2*t,0,i,n)+e:.5*_(2*t-n,0,i,n)+.5*i+e}fabric.util.ease={easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return t/=n/2,1>t?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:i,easeInOutCubic:n,easeInQuart:r,easeOutQuart:o,easeInOutQuart:s,easeInQuint:a,easeOutQuint:c,easeInOutQuint:l,easeInSine:h,easeOutSine:u,easeInOutSine:d,easeInExpo:f,easeOutExpo:p,easeInOutExpo:g,easeInCirc:m,easeOutCirc:v,easeInOutCirc:b,easeInElastic:y,easeOutElastic:x,easeInOutElastic:w,easeInBack:C,easeOutBack:S,easeInOutBack:A,easeInBounce:k,easeOutBounce:_,easeInOutBounce:T}}(),function(t){function e(t){return t in m?m[t]:t}function i(t,e,i){var n;"fill"!==t&&"stroke"!==t||"none"!==e?"fillRule"===t?e="evenodd"===e?"destination-over":e:"strokeDashArray"===t?e=e.replace(/,/g," ").split(/\s+/):"transformMatrix"===t&&(e=i&&i.transformMatrix?g(i.transformMatrix,h.parseTransformAttribute(e)):h.parseTransformAttribute(e)):e="",n="[object Array]"===Object.prototype.toString.call(e);var r=n?e.map(parseFloat):parseFloat(e);return!n&&isNaN(r)?e:r}function n(t){for(var e in v)if(t[e]&&"undefined"!=typeof t[v[e]]&&0!==t[e].indexOf("url(")){var i=new h.Color(t[e]);t[e]=i.setAlpha(p(i.getAlpha()*t[v[e]],2)).toRgba(),delete t[v[e]]}return t}function r(t,e){var i=t.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(i){var n=i[1],r=i[3],o=i[4],s=i[5],a=i[6];n&&(e.fontStyle=n),r&&(e.fontSize=isNaN(parseFloat(r))?r:parseFloat(r)),o&&(e.fontSize=parseFloat(o)),a&&(e.fontFamily=a),s&&(e.lineHeight="normal"===s?1:s)}}function o(t,n){var o,s;t.replace(/;$/,"").split(";").forEach(function(t){var a=t.split(":");o=e(a[0].trim().toLowerCase()),s=i(o,a[1].trim()),"font"===o?r(s,n):n[o]=s})}function s(t,n){var o,s;for(var a in t)"undefined"!=typeof t[a]&&(o=e(a.toLowerCase()),s=i(o,t[a]),"font"===o?r(s,n):n[o]=s)}function a(t){var e=t.nodeName,i=t.getAttribute("class"),n=t.getAttribute("id"),r={};for(var o in h.cssRules){var s=i&&new RegExp("^\\."+i).test(o)||n&&new RegExp("^#"+n).test(o)||new RegExp("^"+e).test(o);if(s)for(var a in h.cssRules[o])r[a]=h.cssRules[o][a]}return r}function c(t){var e=t.objects,i=t.options;return e=e.map(function(t){return h[d(t.type)].fromObject(t)}),{objects:e,options:i}}function l(t,e,i){e[i]&&e[i].toSVG&&t.push('<pattern x="0" y="0" id="',i,'Pattern" ','width="',e[i].source.width,'" height="',e[i].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',e[i].source.width,'" height="',e[i].source.height,'" xlink:href="',e[i].source.src,'"></image></pattern>')}var h=t.fabric||(t.fabric={}),u=h.util.object.extend,d=h.util.string.capitalize,f=h.util.object.clone,p=h.util.toFixed,g=h.util.multiplyTransformMatrices,m={cx:"left",x:"left",r:"radius",cy:"top",y:"top",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration"},v={stroke:"strokeOpacity",fill:"fillOpacity"};h.parseTransformAttribute=function(){function t(t,e){var i=e[0];t[0]=Math.cos(i),t[1]=Math.sin(i),t[2]=-Math.sin(i),t[3]=Math.cos(i)}function e(t,e){var i=e[0],n=2===e.length?e[1]:e[0];t[0]=i,t[3]=n}function i(t,e){t[2]=e[0]}function n(t,e){t[1]=e[0]}function r(t,e){t[4]=e[0],2===e.length&&(t[5]=e[1])}var o=[1,0,0,1,0,0],s="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",a="(?:\\s+,?\\s*|,\\s*)",c="(?:(skewX)\\s*\\(\\s*("+s+")\\s*\\))",l="(?:(skewY)\\s*\\(\\s*("+s+")\\s*\\))",u="(?:(rotate)\\s*\\(\\s*("+s+")(?:"+a+"("+s+")"+a+"("+s+"))?\\s*\\))",d="(?:(scale)\\s*\\(\\s*("+s+")(?:"+a+"("+s+"))?\\s*\\))",f="(?:(translate)\\s*\\(\\s*("+s+")(?:"+a+"("+s+"))?\\s*\\))",p="(?:(matrix)\\s*\\(\\s*("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")\\s*\\))",g="(?:"+p+"|"+f+"|"+d+"|"+u+"|"+c+"|"+l+")",m="(?:"+g+"(?:"+a+g+")*)",v="^\\s*(?:"+m+"?)\\s*$",b=new RegExp(v),y=new RegExp(g,"g");return function(s){var a=o.concat(),c=[];if(!s||s&&!b.test(s))return a;s.replace(y,function(s){var l=new RegExp(g).exec(s).filter(function(t){return""!==t&&null!=t}),h=l[1],u=l.slice(2).map(parseFloat);switch(h){case"translate":r(a,u);break;case"rotate":t(a,u);break;case"scale":e(a,u);break;case"skewX":i(a,u);break;case"skewY":n(a,u);break;case"matrix":a=u}c.push(a.concat()),a=o.concat()});for(var l=c[0];c.length>1;)c.shift(),l=h.util.multiplyTransformMatrices(l,c[0]);return l}}(),h.parseSVGDocument=function(){function t(t,e){for(;t&&(t=t.parentNode);)if(e.test(t.nodeName))return!0;return!1}var e=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,i="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",n=new RegExp("^\\s*("+i+"+)\\s*,?\\s*("+i+"+)\\s*,?\\s*("+i+"+)\\s*,?\\s*("+i+"+)\\s*$");return function(i,r,o){if(i){var s=new Date,a=h.util.toArray(i.getElementsByTagName("*"));if(0===a.length){a=i.selectNodes('//*[name(.)!="svg"]');for(var c=[],l=0,u=a.length;u>l;l++)c[l]=a[l];a=c}var d=a.filter(function(i){return e.test(i.tagName)&&!t(i,/^(?:pattern|defs)$/)});if(d&&(!d||d.length)){var p,g,m=i.getAttribute("viewBox"),v=i.getAttribute("width"),b=i.getAttribute("height"),y=null,x=null;m&&(m=m.match(n))&&(p=parseInt(m[1],10),g=parseInt(m[2],10),y=parseInt(m[3],10),x=parseInt(m[4],10)),y=v?parseFloat(v):y,x=b?parseFloat(b):x;var w={width:y,height:x};h.gradientDefs=h.getGradientDefs(i),h.cssRules=h.getCSSRules(i),h.parseElements(d,function(t){h.documentParsingTime=new Date-s,r&&r(t,w)},f(w),o)}}}}();var b={has:function(t,e){e(!1)},get:function(){},set:function(){}};u(h,{resolveGradients:function(t){for(var e=t.length;e--;){var i=t[e].get("fill");if(/^url\(/.test(i)){var n=i.slice(5,i.length-1);h.gradientDefs[n]&&t[e].set("fill",h.Gradient.fromElement(h.gradientDefs[n],t[e]))}}},getGradientDefs:function(t){var e,i,n=t.getElementsByTagName("linearGradient"),r=t.getElementsByTagName("radialGradient"),o={};for(i=n.length;i--;)e=n[i],o[e.getAttribute("id")]=e;for(i=r.length;i--;)e=r[i],o[e.getAttribute("id")]=e;return o},parseAttributes:function(t,r){if(t){var o,s={};t.parentNode&&/^g$/i.test(t.parentNode.nodeName)&&(s=h.parseAttributes(t.parentNode,r));var c=r.reduce(function(n,r){return o=t.getAttribute(r),o&&(r=e(r),o=i(r,o,s),n[r]=o),n},{});return c=u(c,u(a(t),h.parseStyleAttribute(t))),n(u(s,c))}},parseElements:function(t,e,i,n){new h.ElementsParser(t,e,i,n).parse()},parseStyleAttribute:function(t){var e={},i=t.getAttribute("style");return i?("string"==typeof i?o(i,e):s(i,e),e):e},parsePointsAttribute:function(t){if(!t)return null;t=t.trim();var e=t.indexOf(",")>-1;t=t.split(/\s+/);var i,n,r=[];if(e)for(i=0,n=t.length;n>i;i++){var o=t[i].split(",");r.push({x:parseFloat(o[0]),y:parseFloat(o[1])})}else for(i=0,n=t.length;n>i;i+=2)r.push({x:parseFloat(t[i]),y:parseFloat(t[i+1])});return r},getCSSRules:function(t){for(var e,i=t.getElementsByTagName("style"),n={},r=0,o=i.length;o>r;r++){var s=i[0].textContent;s=s.replace(/\/\*[\s\S]*?\*\//g,""),e=s.match(/[^{]*\{[\s\S]*?\}/g),e=e.map(function(t){return t.trim()}),e.forEach(function(t){var e=t.match(/([\s\S]*?)\s*\{([^}]*)\}/);t=e[1];var i=e[2].trim(),r=i.replace(/;$/,"").split(/\s*;\s*/);n[t]||(n[t]={});for(var o=0,s=r.length;s>o;o++){var a=r[o].split(/\s*:\s*/),c=a[0],l=a[1];n[t][c]=l}})}return n},loadSVGFromURL:function(t,e,i){function n(n){var r=n.responseXML;r&&!r.documentElement&&h.window.ActiveXObject&&n.responseText&&(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),r&&r.documentElement&&h.parseSVGDocument(r.documentElement,function(i,n){b.set(t,{objects:h.util.array.invoke(i,"toObject"),options:n}),e(i,n)},i)}t=t.replace(/^\n\s*/,"").trim(),b.has(t,function(i){i?b.get(t,function(t){var i=c(t);e(i.objects,i.options)}):new h.util.request(t,{method:"get",onComplete:n})})},loadSVGFromString:function(t,e,i){t=t.trim();var n;if("undefined"!=typeof DOMParser){var r=new DOMParser;r&&r.parseFromString&&(n=r.parseFromString(t,"text/xml"))}else h.window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));h.parseSVGDocument(n.documentElement,function(t,i){e(t,i)},i)},createSVGFontFacesMarkup:function(t){for(var e="",i=0,n=t.length;n>i;i++)"text"===t[i].type&&t[i].path&&(e+=["@font-face {","font-family: ",t[i].fontFamily,"; ","src: url('",t[i].path,"')","}"].join(""));return e&&(e=['<style type="text/css">',"<![CDATA[",e,"]]>","</style>"].join("")),e},createSVGRefElementsMarkup:function(t){var e=[];return l(e,t,"backgroundColor"),l(e,t,"overlayColor"),e.join("")}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(t,e,i,n){this.elements=t,this.callback=e,this.options=i,this.reviver=n},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var t=0,e=this.elements.length;e>t;t++)!function(t,e){setTimeout(function(){t.createObject(t.elements[e],e)},0)}(this,t)},fabric.ElementsParser.prototype.createObject=function(t,e){var i=fabric[fabric.util.string.capitalize(t.tagName)];if(i&&i.fromElement)try{this._createObject(i,t,e)}catch(n){fabric.log(n)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(t,e,i){if(t.async)t.fromElement(e,this.createCallback(i,e),this.options);else{var n=t.fromElement(e,this.options);this.reviver&&this.reviver(e,n),this.instances.splice(i,0,n),this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(t,e){var i=this;return function(n){i.reviver&&i.reviver(e,n),i.instances.splice(t,0,n),i.checkIfDone()}},fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(t){return null!=t}),fabric.resolveGradients(this.instances),this.callback(this.instances))},function(t){function e(t,e){this.x=t,this.y=e}var i=t.fabric||(t.fabric={});return i.Point?void i.warn("fabric.Point is already defined"):(i.Point=e,void(e.prototype={constructor:e,add:function(t){return new e(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new e(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new e(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new e(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new e(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new e(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,i){return new e(this.x+(t.x-this.x)*i,this.y+(t.y-this.y)*i)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return new e(this.x+(t.x-this.x)/2,this.y+(t.y-this.y)/2)},min:function(t){return new e(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new e(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){this.x=t,this.y=e},setFromPoint:function(t){this.x=t.x,this.y=t.y},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i}}))}("undefined"!=typeof exports?exports:this),function(t){function e(t){this.status=t,this.points=[]}var i=t.fabric||(t.fabric={});return i.Intersection?void i.warn("fabric.Intersection is already defined"):(i.Intersection=e,i.Intersection.prototype={appendPoint:function(t){this.points.push(t)},appendPoints:function(t){this.points=this.points.concat(t)}},i.Intersection.intersectLineLine=function(t,n,r,o){var s,a=(o.x-r.x)*(t.y-r.y)-(o.y-r.y)*(t.x-r.x),c=(n.x-t.x)*(t.y-r.y)-(n.y-t.y)*(t.x-r.x),l=(o.y-r.y)*(n.x-t.x)-(o.x-r.x)*(n.y-t.y);if(0!==l){var h=a/l,u=c/l;h>=0&&1>=h&&u>=0&&1>=u?(s=new e("Intersection"),s.points.push(new i.Point(t.x+h*(n.x-t.x),t.y+h*(n.y-t.y)))):s=new e}else s=new e(0===a||0===c?"Coincident":"Parallel");return s},i.Intersection.intersectLinePolygon=function(t,i,n){for(var r=new e,o=n.length,s=0;o>s;s++){var a=n[s],c=n[(s+1)%o],l=e.intersectLineLine(t,i,a,c);r.appendPoints(l.points)}return r.points.length>0&&(r.status="Intersection"),r},i.Intersection.intersectPolygonPolygon=function(t,i){for(var n=new e,r=t.length,o=0;r>o;o++){var s=t[o],a=t[(o+1)%r],c=e.intersectLinePolygon(s,a,i);n.appendPoints(c.points)}return n.points.length>0&&(n.status="Intersection"),n},void(i.Intersection.intersectPolygonRectangle=function(t,n,r){var o=n.min(r),s=n.max(r),a=new i.Point(s.x,o.y),c=new i.Point(o.x,s.y),l=e.intersectLinePolygon(o,a,t),h=e.intersectLinePolygon(a,s,t),u=e.intersectLinePolygon(s,c,t),d=e.intersectLinePolygon(c,o,t),f=new e;return f.appendPoints(l.points),f.appendPoints(h.points),f.appendPoints(u.points),f.appendPoints(d.points),f.points.length>0&&(f.status="Intersection"),f}))}("undefined"!=typeof exports?exports:this),function(t){function e(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function i(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}var n=t.fabric||(t.fabric={});return n.Color?void n.warn("fabric.Color is already defined."):(n.Color=e,n.Color.prototype={_tryParsingColor:function(t){var i;t in e.colorNameMap&&(t=e.colorNameMap[t]),i=e.sourceFromHex(t),i||(i=e.sourceFromRgb(t)),i||(i=e.sourceFromHsl(t)),i&&this.setSource(i)},_rgbToHsl:function(t,e,i){t/=255,e/=255,i/=255;var r,o,s,a=n.util.array.max([t,e,i]),c=n.util.array.min([t,e,i]);if(s=(a+c)/2,a===c)r=o=0;else{var l=a-c;switch(o=s>.5?l/(2-a-c):l/(a+c),a){case t:r=(e-i)/l+(i>e?6:0);break;case e:r=(i-t)/l+2;break;case i:r=(t-e)/l+4}r/=6}return[Math.round(360*r),Math.round(100*o),Math.round(100*s)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e,i,n=this.getSource();return t=n[0].toString(16),t=1===t.length?"0"+t:t,e=n[1].toString(16),e=1===e.length?"0"+e:e,i=n[2].toString(16),i=1===i.length?"0"+i:i,t.toUpperCase()+e.toUpperCase()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),n=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(t){t instanceof e||(t=new e(t));for(var i=[],n=this.getAlpha(),r=.5,o=this.getSource(),s=t.getSource(),a=0;3>a;a++)i.push(Math.round(o[a]*(1-r)+s[a]*r));return i[3]=n,this.setSource(i),this}},n.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,n.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,n.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,n.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},n.Color.fromRgb=function(t){return e.fromSource(e.sourceFromRgb(t))},n.Color.sourceFromRgb=function(t){var i=t.match(e.reRGBa);if(i){var n=parseInt(i[1],10)/(/%$/.test(i[1])?100:1)*(/%$/.test(i[1])?255:1),r=parseInt(i[2],10)/(/%$/.test(i[2])?100:1)*(/%$/.test(i[2])?255:1),o=parseInt(i[3],10)/(/%$/.test(i[3])?100:1)*(/%$/.test(i[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(o,10),i[4]?parseFloat(i[4]):1]}},n.Color.fromRgba=e.fromRgb,n.Color.fromHsl=function(t){return e.fromSource(e.sourceFromHsl(t))},n.Color.sourceFromHsl=function(t){var n=t.match(e.reHSLa);if(n){var r,o,s,a=(parseFloat(n[1])%360+360)%360/360,c=parseFloat(n[2])/(/%$/.test(n[2])?100:1),l=parseFloat(n[3])/(/%$/.test(n[3])?100:1);if(0===c)r=o=s=l;else{var h=.5>=l?l*(c+1):l+c-l*c,u=2*l-h;r=i(u,h,a+1/3),o=i(u,h,a),s=i(u,h,a-1/3)}return[Math.round(255*r),Math.round(255*o),Math.round(255*s),n[4]?parseFloat(n[4]):1]}},n.Color.fromHsla=e.fromHsl,n.Color.fromHex=function(t){return e.fromSource(e.sourceFromHex(t))},n.Color.sourceFromHex=function(t){if(t.match(e.reHex)){var i=t.slice(t.indexOf("#")+1),n=3===i.length,r=n?i.charAt(0)+i.charAt(0):i.substring(0,2),o=n?i.charAt(1)+i.charAt(1):i.substring(2,4),s=n?i.charAt(2)+i.charAt(2):i.substring(4,6);return[parseInt(r,16),parseInt(o,16),parseInt(s,16),1]}},void(n.Color.fromSource=function(t){var i=new e;return i.setSource(t),i}))}("undefined"!=typeof exports?exports:this),function(){function t(t){var e,i,n=t.getAttribute("style"),r=t.getAttribute("offset");if(r=parseFloat(r)/(/%$/.test(r)?100:1),n){var o=n.split(/\s*;\s*/);""===o[o.length-1]&&o.pop();for(var s=o.length;s--;){var a=o[s].split(/\s*:\s*/),c=a[0].trim(),l=a[1].trim();"stop-color"===c?e=l:"stop-opacity"===c&&(i=l)}}return e||(e=t.getAttribute("stop-color")||"rgb(0,0,0)"),i||(i=t.getAttribute("stop-opacity")),e=new fabric.Color(e).toRgb(),{offset:r,color:e,opacity:isNaN(parseFloat(i))?1:parseFloat(i)}}function e(t){return{x1:t.getAttribute("x1")||0,y1:t.getAttribute("y1")||0,x2:t.getAttribute("x2")||"100%",y2:t.getAttribute("y2")||0}}function i(t){return{x1:t.getAttribute("fx")||t.getAttribute("cx")||"50%",y1:t.getAttribute("fy")||t.getAttribute("cy")||"50%",r1:0,x2:t.getAttribute("cx")||"50%",y2:t.getAttribute("cy")||"50%",r2:t.getAttribute("r")||"50%"}}function n(t,e){for(var i in e){if("string"==typeof e[i]&&/^\d+%$/.test(e[i])){var n=parseFloat(e[i],10);"x1"===i||"x2"===i||"r2"===i?e[i]=fabric.util.toFixed(t.width*n/100,2):("y1"===i||"y2"===i)&&(e[i]=fabric.util.toFixed(t.height*n/100,2))}r(e,i,t)}}function r(t,e,i){"x1"===e||"x2"===e?t[e]-=fabric.util.toFixed(i.width/2,2):("y1"===e||"y2"===e)&&(t[e]-=fabric.util.toFixed(i.height/2,2))}function o(t,e){for(var i in e)r(e,i,t),"x1"===i||"x2"===i||"r2"===i?e[i]=fabric.util.toFixed(e[i]/t.width*100,2)+"%":("y1"===i||"y2"===i)&&(e[i]=fabric.util.toFixed(e[i]/t.height*100,2)+"%")}fabric.Gradient=fabric.util.createClass({initialize:function(t){t||(t={});var e={};this.id=fabric.Object.__uid++,this.type=t.type||"linear",e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0},"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.gradientUnits=t.gradientUnits||"objectBoundingBox",this.colorStops=t.colorStops.slice()},addColorStop:function(t){for(var e in t){var i=new fabric.Color(t[e]);this.colorStops.push({offset:e,color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(t,e){var i,n=fabric.util.object.clone(this.coords);this.colorStops.sort(function(t,e){return t.offset-e.offset}),e&&"userSpaceOnUse"===this.gradientUnits?(n.x1+=t.width/2,n.y1+=t.height/2,n.x2+=t.width/2,n.y2+=t.height/2):"objectBoundingBox"===this.gradientUnits&&o(t,n),"linear"===this.type?i=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',n.x1,'" y1="',n.y1,'" x2="',n.x2,'" y2="',n.y2,'">']:"radial"===this.type&&(i=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',n.x2,'" cy="',n.y2,'" r="',n.r2,'" fx="',n.x1,'" fy="',n.y1,'">']);for(var r=0;r<this.colorStops.length;r++)i.push("<stop ",'offset="',100*this.colorStops[r].offset+"%",'" style="stop-color:',this.colorStops[r].color,this.colorStops[r].opacity?";stop-opacity: "+this.colorStops[r].opacity:";",'"/>');return i.push("linear"===this.type?"</linearGradient>":"</radialGradient>"),i.join("")},toLive:function(t){var e;if(this.type){"linear"===this.type?e=t.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2):"radial"===this.type&&(e=t.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2));for(var i=0,n=this.colorStops.length;n>i;i++){var r=this.colorStops[i].color,o=this.colorStops[i].opacity,s=this.colorStops[i].offset;"undefined"!=typeof o&&(r=new fabric.Color(r).setAlpha(o).toRgba()),e.addColorStop(parseFloat(s),r)}return e}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(r,o){var s=r.getElementsByTagName("stop"),a="linearGradient"===r.nodeName?"linear":"radial",c=r.getAttribute("gradientUnits")||"objectBoundingBox",l=[],h={};"linear"===a?h=e(r):"radial"===a&&(h=i(r));for(var u=s.length;u--;)l.push(t(s[u]));return n(o,h),new fabric.Gradient({type:a,coords:h,gradientUnits:c,colorStops:l})},forObject:function(t,e){return e||(e={}),n(t,e),new fabric.Gradient(e)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(t){if(t||(t={}),this.id=fabric.Object.__uid++,t.source)if("string"==typeof t.source)if("undefined"!=typeof fabric.util.getFunctionBody(t.source))this.source=new Function(fabric.util.getFunctionBody(t.source));else{var e=this;this.source=fabric.util.createImage(),fabric.util.loadImage(t.source,function(t){e.source=t})}else this.source=t.source;t.repeat&&(this.repeat=t.repeat),t.offsetX&&(this.offsetX=t.offsetX),t.offsetY&&(this.offsetY=t.offsetY)},toObject:function(){var t;return"function"==typeof this.source?t=String(this.source):"string"==typeof this.source.src&&(t=this.source.src),{source:t,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(t){var e="function"==typeof this.source?this.source():this.source,i=e.width/t.getWidth(),n=e.height/t.getHeight(),r="";return e.src?r=e.src:e.toDataURL&&(r=e.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+'" y="'+this.offsetY+'" width="'+i+'" height="'+n+'"><image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+r+'"></image></pattern>'
},toLive:function(t){var e="function"==typeof this.source?this.source():this.source;if(!e)return"";if("undefined"!=typeof e.src){if(!e.complete)return"";if(0===e.naturalWidth||0===e.naturalHeight)return""}return t.createPattern(e,this.repeat)}}),function(t){var e=t.fabric||(t.fabric={});return e.Shadow?void e.warn("fabric.Shadow is already defined."):(e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(t){"string"==typeof t&&(t=this._parseShadow(t));for(var i in t)this[i]=t[i];this.id=e.Object.__uid++},_parseShadow:function(t){var i=t.trim(),n=e.Shadow.reOffsetsAndBlur.exec(i)||[],r=i.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:r.trim(),offsetX:parseInt(n[1],10)||0,offsetY:parseInt(n[2],10)||0,blur:parseInt(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(t){var e="SourceAlpha";return!t||t.fill!==this.color&&t.stroke!==this.color||(e="SourceGraphic"),'<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+e+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var t={},i=e.Shadow.prototype;return this.color!==i.color&&(t.color=this.color),this.blur!==i.blur&&(t.blur=this.blur),this.offsetX!==i.offsetX&&(t.offsetX=this.offsetX),this.offsetY!==i.offsetY&&(t.offsetY=this.offsetY),t}}),void(e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))}("undefined"!=typeof exports?exports:this),function(){if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var t=fabric.util.object.extend,e=fabric.util.getElementOffset,i=fabric.util.removeFromArray,n=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(t,e){e||(e={}),this._initStatic(t,e),fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,onBeforeScaleRotate:function(){},_initStatic:function(t,e){this._objects=[],this._createLowerCanvas(t),this._initOptions(e),e.overlayImage&&this.setOverlayImage(e.overlayImage,this.renderAll.bind(this)),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,this.renderAll.bind(this)),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,this.renderAll.bind(this)),e.overlayColor&&this.setOverlayColor(e.overlayColor,this.renderAll.bind(this)),this.calcOffset()},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},__setBgOverlayImage:function(t,e,i,n){return"string"==typeof e?fabric.util.loadImage(e,function(e){this[t]=new fabric.Image(e,n),i&&i()},this):(this[t]=e,i&&i()),this},__setBgOverlayColor:function(t,e,i){if(e.source){var n=this;fabric.util.loadImage(e.source,function(r){n[t]=new fabric.Pattern({source:r,repeat:e.repeat,offsetX:e.offsetX,offsetY:e.offsetY}),i&&i()})}else this[t]=e,i&&i();return this},_createCanvasElement:function(){var t=fabric.document.createElement("canvas");if(t.style||(t.style={}),!t)throw n;return this._initCanvasElement(t),t},_initCanvasElement:function(t){if(fabric.util.createCanvasElement(t),"undefined"==typeof t.getContext)throw n},_initOptions:function(t){for(var e in t)this[e]=t[e];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px")},_createLowerCanvas:function(t){this.lowerCanvasEl=fabric.util.getById(t)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t){return this._setDimension("width",t)},setHeight:function(t){return this._setDimension("height",t)},setDimensions:function(t){for(var e in t)this._setDimension(e,t[e]);return this},_setDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.lowerCanvasEl.style[t]=e+"px",this.upperCanvasEl&&(this.upperCanvasEl[t]=e,this.upperCanvasEl.style[t]=e+"px"),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e+"px"),this[t]=e,this.calcOffset(),this.renderAll(),this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(t,e){if(e)if(this.controlsAboveOverlay){var i=e.hasBorders,n=e.hasControls;e.hasBorders=e.hasControls=!1,e.render(t),e.hasBorders=i,e.hasControls=n}else e.render(t)},_onObjectAdded:function(t){this.stateful&&t.setupState(),t.setCoords(),t.canvas=this,this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.getActiveObject()===t&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared")),this.fire("object:removed",{target:t}),t.fire("removed")},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(t){var e=this[t===!0&&this.interactive?"contextTop":"contextContainer"],i=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),t||this.clearContext(e),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,e),this._renderBackground(e),this._renderObjects(e,i),this._renderActiveGroup(e,i),this.clipTo&&e.restore(),this._renderOverlay(e),this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.fire("after:render"),this},_renderObjects:function(t,e){var i,n;if(e)for(i=0,n=this._objects.length;n>i;++i)this._objects[i]&&!e.contains(this._objects[i])&&this._draw(t,this._objects[i]);else for(i=0,n=this._objects.length;n>i;++i)this._draw(t,this._objects[i])},_renderActiveGroup:function(t,e){if(e){var i=[];this.forEachObject(function(t){e.contains(t)&&i.push(t)}),e._set("objects",i),this._draw(t,e)}},_renderBackground:function(t){this.backgroundColor&&(t.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(t):this.backgroundColor,t.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)),this.backgroundImage&&this.backgroundImage.render(t)},_renderOverlay:function(t){this.overlayColor&&(t.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(t):this.overlayColor,t.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height)),this.overlayImage&&this.overlayImage.render(t)},renderTop:function(){var t=this.contextTop||this.contextContainer;this.clearContext(t),this.selection&&this._groupSelector&&this._drawSelection();var e=this.getActiveGroup();return e&&e.render(t),this._renderOverlay(t),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(t){return this._centerObject(t,new fabric.Point(this.getCenter().left,t.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(t){return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(t){var e=this.getCenter();return this._centerObject(t,new fabric.Point(e.left,e.top)),this.renderAll(),this},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(e,i){var n=this.getActiveGroup();n&&this.discardActiveGroup();var r={objects:this._toObjects(e,i)};return t(r,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,r,i),n&&(this.setActiveGroup(new fabric.Group(n.getObjects(),{originX:"center",originY:"center"})),n.forEachObject(function(t){t.set("active",!0)})),this._currentTransform&&(this._currentTransform.target=this.getActiveGroup()),r},_toObjects:function(t,e){return this.getObjects().map(function(i){return this._toObject(i,t,e)},this)},_toObject:function(t,e,i){var n;this.includeDefaultValues||(n=t.includeDefaultValues,t.includeDefaultValues=!1);var r=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=n),r},__serializeBgOverlay:function(){var t={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(t.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(t.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(t.overlayImage=this.overlayImage.toObject()),t},toSVG:function(t,e){t||(t={});var i=[];return this._setSVGPreamble(i,t),this._setSVGHeader(i,t),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage"),this._setSVGObjects(i,e),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage"),i.push("</svg>"),i.join("")},_setSVGPreamble:function(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(t,e){t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',e.viewBox?e.viewBox.width:this.width,'" ','height="',e.viewBox?e.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,e.viewBox?'viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(t,e){var i=this.getActiveGroup();i&&this.discardActiveGroup();for(var n=0,r=this.getObjects(),o=r.length;o>n;n++)t.push(r[n].toSVG(e));i&&(this.setActiveGroup(new fabric.Group(i.getObjects())),i.forEachObject(function(t){t.set("active",!0)}))},_setSVGBgOverlayImage:function(t,e){this[e]&&this[e].toSVG&&t.push(this[e].toSVG())},_setSVGBgOverlayColor:function(t,e){this[e]&&this[e].source?t.push('<rect x="',this[e].offsetX,'" y="',this[e].offsetY,'" ','width="',"repeat-y"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.width:this.width,'" height="',"repeat-x"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.height:this.height,'" fill="url(#'+e+'Pattern)"',"></rect>"):this[e]&&"overlayColor"===e&&t.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[e],'"',"></rect>")},sendToBack:function(t){return i(this._objects,t),this._objects.unshift(t),this.renderAll&&this.renderAll()},bringToFront:function(t){return i(this._objects,t),this._objects.push(t),this.renderAll&&this.renderAll()},sendBackwards:function(t,e){var n=this._objects.indexOf(t);if(0!==n){var r=this._findNewLowerIndex(t,n,e);i(this._objects,t),this._objects.splice(r,0,t),this.renderAll&&this.renderAll()}return this},_findNewLowerIndex:function(t,e,i){var n;if(i){n=e;for(var r=e-1;r>=0;--r){var o=t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t);if(o){n=r;break}}}else n=e-1;return n},bringForward:function(t,e){var n=this._objects.indexOf(t);if(n!==this._objects.length-1){var r=this._findNewUpperIndex(t,n,e);i(this._objects,t),this._objects.splice(r,0,t),this.renderAll&&this.renderAll()}return this},_findNewUpperIndex:function(t,e,i){var n;if(i){n=e;for(var r=e+1;r<this._objects.length;++r){var o=t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t);if(o){n=r;break}}}else n=e+1;return n},moveTo:function(t,e){return i(this._objects,t),this._objects.splice(e,0,t),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),t(fabric.StaticCanvas.prototype,fabric.Observable),t(fabric.StaticCanvas.prototype,fabric.Collection),t(fabric.StaticCanvas.prototype,fabric.DataURLExporter),t(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=fabric.util.createCanvasElement();if(!e||!e.getContext)return null;var i=e.getContext("2d");if(!i)return null;switch(t){case"getImageData":return"undefined"!=typeof i.getImageData;case"setLineDash":return"undefined"!=typeof i.setLineDash;case"toDataURL":return"undefined"!=typeof e.toDataURL;case"toDataURLWithQuality":try{return e.toDataURL("image/jpeg",0),!0}catch(n){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(t){return this.shadow=new fabric.Shadow(t),this},_setBrushStyles:function(){var t=this.canvas.contextTop;t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var t=this.canvas.contextTop;t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offsetX,t.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}}),function(){var t=fabric.util.array.min,e=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(t){this.canvas=t,this._points=[]},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){this._captureDrawingPath(t),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(t){var e=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){this._points.push(t)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(t){var e=new fabric.Point(t.x,t.y);this._addPoint(e)},_render:function(){var t=this.canvas.contextTop;t.beginPath();var e=this._points[0],i=this._points[1];2===this._points.length&&e.x===i.x&&e.y===i.y&&(e.x-=.5,i.x+=.5),t.moveTo(e.x,e.y);for(var n=1,r=this._points.length;r>n;n++){var o=e.midPointFrom(i);t.quadraticCurveTo(e.x,e.y,o.x,o.y),e=this._points[n],i=this._points[n+1]}t.lineTo(e.x,e.y),t.stroke()},_getSVGPathData:function(){return this.box=this.getPathBoundingBox(this._points),this.convertPointsToSVGPath(this._points,this.box.minx,this.box.maxx,this.box.miny,this.box.maxy)},getPathBoundingBox:function(i){for(var n=[],r=[],o=i[0],s=i[1],a=o,c=1,l=i.length;l>c;c++){var h=o.midPointFrom(s);n.push(a.x),n.push(h.x),r.push(a.y),r.push(h.y),o=i[c],s=i[c+1],a=h}return n.push(o.x),r.push(o.y),{minx:t(n),miny:t(r),maxx:e(n),maxy:e(r)}},convertPointsToSVGPath:function(t,e,i,n){var r=[],o=new fabric.Point(t[0].x-e,t[0].y-n),s=new fabric.Point(t[1].x-e,t[1].y-n);r.push("M ",t[0].x-e," ",t[0].y-n," ");for(var a=1,c=t.length;c>a;a++){var l=o.midPointFrom(s);r.push("Q ",o.x," ",o.y," ",l.x," ",l.y," "),o=new fabric.Point(t[a].x-e,t[a].y-n),a+1<t.length&&(s=new fabric.Point(t[a+1].x-e,t[a+1].y-n))}return r.push("L ",o.x," ",o.y," "),r},createPath:function(t){var e=new fabric.Path(t);return e.fill=null,e.stroke=this.color,e.strokeWidth=this.width,e.strokeLineCap=this.strokeLineCap,e.strokeLineJoin=this.strokeLineJoin,this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},_finalizeAndAddPath:function(){var t=this.canvas.contextTop;t.closePath();var e=this._getSVGPathData().join("");if("M 0 0 Q 0 0 0 0 L 0 0"===e)return void this.canvas.renderAll();var i=this.box.minx+(this.box.maxx-this.box.minx)/2,n=this.box.miny+(this.box.maxy-this.box.miny)/2;this.canvas.contextTop.arc(i,n,3,0,2*Math.PI,!1);var r=this.createPath(e);r.set({left:i,top:n,originX:"center",originY:"center"}),this.canvas.add(r),r.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:r})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop;i.fillStyle=e.fill,i.beginPath(),i.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),i.closePath(),i.fill()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},onMouseMove:function(t){this.drawDot(t)},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.points.length;n>i;i++){var r=this.points[i],o=new fabric.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&o.setShadow(this.shadow),e.push(o)}var s=new fabric.Group(e,{originX:"center",originY:"center"});this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},addPoint:function(t){var e=new fabric.Point(t.x,t.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=n,this.points.push(e),e}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render()},onMouseMove:function(t){this.addSprayChunk(t),this.render()},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.sprayChunks.length;n>i;i++)for(var r=this.sprayChunks[i],o=0,s=r.length;s>o;o++){var a=new fabric.Rect({width:r[o].width,height:r[o].width,left:r[o].x+1,top:r[o].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&a.setShadow(this.shadow),e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var c=new fabric.Group(e,{originX:"center",originY:"center"});this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},_getOptimizedRects:function(t){for(var e,i={},n=0,r=t.length;r>n;n++)e=t[n].left+""+t[n].top,i[e]||(i[e]=t[n]);var o=[];for(e in i)o.push(i[e]);return o},render:function(){var t=this.canvas.contextTop;t.fillStyle=this.color,t.save();for(var e=0,i=this.sprayChunkPoints.length;i>e;e++){var n=this.sprayChunkPoints[e];"undefined"!=typeof n.opacity&&(t.globalAlpha=n.opacity),t.fillRect(n.x,n.y,n.width,n.width)}t.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];for(var e,i,n,r=this.width/2,o=0;o<this.density;o++){e=fabric.util.getRandomInt(t.x-r,t.x+r),i=fabric.util.getRandomInt(t.y-r,t.y+r),n=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var s={x:e,y:i,width:n};this.randomOpacity&&(s.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(s)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=20,e=5,i=fabric.document.createElement("canvas"),n=i.getContext("2d");return i.width=i.height=t+e,n.fillStyle=this.color,n.beginPath(),n.arc(t/2,t/2,t/2,0,2*Math.PI,!1),n.closePath(),n.fill(),i},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(t){var e=this.callSuper("createPath",t);return e.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),e}}),function(){var t=fabric.util.getPointer,e=fabric.util.degreesToRadians,i=fabric.util.radiansToDegrees,n=Math.atan2,r=Math.abs,o=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(t,e){e||(e={}),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas(),fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_resetCurrentTransform:function(t){var e=this._currentTransform;e.target.set({scaleX:e.original.scaleX,scaleY:e.original.scaleY,left:e.original.left,top:e.original.top}),this._shouldCenterTransform(t,e.target)?"rotate"===e.action?this._setOriginToCenter(e.target):("center"!==e.originX&&(e.mouseXSign="right"===e.originX?-1:1),"center"!==e.originY&&(e.mouseYSign="bottom"===e.originY?-1:1),e.originX="center",e.originY="center"):(e.originX=e.original.originX,e.originY=e.original.originY)},containsPoint:function(t,e){var i=this.getPointer(t),n=this._normalizePointer(e,i);return e.containsPoint(n)||e._findTargetCorner(i)},_normalizePointer:function(t,e){var i=this.getActiveGroup(),n=e.x,r=e.y,o=i&&"group"!==t.type&&i.contains(t);return o&&(n-=i.left,r-=i.top),{x:n,y:r}},isTargetTransparent:function(t,e,i){var n=t.hasBorders,r=t.transparentCorners;t.hasBorders=t.transparentCorners=!1,this._draw(this.contextCache,t),t.hasBorders=n,t.transparentCorners=r;var o=fabric.util.isTransparent(this.contextCache,e,i,this.targetFindTolerance);return this.clearContext(this.contextCache),o},_shouldClearSelection:function(t,e){var i=this.getActiveGroup(),n=this.getActiveObject();return!e||e&&i&&!i.contains(e)&&i!==e&&!t.shiftKey||e&&!e.evented||e&&!e.selectable&&n&&n!==e},_shouldCenterTransform:function(t,e){if(e){var i,n=this._currentTransform;return"scale"===n.action||"scaleX"===n.action||"scaleY"===n.action?i=this.centeredScaling||e.centeredScaling:"rotate"===n.action&&(i=this.centeredRotation||e.centeredRotation),i?!t.altKey:t.altKey}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?i.x="right":("mr"===e||"tr"===e||"br"===e)&&(i.x="left"),"tl"===e||"mt"===e||"tr"===e?i.y="bottom":("bl"===e||"mb"===e||"br"===e)&&(i.y="top"),i},_getActionFromCorner:function(t,e){var i="drag";return e&&(i="ml"===e||"mr"===e?"scaleX":"mt"===e||"mb"===e?"scaleY":"mtr"===e?"rotate":"scale"),i},_setupCurrentTransform:function(t,i){if(i){var n=this.getPointer(t),r=i._findTargetCorner(n),o=this._getActionFromCorner(i,r),s=this._getOriginFromCorner(i,r);this._currentTransform={target:i,action:o,scaleX:i.scaleX,scaleY:i.scaleY,offsetX:n.x-i.left,offsetY:n.y-i.top,originX:s.x,originY:s.y,ex:n.x,ey:n.y,left:i.left,top:i.top,theta:e(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:i.left,top:i.top,scaleX:i.scaleX,scaleY:i.scaleY,originX:s.x,originY:s.y},this._resetCurrentTransform(t)}},_translateObject:function(t,e){var i=this._currentTransform.target;i.get("lockMovementX")||i.set("left",t-this._currentTransform.offsetX),i.get("lockMovementY")||i.set("top",e-this._currentTransform.offsetY)},_scaleObject:function(t,e,i){var n=this._currentTransform,r=n.target,o=r.get("lockScalingX"),s=r.get("lockScalingY");if(!o||!s){var a=r.translateToOriginPoint(r.getCenterPoint(),n.originX,n.originY),c=r.toLocalPoint(new fabric.Point(t,e),n.originX,n.originY);this._setLocalMouse(c,n),this._setObjectScale(c,n,o,s,i),r.setPositionByOrigin(a,n.originX,n.originY)}},_setObjectScale:function(t,e,i,n,r){var o=e.target;e.newScaleX=o.scaleX,e.newScaleY=o.scaleY,"equally"!==r||i||n?r?"x"!==r||o.get("lockUniScaling")?"y"!==r||o.get("lockUniScaling")||(e.newScaleY=t.y/(o.height+o.strokeWidth),n||o.set("scaleY",e.newScaleY)):(e.newScaleX=t.x/(o.width+o.strokeWidth),i||o.set("scaleX",e.newScaleX)):(e.newScaleX=t.x/(o.width+o.strokeWidth),e.newScaleY=t.y/(o.height+o.strokeWidth),i||o.set("scaleX",e.newScaleX),n||o.set("scaleY",e.newScaleY)):this._scaleObjectEqually(t,o,e),this._flipObject(e)},_scaleObjectEqually:function(t,e,i){var n=t.y+t.x,r=(e.height+e.strokeWidth)*i.original.scaleY+(e.width+e.strokeWidth)*i.original.scaleX;i.newScaleX=i.original.scaleX*n/r,i.newScaleY=i.original.scaleY*n/r,e.set("scaleX",i.newScaleX),e.set("scaleY",i.newScaleY)},_flipObject:function(t){t.newScaleX<0&&("left"===t.originX?t.originX="right":"right"===t.originX&&(t.originX="left")),t.newScaleY<0&&("top"===t.originY?t.originY="bottom":"bottom"===t.originY&&(t.originY="top"))},_setLocalMouse:function(t,e){var i=e.target;"right"===e.originX?t.x*=-1:"center"===e.originX&&(t.x*=2*e.mouseXSign,t.x<0&&(e.mouseXSign=-e.mouseXSign)),"bottom"===e.originY?t.y*=-1:"center"===e.originY&&(t.y*=2*e.mouseYSign,t.y<0&&(e.mouseYSign=-e.mouseYSign)),r(t.x)>i.padding?t.x<0?t.x+=i.padding:t.x-=i.padding:t.x=0,r(t.y)>i.padding?t.y<0?t.y+=i.padding:t.y-=i.padding:t.y=0},_rotateObject:function(t,e){var r=this._currentTransform;if(!r.target.get("lockRotation")){var o=n(r.ey-r.top,r.ex-r.left),s=n(e-r.top,t-r.left),a=i(s-o+r.theta);0>a&&(a=360+a),r.target.angle=a}},_setCursor:function(t){this.upperCanvasEl.style.cursor=t},_resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.setAngle(0)},_drawSelection:function(){var t=this.contextTop,e=this._groupSelector,i=e.left,n=e.top,s=r(i),a=r(n);if(t.fillStyle=this.selectionColor,t.fillRect(e.ex-(i>0?0:-i),e.ey-(n>0?0:-n),s,a),t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1){var c=e.ex+o-(i>0?0:s),l=e.ey+o-(n>0?0:a);t.beginPath(),fabric.util.drawDashedLine(t,c,l,c+s,l,this.selectionDashArray),fabric.util.drawDashedLine(t,c,l+a-1,c+s,l+a-1,this.selectionDashArray),fabric.util.drawDashedLine(t,c,l,c,l+a,this.selectionDashArray),fabric.util.drawDashedLine(t,c+s-1,l,c+s-1,l+a,this.selectionDashArray),t.closePath(),t.stroke()}else t.strokeRect(e.ex+o-(i>0?0:s),e.ey+o-(n>0?0:a),s,a)},_isLastRenderedObject:function(t){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(t,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(t))},findTarget:function(t,e){if(!this.skipTargetFind){if(this._isLastRenderedObject(t))return this.lastRenderedObjectWithControlsAboveOverlay;var i=this.getActiveGroup();if(i&&!e&&this.containsPoint(t,i))return i;var n=this._searchPossibleTargets(t);return this._fireOverOutEvents(n),n}},_fireOverOutEvents:function(t){t?this._hoveredTarget!==t&&(this.fire("mouse:over",{target:t}),t.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=t):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(t,e,i){if(e&&e.visible&&e.evented&&this.containsPoint(t,e)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;var n=this.isTargetTransparent(e,i.x,i.y);if(!n)return!0}},_searchPossibleTargets:function(t){var e,i=this.getPointer(t);if(this._activeObject&&this._checkTarget(t,this._activeObject,i))return this.relatedTarget=this._activeObject,this._activeObject;for(var n=this._objects.length;n--;)if(this._checkTarget(t,this._objects[n],i)){this.relatedTarget=this._objects[n],e=this._objects[n];break}return e},getPointer:function(e){var i,n=t(e,this.upperCanvasEl),r=this.upperCanvasEl.getBoundingClientRect();return i=0===r.width||0===r.height?{width:1,height:1}:{width:this.upperCanvasEl.width/r.width,height:this.upperCanvasEl.height/r.height},{x:(n.x-this._offset.left)*i.width,y:(n.y-this._offset.top)*i.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+t),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.getWidth()||t.width,i=this.getHeight()||t.height;fabric.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0}),t.width=e,t.height=i,fabric.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(t){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=t,t.set("active",!0)},setActiveObject:function(t,e){return this._setActiveObject(t),this.renderAll(),this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null
},discardActiveObject:function(t){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:t}),this},_setActiveGroup:function(t){this._activeGroup=t,t&&(t.canvas=this,t.set("active",!0))},setActiveGroup:function(t,e){return this._setActiveGroup(t),t&&(this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var t=this.getActiveGroup();t&&t.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(t){return this._discardActiveGroup(),this.fire("selection:cleared",{e:t}),this},deactivateAll:function(){for(var t=this.getObjects(),e=0,i=t.length;i>e;e++)t[e].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(t){var e=this.getActiveGroup()||this.getActiveObject();return e&&this.fire("before:selection:cleared",{target:e,e:t}),this.deactivateAll(),e&&this.fire("selection:cleared",{e:t}),this},drawControls:function(t){var e=this.getActiveGroup();e?this._drawGroupControls(t,e):this._drawObjectsControls(t)},_drawGroupControls:function(t,e){this._drawControls(t,e,"Group")},_drawObjectsControls:function(t){for(var e=0,i=this._objects.length;i>e;++e)this._objects[e]&&this._objects[e].active&&(this._drawControls(t,this._objects[e],"Object"),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[e])},_drawControls:function(t,e,i){t.save(),fabric[i].prototype.transform.call(e,t),e.drawBorders(t).drawControls(t),t.restore()}});for(var s in fabric.StaticCanvas)"prototype"!==s&&(fabric.Canvas[s]=fabric.StaticCanvas[s]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var t={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=fabric.util.addListener,i=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),e(fabric.window,"resize",this._onResize),e(this.upperCanvasEl,"mousedown",this._onMouseDown),e(this.upperCanvasEl,"mousemove",this._onMouseMove),e(this.upperCanvasEl,"mousewheel",this._onMouseWheel),e(this.upperCanvasEl,"touchstart",this._onMouseDown),e(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof Event&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.add(this.upperCanvasEl,"shake",this._onShake))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){i(fabric.window,"resize",this._onResize),i(this.upperCanvasEl,"mousedown",this._onMouseDown),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"mousewheel",this._onMouseWheel),i(this.upperCanvasEl,"touchstart",this._onMouseDown),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof Event&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake))},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t,e){this.__onMouseWheel&&this.__onMouseWheel(t,e)},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onMouseDown:function(t){this.__onMouseDown(t),e(fabric.document,"touchend",this._onMouseUp),e(fabric.document,"touchmove",this._onMouseMove),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===t.type?i(this.upperCanvasEl,"mousedown",this._onMouseDown):(e(fabric.document,"mouseup",this._onMouseUp),e(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(t){this.__onMouseUp(t),i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"touchend",this._onMouseUp),i(fabric.document,"mousemove",this._onMouseMove),i(fabric.document,"touchmove",this._onMouseMove),e(this.upperCanvasEl,"mousemove",this._onMouseMove),e(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===t.type&&setTimeout(function(){e(this.upperCanvasEl,"mousedown",this._onMouseDown)},400)},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t,e){var i=this.getActiveGroup()||this.getActiveObject();return!!(t&&(t.isMoving||t!==i)||!t&&i||!t&&!i&&!this._groupSelector||e&&this._previousPointer&&this.selection&&(e.x!==this._previousPointer.x||e.y!==this._previousPointer.y))},__onMouseUp:function(t){var e;if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);this._currentTransform?(this._finalizeCurrentTransform(),e=this._currentTransform.target):e=this.findTarget(t,!0);var i=this._shouldRender(e,this.getPointer(t));this._maybeGroupObjects(t),e&&(e.isMoving=!1),i&&this.renderAll(),this._handleCursorAndEvent(t,e)},_handleCursorAndEvent:function(t,e){this._setCursorFromEvent(t,e);var i=this;setTimeout(function(){i._setCursorFromEvent(t,e)},50),this.fire("mouse:up",{target:e,e:t}),e&&e.fire("mouseup",{e:t})},_finalizeCurrentTransform:function(){var t=this._currentTransform,e=t.target;e._scaling&&(e._scaling=!1),e.setCoords(),this.stateful&&e.hasStateChanged()&&(this.fire("object:modified",{target:e}),e.fire("modified")),this._restoreOriginXY(e)},_restoreOriginXY:function(t){if(this._previousOriginX&&this._previousOriginY){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.discardActiveObject(t).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop),this.freeDrawingBrush.onMouseDown(this.getPointer(t)),this.fire("mouse:down",{e:t})},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e)}this.upperCanvasEl.style.cursor=this.freeDrawingCursor,this.fire("mouse:move",{e:t})},_onMouseUpInDrawingMode:function(t){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this.fire("mouse:up",{e:t})},__onMouseDown:function(t){var e="which"in t?1===t.which:1===t.button;if(e||fabric.isTouchSupported){if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._currentTransform){var i=this.findTarget(t),n=this.getPointer(t);this._previousPointer=n;var r=this._shouldRender(i,n),o=this._shouldGroup(t,i);this._shouldClearSelection(t,i)?this._clearSelection(t,i,n):o&&(this._handleGrouping(t,i),i=this.getActiveGroup()),i&&i.selectable&&!o&&(this._beforeTransform(t,i),this._setupCurrentTransform(t,i)),r&&this.renderAll(),this.fire("mouse:down",{target:i,e:t}),i&&i.fire("mousedown",{e:t})}}},_beforeTransform:function(t,e){var i;this.stateful&&e.saveState(),(i=e._findTargetCorner(this.getPointer(t)))&&this.onBeforeScaleRotate(e),e!==this.getActiveGroup()&&e!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(e,t))},_clearSelection:function(t,e,i){this.deactivateAllWithDispatch(t),e&&e.selectable?this.setActiveObject(e,t):this.selection&&(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0})},_setOriginToCenter:function(t){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var e=t.getCenterPoint();t.originX="center",t.originY="center",t.left=e.x,t.top=e.y,this._currentTransform.left=t.left,this._currentTransform.top=t.top},_setCenterToOrigin:function(t){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(t){var e,i;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);var n=this._groupSelector;n?(i=this.getPointer(t),n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t),!e||e&&!e.selectable?this.upperCanvasEl.style.cursor=this.defaultCursor:this._setCursorFromEvent(t,e)),this.fire("mouse:move",{target:e,e:t}),e&&e.fire("mousemove",{e:t})},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.target.isMoving=!0,this._beforeScaleTransform(t,i),this._performTransformAction(t,i,e),this.renderAll()},_performTransformAction:function(t,e,i){var n=i.x,r=i.y,o=e.target,s=e.action;"rotate"===s?(this._rotateObject(n,r),this._fire("rotating",o,t)):"scale"===s?(this._onScale(t,e,n,r),this._fire("scaling",o,t)):"scaleX"===s?(this._scaleObject(n,r,"x"),this._fire("scaling",o,t)):"scaleY"===s?(this._scaleObject(n,r,"y"),this._fire("scaling",o,t)):(this._translateObject(n,r),this._fire("moving",o,t),this._setCursor(this.moveCursor))},_fire:function(t,e,i){this.fire("object:"+t,{target:e,e:i}),e.fire(t,{e:i})},_beforeScaleTransform:function(t,e){if("scale"===e.action||"scaleX"===e.action||"scaleY"===e.action){var i=this._shouldCenterTransform(t,e.target);(i&&("center"!==e.originX||"center"!==e.originY)||!i&&"center"===e.originX&&"center"===e.originY)&&(this._resetCurrentTransform(t),e.reset=!0)}},_onScale:function(t,e,i,n){!t.shiftKey&&!this.uniScaleTransform||e.target.get("lockUniScaling")?(e.reset||"scale"!==e.currentAction||this._resetCurrentTransform(t,e.target),e.currentAction="scaleEqually",this._scaleObject(i,n,"equally")):(e.currentAction="scale",this._scaleObject(i,n))},_setCursorFromEvent:function(t,e){var i=this.upperCanvasEl.style;if(!e||!e.selectable)return i.cursor=this.defaultCursor,!1;var n=this.getActiveGroup(),r=e._findTargetCorner&&(!n||!n.contains(e))&&e._findTargetCorner(this.getPointer(t));return r?this._setCornerCursor(r,e):i.cursor=e.hoverCursor||this.hoverCursor,!0},_setCornerCursor:function(e,i){var n=this.upperCanvasEl.style;if(e in t)n.cursor=this._getRotatedCornerCursor(e,i);else{if("mtr"!==e||!i.hasRotatingPoint)return n.cursor=this.defaultCursor,!1;n.cursor=this.rotationCursor}},_getRotatedCornerCursor:function(e,i){var n=Math.round(i.getAngle()%360/45);return 0>n&&(n+=8),n+=t[e],n%=8,this.cursorMap[n]}})}(),function(){var t=Math.min,e=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(t,e){var i=this.getActiveObject();return t.shiftKey&&(this.getActiveGroup()||i&&i!==e)&&this.selection},_handleGrouping:function(t,e){(e!==this.getActiveGroup()||(e=this.findTarget(t,!0),e&&!e.isType("group")))&&(this.getActiveGroup()?this._updateActiveGroup(e,t):this._createActiveGroup(e,t),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(t,e){var i=this.getActiveGroup();if(i.contains(t)){if(i.removeWithUpdate(t),this._resetObjectTransform(i),t.set("active",!1),1===i.size())return this.discardActiveGroup(e),void this.setActiveObject(i.item(0))}else i.addWithUpdate(t),this._resetObjectTransform(i);this.fire("selection:created",{target:i,e:e}),i.set("active",!0)},_createActiveGroup:function(t,e){if(this._activeObject&&t!==this._activeObject){var i=this._createGroup(t);this.setActiveGroup(i),this._activeObject=null,this.fire("selection:created",{target:i,e:e})}t.set("active",!0)},_createGroup:function(t){var e=this.getObjects(),i=e.indexOf(this._activeObject)<e.indexOf(t),n=i?[this._activeObject,t]:[t,this._activeObject];return new fabric.Group(n,{originX:"center",originY:"center"})},_groupSelectedObjects:function(t){var e=this._collectObjects();1===e.length?this.setActiveObject(e[0],t):e.length>1&&(e=new fabric.Group(e.reverse(),{originX:"center",originY:"center"}),this.setActiveGroup(e,t),e.saveCoords(),this.fire("selection:created",{target:e}),this.renderAll())},_collectObjects:function(){for(var i,n=[],r=this._groupSelector.ex,o=this._groupSelector.ey,s=r+this._groupSelector.left,a=o+this._groupSelector.top,c=new fabric.Point(t(r,s),t(o,a)),l=new fabric.Point(e(r,s),e(o,a)),h=r===s&&o===a,u=this._objects.length;u--&&(i=this._objects[u],!(i&&i.selectable&&i.visible&&(i.intersectsWithRect(c,l)||i.isContainedWithinRect(c,l)||i.containsPoint(c)||i.containsPoint(l))&&(i.set("active",!0),n.push(i),h))););return n},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t);var e=this.getActiveGroup();e&&(e.setObjectsCoords().setCoords(),e.isMoving=!1,this._setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",i=t.quality||1,n=t.multiplier||1,r={left:t.left,top:t.top,width:t.width,height:t.height};return 1!==n?this.__toDataURLWithMultiplier(e,i,r,n):this.__toDataURL(e,i,r)},__toDataURL:function(t,e,i){this.renderAll(!0);var n=this.upperCanvasEl||this.lowerCanvasEl,r=this.__getCroppedCanvas(n,i);"jpg"===t&&(t="jpeg");var o=fabric.StaticCanvas.supports("toDataURLWithQuality")?(r||n).toDataURL("image/"+t,e):(r||n).toDataURL("image/"+t);return this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),r&&(r=null),o},__getCroppedCanvas:function(t,e){var i,n,r="left"in e||"top"in e||"width"in e||"height"in e;return r&&(i=fabric.util.createCanvasElement(),n=i.getContext("2d"),i.width=e.width||this.width,i.height=e.height||this.height,n.drawImage(t,-e.left||0,-e.top||0)),i},__toDataURLWithMultiplier:function(t,e,i,n){var r=this.getWidth(),o=this.getHeight(),s=r*n,a=o*n,c=this.getActiveObject(),l=this.getActiveGroup(),h=this.contextTop||this.contextContainer;n>1&&this.setWidth(s).setHeight(a),h.scale(n,n),i.left&&(i.left*=n),i.top&&(i.top*=n),i.width?i.width*=n:1>n&&(i.width=s),i.height?i.height*=n:1>n&&(i.height=a),l?this._tempRemoveBordersControlsFromGroup(l):c&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0);var u=this.__toDataURL(t,e,i);return this.width=r,this.height=o,h.scale(1/n,1/n),this.setWidth(r).setHeight(o),l?this._restoreBordersControlsOnGroup(l):c&&this.setActiveObject&&this.setActiveObject(c),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),u},toDataURLWithMultiplier:function(t,e,i){return this.toDataURL({format:t,multiplier:e,quality:i})},_tempRemoveBordersControlsFromGroup:function(t){t.origHasControls=t.hasControls,t.origBorderColor=t.borderColor,t.hasControls=!0,t.borderColor="rgba(0,0,0,0)",t.forEachObject(function(t){t.origBorderColor=t.borderColor,t.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(t){t.hideControls=t.origHideControls,t.borderColor=t.origBorderColor,t.forEachObject(function(t){t.borderColor=t.origBorderColor,delete t.origBorderColor})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e,i){return this.loadFromJSON(t,e,i)},loadFromJSON:function(t,e,i){if(t){var n="string"==typeof t?JSON.parse(t):t;this.clear();var r=this;return this._enlivenObjects(n.objects,function(){r._setBgOverlay(n,e)},i),this}},_setBgOverlay:function(t,e){var i=this,n={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(t.backgroundImage||t.overlayImage||t.background||t.overlay))return void(e&&e());var r=function(){n.backgroundImage&&n.overlayImage&&n.backgroundColor&&n.overlayColor&&(i.renderAll(),e&&e())};this.__setBgOverlay("backgroundImage",t.backgroundImage,n,r),this.__setBgOverlay("overlayImage",t.overlayImage,n,r),this.__setBgOverlay("backgroundColor",t.background,n,r),this.__setBgOverlay("overlayColor",t.overlay,n,r),r()},__setBgOverlay:function(t,e,i,n){var r=this;return e?void("backgroundImage"===t||"overlayImage"===t?fabric.Image.fromObject(e,function(e){r[t]=e,i[t]=!0,n&&n()}):this["set"+fabric.util.string.capitalize(t,!0)](e,function(){i[t]=!0,n&&n()})):void(i[t]=!0)},_enlivenObjects:function(t,e,i){var n=this;if(0===t.length)return void(e&&e());var r=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(t,function(t){t.forEach(function(t,e){n.insertAt(t,e,!0)}),n.renderOnAddRemove=r,e&&e()},null,i)},_toDataURL:function(t,e){this.clone(function(i){e(i.toDataURL(t))})},_toDataURLWithMultiplier:function(t,e,i){this.clone(function(n){i(n.toDataURLWithMultiplier(t,e))})},clone:function(t,e){var i=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(e){e.loadFromJSON(i,function(){t&&t(e)})})},cloneWithoutData:function(t){var e=fabric.document.createElement("canvas");e.width=this.getWidth(),e.height=this.getHeight();var i=new fabric.Canvas(e);i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.toFixed,r=e.util.string.capitalize,o=e.util.degreesToRadians,s=e.StaticCanvas.supports("setLineDash");e.Object||(e.Object=e.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule shadow clipTo visible backgroundColor".split(" "),initialize:function(t){t&&this.setOptions(t)},_initGradient:function(t){!t.fill||!t.fill.colorStops||t.fill instanceof e.Gradient||this.set("fill",new e.Gradient(t.fill))},_initPattern:function(t){!t.fill||!t.fill.source||t.fill instanceof e.Pattern||this.set("fill",new e.Pattern(t.fill)),!t.stroke||!t.stroke.source||t.stroke instanceof e.Pattern||this.set("stroke",new e.Pattern(t.stroke))},_initClipping:function(t){if(t.clipTo&&"string"==typeof t.clipTo){var i=e.util.getFunctionBody(t.clipTo);"undefined"!=typeof i&&(this.clipTo=new Function("ctx",i))}},setOptions:function(t){for(var e in t)this.set(e,t[e]);this._initGradient(t),this._initPattern(t),this._initClipping(t)},transform:function(t,e){t.globalAlpha=this.opacity;var i=e?this._getLeftTopCoords():this.getCenterPoint();t.translate(i.x,i.y),t.rotate(o(this.angle)),t.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(t){var i=e.Object.NUM_FRACTION_DIGITS,r={type:this.type,originX:this.originX,originY:this.originY,left:n(this.left,i),top:n(this.top,i),width:n(this.width,i),height:n(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:n(this.strokeWidth,i),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:n(this.strokeMiterLimit,i),scaleX:n(this.scaleX,i),scaleY:n(this.scaleY,i),angle:n(this.getAngle(),i),flipX:this.flipX,flipY:this.flipY,opacity:n(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor};return this.includeDefaultValues||(r=this._removeDefaultValues(r)),e.util.populateWithProperties(this,r,t),r},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(t){var i=e.util.getKlass(t.type).prototype,n=i.stateProperties;return n.forEach(function(e){t[e]===i[e]&&delete t[e]}),t},toString:function(){return"#<fabric."+r(this.type)+">"},get:function(t){return this[t]},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,i){var r="scaleX"===t||"scaleY"===t;return r&&(i=this._constrainScale(i)),"scaleX"===t&&0>i?(this.flipX=!this.flipX,i*=-1):"scaleY"===t&&0>i?(this.flipY=!this.flipY,i*=-1):"width"===t||"height"===t?this.minScaleLimit=n(Math.min(.1,1/Math.max(this.width,this.height)),2):"shadow"!==t||!i||i instanceof e.Shadow||(i=new e.Shadow(i)),this[t]=i,this},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},setSourcePath:function(t){return this.sourcePath=t,this},render:function(t,i){if(0!==this.width&&0!==this.height&&this.visible){t.save(),this._setupFillRule(t),this._transform(t,i),this._setStrokeStyles(t),this._setFillStyles(t);var n=this.transformMatrix;n&&this.group&&(t.translate(-this.group.width/2,-this.group.height/2),t.transform(n[0],n[1],n[2],n[3],n[4],n[5])),this._setShadow(t),this.clipTo&&e.util.clipContext(this,t),this._render(t,i),this.clipTo&&t.restore(),this._removeShadow(t),this._restoreFillRule(t),this.active&&!i&&(this.drawBorders(t),this.drawControls(t)),t.restore()}},_transform:function(t,e){var i=this.transformMatrix;i&&!this.group&&t.setTransform(i[0],i[1],i[2],i[3],i[4],i[5]),e||this.transform(t)},_setStrokeStyles:function(t){this.stroke&&(t.lineWidth=this.strokeWidth,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,t.strokeStyle=this.stroke.toLive?this.stroke.toLive(t):this.stroke)},_setFillStyles:function(t){this.fill&&(t.fillStyle=this.fill.toLive?this.fill.toLive(t):this.fill)},_setShadow:function(t){this.shadow&&(t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offsetX,t.shadowOffsetY=this.shadow.offsetY)},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_renderFill:function(t){this.fill&&(this.fill.toLive&&(t.save(),t.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)),t.fill(),this.fill.toLive&&t.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t))},_renderStroke:function(t){this.stroke&&(t.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),s?(t.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(t)):this._renderDashedStroke&&this._renderDashedStroke(t),t.stroke()):this._stroke?this._stroke(t):t.stroke(),this._removeShadow(t),t.restore())},clone:function(t,i){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(i),t):new e.Object(this.toObject(i))},cloneAsImage:function(t){var i=this.toDataURL();return e.util.loadImage(i,function(i){t&&t(new e.Image(i))}),this},toDataURL:function(t){t||(t={});var i=e.util.createCanvasElement(),n=this.getBoundingRect();i.width=n.width,i.height=n.height,e.util.wrapElement(i,"div");var r=new e.Canvas(i);"jpg"===t.format&&(t.format="jpeg"),"jpeg"===t.format&&(r.backgroundColor="#fff");var o={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new e.Point(i.width/2,i.height/2),"center","center");var s=this.canvas;r.add(this);var a=r.toDataURL(t);return this.set(o).setCoords(),this.canvas=s,r.dispose(),r=null,a},isType:function(t){return this.type===t},complexity:function(){return 0},toJSON:function(t){return this.toObject(t)},setGradient:function(t,i){i||(i={});var n={colorStops:[]};n.type=i.type||(i.r1||i.r2?"radial":"linear"),n.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},(i.r1||i.r2)&&(n.coords.r1=i.r1,n.coords.r2=i.r2);for(var r in i.colorStops){var o=new e.Color(i.colorStops[r]);n.colorStops.push({offset:r,color:o.toRgb(),opacity:o.getAlpha()})}return this.set(t,e.Gradient.forObject(this,n))},setPatternFill:function(t){return this.set("fill",new e.Pattern(t))},setShadow:function(t){return this.set("shadow",new e.Shadow(t))},setColor:function(t){return this.set("fill",t),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(t,e){e=e||this.canvas.getPointer(t);var i=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:e.x-i.x,y:e.y-i.y}},_setupFillRule:function(t){this.fillRule&&(this._prevFillRule=t.globalCompositeOperation,t.globalCompositeOperation=this.fillRule)},_restoreFillRule:function(t){this.fillRule&&this._prevFillRule&&(t.globalCompositeOperation=this._prevFillRule)}}),e.util.createAccessors(e.Object),e.Object.prototype.rotate=e.Object.prototype.setAngle,i(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object.__uid=0)}("undefined"!=typeof exports?exports:this),function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(e,i,n){var r=e.x,o=e.y,s=this.stroke?this.strokeWidth:0;return"left"===i?r=e.x+(this.getWidth()+s*this.scaleX)/2:"right"===i&&(r=e.x-(this.getWidth()+s*this.scaleX)/2),"top"===n?o=e.y+(this.getHeight()+s*this.scaleY)/2:"bottom"===n&&(o=e.y-(this.getHeight()+s*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(r,o),e,t(this.angle))},translateToOriginPoint:function(e,i,n){var r=e.x,o=e.y,s=this.stroke?this.strokeWidth:0;return"left"===i?r=e.x-(this.getWidth()+s*this.scaleX)/2:"right"===i&&(r=e.x+(this.getWidth()+s*this.scaleX)/2),"top"===n?o=e.y-(this.getHeight()+s*this.scaleY)/2:"bottom"===n&&(o=e.y+(this.getHeight()+s*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(r,o),e,t(this.angle))},getCenterPoint:function(){var t=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(e,i,n){var r,o,s=this.getCenterPoint(),a=this.stroke?this.strokeWidth:0;return i&&n?(r="left"===i?s.x-(this.getWidth()+a*this.scaleX)/2:"right"===i?s.x+(this.getWidth()+a*this.scaleX)/2:s.x,o="top"===n?s.y-(this.getHeight()+a*this.scaleY)/2:"bottom"===n?s.y+(this.getHeight()+a*this.scaleY)/2:s.y):(r=this.left,o=this.top),fabric.util.rotatePoint(new fabric.Point(e.x,e.y),s,-t(this.angle)).subtractEquals(new fabric.Point(r,o))},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(e){var i=t(this.angle),n=this.getWidth()/2,r=Math.cos(i)*n,o=Math.sin(i)*n,s=this.getWidth(),a=Math.cos(i)*s,c=Math.sin(i)*s;"center"===this.originX&&"left"===e||"right"===this.originX&&"center"===e?(this.left-=r,this.top-=o):"left"===this.originX&&"center"===e||"center"===this.originX&&"right"===e?(this.left+=r,this.top+=o):"left"===this.originX&&"right"===e?(this.left+=a,this.top+=c):"right"===this.originX&&"left"===e&&(this.left-=a,this.top-=c),this.setCoords(),this.originX=e},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(t,e){var i=this.oCoords,n=new fabric.Point(i.tl.x,i.tl.y),r=new fabric.Point(i.tr.x,i.tr.y),o=new fabric.Point(i.bl.x,i.bl.y),s=new fabric.Point(i.br.x,i.br.y),a=fabric.Intersection.intersectPolygonRectangle([n,r,s,o],t,e);return"Intersection"===a.status},intersectsWithObject:function(t){function e(t){return{tl:new fabric.Point(t.tl.x,t.tl.y),tr:new fabric.Point(t.tr.x,t.tr.y),bl:new fabric.Point(t.bl.x,t.bl.y),br:new fabric.Point(t.br.x,t.br.y)}}var i=e(this.oCoords),n=e(t.oCoords),r=fabric.Intersection.intersectPolygonPolygon([i.tl,i.tr,i.br,i.bl],[n.tl,n.tr,n.br,n.bl]);return"Intersection"===r.status},isContainedWithinObject:function(t){var e=t.getBoundingRect(),i=new fabric.Point(e.left,e.top),n=new fabric.Point(e.left+e.width,e.top+e.height);return this.isContainedWithinRect(i,n)},isContainedWithinRect:function(t,e){var i=this.getBoundingRect();return i.left>=t.x&&i.left+i.width<=e.x&&i.top>=t.y&&i.top+i.height<=e.y},containsPoint:function(t){var e=this._getImageLines(this.oCoords),i=this._findCrossPoints(t,e);return 0!==i&&i%2===1},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,r,o,s,a,c,l=0;for(var h in e)if(c=e[h],!(c.o.y<t.y&&c.d.y<t.y||c.o.y>=t.y&&c.d.y>=t.y||(c.o.x===c.d.x&&c.o.x>=t.x?(s=c.o.x,a=t.y):(i=0,n=(c.d.y-c.o.y)/(c.d.x-c.o.x),r=t.y-i*t.x,o=c.o.y-n*c.o.x,s=-(r-o)/(i-n),a=r+i*s),s>=t.x&&(l+=1),2!==l)))break;return l},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var t=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],e=fabric.util.array.min(t),i=fabric.util.array.max(t),n=Math.abs(e-i),r=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],o=fabric.util.array.min(r),s=fabric.util.array.max(r),a=Math.abs(o-s);return{left:e,top:o,width:n,height:a}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?0>t?-this.minScaleLimit:this.minScaleLimit:t},scale:function(t){return t=this._constrainScale(t),0>t&&(this.flipX=!this.flipX,this.flipY=!this.flipY,t*=-1),this.scaleX=t,this.scaleY=t,this.setCoords(),this},scaleToWidth:function(t){var e=this.getBoundingRectWidth()/this.getWidth();return this.scale(t/this.width/e)},scaleToHeight:function(t){var e=this.getBoundingRectHeight()/this.getHeight();return this.scale(t/this.height/e)},setCoords:function(){var e=this.strokeWidth>1?this.strokeWidth:0,i=this.padding,n=t(this.angle);this.currentWidth=(this.width+e)*this.scaleX+2*i,this.currentHeight=(this.height+e)*this.scaleY+2*i,this.currentWidth<0&&(this.currentWidth=Math.abs(this.currentWidth));var r=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),o=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),s=Math.cos(o+n)*r,a=Math.sin(o+n)*r,c=Math.sin(n),l=Math.cos(n),h=this.getCenterPoint(),u={x:h.x-s,y:h.y-a},d={x:u.x+this.currentWidth*l,y:u.y+this.currentWidth*c},f={x:d.x-this.currentHeight*c,y:d.y+this.currentHeight*l},p={x:u.x-this.currentHeight*c,y:u.y+this.currentHeight*l},g={x:u.x-this.currentHeight/2*c,y:u.y+this.currentHeight/2*l},m={x:u.x+this.currentWidth/2*l,y:u.y+this.currentWidth/2*c},v={x:d.x-this.currentHeight/2*c,y:d.y+this.currentHeight/2*l},b={x:p.x+this.currentWidth/2*l,y:p.y+this.currentWidth/2*c},y={x:m.x,y:m.y};
return this.oCoords={tl:u,tr:d,br:f,bl:p,ml:g,mt:m,mr:v,mb:b,mtr:y},this._setCornerCoords&&this._setCornerCoords(),this}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas.moveTo(this,t),this}}),fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var t=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",e=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",i=this.strokeWidth?this.strokeWidth:"0",n=this.strokeDashArray?this.strokeDashArray.join(" "):"",r=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",s=this.strokeMiterLimit?this.strokeMiterLimit:"4",a="undefined"!=typeof this.opacity?this.opacity:"1",c=this.visible?"":" visibility: hidden;",l=this.shadow&&"text"!==this.type?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",e,"; ","stroke-width: ",i,"; ","stroke-dasharray: ",n,"; ","stroke-linecap: ",r,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",s,"; ","fill: ",t,"; ","opacity: ",a,";",l,c].join("")},getSvgTransform:function(){var t=fabric.util.toFixed,e=this.getAngle(),i=this.getCenterPoint(),n=fabric.Object.NUM_FRACTION_DIGITS,r="translate("+t(i.x,n)+" "+t(i.y,n)+")",o=0!==e?" rotate("+t(e,n)+")":"",s=1===this.scaleX&&1===this.scaleY?"":" scale("+t(this.scaleX,n)+" "+t(this.scaleY,n)+")",a=this.flipX?"matrix(-1 0 0 1 0 0) ":"",c=this.flipY?"matrix(1 0 0 -1 0 0)":"";return[r,o,s,a,c].join("")},_createBaseSVGMarkup:function(){var t=[];return this.fill&&this.fill.toLive&&t.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&t.push(this.stroke.toSVG(this,!1)),this.shadow&&t.push(this.shadow.toSVG(this)),t}}),fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(t){return this.get(t)!==this.originalState[t]},this)},saveState:function(t){return this.stateProperties.forEach(function(t){this.originalState[t]=this.get(t)},this),t&&t.stateProperties&&t.stateProperties.forEach(function(t){this.originalState[t]=this.get(t)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var t=fabric.util.degreesToRadians,e="undefined"!=typeof G_vmlCanvasManager;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||!this.active)return!1;var e,i,n=t.x,r=t.y;for(var o in this.oCoords)if(this.isControlVisible(o)&&("mtr"!==o||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==o&&"mr"!==o&&"mb"!==o&&"ml"!==o)&&(i=this._getImageLines(this.oCoords[o].corner),e=this._findCrossPoints({x:n,y:r},i),0!==e&&e%2===1))return this.__corner=o,o;return!1},_setCornerCoords:function(){var e=this.oCoords,i=t(this.angle),n=t(45-this.angle),r=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,o=r*Math.cos(n),s=r*Math.sin(n),a=Math.sin(i),c=Math.cos(i);e.tl.corner={tl:{x:e.tl.x-s,y:e.tl.y-o},tr:{x:e.tl.x+o,y:e.tl.y-s},bl:{x:e.tl.x-o,y:e.tl.y+s},br:{x:e.tl.x+s,y:e.tl.y+o}},e.tr.corner={tl:{x:e.tr.x-s,y:e.tr.y-o},tr:{x:e.tr.x+o,y:e.tr.y-s},br:{x:e.tr.x+s,y:e.tr.y+o},bl:{x:e.tr.x-o,y:e.tr.y+s}},e.bl.corner={tl:{x:e.bl.x-s,y:e.bl.y-o},bl:{x:e.bl.x-o,y:e.bl.y+s},br:{x:e.bl.x+s,y:e.bl.y+o},tr:{x:e.bl.x+o,y:e.bl.y-s}},e.br.corner={tr:{x:e.br.x+o,y:e.br.y-s},bl:{x:e.br.x-o,y:e.br.y+s},br:{x:e.br.x+s,y:e.br.y+o},tl:{x:e.br.x-s,y:e.br.y-o}},e.ml.corner={tl:{x:e.ml.x-s,y:e.ml.y-o},tr:{x:e.ml.x+o,y:e.ml.y-s},bl:{x:e.ml.x-o,y:e.ml.y+s},br:{x:e.ml.x+s,y:e.ml.y+o}},e.mt.corner={tl:{x:e.mt.x-s,y:e.mt.y-o},tr:{x:e.mt.x+o,y:e.mt.y-s},bl:{x:e.mt.x-o,y:e.mt.y+s},br:{x:e.mt.x+s,y:e.mt.y+o}},e.mr.corner={tl:{x:e.mr.x-s,y:e.mr.y-o},tr:{x:e.mr.x+o,y:e.mr.y-s},bl:{x:e.mr.x-o,y:e.mr.y+s},br:{x:e.mr.x+s,y:e.mr.y+o}},e.mb.corner={tl:{x:e.mb.x-s,y:e.mb.y-o},tr:{x:e.mb.x+o,y:e.mb.y-s},bl:{x:e.mb.x-o,y:e.mb.y+s},br:{x:e.mb.x+s,y:e.mb.y+o}},e.mtr.corner={tl:{x:e.mtr.x-s+a*this.rotatingPointOffset,y:e.mtr.y-o-c*this.rotatingPointOffset},tr:{x:e.mtr.x+o+a*this.rotatingPointOffset,y:e.mtr.y-s-c*this.rotatingPointOffset},bl:{x:e.mtr.x-o+a*this.rotatingPointOffset,y:e.mtr.y+s-c*this.rotatingPointOffset},br:{x:e.mtr.x+s+a*this.rotatingPointOffset,y:e.mtr.y+o-c*this.rotatingPointOffset}}},drawBorders:function(t){if(!this.hasBorders)return this;var e=this.padding,i=2*e,n=2*~~(this.strokeWidth/2);t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=this.borderColor;var r=1/this._constrainScale(this.scaleX),o=1/this._constrainScale(this.scaleY);t.lineWidth=1/this.borderScaleFactor,t.scale(r,o);var s=this.getWidth(),a=this.getHeight();if(t.strokeRect(~~(-(s/2)-e-n/2*this.scaleX)-.5,~~(-(a/2)-e-n/2*this.scaleY)-.5,~~(s+i+n*this.scaleX)+1,~~(a+i+n*this.scaleY)+1),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var c=(this.flipY?a+n*this.scaleY+2*e:-a-n*this.scaleY-2*e)/2;t.beginPath(),t.moveTo(0,c),t.lineTo(0,c+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),t.closePath(),t.stroke()}return t.restore(),this},drawControls:function(t){if(!this.hasControls)return this;var e=this.cornerSize,i=e/2,n=~~(this.strokeWidth/2),r=-(this.width/2),o=-(this.height/2),s=this.padding/this.scaleX,a=this.padding/this.scaleY,c=i/this.scaleY,l=i/this.scaleX,h=(i-e)/this.scaleX,u=(i-e)/this.scaleY,d=this.height,f=this.width,p=this.transparentCorners?"strokeRect":"fillRect";return t.save(),t.lineWidth=1/Math.max(this.scaleX,this.scaleY),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=t.fillStyle=this.cornerColor,this._drawControl("tl",t,p,r-l-n-s,o-c-n-a),this._drawControl("tr",t,p,r+f-l+n+s,o-c-n-a),this._drawControl("bl",t,p,r-l-n-s,o+d+u+n+a),this._drawControl("br",t,p,r+f+h+n+s,o+d+u+n+a),this.get("lockUniScaling")||(this._drawControl("mt",t,p,r+f/2-l,o-c-n-a),this._drawControl("mb",t,p,r+f/2-l,o+d+u+n+a),this._drawControl("mb",t,p,r+f+h+n+s,o+d/2-c),this._drawControl("ml",t,p,r-l-n-s,o+d/2-c)),this.hasRotatingPoint&&this._drawControl("mtr",t,p,r+f/2-l,this.flipY?o+d+this.rotatingPointOffset/this.scaleY-this.cornerSize/this.scaleX/2+n+a:o-this.rotatingPointOffset/this.scaleY-this.cornerSize/this.scaleY/2-n-a),t.restore(),this},_drawControl:function(t,i,n,r,o){var s=this.cornerSize/this.scaleX,a=this.cornerSize/this.scaleY;this.isControlVisible(t)&&(e||this.transparentCorners||i.clearRect(r,o,s,a),i[n](r,o,s,a))},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){t||(t={});for(var e in t)this.setControlVisible(e,t[e]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,e){e=e||{};var i=function(){},n=e.onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(e){t.set("left",e),o.renderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxCenterObjectV:function(t,e){e=e||{};var i=function(){},n=e.onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(e){t.set("top",e),o.renderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxRemove:function(t,e){e=e||{};var i=function(){},n=e.onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){t.set("active",!1)},onChange:function(e){t.set("opacity",e),o.renderAll(),r()},onComplete:function(){o.remove(t),n()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,i=[];for(t in arguments[0])i.push(t);for(var n=0,r=i.length;r>n;n++)t=i[n],e=n!==r-1,this._animate(t,arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(t,e,i,n){var r,o=this;e=e.toString(),i=i?fabric.util.object.clone(i):{},~t.indexOf(".")&&(r=t.split("."));var s=r?this.get(r[0])[r[1]]:this.get(t);"from"in i||(i.from=s),e=~e.indexOf("=")?s+parseFloat(e.replace("=","")):parseFloat(e),fabric.util.animate({startValue:i.from,endValue:e,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(o)},onChange:function(e){r?o[r[0]][r[1]]=e:o.set(t,e),n||i.onChange&&i.onChange()},onComplete:function(){n||(o.setCoords(),i.onComplete&&i.onComplete())}})}}),function(t){function e(t,e){var i=t.origin,n=t.axis1,r=t.axis2,o=t.dimension,s=e.nearest,a=e.center,c=e.farthest;return function(){switch(this.get(i)){case s:return Math.min(this.get(n),this.get(r));case a:return Math.min(this.get(n),this.get(r))+.5*this.get(o);case c:return Math.max(this.get(n),this.get(r))}}}var i=t.fabric||(t.fabric={}),n=i.util.object.extend,r={x1:1,x2:1,y1:1,y2:1},o=i.StaticCanvas.supports("setLineDash");return i.Line?void i.warn("fabric.Line is already defined"):(i.Line=i.util.createClass(i.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(t,e){e=e||{},t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.width=Math.abs(this.x2-this.x1)||1,this.height=Math.abs(this.y2-this.y1)||1,this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this[t]=e,"undefined"!=typeof r[t]&&this._setWidthHeight(),this},_getLeftToOriginX:e({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:e({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t){t.beginPath();var e=this.group&&"path-group"===this.group.type;if(e&&!this.transformMatrix){var i=this.getCenterPoint();t.translate(-this.group.width/2+i.x,-this.group.height/2+i.y)}if(!this.strokeDashArray||this.strokeDashArray&&o){var n=this.x1<=this.x2?-1:1,r=this.y1<=this.y2?-1:1;t.moveTo(1===this.width?0:n*this.width/2,1===this.height?0:r*this.height/2),t.lineTo(1===this.width?0:-1*n*this.width/2,1===this.height?0:-1*r*this.height/2)}t.lineWidth=this.strokeWidth;var s=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=s},_renderDashedStroke:function(t){var e=this.x1<=this.x2?-1:1,n=this.y1<=this.y2?-1:1,r=1===this.width?0:e*this.width/2,o=1===this.height?0:n*this.height/2;t.beginPath(),i.util.drawDashedLine(t,r,o,-r,-o,this.strokeDashArray),t.closePath()},toObject:function(t){return n(this.callSuper("toObject",t),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(t){var e=this._createBaseSVGMarkup();return e.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),i.Line.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),i.Line.fromElement=function(t,e){var r=i.parseAttributes(t,i.Line.ATTRIBUTE_NAMES),o=[r.x1||0,r.y1||0,r.x2||0,r.y2||0];return new i.Line(o,n(r,e))},void(i.Line.fromObject=function(t){var e=[t.x1,t.y1,t.x2,t.y2];return new i.Line(e,t)}))}("undefined"!=typeof exports?exports:this),function(t){function e(t){return"radius"in t&&t.radius>0}var i=t.fabric||(t.fabric={}),n=2*Math.PI,r=i.util.object.extend;return i.Circle?void i.warn("fabric.Circle is already defined."):(i.Circle=i.util.createClass(i.Object,{type:"circle",radius:0,initialize:function(t){t=t||{},this.set("radius",t.radius||0),this.callSuper("initialize",t)},_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return r(this.callSuper("toObject",t),{radius:this.get("radius")})},toSVG:function(t){var e=this._createBaseSVGMarkup();return e.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.globalAlpha=this.group?t.globalAlpha*this.opacity:this.opacity,t.arc(e?this.left:0,e?this.top:0,this.radius,0,n,!1),t.closePath(),this._renderFill(t),this.stroke&&this._renderStroke(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){this.radius=t,this.set("width",2*t).set("height",2*t)},complexity:function(){return 1}}),i.Circle.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),i.Circle.fromElement=function(t,n){n||(n={});var o=i.parseAttributes(t,i.Circle.ATTRIBUTE_NAMES);if(!e(o))throw new Error("value of `r` attribute is required and can not be negative");"left"in o&&(o.left-=n.width/2||0),"top"in o&&(o.top-=n.height/2||0);var s=new i.Circle(r(o,n));return s.cx=parseFloat(t.getAttribute("cx"))||0,s.cy=parseFloat(t.getAttribute("cy"))||0,s},void(i.Circle.fromObject=function(t){return new i.Circle(t)}))}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={});return e.Triangle?void e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("width",t.width||100).set("height",t.height||100)},_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderFill(t),this._renderStroke(t)},_renderDashedStroke:function(t){var i=this.width/2,n=this.height/2;t.beginPath(),e.util.drawDashedLine(t,-i,n,0,-n,this.strokeDashArray),e.util.drawDashedLine(t,0,-n,i,n,this.strokeDashArray),e.util.drawDashedLine(t,i,n,-i,n,this.strokeDashArray),t.closePath()},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.width/2,n=this.height/2,r=[-i+" "+n,"0 "+-n,i+" "+n].join(",");return e.push("<polygon ",'points="',r,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),void(e.Triangle.fromObject=function(t){return new e.Triangle(t)}))}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=2*Math.PI,n=e.util.object.extend;return e.Ellipse?void e.warn("fabric.Ellipse is already defined."):(e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("rx",t.rx||0),this.set("ry",t.ry||0),this.set("width",2*this.get("rx")),this.set("height",2*this.get("ry"))},toObject:function(t){return n(this.callSuper("toObject",t),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(t){var e=this._createBaseSVGMarkup();return e.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(e.join("")):e.join("")},render:function(t,e){return 0!==this.rx&&0!==this.ry?this.callSuper("render",t,e):void 0},_render:function(t,e){t.beginPath(),t.save(),t.globalAlpha=this.group?t.globalAlpha*this.opacity:this.opacity,this.transformMatrix&&this.group&&t.translate(this.cx,this.cy),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(e?this.left:0,e?this.top:0,this.rx,0,i,!1),t.restore(),this._renderFill(t),this._renderStroke(t)},complexity:function(){return 1}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(t,i){i||(i={});var r=e.parseAttributes(t,e.Ellipse.ATTRIBUTE_NAMES),o=r.left,s=r.top;"left"in r&&(r.left-=i.width/2||0),"top"in r&&(r.top-=i.height/2||0);var a=new e.Ellipse(n(r,i));return a.cx=o||0,a.cy=s||0,a},void(e.Ellipse.fromObject=function(t){return new e.Ellipse(t)}))}("undefined"!=typeof exports?exports:this),function(t){function e(t){return t.left=t.left||0,t.top=t.top||0,t}var i=t.fabric||(t.fabric={}),n=i.util.object.extend;if(i.Rect)return void console.warn("fabric.Rect is already defined");var r=i.Object.prototype.stateProperties.concat();r.push("rx","ry","x","y"),i.Rect=i.util.createClass(i.Object,{stateProperties:r,type:"rect",rx:0,ry:0,x:0,y:0,strokeDashArray:null,initialize:function(t){t=t||{},this.callSuper("initialize",t),this._initRxRy(),this.x=t.x||0,this.y=t.y||0},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t){if(1===this.width&&1===this.height)return void t.fillRect(0,0,1,1);var e=this.rx||0,i=this.ry||0,n=this.width,r=this.height,o=-n/2,s=-r/2,a=this.group&&"path-group"===this.group.type,c=0!==e||0!==i;t.beginPath(),t.globalAlpha=a?t.globalAlpha*this.opacity:this.opacity,this.transformMatrix&&a&&t.translate(this.width/2+this.x,this.height/2+this.y),!this.transformMatrix&&a&&t.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y),t.moveTo(o+e,s),t.lineTo(o+n-e,s),c&&t.quadraticCurveTo(o+n,s,o+n,s+i,o+n,s+i),t.lineTo(o+n,s+r-i),c&&t.quadraticCurveTo(o+n,s+r,o+n-e,s+r,o+n-e,s+r),t.lineTo(o+e,s+r),c&&t.quadraticCurveTo(o,s+r,o,s+r-i,o,s+r-i),t.lineTo(o,s+i),c&&t.quadraticCurveTo(o,s,o+e,s,o+e,s),t.closePath(),this._renderFill(t),this._renderStroke(t)},_renderDashedStroke:function(t){var e=-this.width/2,n=-this.height/2,r=this.width,o=this.height;t.beginPath(),i.util.drawDashedLine(t,e,n,e+r,n,this.strokeDashArray),i.util.drawDashedLine(t,e+r,n,e+r,n+o,this.strokeDashArray),i.util.drawDashedLine(t,e+r,n+o,e,n+o,this.strokeDashArray),i.util.drawDashedLine(t,e,n+o,e,n,this.strokeDashArray),t.closePath()},_normalizeLeftTopProperties:function(t){return"left"in t&&this.set("left",t.left+this.getWidth()/2),this.set("x",t.left||0),"top"in t&&this.set("top",t.top+this.getHeight()/2),this.set("y",t.top||0),this},toObject:function(t){var e=n(this.callSuper("toObject",t),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")});return this.includeDefaultValues||this._removeDefaultValues(e),e},toSVG:function(t){var e=this._createBaseSVGMarkup();return e.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),i.Rect.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),i.Rect.fromElement=function(t,r){if(!t)return null;var o=i.parseAttributes(t,i.Rect.ATTRIBUTE_NAMES);o=e(o);var s=new i.Rect(n(r?i.util.object.clone(r):{},o));return s._normalizeLeftTopProperties(o),s},i.Rect.fromObject=function(t){return new i.Rect(t)}}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.util.toFixed;return e.Polyline?void e.warn("fabric.Polyline is already defined"):(e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,initialize:function(t,e,i){e=e||{},this.set("points",t),this.callSuper("initialize",e),this._calcDimensions(i)},_calcDimensions:function(t){return e.Polygon.prototype._calcDimensions.call(this,t)},toObject:function(t){return e.Polygon.prototype.toObject.call(this,t)},toSVG:function(t){for(var e=[],n=this._createBaseSVGMarkup(),r=0,o=this.points.length;o>r;r++)e.push(i(this.points[r].x,2),",",i(this.points[r].y,2)," ");return n.push("<polyline ",'points="',e.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(n.join("")):n.join("")},_render:function(t){var e;t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var i=0,n=this.points.length;n>i;i++)e=this.points[i],t.lineTo(e.x,e.y);this._renderFill(t),this._renderStroke(t)},_renderDashedStroke:function(t){var i,n;t.beginPath();for(var r=0,o=this.points.length;o>r;r++)i=this.points[r],n=this.points[r+1]||i,e.util.drawDashedLine(t,i.x,i.y,n.x,n.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElement=function(t,i){if(!t)return null;i||(i={});var n=e.parsePointsAttribute(t.getAttribute("points")),r=e.parseAttributes(t,e.Polyline.ATTRIBUTE_NAMES);return e.util.normalizePoints(n,i),new e.Polyline(n,e.util.object.extend(r,i),!0)},void(e.Polyline.fromObject=function(t){var i=t.points;return new e.Polyline(i,t,!0)}))}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max,o=e.util.toFixed;return e.Polygon?void e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Object,{type:"polygon",points:null,initialize:function(t,e,i){e=e||{},this.points=t,this.callSuper("initialize",e),this._calcDimensions(i)},_calcDimensions:function(t){var e=this.points,i=n(e,"x"),o=n(e,"y"),s=r(e,"x"),a=r(e,"y");if(this.width=s-i||1,this.height=a-o||1,this.minX=i,this.minY=o,!t){var c=this.width/2+this.minX,l=this.height/2+this.minY;this.points.forEach(function(t){t.x-=c,t.y-=l},this)}},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat()})},toSVG:function(t){for(var e=[],i=this._createBaseSVGMarkup(),n=0,r=this.points.length;r>n;n++)e.push(o(this.points[n].x,2),",",o(this.points[n].y,2)," ");return i.push("<polygon ",'points="',e.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(i.join("")):i.join("")},_render:function(t){var e;t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var i=0,n=this.points.length;n>i;i++)e=this.points[i],t.lineTo(e.x,e.y);this._renderFill(t),(this.stroke||this.strokeDashArray)&&(t.closePath(),this._renderStroke(t))},_renderDashedStroke:function(t){var i,n;t.beginPath();for(var r=0,o=this.points.length;o>r;r++)i=this.points[r],n=this.points[r+1]||this.points[0],e.util.drawDashedLine(t,i.x,i.y,n.x,n.y,this.strokeDashArray);t.closePath()},complexity:function(){return this.points.length}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=function(t,n){if(!t)return null;n||(n={});var r=e.parsePointsAttribute(t.getAttribute("points")),o=e.parseAttributes(t,e.Polygon.ATTRIBUTE_NAMES);return e.util.normalizePoints(r,n),new e.Polygon(r,i(o,n),!0)},void(e.Polygon.fromObject=function(t){return new e.Polygon(t.points,t,!0)}))}("undefined"!=typeof exports?exports:this),function(t){function e(t){return"H"===t[0]?t[1]:t[t.length-2]}function i(t){return"V"===t[0]?t[1]:t[t.length-1]}var n=t.fabric||(t.fabric={}),r=n.util.array.min,o=n.util.array.max,s=n.util.object.extend,a=Object.prototype.toString,c=n.util.drawArc,l={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};return n.Path?void n.warn("fabric.Path is already defined"):(n.Path=n.util.createClass(n.Object,{type:"path",path:null,initialize:function(t,e){if(e=e||{},this.setOptions(e),!t)throw new Error("`path` argument is required");var i="[object Array]"===a.call(t);this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(i||(this.path=this._parsePath()),this._initializePath(e),e.sourcePath&&this.setSourcePath(e.sourcePath))},_initializePath:function(t){var e="width"in t&&null!=t.width,i="height"in t&&null!=t.width,n="left"in t,r="top"in t,o=n?this.left:0,a=r?this.top:0;e&&i?(r||(this.top=this.height/2),n||(this.left=this.width/2)):(s(this,this._parseDimensions()),e&&(this.width=t.width),i&&(this.height=t.height)),this.pathOffset=this.pathOffset||this._calculatePathOffset(o,a)},_calculatePathOffset:function(t,e){return{x:this.left-t-this.width/2,y:this.top-e-this.height/2}},_render:function(t){for(var e,i,n,r,o,s,a=null,l=0,h=0,u=0,d=0,f=-(this.width/2+this.pathOffset.x),p=-(this.height/2+this.pathOffset.y),g=0,m=this.path.length;m>g;++g){switch(e=this.path[g],e[0]){case"l":l+=e[1],h+=e[2],t.lineTo(l+f,h+p);break;case"L":l=e[1],h=e[2],t.lineTo(l+f,h+p);break;case"h":l+=e[1],t.lineTo(l+f,h+p);break;case"H":l=e[1],t.lineTo(l+f,h+p);break;case"v":h+=e[1],t.lineTo(l+f,h+p);break;case"V":h=e[1],t.lineTo(l+f,h+p);break;case"m":l+=e[1],h+=e[2],s=!a||"m"!==a[0]&&"M"!==a[0]?"moveTo":"lineTo",t[s](l+f,h+p);break;case"M":l=e[1],h=e[2],s=!a||"m"!==a[0]&&"M"!==a[0]?"moveTo":"lineTo",t[s](l+f,h+p);break;case"c":i=l+e[5],n=h+e[6],u=l+e[3],d=h+e[4],t.bezierCurveTo(l+e[1]+f,h+e[2]+p,u+f,d+p,i+f,n+p),l=i,h=n;break;case"C":l=e[5],h=e[6],u=e[3],d=e[4],t.bezierCurveTo(e[1]+f,e[2]+p,u+f,d+p,l+f,h+p);break;case"s":i=l+e[3],n=h+e[4],u=u?2*l-u:l,d=d?2*h-d:h,t.bezierCurveTo(u+f,d+p,l+e[1]+f,h+e[2]+p,i+f,n+p),u=l+e[1],d=h+e[2],l=i,h=n;break;case"S":i=e[3],n=e[4],u=2*l-u,d=2*h-d,t.bezierCurveTo(u+f,d+p,e[1]+f,e[2]+p,i+f,n+p),l=i,h=n,u=e[1],d=e[2];break;case"q":i=l+e[3],n=h+e[4],u=l+e[1],d=h+e[2],t.quadraticCurveTo(u+f,d+p,i+f,n+p),l=i,h=n;break;case"Q":i=e[3],n=e[4],t.quadraticCurveTo(e[1]+f,e[2]+p,i+f,n+p),l=i,h=n,u=e[1],d=e[2];break;case"t":i=l+e[1],n=h+e[2],null===a[0].match(/[QqTt]/)?(u=l,d=h):"t"===a[0]?(u=2*l-r,d=2*h-o):"q"===a[0]&&(u=2*l-u,d=2*h-d),r=u,o=d,t.quadraticCurveTo(u+f,d+p,i+f,n+p),l=i,h=n,u=l+e[1],d=h+e[2];break;case"T":i=e[1],n=e[2],u=2*l-u,d=2*h-d,t.quadraticCurveTo(u+f,d+p,i+f,n+p),l=i,h=n;break;case"a":c(t,l+f,h+p,[e[1],e[2],e[3],e[4],e[5],e[6]+l+f,e[7]+h+p]),l+=e[6],h+=e[7];break;case"A":c(t,l+f,h+p,[e[1],e[2],e[3],e[4],e[5],e[6]+f,e[7]+p]),l=e[6],h=e[7];break;case"z":case"Z":t.closePath()}a=e}},render:function(t,e){if(this.visible){t.save();var i=this.transformMatrix;i&&t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),e||this.transform(t),this._setStrokeStyles(t),this._setFillStyles(t),this._setShadow(t),this.clipTo&&n.util.clipContext(this,t),t.beginPath(),this._render(t),this._renderFill(t),this._renderStroke(t),this.clipTo&&t.restore(),this._removeShadow(t),!e&&this.active&&(this.drawBorders(t),this.drawControls(t)),t.restore()}},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){var e=s(this.callSuper("toObject",t),{path:this.path.map(function(t){return t.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(e.sourcePath=this.sourcePath),this.transformMatrix&&(e.transformMatrix=this.transformMatrix),e},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.path=this.sourcePath),delete e.sourcePath,e},toSVG:function(t){for(var e=[],i=this._createBaseSVGMarkup(),n=0,r=this.path.length;r>n;n++)e.push(this.path[n].join(" "));var o=e.join(" ");return i.push('<g transform="',this.group?"":this.getSvgTransform(),'">',"<path ",'d="',o,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',"/>","</g>"),t?t(i.join("")):i.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var t,e,i,n,r,o=[],s=[],a=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,c=0,h=this.path.length;h>c;c++){for(t=this.path[c],n=t.slice(1).trim(),s.length=0;i=a.exec(n);)s.push(i[0]);r=[t.charAt(0)];for(var u=0,d=s.length;d>u;u++)e=parseFloat(s[u]),isNaN(e)||r.push(e);var f=r[0].toLowerCase(),p=l[f];if(r.length-1>p)for(var g=1,m=r.length;m>g;g+=p)o.push([r[0]].concat(r.slice(g,g+p)));else o.push(r)}return o},_parseDimensions:function(){var t=[],e=[],i={};this.path.forEach(function(n,r){this._getCoordsFromCommand(n,r,t,e,i)},this);var n=r(t),s=r(e),a=o(t),c=o(e),l=a-n,h=c-s,u={left:this.left+(n+l/2),top:this.top+(s+h/2),width:l,height:h};return u},_getCoordsFromCommand:function(t,n,r,o,s){var a=!1;"H"!==t[0]&&(s.x=e(0===n?t:this.path[n-1])),"V"!==t[0]&&(s.y=i(0===n?t:this.path[n-1])),t[0]===t[0].toLowerCase()&&(a=!0);var c,l=this._getXY(t,a,s);c=parseInt(l.x,10),isNaN(c)||r.push(c),c=parseInt(l.y,10),isNaN(c)||o.push(c)},_getXY:function(t,n,r){var o=n?r.x+e(t):"V"===t[0]?r.x:e(t),s=n?r.y+i(t):"H"===t[0]?r.y:i(t);return{x:o,y:s}}}),n.Path.fromObject=function(t,e){"string"==typeof t.path?n.loadSVGFromURL(t.path,function(i){var r=i[0],o=t.path;delete t.path,n.util.object.extend(r,t),r.setSourcePath(o),e(r)}):e(new n.Path(t.path,t))},n.Path.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(["d"]),n.Path.fromElement=function(t,e,i){var r=n.parseAttributes(t,n.Path.ATTRIBUTE_NAMES);e&&e(new n.Path(r.d,s(r,i)))},void(n.Path.async=!0))}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.invoke,r=e.Object.prototype.toObject;return e.PathGroup?void e.warn("fabric.PathGroup is already defined"):(e.PathGroup=e.util.createClass(e.Path,{type:"path-group",fill:"",initialize:function(t,e){e=e||{},this.paths=t||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;this.setOptions(e),this.setCoords(),e.sourcePath&&this.setSourcePath(e.sourcePath)},render:function(t){if(this.visible){t.save();var i=this.transformMatrix;i&&t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(t),this._setShadow(t),this.clipTo&&e.util.clipContext(this,t);for(var n=0,r=this.paths.length;r>n;++n)this.paths[n].render(t,!0);this.clipTo&&t.restore(),this._removeShadow(t),this.active&&(this.drawBorders(t),this.drawControls(t)),t.restore()}},_set:function(t,e){if("fill"===t&&e&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(t,e);return this.callSuper("_set",t,e)},toObject:function(t){var e=i(r.call(this,t),{paths:n(this.getObjects(),"toObject",t)});return this.sourcePath&&(e.sourcePath=this.sourcePath),e},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.paths=this.sourcePath),e},toSVG:function(t){for(var e=this.getObjects(),i=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"],n=0,r=e.length;r>n;n++)i.push(e[n].toSVG(t));return i.push("</g>"),t?t(i.join("")):i.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var t=this.getObjects()[0].get("fill");return this.getObjects().every(function(e){return e.get("fill")===t})},complexity:function(){return this.paths.reduce(function(t,e){return t+(e&&e.complexity?e.complexity():0)},0)},getObjects:function(){return this.paths}}),e.PathGroup.fromObject=function(t,i){"string"==typeof t.paths?e.loadSVGFromURL(t.paths,function(n){var r=t.paths;delete t.paths;var o=e.util.groupSVGElements(n,t,r);i(o)}):e.util.enlivenObjects(t.paths,function(n){delete t.paths,i(new e.PathGroup(n,t))})},void(e.PathGroup.async=!0))}("undefined"!=typeof exports?exports:this),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max,o=e.util.array.invoke;if(!e.Group){var s={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",initialize:function(t,e){e=e||{},this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;this.originalState={},this.callSuper("initialize"),this._calcBounds(),this._updateObjectsCoords(),e&&i(this,e),this._setOpacityIfSame(),this.setCoords(!0),this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)
},_updateObjectCoords:function(t){var e=t.getLeft(),i=t.getTop();t.set({originalLeft:e,originalTop:i,left:e-this.left,top:i-this.top}),t.setCoords(),t.__origHasControls=t.hasControls,t.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),this._objects.push(t),t.group=this,this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(t){t.set("active",!0),t.group=this},removeWithUpdate:function(t){return this._moveFlippedObject(t),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(t){t.group=this},_onObjectRemoved:function(t){delete t.group,t.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(t,e){if(t in this.delegatedProperties){var i=this._objects.length;for(this[t]=e;i--;)this._objects[i].set(t,e)}else this[t]=e},toObject:function(t){return i(this.callSuper("toObject",t),{objects:o(this._objects,"toObject",t)})},render:function(t,i){if(this.visible){t.save(),this.transform(t),this.clipTo&&e.util.clipContext(this,t);for(var n=0,r=this._objects.length;r>n;n++)this._renderObject(this._objects[n],t);this.clipTo&&t.restore(),!i&&this.active&&(this.drawBorders(t),this.drawControls(t)),t.restore()}},_renderObject:function(t,e){var i=t.borderScaleFactor,n=t.hasRotatingPoint,r=Math.max(this.scaleX,this.scaleY);t.visible&&(t.borderScaleFactor=r,t.hasRotatingPoint=!1,t.render(e),t.borderScaleFactor=i,t.hasRotatingPoint=n)},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},_moveFlippedObject:function(t){var e=t.get("originX"),i=t.get("originY"),n=t.getCenterPoint();t.set({originX:"center",originY:"center",left:n.x,top:n.y}),this._toggleFlipping(t);var r=t.getPointByOrigin(e,i);return t.set({originX:e,originY:i,left:r.x,top:r.y}),this},_toggleFlipping:function(t){this.flipX&&(t.toggle("flipX"),t.set("left",-t.get("left")),t.setAngle(-t.getAngle())),this.flipY&&(t.toggle("flipY"),t.set("top",-t.get("top")),t.setAngle(-t.getAngle()))},_restoreObjectState:function(t){return this._setObjectPosition(t),t.setCoords(),t.hasControls=t.__origHasControls,delete t.__origHasControls,t.set("active",!1),t.setCoords(),delete t.group,this},_setObjectPosition:function(t){var e=this.getLeft(),i=this.getTop(),n=this._getRotatedLeftTop(t);t.set({angle:t.getAngle()+this.getAngle(),left:e+n.left,top:i+n.top,scaleX:t.get("scaleX")*this.get("scaleX"),scaleY:t.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(t){var e=this.getAngle()*(Math.PI/180);return{left:-Math.sin(e)*t.getTop()*this.get("scaleY")+Math.cos(e)*t.getLeft()*this.get("scaleX"),top:Math.cos(e)*t.getTop()*this.get("scaleY")+Math.sin(e)*t.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords()}),this},_setOpacityIfSame:function(){var t=this.getObjects(),e=t[0]?t[0].get("opacity"):1,i=t.every(function(t){return t.get("opacity")===e});i&&(this.opacity=e)},_calcBounds:function(t){for(var e,i=[],n=[],r=0,o=this._objects.length;o>r;++r){e=this._objects[r],e.setCoords();for(var s in e.oCoords)i.push(e.oCoords[s].x),n.push(e.oCoords[s].y)}this.set(this._getBounds(i,n,t))},_getBounds:function(t,e,i){var o=n(t),s=r(t),a=n(e),c=r(e),l=s-o||0,h=c-a||0,u={width:l,height:h};return i||(u.left=o+l/2||0,u.top=a+h/2||0),u},toSVG:function(t){for(var e=["<g ",'transform="',this.getSvgTransform(),'">'],i=0,n=this._objects.length;n>i;i++)e.push(this._objects[i].toSVG(t));return e.push("</g>"),t?t(e.join("")):e.join("")},get:function(t){if(t in s){if(this[t])return this[t];for(var e=0,i=this._objects.length;i>e;e++)if(this._objects[e][t])return!0;return!1}return t in this.delegatedProperties?this._objects[0]&&this._objects[0].get(t):this[t]}}),e.Group.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){delete t.objects,i&&i(new e.Group(n,t))})},e.Group.async=!0}}("undefined"!=typeof exports?exports:this),function(t){var e=fabric.util.object.extend;return t.fabric||(t.fabric={}),t.fabric.Image?void fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",initialize:function(t,e){e||(e={}),this.filters=[],this.callSuper("initialize",e),this._initElement(t,e),this._initConfig(e),e.filters&&(this.filters=e.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(t,e){return this._element=t,this._originalElement=t,this._initConfig(),0!==this.filters.length&&this.applyFilters(e),this},setCrossOrigin:function(t){return this.crossOrigin=t,this._element.crossOrigin=t,this},getOriginalSize:function(){var t=this.getElement();return{width:t.width,height:t.height}},render:function(t,e){if(this.visible){t.save();var i=this.transformMatrix,n=this.group&&"path-group"===this.group.type;n&&t.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2),i&&t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),e||this.transform(t),t.save(),this._setShadow(t),this.clipTo&&fabric.util.clipContext(this,t);try{this._render(t)}catch(r){var o=new Image,s=this;o.onload=function(){s.render(t,e)},o.src=this._element.src,this._element=o}this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),this._renderStroke(t),this.clipTo&&t.restore(),t.restore(),this.active&&!e&&(this.drawBorders(t),this.drawControls(t)),t.restore()}},_stroke:function(t){t.save(),this._setStrokeStyles(t),t.beginPath(),t.strokeRect(-this.width/2,-this.height/2,this.width,this.height),t.closePath(),t.restore()},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,n=this.width,r=this.height;t.save(),this._setStrokeStyles(t),t.beginPath(),fabric.util.drawDashedLine(t,e,i,e+n,i,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i,e+n,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i+r,e,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e,i+r,e,i,this.strokeDashArray),t.closePath(),t.restore()},toObject:function(t){return e(this.callSuper("toObject",t),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(t){return t&&t.toObject()}),crossOrigin:this.crossOrigin})},toSVG:function(t){var e=[];if(e.push('<g transform="',this.getSvgTransform(),'">','<image xlink:href="',this.getSvgSrc(),'" style="',this.getSvgStyles(),'" transform="translate('+-this.width/2+" "+-this.height/2+")",'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="none"',"></image>"),this.stroke||this.strokeDashArray){var i=this.fill;this.fill=null,e.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>'),this.fill=i}return e.push("</g>"),t?t(e.join("")):e.join("")},getSrc:function(){return this.getElement()?this.getElement().src||this.getElement()._src:void 0},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(t,e){this.constructor.fromObject(this.toObject(e),t)},applyFilters:function(t){if(this._originalElement){if(0===this.filters.length)return this._element=this._originalElement,void(t&&t());var e=this._originalElement,i=fabric.util.createCanvasElement(),n=fabric.util.createImage(),r=this;return i.width=e.width,i.height=e.height,i.getContext("2d").drawImage(e,0,0,e.width,e.height),this.filters.forEach(function(t){t&&t.applyTo(i)}),n.width=e.width,n.height=e.height,fabric.isLikelyNode?(n.src=i.toBuffer(void 0,fabric.Image.pngCompression),r._element=n,t&&t()):(n.onload=function(){r._element=n,t&&t(),n.onload=i=e=null},n.src=i.toDataURL("image/png")),this}},_render:function(t){this._element&&t.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width),this.set("height",t.height)},_initElement:function(t){this.setElement(fabric.util.getById(t)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t),this._element&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(t,e){t.filters&&t.filters.length?fabric.util.enlivenObjects(t.filters,function(t){e&&e(t)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){this.width="width"in t?t.width:this.getElement()?this.getElement().width||0:0,this.height="height"in t?t.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(t,e){fabric.util.loadImage(t.src,function(i){fabric.Image.prototype._initFilters.call(t,t,function(n){t.filters=n||[];var r=new fabric.Image(i,t);e&&e(r)})},null,t.crossOrigin)},fabric.Image.fromURL=function(t,e,i){fabric.util.loadImage(t,function(t){e(new fabric.Image(t,i))},null,i&&i.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height xlink:href".split(" ")),fabric.Image.fromElement=function(t,i,n){var r=fabric.parseAttributes(t,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(r["xlink:href"],i,e(n?fabric.util.object.clone(n):{},r))},fabric.Image.async=!0,void(fabric.Image.pngCompression=1))}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.getAngle()%360;return t>0?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(t){t=t||{};var e=function(){},i=t.onComplete||e,n=t.onChange||e,r=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){r.setAngle(t),n()},onComplete:function(){r.setCoords(),i()},onStart:function(){r.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.renderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,r=e.util.toFixed,o=e.StaticCanvas.supports("setLineDash");if(e.Text)return void e.warn("fabric.Text is already defined");var s=e.Object.prototype.stateProperties.concat();s.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path"),e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:s,stroke:null,shadow:null,initialize:function(t,e){e=e||{},this.text=t,this.__skipDimension=!0,this.setOptions(e),this.__skipDimension=!1,this._initDimensions(),this.setCoords()},_initDimensions:function(){if(!this.__skipDimension){var t=e.util.createCanvasElement();this._render(t.getContext("2d"))}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(t){var e=this.group&&"path-group"===this.group.type;e&&!this.transformMatrix?t.translate(-this.group.width/2+this.left,-this.group.height/2+this.top):e&&this.transformMatrix&&t.translate(-this.group.width/2,-this.group.height/2),"undefined"==typeof Cufon||this.useNative===!0?this._renderViaNative(t):this._renderViaCufon(t)},_renderViaNative:function(t){var i=this.text.split(this._reNewline);this.transform(t,e.isLikelyNode),this._setTextStyles(t),this.width=this._getTextWidth(t,i),this.height=this._getTextHeight(t,i),this.clipTo&&e.util.clipContext(this,t),this._renderTextBackground(t,i),this._translateForTextAlign(t),this._renderText(t,i),"left"!==this.textAlign&&"justify"!==this.textAlign&&t.restore(),this._renderTextDecoration(t,i),this.clipTo&&t.restore(),this._setBoundaries(t,i),this._totalLineHeight=0},_renderText:function(t,e){t.save(),this._setShadow(t),this._renderTextFill(t,e),this._renderTextStroke(t,e),this._removeShadow(t),t.restore()},_translateForTextAlign:function(t){"left"!==this.textAlign&&"justify"!==this.textAlign&&(t.save(),t.translate("center"===this.textAlign?this.width/2:this.width,0))},_setBoundaries:function(t,e){this._boundaries=[];for(var i=0,n=e.length;n>i;i++){var r=this._getLineWidth(t,e[i]),o=this._getLineLeftOffset(r);this._boundaries.push({height:this.fontSize*this.lineHeight,width:r,left:o})}},_setTextStyles:function(t){this._setFillStyles(t),this._setStrokeStyles(t),t.textBaseline="alphabetic",this.skipTextAlign||(t.textAlign=this.textAlign),t.font=this._getFontDeclaration()},_getTextHeight:function(t,e){return this.fontSize*e.length*this.lineHeight},_getTextWidth:function(t,e){for(var i=t.measureText(e[0]||"|").width,n=1,r=e.length;r>n;n++){var o=t.measureText(e[n]).width;o>i&&(i=o)}return i},_renderChars:function(t,e,i,n,r){e[t](i,n,r)},_renderTextLine:function(t,e,i,n,r,o){if(r-=this.fontSize/4,"justify"!==this.textAlign)return void this._renderChars(t,e,i,n,r,o);var s=e.measureText(i).width,a=this.width;if(a>s)for(var c=i.split(/\s+/),l=e.measureText(i.replace(/\s+/g,"")).width,h=a-l,u=c.length-1,d=h/u,f=0,p=0,g=c.length;g>p;p++)this._renderChars(t,e,c[p],n+f,r,o),f+=e.measureText(c[p]).width+d;else this._renderChars(t,e,i,n,r,o)},_getLeftOffset:function(){return e.isLikelyNode?0:-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(t,e){if(this.fill||this._skipFillStrokeCheck){this._boundaries=[];for(var i=0,n=0,r=e.length;r>n;n++){var o=this._getHeightOfLine(t,n,e);i+=o,this._renderTextLine("fillText",t,e[n],this._getLeftOffset(),this._getTopOffset()+i,n)}}},_renderTextStroke:function(t,e){if(this.stroke||this._skipFillStrokeCheck){var i=0;t.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),o&&t.setLineDash(this.strokeDashArray)),t.beginPath();for(var n=0,r=e.length;r>n;n++){var s=this._getHeightOfLine(t,n,e);i+=s,this._renderTextLine("strokeText",t,e[n],this._getLeftOffset(),this._getTopOffset()+i,n)}t.closePath(),t.restore()}},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(t,e){this._renderTextBoxBackground(t),this._renderTextLinesBackground(t,e)},_renderTextBoxBackground:function(t){this.backgroundColor&&(t.save(),t.fillStyle=this.backgroundColor,t.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),t.restore())},_renderTextLinesBackground:function(t,e){if(this.textBackgroundColor){t.save(),t.fillStyle=this.textBackgroundColor;for(var i=0,n=e.length;n>i;i++)if(""!==e[i]){var r=this._getLineWidth(t,e[i]),o=this._getLineLeftOffset(r);t.fillRect(this._getLeftOffset()+o,this._getTopOffset()+i*this.fontSize*this.lineHeight,r,this.fontSize*this.lineHeight)}t.restore()}},_getLineLeftOffset:function(t){return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:0},_getLineWidth:function(t,e){return"justify"===this.textAlign?this.width:t.measureText(e).width},_renderTextDecoration:function(t,e){function i(i){for(var o=0,s=e.length;s>o;o++){var a=r._getLineWidth(t,e[o]),c=r._getLineLeftOffset(a);t.fillRect(r._getLeftOffset()+c,~~(i+o*r._getHeightOfLine(t,o,e)-n),a,1)}}if(this.textDecoration){var n=this._getTextHeight(t,e)/2,r=this;this.textDecoration.indexOf("underline")>-1&&i(this.fontSize*this.lineHeight),this.textDecoration.indexOf("line-through")>-1&&i(this.fontSize*this.lineHeight-this.fontSize/2),this.textDecoration.indexOf("overline")>-1&&i(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[e.isLikelyNode?this.fontWeight:this.fontStyle,e.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(t,e){if(this.visible){t.save();var i=this.transformMatrix;i&&!this.group&&t.setTransform(i[0],i[1],i[2],i[3],i[4],i[5]),this._render(t),!e&&this.active&&(this.drawBorders(t),this.drawControls(t)),t.restore()}},toObject:function(t){var e=i(this.callSuper("toObject",t),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});return this.includeDefaultValues||this._removeDefaultValues(e),e},toSVG:function(t){var e=[],i=this.text.split(this._reNewline),n=this._getSVGLeftTopOffsets(i),r=this._getSVGTextAndBg(n.lineTop,n.textLeft,i),o=this._getSVGShadows(n.lineTop,i);return n.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0,this._wrapSVGTextAndBg(e,r,o,n),t?t(e.join("")):e.join("")},_getSVGLeftTopOffsets:function(t){var e=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,i=-(this.width/2),n=this.useNative?this.fontSize-1:this.height/2-t.length*this.fontSize-this._totalLineHeight;return{textLeft:i,textTop:n,lineTop:e}},_wrapSVGTextAndBg:function(t,e,i,n){t.push('<g transform="',this.getSvgTransform(),'">',e.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',r(n.textLeft,2)," ",r(n.textTop,2),')">',i.join(""),e.textSpans.join(""),"</text>","</g>")},_getSVGShadows:function(t,i){var n,o,s=[],a=1;if(!this.shadow||!this._boundaries)return s;for(n=0,o=i.length;o>n;n++)if(""!==i[n]){var c=this._boundaries&&this._boundaries[n]?this._boundaries[n].left:0;s.push('<tspan x="',r(c+a+this.shadow.offsetX,2),0===n||this.useNative?'" y':'" dy','="',r(this.useNative?t*n-this.height/2+this.shadow.offsetY:t+(0===n?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",e.util.string.escapeXml(i[n]),"</tspan>"),a=1}else a++;return s},_getSVGTextAndBg:function(t,e,i){var n=[],r=[],o=1;this._setSVGBg(r);for(var s=0,a=i.length;a>s;s++)""!==i[s]?(this._setSVGTextLineText(i[s],s,n,t,o,r),o=1):o++,this.textBackgroundColor&&this._boundaries&&this._setSVGTextLineBg(r,s,e,t);return{textSpans:n,textBgRects:r}},_setSVGTextLineText:function(t,i,n,o,s){var a=this._boundaries&&this._boundaries[i]?r(this._boundaries[i].left,2):0;n.push('<tspan x="',a,'" ',0===i||this.useNative?"y":"dy",'="',r(this.useNative?o*i-this.height/2:o*s,2),'" ',this._getFillAttributes(this.fill),">",e.util.string.escapeXml(t),"</tspan>")},_setSVGTextLineBg:function(t,e,i,n){t.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',r(i+this._boundaries[e].left,2),'" y="',r(n*e-this.height/2,2),'" width="',r(this._boundaries[e].width,2),'" height="',r(this._boundaries[e].height,2),'"></rect>')},_setSVGBg:function(t){this.backgroundColor&&this._boundaries&&t.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',r(-this.width/2,2),'" y="',r(-this.height/2,2),'" width="',r(this.width,2),'" height="',r(this.height,2),'"></rect>')},_getFillAttributes:function(t){var i=t&&"string"==typeof t?new e.Color(t):"";return i&&i.getSource()&&1!==i.getAlpha()?'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},_set:function(t,e){"fontFamily"===t&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+e+"$3")),this.callSuper("_set",t,e),t in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y font-family font-style font-weight font-size text-decoration".split(" ")),e.Text.fromElement=function(t,i){if(!t)return null;var n=e.parseAttributes(t,e.Text.ATTRIBUTE_NAMES);i=e.util.object.extend(i?e.util.object.clone(i):{},n);var r=new e.Text(t.textContent,i);return r.set({left:r.getLeft()+r.getWidth()/2,top:r.getTop()-r.getHeight()/2}),r},e.Text.fromObject=function(t){return new e.Text(t.text,n(t))},e.util.createAccessors(e.Text)}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Text.prototype,{_renderViaCufon:function(t){var e=Cufon.textOptions||(Cufon.textOptions={});e.left=this.left,e.top=this.top,e.context=t,e.color=this.fill;var i=this._initDummyElementForCufon();this.transform(t),Cufon.replaceElement(i,{engine:"canvas",separate:"none",fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.shadow&&this.shadow.toString(),textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,stroke:this.stroke,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor}),this.width=e.width,this.height=e.height,this._totalLineHeight=e.totalLineHeight,this._fontAscent=e.fontAscent,this._boundaries=e.boundaries,i=null,this.setCoords()},_initDummyElementForCufon:function(){var t=fabric.document.createElement("pre"),e=fabric.document.createElement("div");return e.appendChild(t),"undefined"==typeof G_vmlCanvasManager?t.innerHTML=this.text:t.innerText=this.text.replace(/\r?\n/gi,"\r"),t.style.fontSize=this.fontSize+"px",t.style.letterSpacing="normal",t}}),function(){var t=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(t,e){this.styles=e?e.styles||{}:{},this.callSuper("initialize",t,e),this.initBehavior(),fabric.IText.instances.push(this),this.__lineWidths={},this.__lineHeights={},this.__lineOffsets={}},isEmptyStyles:function(){if(!this.styles)return!0;var t=this.styles;for(var e in t)for(var i in t[e])for(var n in t[e][i])return!1;return!0},setSelectionStart:function(t){this.selectionStart!==t&&this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionStart=t,this.hiddenTextarea&&(this.hiddenTextarea.selectionStart=t)},setSelectionEnd:function(t){this.selectionEnd!==t&&this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionEnd=t,this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=t)},getSelectionStyles:function(t,e){if(2===arguments.length){for(var i=[],n=t;e>n;n++)i.push(this.getSelectionStyles(n));return i}var r=this.get2DCursorLocation(t);return this.styles[r.lineIndex]?this.styles[r.lineIndex][r.charIndex]||{}:{}},setSelectionStyles:function(t){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,t);else for(var e=this.selectionStart;e<this.selectionEnd;e++)this._extendStyles(e,t);return this},_extendStyles:function(t,e){var i=this.get2DCursorLocation(t);this.styles[i.lineIndex]||(this.styles[i.lineIndex]={}),this.styles[i.lineIndex][i.charIndex]||(this.styles[i.lineIndex][i.charIndex]={}),fabric.util.object.extend(this.styles[i.lineIndex][i.charIndex],e)},_render:function(t){this.callSuper("_render",t),this.ctx=t,this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var t,e=this.text.split("");this.selectionStart===this.selectionEnd?(t=this._getCursorBoundaries(e,"cursor"),this.renderCursor(t)):(t=this._getCursorBoundaries(e,"selection"),this.renderSelection(e,t))}},get2DCursorLocation:function(t){"undefined"==typeof t&&(t=this.selectionStart);var e=this.text.slice(0,t),i=e.split(this._reNewline);return{lineIndex:i.length-1,charIndex:i[i.length-1].length}},getCurrentCharStyle:function(t,e){var i=this.styles[t]&&this.styles[t][0===e?0:e-1];return{fontSize:i&&i.fontSize||this.fontSize,fill:i&&i.fill||this.fill,textBackgroundColor:i&&i.textBackgroundColor||this.textBackgroundColor,textDecoration:i&&i.textDecoration||this.textDecoration,fontFamily:i&&i.fontFamily||this.fontFamily,stroke:i&&i.stroke||this.stroke,strokeWidth:i&&i.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(t,e){return this.styles[t]&&this.styles[t][0===e?0:e-1]&&this.styles[t][0===e?0:e-1].fontSize||this.fontSize},getCurrentCharColor:function(t,e){return this.styles[t]&&this.styles[t][0===e?0:e-1]&&this.styles[t][0===e?0:e-1].fill||this.cursorColor},_getCursorBoundaries:function(t,e){var i=this.get2DCursorLocation(),n=this.text.split(this._reNewline),r=Math.round(this._getLeftOffset()),o=-this.height/2,s=this._getCursorBoundariesOffsets(t,e,i,n);return{left:r,top:o,leftOffset:s.left+s.lineLeft,topOffset:s.top}},_getCursorBoundariesOffsets:function(t,e,i,n){for(var r=0,o=0,s=0,a=0,c="cursor"===e?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(i.lineIndex,i.charIndex):0,l=0;l<this.selectionStart;l++){if("\n"===t[l]){a=0;var h=o+("cursor"===e?1:0);c+=this._getCachedLineHeight(h),o++,s=0}else a+=this._getWidthOfChar(this.ctx,t[l],o,s),s++;r=this._getCachedLineOffset(o,n)}return this._clearCache(),{top:c,left:a,lineLeft:r}},_clearCache:function(){this.__lineWidths={},this.__lineHeights={},this.__lineOffsets={}},_getCachedLineHeight:function(t){return this.__lineHeights[t]||(this.__lineHeights[t]=this._getHeightOfLine(this.ctx,t))},_getCachedLineWidth:function(t,e){return this.__lineWidths[t]||(this.__lineWidths[t]=this._getWidthOfLine(this.ctx,t,e))},_getCachedLineOffset:function(t,e){var i=this._getCachedLineWidth(t,e);return this.__lineOffsets[t]||(this.__lineOffsets[t]=this._getLineLeftOffset(i))},renderCursor:function(t){var e=this.ctx;e.save();var i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex,o=this.getCurrentCharFontSize(n,r),s=0===n&&0===r?this._getCachedLineOffset(n,this.text.split(this._reNewline)):t.leftOffset;e.fillStyle=this.getCurrentCharColor(n,r),e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,e.fillRect(t.left+s,t.top+t.topOffset,this.cursorWidth/this.scaleX,o),e.restore()},renderSelection:function(t,e){var i=this.ctx;i.save(),i.fillStyle=this.selectionColor;for(var n=this.get2DCursorLocation(this.selectionStart),r=this.get2DCursorLocation(this.selectionEnd),o=n.lineIndex,s=r.lineIndex,a=this.text.split(this._reNewline),c=o;s>=c;c++){var l=this._getCachedLineOffset(c,a)||0,h=this._getCachedLineHeight(c),u=0;if(c===o)for(var d=0,f=a[c].length;f>d;d++)d>=n.charIndex&&(c!==s||d<r.charIndex)&&(u+=this._getWidthOfChar(i,a[c][d],c,d)),d<n.charIndex&&(l+=this._getWidthOfChar(i,a[c][d],c,d));else if(c>o&&s>c)u+=this._getCachedLineWidth(c,a)||5;else if(c===s)for(var p=0,g=r.charIndex;g>p;p++)u+=this._getWidthOfChar(i,a[c][p],c,p);i.fillRect(e.left+l,e.top+e.topOffset,u,h),e.topOffset+=h}i.restore()},_renderChars:function(t,e,i,n,r,o){if(this.isEmptyStyles())return this._renderCharsFast(t,e,i,n,r);this.skipTextAlign=!0,n-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:0;var s,a=this.text.split(this._reNewline),c=this._getWidthOfLine(e,o,a),l=this._getHeightOfLine(e,o,a),h=this._getLineLeftOffset(c),u=i.split(""),d="";n+=h||0,e.save();for(var f=0,p=u.length;p>=f;f++){s=s||this.getCurrentCharStyle(o,f);var g=this.getCurrentCharStyle(o,f+1);(this._hasStyleChanged(s,g)||f===p)&&(this._renderChar(t,e,o,f-1,d,n,r,l),d="",s=g),d+=u[f]}e.restore()},_renderCharsFast:function(t,e,i,n,r){this.skipTextAlign=!1,"fillText"===t&&this.fill&&this.callSuper("_renderChars",t,e,i,n,r),"strokeText"===t&&this.stroke&&this.callSuper("_renderChars",t,e,i,n,r)},_renderChar:function(t,e,i,n,r,o,s,a){var c,l,h;if(this.styles&&this.styles[i]&&(c=this.styles[i][n])){var u=c.stroke||this.stroke,d=c.fill||this.fill;e.save(),l=this._applyCharStylesGetWidth(e,r,i,n,c),h=this._getHeightOfChar(e,r,i,n),d&&e.fillText(r,o,s),u&&e.strokeText(r,o,s),this._renderCharDecoration(e,c,o,s,l,a,h),e.restore(),e.translate(l,0)}else"strokeText"===t&&this.stroke&&e[t](r,o,s),"fillText"===t&&this.fill&&e[t](r,o,s),l=this._applyCharStylesGetWidth(e,r,i,n),this._renderCharDecoration(e,null,o,s,l,a),e.translate(e.measureText(r).width,0)},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.fontSize!==e.fontSize||t.textBackgroundColor!==e.textBackgroundColor||t.textDecoration!==e.textDecoration||t.fontFamily!==e.fontFamily||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth},_renderCharDecoration:function(t,e,i,n,r,o,s){var a=e?e.textDecoration||this.textDecoration:this.textDecoration,c=(e?e.fontSize:null)||this.fontSize;a&&(a.indexOf("underline")>-1&&this._renderCharDecorationAtOffset(t,i,n+this.fontSize/this._fontSizeFraction,r,0,this.fontSize/20),a.indexOf("line-through")>-1&&this._renderCharDecorationAtOffset(t,i,n+this.fontSize/this._fontSizeFraction,r,s/2,c/20),a.indexOf("overline")>-1&&this._renderCharDecorationAtOffset(t,i,n,r,o-this.fontSize/this._fontSizeFraction,this.fontSize/20))},_renderCharDecorationAtOffset:function(t,e,i,n,r,o){t.fillRect(e,i-r,n,o)},_renderTextLine:function(t,e,i,n,r,o){r+=this.fontSize/4,this.callSuper("_renderTextLine",t,e,i,n,r,o)},_renderTextDecoration:function(t,e){return this.isEmptyStyles()?this.callSuper("_renderTextDecoration",t,e):void 0},_renderTextLinesBackground:function(t,e){if(this.textBackgroundColor||this.styles){t.save(),this.textBackgroundColor&&(t.fillStyle=this.textBackgroundColor);for(var i=0,n=this.fontSize/this._fontSizeFraction,r=0,o=e.length;o>r;r++){var s=this._getHeightOfLine(t,r,e);if(""!==e[r]){var a=this._getWidthOfLine(t,r,e),c=this._getLineLeftOffset(a);if(this.textBackgroundColor&&(t.fillStyle=this.textBackgroundColor,t.fillRect(this._getLeftOffset()+c,this._getTopOffset()+i+n,a,s)),this.styles[r])for(var l=0,h=e[r].length;h>l;l++)if(this.styles[r]&&this.styles[r][l]&&this.styles[r][l].textBackgroundColor){var u=e[r][l];t.fillStyle=this.styles[r][l].textBackgroundColor,t.fillRect(this._getLeftOffset()+c+this._getWidthOfCharsAt(t,r,l,e),this._getTopOffset()+i+n,this._getWidthOfChar(t,u,r,l,e)+1,s)}i+=s}else i+=s}t.restore()}},_getCacheProp:function(t,e){return t+e.fontFamily+e.fontSize+e.fontWeight+e.fontStyle+e.shadow},_applyCharStylesGetWidth:function(e,i,n,r,o){var s=o||this.styles[n]&&this.styles[n][r];s=s?t(s):{},this._applyFontStyles(s);var a=this._getCacheProp(i,s);if(this.isEmptyStyles()&&this._charWidthsCache[a]&&this.caching)return this._charWidthsCache[a];"string"==typeof s.shadow&&(s.shadow=new fabric.Shadow(s.shadow));var c=s.fill||this.fill;return e.fillStyle=c.toLive?c.toLive(e):c,s.stroke&&(e.strokeStyle=s.stroke&&s.stroke.toLive?s.stroke.toLive(e):s.stroke),e.lineWidth=s.strokeWidth||this.strokeWidth,e.font=this._getFontDeclaration.call(s),this._setShadow.call(s,e),this.caching?(this._charWidthsCache[a]||(this._charWidthsCache[a]=e.measureText(i).width),this._charWidthsCache[a]):e.measureText(i).width},_applyFontStyles:function(t){t.fontFamily||(t.fontFamily=this.fontFamily),t.fontSize||(t.fontSize=this.fontSize),t.fontWeight||(t.fontWeight=this.fontWeight),t.fontStyle||(t.fontStyle=this.fontStyle)
},_getStyleDeclaration:function(e,i){return this.styles[e]&&this.styles[e][i]?t(this.styles[e][i]):{}},_getWidthOfChar:function(t,e,i,n){var r=this._getStyleDeclaration(i,n);this._applyFontStyles(r);var o=this._getCacheProp(e,r);if(this._charWidthsCache[o]&&this.caching)return this._charWidthsCache[o];if(t){t.save();var s=this._applyCharStylesGetWidth(t,e,i,n);return t.restore(),s}},_getHeightOfChar:function(t,e,i,n){return this.styles[i]&&this.styles[i][n]?this.styles[i][n].fontSize||this.fontSize:this.fontSize},_getWidthOfCharAt:function(t,e,i,n){n=n||this.text.split(this._reNewline);var r=n[e].split("")[i];return this._getWidthOfChar(t,r,e,i)},_getHeightOfCharAt:function(t,e,i,n){n=n||this.text.split(this._reNewline);var r=n[e].split("")[i];return this._getHeightOfChar(t,r,e,i)},_getWidthOfCharsAt:function(t,e,i,n){for(var r=0,o=0;i>o;o++)r+=this._getWidthOfCharAt(t,e,o,n);return r},_getWidthOfLine:function(t,e,i){return this._getWidthOfCharsAt(t,e,i[e].length,i)},_getTextWidth:function(t,e){if(this.isEmptyStyles())return this.callSuper("_getTextWidth",t,e);for(var i=this._getWidthOfLine(t,0,e),n=1,r=e.length;r>n;n++){var o=this._getWidthOfLine(t,n,e);o>i&&(i=o)}return i},_getHeightOfLine:function(t,e,i){i=i||this.text.split(this._reNewline);for(var n=this._getHeightOfChar(t,i[e][0],e,0),r=i[e],o=r.split(""),s=1,a=o.length;a>s;s++){var c=this._getHeightOfChar(t,o[s],e,s);c>n&&(n=c)}return n*this.lineHeight},_getTextHeight:function(t,e){for(var i=0,n=0,r=e.length;r>n;n++)i+=this._getHeightOfLine(t,n,e);return i},_getTopOffset:function(){var t=fabric.Text.prototype._getTopOffset.call(this);return t-this.fontSize/this._fontSizeFraction},_renderTextBoxBackground:function(t){this.backgroundColor&&(t.save(),t.fillStyle=this.backgroundColor,t.fillRect(this._getLeftOffset(),this._getTopOffset()+this.fontSize/this._fontSizeFraction,this.width,this.height),t.restore())},toObject:function(e){return fabric.util.object.extend(this.callSuper("toObject",e),{styles:t(this.styles)})}}),fabric.IText.fromObject=function(e){return new fabric.IText(e.text,t(e))},fabric.IText.instances=[]}(),function(){var t=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initCursorSelectionHandlers(),this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var t=this;setTimeout(function(){t.selected=!0},100),this.canvas&&!this.canvas._hasITextHandlers&&(this._initCanvasHandlers(),this.canvas._hasITextHandlers=!0)})},_initCanvasHandlers:function(){this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers.call()}),this.canvas.on("mouse:up",function(){fabric.IText.instances.forEach(function(t){t.__isMousedown=!1})}),this.canvas.on("object:selected",function(t){fabric.IText.prototype.exitEditingOnOthers.call(t.target)})},_tick:function(){var t=this;this._abortCursorAnimation||this.animate("_currentCursorOpacity",1,{duration:this.cursorDuration,onComplete:function(){t._onTickComplete()},onChange:function(){t.canvas&&t.canvas.renderAll()},abort:function(){return t._abortCursorAnimation}})},_onTickComplete:function(){if(!this._abortCursorAnimation){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){t._tick()},onChange:function(){t.canvas&&t.canvas.renderAll()},abort:function(){return t._abortCursorAnimation}})},100)}},initDelayedCursor:function(t){var e=this,i=t?0:this.cursorDelay;t&&(this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&this.canvas.renderAll()),this._cursorTimeout2&&clearTimeout(this._cursorTimeout2),this._cursorTimeout2=setTimeout(function(){e._abortCursorAnimation=!1,e._tick()},i)},abortCursorAnimation:function(){this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,this.canvas&&this.canvas.renderAll();var t=this;setTimeout(function(){t._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0,this.selectionEnd=this.text.length,this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(t){var e=0,i=t-1;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i--;for(;/\S/.test(this.text.charAt(i))&&i>-1;)e++,i--;return t-e},findWordBoundaryRight:function(t){var e=0,i=t;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i++;for(;/\S/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},findLineBoundaryLeft:function(t){for(var e=0,i=t-1;!/\n/.test(this.text.charAt(i))&&i>-1;)e++,i--;return t-e},findLineBoundaryRight:function(t){for(var e=0,i=t;!/\n/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},getNumNewLinesInSelectedText:function(){for(var t=this.getSelectedText(),e=0,i=0,n=t.split(""),r=n.length;r>i;i++)"\n"===n[i]&&e++;return e},searchWordBoundary:function(t,e){for(var i=this._reSpace.test(this.text.charAt(t))?t-1:t,n=this.text.charAt(i),r=/[ \n\.,;!\?\-]/;!r.test(n)&&i>0&&i<this.text.length;)i+=e,n=this.text.charAt(i);return r.test(n)&&"\n"!==n&&(i+=1===e?0:1),i},selectWord:function(t){var e=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.setSelectionStart(e),this.setSelectionEnd(i),this.initDelayedCursor(!0)},selectLine:function(t){var e=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);this.setSelectionStart(e),this.setSelectionEnd(i),this.initDelayedCursor(!0)},enterEditing:function(){return!this.isEditing&&this.editable?(this.exitEditingOnOthers(),this.isEditing=!0,this.initHiddenTextarea(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),this.canvas&&this.canvas.fire("text:editing:entered",{target:this}),this):void 0},exitEditingOnOthers:function(){fabric.IText.instances.forEach(function(t){t.selected=!1,t.isEditing&&t.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){var t=this.text.split(this._reNewline);for(var e in this.styles)t[e]||delete this.styles[e]},_removeCharsFromTo:function(t,e){for(var i=e;i!==t;){var n=this.get2DCursorLocation(i).charIndex;i--;var r=this.get2DCursorLocation(i).charIndex,o=r>n;o?this.removeStyleObject(o,i+1):this.removeStyleObject(0===this.get2DCursorLocation(i).charIndex,i)}this.text=this.text.slice(0,t)+this.text.slice(e)},insertChars:function(t){var e="\n"===this.text.slice(this.selectionStart,this.selectionStart+1);this.text=this.text.slice(0,this.selectionStart)+t+this.text.slice(this.selectionEnd),this.selectionStart===this.selectionEnd&&this.insertStyleObjects(t,e,this.copiedStyles),this.selectionStart+=t.length,this.selectionEnd=this.selectionStart,this.canvas&&this.canvas.renderAll().renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(e,i,n){this.shiftLineStyles(e,1),this.styles[e+1]||(this.styles[e+1]={});var r=this.styles[e][i-1],o={};if(n)o[0]=t(r),this.styles[e+1]=o;else{for(var s in this.styles[e])parseInt(s,10)>=i&&(o[parseInt(s,10)-i]=this.styles[e][s],delete this.styles[e][s]);this.styles[e+1]=o}},insertCharStyleObject:function(e,i,n){var r=this.styles[e],o=t(r);0!==i||n||(i=1);for(var s in o){var a=parseInt(s,10);a>=i&&(r[a+1]=o[a])}this.styles[e][i]=n||t(r[i-1])},insertStyleObjects:function(t,e,i){if(!this.isEmptyStyles()){var n=this.get2DCursorLocation(),r=n.lineIndex,o=n.charIndex;this.styles[r]||(this.styles[r]={}),"\n"===t?this.insertNewlineStyleObject(r,o,e):i?this._insertStyles(i):this.insertCharStyleObject(r,o)}},_insertStyles:function(t){for(var e=0,i=t.length;i>e;e++){var n=this.get2DCursorLocation(this.selectionStart+e),r=n.lineIndex,o=n.charIndex;this.insertCharStyleObject(r,o,t[e])}},shiftLineStyles:function(e,i){var n=t(this.styles);for(var r in this.styles){var o=parseInt(r,10);o>e&&(this.styles[o+i]=n[o])}},removeStyleObject:function(e,i){var n=this.get2DCursorLocation(i),r=n.lineIndex,o=n.charIndex;if(e){var s=this.text.split(this._reNewline),a=s[r-1],c=a?a.length:0;this.styles[r-1]||(this.styles[r-1]={});for(o in this.styles[r])this.styles[r-1][parseInt(o,10)+c]=this.styles[r][o];this.shiftLineStyles(r,-1)}else{var l=this.styles[r];if(l){var h=this.selectionStart===this.selectionEnd?-1:0;delete l[o+h]}var u=t(l);for(var d in u){var f=parseInt(d,10);f>=o&&0!==f&&(l[f-1]=u[f],delete l[f])}}},insertNewline:function(){this.insertChars("\n")}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(t){this.__newClickTime=+new Date;var e=this.canvas.getPointer(t.e);this.isTripleClick(e)?(this.fire("tripleclick",t),this._stopEvent(t.e)):this.isDoubleClick(e)&&(this.fire("dblclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y&&this.__lastIsEditing},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMousemoveHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(t){this.selectWord(this.getSelectionStartFromPointer(t.e))}),this.on("tripleclick",function(t){this.selectLine(this.getSelectionStartFromPointer(t.e))})},initMousedownHandler:function(){this.on("mousedown",function(t){var e=this.canvas.getPointer(t.e);this.__mousedownX=e.x,this.__mousedownY=e.y,this.__isMousedown=!0,this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea),this.selected&&this.setCursorByClick(t.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},initMousemoveHandler:function(){this.on("mousemove",function(t){if(this.__isMousedown&&this.isEditing){var e=this.getSelectionStartFromPointer(t.e);e>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),this.setSelectionEnd(e)):(this.setSelectionStart(e),this.setSelectionEnd(this.__selectionStartOnMouseDown))}})},_isObjectMoved:function(t){var e=this.canvas.getPointer(t);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.on("mouseup",function(t){this.__isMousedown=!1,this._isObjectMoved(t.e)||(this.selected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t);t.shiftKey?e<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(e)):this.setSelectionEnd(e):(this.setSelectionStart(e),this.setSelectionEnd(e))},_getLocalRotatedPointer:function(t){var e=this.canvas.getPointer(t),i=new fabric.Point(e.x,e.y),n=new fabric.Point(this.left,this.top),r=fabric.util.rotatePoint(i,n,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(t,r)},getSelectionStartFromPointer:function(t){for(var e,i=this._getLocalRotatedPointer(t),n=this.text.split(this._reNewline),r=0,o=0,s=0,a=0,c=0,l=n.length;l>c;c++){s+=this._getHeightOfLine(this.ctx,c)*this.scaleY;var h=this._getWidthOfLine(this.ctx,c,n),u=this._getLineLeftOffset(h);o=u*this.scaleX,this.flipX&&(n[c]=n[c].split("").reverse().join(""));for(var d=0,f=n[c].length;f>d;d++){var p=n[c][d];if(r=o,o+=this._getWidthOfChar(this.ctx,p,c,this.flipX?f-d:d)*this.scaleX,!(s<=i.y||o<=i.x))return this._getNewSelectionStartFromOffset(i,r,o,a+c,f);a++}if(i.y<s)return this._getNewSelectionStartFromOffset(i,r,o,a+c,f,d)}return"undefined"==typeof e?this.text.length:void 0},_getNewSelectionStartFromOffset:function(t,e,i,n,r,o){var s=t.x-e,a=i-t.x,c=a>s?0:1,l=n+c;return this.flipX&&(l=r-l),l>this.text.length&&(l=this.text.length),o===r&&l--,l}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.style.cssText="position: absolute; top: 0; left: -9999px",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",13:"insertNewline",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",67:"copy",86:"paste",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing){if(t.keyCode in this._keysMap)this[this._keysMap[t.keyCode]](t);else{if(!(t.keyCode in this._ctrlKeysMap&&(t.ctrlKey||t.metaKey)))return;this[this._ctrlKeysMap[t.keyCode]](t)}t.preventDefault(),t.stopPropagation(),this.canvas&&this.canvas.renderAll()}},forwardDelete:function(t){this.selectionStart===this.selectionEnd&&this.moveCursorRight(t),this.removeChars(t)},copy:function(){var t=this.getSelectedText();this.copiedText=t,this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(){this.copiedText&&this.insertChars(this.copiedText)},cut:function(t){this.copy(),this.removeChars(t)},onKeyPress:function(t){!this.isEditing||t.metaKey||t.ctrlKey||8===t.keyCode||13===t.keyCode||(this.insertChars(String.fromCharCode(t.which)),t.preventDefault(),t.stopPropagation())},getDownCursorOffset:function(t,e){var i,n,r=e?this.selectionEnd:this.selectionStart,o=this.text.split(this._reNewline),s=this.text.slice(0,r),a=this.text.slice(r),c=s.slice(s.lastIndexOf("\n")+1),l=a.match(/(.*)\n?/)[1],h=(a.match(/.*\n(.*)\n?/)||{})[1]||"",u=this.get2DCursorLocation(r);if(u.lineIndex===o.length-1||t.metaKey)return this.text.length-r;var d=this._getWidthOfLine(this.ctx,u.lineIndex,o);n=this._getLineLeftOffset(d);for(var f=n,p=u.lineIndex,g=0,m=c.length;m>g;g++)i=c[g],f+=this._getWidthOfChar(this.ctx,i,p,g);var v=this._getIndexOnNextLine(u,h,f,o);return l.length+1+v},_getIndexOnNextLine:function(t,e,i,n){for(var r,o=t.lineIndex+1,s=this._getWidthOfLine(this.ctx,o,n),a=this._getLineLeftOffset(s),c=a,l=0,h=0,u=e.length;u>h;h++){var d=e[h],f=this._getWidthOfChar(this.ctx,d,o,h);if(c+=f,c>i){r=!0;var p=c-f,g=c,m=Math.abs(p-i),v=Math.abs(g-i);l=m>v?h+1:h;break}}return r||(l=e.length),l},moveCursorDown:function(t){this.abortCursorAnimation(),this._currentCursorOpacity=1;var e=this.getDownCursorOffset(t,"right"===this._selectionDirection);t.shiftKey?this.moveCursorDownWithShift(e):this.moveCursorDownWithoutShift(e),this.initDelayedCursor()},moveCursorDownWithoutShift:function(t){this._selectionDirection="right",this.selectionStart+=t,this.selectionStart>this.text.length&&(this.selectionStart=this.text.length),this.selectionEnd=this.selectionStart},moveCursorDownWithShift:function(t){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?(this.selectionStart+=t,void(this._selectionDirection="left")):(this._selectionDirection="right",this.selectionEnd+=t,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length),void 0)},getUpCursorOffset:function(t,e){var i=e?this.selectionEnd:this.selectionStart,n=this.get2DCursorLocation(i);if(0===n.lineIndex||t.metaKey)return i;for(var r,o=this.text.slice(0,i),s=o.slice(o.lastIndexOf("\n")+1),a=(o.match(/\n?(.*)\n.*$/)||{})[1]||"",c=this.text.split(this._reNewline),l=this._getWidthOfLine(this.ctx,n.lineIndex,c),h=this._getLineLeftOffset(l),u=h,d=n.lineIndex,f=0,p=s.length;p>f;f++)r=s[f],u+=this._getWidthOfChar(this.ctx,r,d,f);var g=this._getIndexOnPrevLine(n,a,u,c);return a.length-g+s.length},_getIndexOnPrevLine:function(t,e,i,n){for(var r,o=t.lineIndex-1,s=this._getWidthOfLine(this.ctx,o,n),a=this._getLineLeftOffset(s),c=a,l=0,h=0,u=e.length;u>h;h++){var d=e[h],f=this._getWidthOfChar(this.ctx,d,o,h);if(c+=f,c>i){r=!0;var p=c-f,g=c,m=Math.abs(p-i),v=Math.abs(g-i);l=m>v?h:h-1;break}}return r||(l=e.length-1),l},moveCursorUp:function(t){this.abortCursorAnimation(),this._currentCursorOpacity=1;var e=this.getUpCursorOffset(t,"right"===this._selectionDirection);t.shiftKey?this.moveCursorUpWithShift(e):this.moveCursorUpWithoutShift(e),this.initDelayedCursor()},moveCursorUpWithShift:function(t){if(this.selectionStart===this.selectionEnd)this.selectionStart-=t;else{if("right"===this._selectionDirection)return this.selectionEnd-=t,void(this._selectionDirection="right");this.selectionStart-=t}this.selectionStart<0&&(this.selectionStart=0),this._selectionDirection="left"},moveCursorUpWithoutShift:function(t){this.selectionStart===this.selectionEnd&&(this.selectionStart-=t),this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd=this.selectionStart,this._selectionDirection="left"},moveCursorLeft:function(t){(0!==this.selectionStart||0!==this.selectionEnd)&&(this.abortCursorAnimation(),this._currentCursorOpacity=1,t.shiftKey?this.moveCursorLeftWithShift(t):this.moveCursorLeftWithoutShift(t),this.initDelayedCursor())},_move:function(t,e,i){t.altKey?this[e]=this["findWordBoundary"+i](this[e]):t.metaKey?this[e]=this["findLineBoundary"+i](this[e]):this[e]+="Left"===i?-1:1},_moveLeft:function(t,e){this._move(t,e,"Left")},_moveRight:function(t,e){this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this._moveLeft(t,"selectionStart"),this.selectionEnd=this.selectionStart},moveCursorLeftWithShift:function(t){"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(t,"selectionStart"),"\n"===this.text.charAt(this.selectionStart)&&this.selectionStart--,this.selectionStart<0&&(this.selectionStart=0))},moveCursorRight:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,t.shiftKey?this.moveCursorRightWithShift(t):this.moveCursorRightWithoutShift(t),this.initDelayedCursor())},moveCursorRightWithShift:function(t){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):(this._selectionDirection="right",this._moveRight(t,"selectionEnd"),"\n"===this.text.charAt(this.selectionEnd-1)&&this.selectionEnd++,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length))},moveCursorRightWithoutShift:function(t){this._selectionDirection="right",this.selectionStart===this.selectionEnd?(this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):(this.selectionEnd+=this.getNumNewLinesInSelectedText(),this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length),this.selectionStart=this.selectionEnd)},removeChars:function(t){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(t):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.selectionEnd=this.selectionStart,this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll().renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(t){if(0!==this.selectionStart)if(t.metaKey){var e=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(e,this.selectionStart),this.selectionStart=e}else if(t.altKey){var i=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(i,this.selectionStart),this.selectionStart=i}else{var n="\n"===this.text.slice(this.selectionStart-1,this.selectionStart);this.removeStyleObject(n),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)}}}),fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(t,e,i,n,r,o){this.styles[e]?this._setSVGTextLineChars(t,e,i,n,r,o):this.callSuper("_setSVGTextLineText",t,e,i,n,r)},_setSVGTextLineChars:function(t,e,i,n,r,o){for(var s=0===e||this.useNative?"y":"dy",a=t.split(""),c=0,l=this._getSVGLineLeftOffset(e),h=this._getSVGLineTopOffset(e),u=this._getHeightOfLine(this.ctx,e),d=0,f=a.length;f>d;d++){var p=this.styles[e][d]||{};i.push(this._createTextCharSpan(a[d],p,l,h,s,c));var g=this._getWidthOfChar(this.ctx,a[d],e,d);p.textBackgroundColor&&o.push(this._createTextCharBg(p,l,h,u,g,c)),c+=g}},_getSVGLineLeftOffset:function(t){return this._boundaries&&this._boundaries[t]?fabric.util.toFixed(this._boundaries[t].left,2):0},_getSVGLineTopOffset:function(t){for(var e=0,i=0;t>=i;i++)e+=this._getHeightOfLine(this.ctx,i);return e-this.height/2},_createTextCharBg:function(t,e,i,n,r,o){return['<rect fill="',t.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+n,")",'" x="',e+o,'" y="',i+n,'" width="',r,'" height="',n,'"></rect>'].join("")},_createTextCharSpan:function(t,e,i,n,r,o){var s=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},e));return['<tspan x="',i+o,'" ',r,'="',n,'" ',e.fontFamily?'font-family="'+e.fontFamily.replace(/"/g,"'")+'" ':"",e.fontSize?'font-size="'+e.fontSize+'" ':"",e.fontStyle?'font-style="'+e.fontStyle+'" ':"",e.fontWeight?'font-weight="'+e.fontWeight+'" ':"",e.textDecoration?'text-decoration="'+e.textDecoration+'" ':"",'style="',s,'">',fabric.util.string.escapeXml(t),"</tspan>"].join("")}}),function(){function request(t,e,i){var n=URL.parse(t);n.port||(n.port=0===n.protocol.indexOf("https:")?443:80);var r=443===n.port?HTTPS:HTTP,o=r.request({hostname:n.hostname,port:n.port,path:n.path,method:"GET"},function(t){var n="";e&&t.setEncoding(e),t.on("end",function(){i(n)}),t.on("data",function(e){200===t.statusCode&&(n+=e)})});o.on("error",function(t){fabric.log(t.errno===process.ECONNREFUSED?"ECONNREFUSED: connection refused to "+n.hostname+":"+n.port:t.message)}),o.end()}function requestFs(t,e){var i=require("fs");i.readFile(t,function(t,i){if(t)throw fabric.log(t),t;e(i)})}if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(t,e,i){function n(n){r.src=new Buffer(n,"binary"),r._src=t,e&&e.call(i,r)}var r=new Image;t&&(t instanceof Buffer||0===t.indexOf("data"))?(r.src=r._src=t,e&&e.call(i,r)):t&&0!==t.indexOf("http")?requestFs(t,n):t?request(t,"binary",n):e&&e.call(i,t)},fabric.loadSVGFromURL=function(t,e,i){t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),0!==t.indexOf("http")?requestFs(t,function(t){fabric.loadSVGFromString(t.toString(),e,i)}):request(t,"",function(t){fabric.loadSVGFromString(t,e,i)})},fabric.loadSVGFromString=function(t,e,i){var n=(new DOMParser).parseFromString(t);fabric.parseSVGDocument(n.documentElement,function(t,i){e&&e(t,i)},i)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.Image.fromObject=function(t,e){fabric.util.loadImage(t.src,function(i){var n=new fabric.Image(i);n._initConfig(t),n._initFilters(t,function(t){n.filters=t||[],e&&e(n)})})},fabric.createCanvasForNode=function(t,e,i,n){n=n||i;var r=fabric.document.createElement("canvas"),o=new Canvas(t||600,e||600,n);r.style={},r.width=o.width,r.height=o.height;var s=fabric.Canvas||fabric.StaticCanvas,a=new s(r,i);return a.contextContainer=o.getContext("2d"),a.nodeCanvas=o,a.Font=Canvas.Font,a},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(t){return this.nodeCanvas.createJPEGStream(t)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(t){return origSetWidth.call(this,t),this.nodeCanvas.width=t,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(t){return origSetHeight.call(this,t),this.nodeCanvas.height=t,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}(),define("fabric",function(){}),"undefined"==typeof jQuery)throw new Error("Bootstrap requires jQuery");+function(t){function e(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}t.fn.emulateTransitionEnd=function(e){var i=!1,n=this;t(this).one(t.support.transition.end,function(){i=!0});var r=function(){i||t(n).trigger(t.support.transition.end)};return setTimeout(r,e),this},t(function(){t.support.transition=e()})}(jQuery),+function(t){var e='[data-dismiss="alert"]',i=function(i){t(i).on("click",e,this.close)};i.prototype.close=function(e){function i(){o.trigger("closed.bs.alert").remove()}var n=t(this),r=n.attr("data-target");r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));var o=t(r);e&&e.preventDefault(),o.length||(o=n.hasClass("alert")?n:n.parent()),o.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(o.removeClass("in"),t.support.transition&&o.hasClass("fade")?o.one(t.support.transition.end,i).emulateTransitionEnd(150):i())};var n=t.fn.alert;t.fn.alert=function(e){return this.each(function(){var n=t(this),r=n.data("bs.alert");r||n.data("bs.alert",r=new i(this)),"string"==typeof e&&r[e].call(n)})},t.fn.alert.Constructor=i,t.fn.alert.noConflict=function(){return t.fn.alert=n,this},t(document).on("click.bs.alert.data-api",e,i.prototype.close)}(jQuery),+function(t){var e=function(i,n){this.$element=t(i),this.options=t.extend({},e.DEFAULTS,n),this.isLoading=!1};e.DEFAULTS={loadingText:"loading..."},e.prototype.setState=function(e){var i="disabled",n=this.$element,r=n.is("input")?"val":"html",o=n.data();e+="Text",o.resetText||n.data("resetText",n[r]()),n[r](o[e]||this.options[e]),setTimeout(t.proxy(function(){"loadingText"==e?(this.isLoading=!0,n.addClass(i).attr(i,i)):this.isLoading&&(this.isLoading=!1,n.removeClass(i).removeAttr(i))},this),0)},e.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var i=this.$element.find("input");"radio"==i.prop("type")&&(i.prop("checked")&&this.$element.hasClass("active")?t=!1:e.find(".active").removeClass("active")),t&&i.prop("checked",!this.$element.hasClass("active")).trigger("change")}t&&this.$element.toggleClass("active")};var i=t.fn.button;t.fn.button=function(i){return this.each(function(){var n=t(this),r=n.data("bs.button"),o="object"==typeof i&&i;r||n.data("bs.button",r=new e(this,o)),"toggle"==i?r.toggle():i&&r.setState(i)})},t.fn.button.Constructor=e,t.fn.button.noConflict=function(){return t.fn.button=i,this},t(document).on("click.bs.button.data-api","[data-toggle^=button]",function(e){var i=t(e.target);i.hasClass("btn")||(i=i.closest(".btn")),i.button("toggle"),e.preventDefault()})}(jQuery),+function(t){var e=function(e,i){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=i,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter",t.proxy(this.pause,this)).on("mouseleave",t.proxy(this.cycle,this))};e.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},e.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},e.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},e.prototype.to=function(e){var i=this,n=this.getActiveIndex();return e>this.$items.length-1||0>e?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){i.to(e)}):n==e?this.pause().cycle():this.slide(e>n?"next":"prev",t(this.$items[e]))},e.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},e.prototype.next=function(){return this.sliding?void 0:this.slide("next")},e.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},e.prototype.slide=function(e,i){var n=this.$element.find(".item.active"),r=i||n[e](),o=this.interval,s="next"==e?"left":"right",a="next"==e?"first":"last",c=this;if(!r.length){if(!this.options.wrap)return;r=this.$element.find(".item")[a]()}if(r.hasClass("active"))return this.sliding=!1;var l=t.Event("slide.bs.carousel",{relatedTarget:r[0],direction:s});return this.$element.trigger(l),l.isDefaultPrevented()?void 0:(this.sliding=!0,o&&this.pause(),this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid.bs.carousel",function(){var e=t(c.$indicators.children()[c.getActiveIndex()]);e&&e.addClass("active")})),t.support.transition&&this.$element.hasClass("slide")?(r.addClass(e),r[0].offsetWidth,n.addClass(s),r.addClass(s),n.one(t.support.transition.end,function(){r.removeClass([e,s].join(" ")).addClass("active"),n.removeClass(["active",s].join(" ")),c.sliding=!1,setTimeout(function(){c.$element.trigger("slid.bs.carousel")},0)}).emulateTransitionEnd(1e3*n.css("transition-duration").slice(0,-1))):(n.removeClass("active"),r.addClass("active"),this.sliding=!1,this.$element.trigger("slid.bs.carousel")),o&&this.cycle(),this)};var i=t.fn.carousel;
t.fn.carousel=function(i){return this.each(function(){var n=t(this),r=n.data("bs.carousel"),o=t.extend({},e.DEFAULTS,n.data(),"object"==typeof i&&i),s="string"==typeof i?i:o.slide;r||n.data("bs.carousel",r=new e(this,o)),"number"==typeof i?r.to(i):s?r[s]():o.interval&&r.pause().cycle()})},t.fn.carousel.Constructor=e,t.fn.carousel.noConflict=function(){return t.fn.carousel=i,this},t(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(e){var i,n=t(this),r=t(n.attr("data-target")||(i=n.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"")),o=t.extend({},r.data(),n.data()),s=n.attr("data-slide-to");s&&(o.interval=!1),r.carousel(o),(s=n.attr("data-slide-to"))&&r.data("bs.carousel").to(s),e.preventDefault()}),t(window).on("load",function(){t('[data-ride="carousel"]').each(function(){var e=t(this);e.carousel(e.data())})})}(jQuery),+function(t){var e=function(i,n){this.$element=t(i),this.options=t.extend({},e.DEFAULTS,n),this.transitioning=null,this.options.parent&&(this.$parent=t(this.options.parent)),this.options.toggle&&this.toggle()};e.DEFAULTS={toggle:!0},e.prototype.dimension=function(){var t=this.$element.hasClass("width");return t?"width":"height"},e.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e=t.Event("show.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var i=this.$parent&&this.$parent.find("> .panel > .in");if(i&&i.length){var n=i.data("bs.collapse");if(n&&n.transitioning)return;i.collapse("hide"),n||i.data("bs.collapse",null)}var r=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[r](0),this.transitioning=1;var o=function(){this.$element.removeClass("collapsing").addClass("collapse in")[r]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return o.call(this);var s=t.camelCase(["scroll",r].join("-"));this.$element.one(t.support.transition.end,t.proxy(o,this)).emulateTransitionEnd(350)[r](this.$element[0][s])}}},e.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var i=this.dimension();this.$element[i](this.$element[i]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var n=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return t.support.transition?void this.$element[i](0).one(t.support.transition.end,t.proxy(n,this)).emulateTransitionEnd(350):n.call(this)}}},e.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var i=t.fn.collapse;t.fn.collapse=function(i){return this.each(function(){var n=t(this),r=n.data("bs.collapse"),o=t.extend({},e.DEFAULTS,n.data(),"object"==typeof i&&i);!r&&o.toggle&&"show"==i&&(i=!i),r||n.data("bs.collapse",r=new e(this,o)),"string"==typeof i&&r[i]()})},t.fn.collapse.Constructor=e,t.fn.collapse.noConflict=function(){return t.fn.collapse=i,this},t(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(e){var i,n=t(this),r=n.attr("data-target")||e.preventDefault()||(i=n.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,""),o=t(r),s=o.data("bs.collapse"),a=s?"toggle":n.data(),c=n.attr("data-parent"),l=c&&t(c);s&&s.transitioning||(l&&l.find('[data-toggle=collapse][data-parent="'+c+'"]').not(n).addClass("collapsed"),n[o.hasClass("in")?"addClass":"removeClass"]("collapsed")),o.collapse(a)})}(jQuery),+function(t){function e(e){t(n).remove(),t(r).each(function(){var n=i(t(this)),r={relatedTarget:this};n.hasClass("open")&&(n.trigger(e=t.Event("hide.bs.dropdown",r)),e.isDefaultPrevented()||n.removeClass("open").trigger("hidden.bs.dropdown",r))})}function i(e){var i=e.attr("data-target");i||(i=e.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var n=i&&t(i);return n&&n.length?n:e.parent()}var n=".dropdown-backdrop",r="[data-toggle=dropdown]",o=function(e){t(e).on("click.bs.dropdown",this.toggle)};o.prototype.toggle=function(n){var r=t(this);if(!r.is(".disabled, :disabled")){var o=i(r),s=o.hasClass("open");if(e(),!s){"ontouchstart"in document.documentElement&&!o.closest(".navbar-nav").length&&t('<div class="dropdown-backdrop"/>').insertAfter(t(this)).on("click",e);var a={relatedTarget:this};if(o.trigger(n=t.Event("show.bs.dropdown",a)),n.isDefaultPrevented())return;o.toggleClass("open").trigger("shown.bs.dropdown",a),r.focus()}return!1}},o.prototype.keydown=function(e){if(/(38|40|27)/.test(e.keyCode)){var n=t(this);if(e.preventDefault(),e.stopPropagation(),!n.is(".disabled, :disabled")){var o=i(n),s=o.hasClass("open");if(!s||s&&27==e.keyCode)return 27==e.which&&o.find(r).focus(),n.click();var a=" li:not(.divider):visible a",c=o.find("[role=menu]"+a+", [role=listbox]"+a);if(c.length){var l=c.index(c.filter(":focus"));38==e.keyCode&&l>0&&l--,40==e.keyCode&&l<c.length-1&&l++,~l||(l=0),c.eq(l).focus()}}}};var s=t.fn.dropdown;t.fn.dropdown=function(e){return this.each(function(){var i=t(this),n=i.data("bs.dropdown");n||i.data("bs.dropdown",n=new o(this)),"string"==typeof e&&n[e].call(i)})},t.fn.dropdown.Constructor=o,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=s,this},t(document).on("click.bs.dropdown.data-api",e).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",r,o.prototype.toggle).on("keydown.bs.dropdown.data-api",r+", [role=menu], [role=listbox]",o.prototype.keydown)}(jQuery),+function(t){var e=function(e,i){this.options=i,this.$element=t(e),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};e.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},e.prototype.toggle=function(t){return this[this.isShown?"hide":"show"](t)},e.prototype.show=function(e){var i=this,n=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.backdrop(function(){var n=t.support.transition&&i.$element.hasClass("fade");i.$element.parent().length||i.$element.appendTo(document.body),i.$element.show().scrollTop(0),n&&i.$element[0].offsetWidth,i.$element.addClass("in").attr("aria-hidden",!1),i.enforceFocus();var r=t.Event("shown.bs.modal",{relatedTarget:e});n?i.$element.find(".modal-dialog").one(t.support.transition.end,function(){i.$element.focus().trigger(r)}).emulateTransitionEnd(300):i.$element.focus().trigger(r)}))},e.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one(t.support.transition.end,t.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},e.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.focus()},this))},e.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},e.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.removeBackdrop(),t.$element.trigger("hidden.bs.modal")})},e.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},e.prototype.backdrop=function(e){var i=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var n=t.support.transition&&i;if(this.$backdrop=t('<div class="modal-backdrop '+i+'" />').appendTo(document.body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),n&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;n?this.$backdrop.one(t.support.transition.end,e).emulateTransitionEnd(150):e()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(t.support.transition.end,e).emulateTransitionEnd(150):e()):e&&e()};var i=t.fn.modal;t.fn.modal=function(i,n){return this.each(function(){var r=t(this),o=r.data("bs.modal"),s=t.extend({},e.DEFAULTS,r.data(),"object"==typeof i&&i);o||r.data("bs.modal",o=new e(this,s)),"string"==typeof i?o[i](n):s.show&&o.show(n)})},t.fn.modal.Constructor=e,t.fn.modal.noConflict=function(){return t.fn.modal=i,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(e){var i=t(this),n=i.attr("href"),r=t(i.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),o=r.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(n)&&n},r.data(),i.data());i.is("a")&&e.preventDefault(),r.modal(o,this).one("hide",function(){i.is(":visible")&&i.focus()})}),t(document).on("show.bs.modal",".modal",function(){t(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){t(document.body).removeClass("modal-open")})}(jQuery),+function(t){var e=function(t,e){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",t,e)};e.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},e.prototype.init=function(e,i,n){this.enabled=!0,this.type=e,this.$element=t(i),this.options=this.getOptions(n);for(var r=this.options.trigger.split(" "),o=r.length;o--;){var s=r[o];if("click"==s)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=s){var a="hover"==s?"mouseenter":"focusin",c="hover"==s?"mouseleave":"focusout";this.$element.on(a+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(c+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},e.prototype.getDefaults=function(){return e.DEFAULTS},e.prototype.getOptions=function(e){return e=t.extend({},this.getDefaults(),this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},e.prototype.getDelegateOptions=function(){var e={},i=this.getDefaults();return this._options&&t.each(this._options,function(t,n){i[t]!=n&&(e[t]=n)}),e},e.prototype.enter=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(i.timeout),i.hoverState="in",i.options.delay&&i.options.delay.show?void(i.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show)):i.show()},e.prototype.leave=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(i.timeout),i.hoverState="out",i.options.delay&&i.options.delay.hide?void(i.timeout=setTimeout(function(){"out"==i.hoverState&&i.hide()},i.options.delay.hide)):i.hide()},e.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(e),e.isDefaultPrevented())return;var i=this,n=this.tip();this.setContent(),this.options.animation&&n.addClass("fade");var r="function"==typeof this.options.placement?this.options.placement.call(this,n[0],this.$element[0]):this.options.placement,o=/\s?auto?\s?/i,s=o.test(r);s&&(r=r.replace(o,"")||"top"),n.detach().css({top:0,left:0,display:"block"}).addClass(r),this.options.container?n.appendTo(this.options.container):n.insertAfter(this.$element);var a=this.getPosition(),c=n[0].offsetWidth,l=n[0].offsetHeight;if(s){var h=this.$element.parent(),u=r,d=document.documentElement.scrollTop||document.body.scrollTop,f="body"==this.options.container?window.innerWidth:h.outerWidth(),p="body"==this.options.container?window.innerHeight:h.outerHeight(),g="body"==this.options.container?0:h.offset().left;r="bottom"==r&&a.top+a.height+l-d>p?"top":"top"==r&&a.top-d-l<0?"bottom":"right"==r&&a.right+c>f?"left":"left"==r&&a.left-c<g?"right":r,n.removeClass(u).addClass(r)}var m=this.getCalculatedOffset(r,a,c,l);this.applyPlacement(m,r),this.hoverState=null;var v=function(){i.$element.trigger("shown.bs."+i.type)};t.support.transition&&this.$tip.hasClass("fade")?n.one(t.support.transition.end,v).emulateTransitionEnd(150):v()}},e.prototype.applyPlacement=function(e,i){var n,r=this.tip(),o=r[0].offsetWidth,s=r[0].offsetHeight,a=parseInt(r.css("margin-top"),10),c=parseInt(r.css("margin-left"),10);isNaN(a)&&(a=0),isNaN(c)&&(c=0),e.top=e.top+a,e.left=e.left+c,t.offset.setOffset(r[0],t.extend({using:function(t){r.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),r.addClass("in");var l=r[0].offsetWidth,h=r[0].offsetHeight;if("top"==i&&h!=s&&(n=!0,e.top=e.top+s-h),/bottom|top/.test(i)){var u=0;e.left<0&&(u=-2*e.left,e.left=0,r.offset(e),l=r[0].offsetWidth,h=r[0].offsetHeight),this.replaceArrow(u-o+l,l,"left")}else this.replaceArrow(h-s,h,"top");n&&r.offset(e)},e.prototype.replaceArrow=function(t,e,i){this.arrow().css(i,t?50*(1-t/e)+"%":"")},e.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},e.prototype.hide=function(){function e(){"in"!=i.hoverState&&n.detach(),i.$element.trigger("hidden.bs."+i.type)}var i=this,n=this.tip(),r=t.Event("hide.bs."+this.type);return this.$element.trigger(r),r.isDefaultPrevented()?void 0:(n.removeClass("in"),t.support.transition&&this.$tip.hasClass("fade")?n.one(t.support.transition.end,e).emulateTransitionEnd(150):e(),this.hoverState=null,this)},e.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},e.prototype.hasContent=function(){return this.getTitle()},e.prototype.getPosition=function(){var e=this.$element[0];return t.extend({},"function"==typeof e.getBoundingClientRect?e.getBoundingClientRect():{width:e.offsetWidth,height:e.offsetHeight},this.$element.offset())},e.prototype.getCalculatedOffset=function(t,e,i,n){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-n,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-n/2,left:e.left-i}:{top:e.top+e.height/2-n/2,left:e.left+e.width}},e.prototype.getTitle=function(){var t,e=this.$element,i=this.options;return t=e.attr("data-original-title")||("function"==typeof i.title?i.title.call(e[0]):i.title)},e.prototype.tip=function(){return this.$tip=this.$tip||t(this.options.template)},e.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},e.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},e.prototype.enable=function(){this.enabled=!0},e.prototype.disable=function(){this.enabled=!1},e.prototype.toggleEnabled=function(){this.enabled=!this.enabled},e.prototype.toggle=function(e){var i=e?t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;i.tip().hasClass("in")?i.leave(i):i.enter(i)},e.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var i=t.fn.tooltip;t.fn.tooltip=function(i){return this.each(function(){var n=t(this),r=n.data("bs.tooltip"),o="object"==typeof i&&i;(r||"destroy"!=i)&&(r||n.data("bs.tooltip",r=new e(this,o)),"string"==typeof i&&r[i]())})},t.fn.tooltip.Constructor=e,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=i,this}}(jQuery),+function(t){var e=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");e.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),e.prototype=t.extend({},t.fn.tooltip.Constructor.prototype),e.prototype.constructor=e,e.prototype.getDefaults=function(){return e.DEFAULTS},e.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),i=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content")[this.options.html?"string"==typeof i?"html":"append":"text"](i),t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},e.prototype.hasContent=function(){return this.getTitle()||this.getContent()},e.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},e.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},e.prototype.tip=function(){return this.$tip||(this.$tip=t(this.options.template)),this.$tip};var i=t.fn.popover;t.fn.popover=function(i){return this.each(function(){var n=t(this),r=n.data("bs.popover"),o="object"==typeof i&&i;(r||"destroy"!=i)&&(r||n.data("bs.popover",r=new e(this,o)),"string"==typeof i&&r[i]())})},t.fn.popover.Constructor=e,t.fn.popover.noConflict=function(){return t.fn.popover=i,this}}(jQuery),+function(t){function e(i,n){var r,o=t.proxy(this.process,this);this.$element=t(t(i).is("body")?window:i),this.$body=t("body"),this.$scrollElement=this.$element.on("scroll.bs.scroll-spy.data-api",o),this.options=t.extend({},e.DEFAULTS,n),this.selector=(this.options.target||(r=t(i).attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.offsets=t([]),this.targets=t([]),this.activeTarget=null,this.refresh(),this.process()}e.DEFAULTS={offset:10},e.prototype.refresh=function(){var e=this.$element[0]==window?"offset":"position";this.offsets=t([]),this.targets=t([]);var i=this;this.$body.find(this.selector).map(function(){var n=t(this),r=n.data("target")||n.attr("href"),o=/^#./.test(r)&&t(r);return o&&o.length&&o.is(":visible")&&[[o[e]().top+(!t.isWindow(i.$scrollElement.get(0))&&i.$scrollElement.scrollTop()),r]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){i.offsets.push(this[0]),i.targets.push(this[1])})},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=i-this.$scrollElement.height(),r=this.offsets,o=this.targets,s=this.activeTarget;if(e>=n)return s!=(t=o.last()[0])&&this.activate(t);if(s&&e<=r[0])return s!=(t=o[0])&&this.activate(t);for(t=r.length;t--;)s!=o[t]&&e>=r[t]&&(!r[t+1]||e<=r[t+1])&&this.activate(o[t])},e.prototype.activate=function(e){this.activeTarget=e,t(this.selector).parentsUntil(this.options.target,".active").removeClass("active");var i=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',n=t(i).parents("li").addClass("active");n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate.bs.scrollspy")};var i=t.fn.scrollspy;t.fn.scrollspy=function(i){return this.each(function(){var n=t(this),r=n.data("bs.scrollspy"),o="object"==typeof i&&i;r||n.data("bs.scrollspy",r=new e(this,o)),"string"==typeof i&&r[i]()})},t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=i,this},t(window).on("load",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);e.scrollspy(e.data())})})}(jQuery),+function(t){var e=function(e){this.element=t(e)};e.prototype.show=function(){var e=this.element,i=e.closest("ul:not(.dropdown-menu)"),n=e.data("target");if(n||(n=e.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var r=i.find(".active:last a")[0],o=t.Event("show.bs.tab",{relatedTarget:r});if(e.trigger(o),!o.isDefaultPrevented()){var s=t(n);this.activate(e.parent("li"),i),this.activate(s,s.parent(),function(){e.trigger({type:"shown.bs.tab",relatedTarget:r})})}}},e.prototype.activate=function(e,i,n){function r(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),e.addClass("active"),s?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu")&&e.closest("li.dropdown").addClass("active"),n&&n()}var o=i.find("> .active"),s=n&&t.support.transition&&o.hasClass("fade");s?o.one(t.support.transition.end,r).emulateTransitionEnd(150):r(),o.removeClass("in")};var i=t.fn.tab;t.fn.tab=function(i){return this.each(function(){var n=t(this),r=n.data("bs.tab");r||n.data("bs.tab",r=new e(this)),"string"==typeof i&&r[i]()})},t.fn.tab.Constructor=e,t.fn.tab.noConflict=function(){return t.fn.tab=i,this},t(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault(),t(this).tab("show")})}(jQuery),+function(t){var e=function(i,n){this.options=t.extend({},e.DEFAULTS,n),this.$window=t(window).on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(i),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};e.RESET="affix affix-top affix-bottom",e.DEFAULTS={offset:0},e.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(e.RESET).addClass("affix");var t=this.$window.scrollTop(),i=this.$element.offset();return this.pinnedOffset=i.top-t},e.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},e.prototype.checkPosition=function(){if(this.$element.is(":visible")){var i=t(document).height(),n=this.$window.scrollTop(),r=this.$element.offset(),o=this.options.offset,s=o.top,a=o.bottom;"top"==this.affixed&&(r.top+=n),"object"!=typeof o&&(a=s=o),"function"==typeof s&&(s=o.top(this.$element)),"function"==typeof a&&(a=o.bottom(this.$element));var c=null!=this.unpin&&n+this.unpin<=r.top?!1:null!=a&&r.top+this.$element.height()>=i-a?"bottom":null!=s&&s>=n?"top":!1;if(this.affixed!==c){this.unpin&&this.$element.css("top","");var l="affix"+(c?"-"+c:""),h=t.Event(l+".bs.affix");this.$element.trigger(h),h.isDefaultPrevented()||(this.affixed=c,this.unpin="bottom"==c?this.getPinnedOffset():null,this.$element.removeClass(e.RESET).addClass(l).trigger(t.Event(l.replace("affix","affixed"))),"bottom"==c&&this.$element.offset({top:i-a-this.$element.height()}))}}};var i=t.fn.affix;t.fn.affix=function(i){return this.each(function(){var n=t(this),r=n.data("bs.affix"),o="object"==typeof i&&i;r||n.data("bs.affix",r=new e(this,o)),"string"==typeof i&&r[i]()})},t.fn.affix.Constructor=e,t.fn.affix.noConflict=function(){return t.fn.affix=i,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var e=t(this),i=e.data();i.offset=i.offset||{},i.offsetBottom&&(i.offset.bottom=i.offsetBottom),i.offsetTop&&(i.offset.top=i.offsetTop),e.affix(i)})})}(jQuery),define("bootstrap",["jquery"],function(){}),define("storm.palettes",["storm","storm.main","storm.ui","storm.util","math.util","board.mouse","underscore"],function(t,e,i,n,r,o,s){return{registerpalette:function(e,i){t.palette[e]=i},createAllPallettes:function(t){var e,i=[];for(e in t)i.push({name:e,order:t[e].order});i.sort(function(t,e){return t.order-e.order});for(var n=0;n<i.length;n++)this.createPallette(i[n].name);this.turnOnPalettes()},turnOnPalettes:function(){this.turnOffPalettes(),$(".shape-holder").on("click",function(){var e,r,s=$(this);if($(".load-text-box").hide(),null!=s){if(e=$(s).data().shape,i.resetShapeSelection(),$(s).addClass("shape-selected"),t.$currShape=s,canvas.isSelectMode=!1,canvas.isDrawingMode=!1,t.action=e,"math"==t.action)return!1;if("path"==t.action?(t.pathMode=!0,t.eraseMode=!1,t.highlightMode=!1,canvas.freeDrawingBrush.width=1,canvas.freeDrawingBrush.color=$("#color ul li.border ul li.click").length>0?$("#color ul li.border ul li.click").attr("color"):"#000"):"eraser"==t.action?(t.action=e="path",t.currentCanvas.style.cursor="crosshair",canvas.isDrawingMode=!0,t.pathMode=!1,canvas.freeDrawingBrush.width=t.eraserSize,canvas.freeDrawingBrush.color=t.eraserCorlor,t.eraseMode=!0,t.highlightMode=!1):"highlight"==t.action&&(t.eraseMode=!1,t.highlightMode=!0,t.pathMode=!1,t.action=e="path",t.currentCanvas.style.cursor="crosshair",canvas.isDrawingMode=!0,canvas.freeDrawingBrush.width=t.highlightSize,canvas.freeDrawingBrush.color=t.highlightCorlor),"pointer"===e){canvas.isSelectMode=!0,t.drawShape=!1,canvas.selection=!0;var a=canvas.getObjects();return void $.each(a,function(t,e){e.selectable=!0})}canvas.isSelectMode=!1,canvas.selection=!1;var a=canvas.getObjects();if($.each(a,function(t,e){e.selectable=!1}),"click"===e)return t.currentCanvas.style.cursor="images/pointer.png",void o.mousePointStart({action:"start"});if(o.mousePointStart({action:"stop"}),t.currentCanvas.style.cursor="default","text"===e?(t.drawText=!0,t.modifyText=!0,t.currentCanvas.style.cursor="text"):t.drawText=t.modifyText=!1,t.drawShape=!0,t.paletteName="shapes","path"!==e&&"eraser"!==e&&"highlight"!==e){if(!t.palette[t.paletteName].shapes[e])return;r=n.getDefaultDataFromArray(t.palette[t.paletteName].shapes[e].properties),r.uid=n.uniqid(),t.shapeArgs=[r]}"path"!==t.action?canvas.isDrawingMode=!1:(t.currentCanvas.style.cursor="crosshair",canvas.isDrawingMode=!0)}})},turnOffPalettes:function(){$(".shape-holder").off("click"),$(".shape-holder").removeClass("shape-selected"),t.action="",s(t.canvases).each(function(t){t.discardActiveObject(),t.discardActiveGroup(),t.isSelectMode=!1,t.isDrawingMode=!1,t.isSelectMode=!1,t.selection=!1;var e=t.getObjects();e&&$.each(e,function(t,e){e.selectable=!1}),t.renderAll()})},vectorAction:function(){return'<div class="shape-holder" id="vector-shape" title="Hình học" data-shape="vector"><div class="basic-shape s-vector"></div></div>'},mathTools:function(){return'<div class="shape-holder" id="math-shape"  title="Toán học" data-shape="math"><div class="basic-shape s-math"></div></div>'},asyncTool:function(){return'<div class="shape-holder" id="sync-shape" title="sync-async" data-shape="async"><div class="basic-shape s-sync">Async</div></div>'},createPallette:function(e){var n,r,o,s,a,c,e=t.palette[e].collectionName,l="";"shapes"==e&&(l='<div class="shape-holder"  id="pointer-shape" data-shape="pointer" title="Chọn hình"><div class="basic-shape s-pointer"></div></div><div class="shape-holder" data-shape="click" title="Chỉ dẫn"><div class="basic-shape s-click"></div></div><div class="shape-holder" id="highlight-shape" title="Đánh dấu" data-shape="highlight"><div class="basic-shape s-highlight"></div></div>'),i.updateAccordian(e),n=t.palette[e];for(r in n.shapes)o=n.shapes[r],s=o.name,a=o.displayName,"importimage"!=s&&(c='<div class="shape-holder" id="'+s+'-shape" title="'+a+'" data-shape="'+s+'"><div class="basic-shape s-'+s+'"></div></div>',l+=c);l+='<div class="shape-holder" id="eraser-shape" title="Tẩy" data-shape="eraser"><div class="basic-shape s-eraser"></div></div></div>',l+=this.vectorAction(),l+=this.mathTools(),$("#"+e).append(l)}}}),define("../components/ui.imaginea.accordion",["storm.ui"],function(t){function e(t){this.props=t,this.cntrObj=$("#"+this.props.cntrId),this.initalizeAccordion(),this.showFirstSection()}return e.prototype={initalizeAccordion:function(){var e,i=$(this.cntrObj).find("."+this.props.headerClass),n=this;$(i).bind("click",function(i){e=i.currentTarget,t.resetShapeSelection(),$(e).hasClass(n.props.headerCloseClass)?n.showSection(e):n.closeSection(e)})},showFirstSection:function(){var t=$(this.cntrObj).find("."+this.props.headerClass+":first");this.showSection(t)},showSection:function(t){$(t).removeClass(this.props.headerCloseClass).addClass(this.props.headerOpenClass),$(t).next().show(),$("#accordion").mCustomScrollbar("update")},closeSection:function(t){$(t).addClass(this.props.headerCloseClass).removeClass(this.props.headerOpenClass),$(t).next().hide(),$("#accordion").mCustomScrollbar("update")}},e}),define("board.files",["storm","storm.ui","storm.util","board.pdf"],function(t,e,i,n){function r(e){t.comm.socket.emit("loadPdf",t.parentBoardId,e)}function o(n){if(!n.docUrl)return!1;var r=i.getDefaultDataFromArray(t.palette.components.shapes.image.properties);r.uid=i.uniqid(),t.shapeArgs=[r],t.shapeArgs[0].name="image",t.shapeArgs[0].src=$.trim(n.docUrl),t.shapeArgs[0].source=$.trim(n.docUrl),t.shapeArgs[0].left=100,t.shapeArgs[0].top=100,t.shapeArgs[0].boardId=n.boardId,t.shapeArgs[0].palette="components",t.shapeArgs[0].opacity=1,t.palette.components.shapes.image.toolAction.apply(this,t.shapeArgs),t.comm.sendDrawMsg({palette:"components",action:"image",boardId:n.boardId,args:t.shapeArgs}),e.hideLoading(),d.addFiles(n.docUrl)}function s(t){h=t,$(".list-files").empty();var e="",i='<a href="">home</a>',n=t.split("/"),r=c;_(n).each(function(t){""!=t&&(e+="/"+t,i+=' / <a href="'+e+'">'+t+"</a>",r=r[t])}),$("#reusefiles .path-folder").html(i),_(r).each(function(e,i){if(_(e).isObject()){var n=t+"/"+i;$(".list-files").append('<li><div class="board-icon-folder"></div><a class="load-folder" href="'+n+'">'+i+"</a></li>")}}),_(r).each(function(t,e){if(_(t).isString()){var i=t.substr(t.lastIndexOf(".")+1).toLowerCase();"pdf"==i&&$(".list-files").append('<li><div class="board-icon-pdf"></div><a class="load-pdf-file" href="'+l+t+'">'+e+'</a><div class="board-icon-close rightFloater"></div></li>')}}),_(r).each(function(t,e){if(_(t).isString()){var i=t.substr(t.lastIndexOf(".")+1).toLowerCase();-1!=$.inArray(i,u)&&$(".list-files").append('<li><div class="board-icon-image"></div><a class="load-picture-file" href="'+l+t+'">'+e+'</a><div class="board-icon-close rightFloater"></div></li>')}})}function a(){$("#reusefiles .path-folder").on("click","a",function(t){t.preventDefault();var e=$(this).attr("href");s(e)}),$("#reusefiles .list-files").on("click",".load-folder",function(t){t.preventDefault();var e=$(this).attr("href");s(e)}),$("#reusefiles .list-files").on("click",".load-pdf-file",function(e){e.preventDefault();var i=$(this).attr("href"),o={};o.docUrl=i,o.docPage=1,o.docScale=1,o.boardId=t.currentBoardId,r(o),t.loadedPdf[t.currentBoardId]=i,n.renderPdf(o),$("#uploadModal").modal("hide")}),$("#reusefiles .list-files").on("click","a.load-picture-file",function(e){e.preventDefault(),$("#myModal").modal("hide");var i={};i.docUrl=$(this).attr("href"),i.boardId=t.currentBoardId,o(i),$("#uploadModal").modal("hide")}),$("#reusefiles .list-files").on("click",".board-icon-close",function(){var t=$(this).prev().attr("href");if(void 0!=t){var e={path:t},i=$(this).parent();$.post(baseUrl+"removefile",e).done(function(t){t.success?i.fadeOut(300,function(){i.remove()}):alert("Có lỗi xảy ra khi xóa file")})}}),$("#download_docs").click(function(){if(t.user.role==t.roles.STUDENT&&2!=t.sessionStatus)return void alert("Bạn chỉ có thể tải xuống tài liệu khi lớp học đã kết thúc");var e=t.dataBoards[t.parentBoardId].files;$(".list-docs").empty(),$(".list-images-board").empty();for(var i in e){var n=e[i].split("/");n=n[n.length-1];var r=n.substr(n.lastIndexOf(".")+1).toLowerCase();"pdf"==r?$(".list-docs").append('<li><div class="board-icon-pdf"></div><a class="file-download" target="_blank" href="'+e[i]+'">'+n+"</a></li>"):-1!=$.inArray(r,u)&&$(".list-images-board").append('<li><div class="board-icon-image"></div><a class="file-download" target="_blank" href="'+e[i]+'">'+n+"</a></li>")}$("#downloadModal").modal("show")}),$("#upload_pdf_image").on("click",function(){_(c).isEmpty()?$.get(baseUrl+"listuploaded",function(t){var e=t.files;e&&_(e).isObject&&(c=e,pathPdf="",l=t.path,s(""))
},"json"):s(h)}),$("#insertLinkUrl").click(function(){var e=$("#file_url").val();if(!e)return!1;var n=i.getDefaultDataFromArray(t.palette.components.shapes.image.properties);n.uid=i.uniqid(),t.shapeArgs=[n],t.shapeArgs[0].name="image",t.shapeArgs[0].src=e,t.shapeArgs[0].source=e,t.shapeArgs[0].left=100,t.shapeArgs[0].top=100,t.shapeArgs[0].scale=$("#value_scale").val()?$("#value_scale").val()/100:1,t.shapeArgs[0].palette="components",t.palette.components.shapes.image.toolAction.apply(this,t.shapeArgs),t.comm.sendDrawMsg({palette:"components",action:"image",args:t.shapeArgs}),d.addFiles(e)});var a={beforeSubmit:function(){e.showLoading()},success:function(i){if(0==i.success)return e.hideLoading(),alert("Không thể tải lên file, lý do: "+i.reason),!1;var s={};s.docUrl=i.url,s.docPage=1,s.docScale=1;var a=i.url;s.boardId=t.currentBoardId;var c=a.split(".");d.addFiles(i.url),"pdf"==c[c.length-1].toLowerCase()?(r(s),t.loadedPdf[t.currentBoardId]=s.docUrl,n.renderPdf(s)):o(s)},error:function(){return e.hideLoading(),!1}};$("#form_upload_docs").ajaxForm(a)}var c={},l="",h="",u=["gif","jpeg","jpg","png","bmp"],d={init:function(){n.addFiles=this.addFiles,a()},addFiles:function(e){var i=t.dataBoards[t.parentBoardId].files;void 0!=i&&_(i).isArray()||(i=[]),_(i).contains(e)||i.push(e),t.dataBoards[t.parentBoardId].files=i}};return d}),define("storm.main",["storm","storm.ui","storm.util","storm.fabric","storm.palettes","storm.events","storm.palettes.properties","storm.comm","../components/ui.imaginea.accordion","boards","board.files","geometry.tools"],function(t,e,i,n,r,o,s,a,c,l,h){var u={init:function(){},replaceAllString:function(t,e,i){return i.split(t).join(e)},deleteObjects:function(){var e=canvas.getActiveObject(),i=canvas.getActiveGroup();if(e)canvas.remove(e),t.comm.sendDrawMsg({action:"delete",args:[{uid:e.uid}]});else if(i){var n=i.getObjects();canvas.discardActiveGroup(),n.forEach(function(e){canvas.remove(e),t.comm.sendDrawMsg({action:"delete",args:[{uid:e.uid}]})})}},modifyObject:function(e){var n=i.getCanvasByBoardId(e[0].boardId),r=i.getObjectById(e[0].uid,n);try{r&&(n.getActiveGroup()&&(n.deactivateAllWithDispatch(),n.renderAll()),t.palette[r.palette].shapes[r.name].modifyAction?t.palette[r.palette].shapes[r.name].modifyAction.apply(this,e):null,r.setCoords()),canvas.renderAll()}catch(o){console&&console.error&&console.error("Problems with modifyObject"+o)}},sendModifiedObject:function(){var e=canvas.getActiveObject();t.comm.sendDrawMsg({action:"modified",name:e.name,palette:e.palette,path:e.path,args:[{uid:e.uid,object:e}]})},drawPath:function(t,e){var i=new fabric.Path(t.path);i.fill=null,i.stroke=t.stroke,i.strokeWidth=t.strokeWidth,i.uid=t.uid,i.name="drawingpath",i.scaleX=1,i.scaleY=1,i.palette="shapes",i.set("left",t.left),i.set("top",t.top),i.originX=t.originX?t.originX:"left",i.originY=t.originY?t.originY:"top",i.angle=t.angle?t.angle:0,i.set("width",t.width),i.set("height",t.height),e.add(i),e.renderAll(),i.setCoords()},addTools:function(){r.createAllPallettes(t.palette),new c({cntrId:"accordion",headerClass:"p-header",sectionClass:"p-cntr",headerOpenClass:"p-open",headerCloseClass:"p-close"}),$("#toolsdiv").append("<div id='deleteTool' class='tools deleteTool'></div>"),$("#deleteTool").click(function(){u.deleteObjects()})},commOnDraw:function(){a.prototype.onDraw=function(e){if(e&&e.args){e.args[0].boardId=e.boardId;var n=i.getCanvasByBoardId(e.boardId);if(void 0===e.action||null===e.action)return;switch(e.action){case"modified":t.main.modifyObject(e.args);break;case"drawpath":t.main.drawPath(e.args[0],n);break;case"delete":var r=i.getObjectById(e.args[0].uid,n),o=n.getActiveObject();n.remove(r),o==r&&t.quickMenu.hideQuickMenu();break;case"importimage":t.main.addImageToCanvasFromServer(e.args[0]);break;case"zindexchange":var r=i.getObjectById(e.args[0].uid,n);"forward"===e.args[0].change?(n.bringForward(r),n.renderAll()):(n.sendBackwards(r),n.renderAll());break;case"uploadLayout":t.main.addLayoutToCanvasFromServer(e.args[0]);break;default:void 0!==t.palette[e.palette]&&(t.palette[e.palette].shapes[e.action].toolAction.apply(this,e.args),canvas.renderAll())}"image"!=e.action||e.args[0].latex||h.addFiles(e.args[0].src)}}},addImageToCanvasFromServer:function(e){var i=new Image;i.onload=function(){e.image=this,e.width=this.width,e.height=this.height,t.main.addImageToCanvas(e)},i.src=e.src},addLayoutToCanvasFromServer:function(e){var i=new Image;i.onload=function(){e.image=this,e.width=this.width,e.height=this.height,t.main.addLayoutToCanvas(e)},i.src=e.src},addLayoutToCanvas:function(e){var i=new fabric.Image(e.image,{width:e.width,height:e.height});canvas.setBackgroundImage(e.src,function(){canvas.renderAll()}),i.uid=e.uid,i.name=e.name,i.palette=e.palette,e.self&&(e.self=!1,t.comm.sendDrawMsg({action:"uploadLayout",palette:i.palette,args:[{uid:i.uid,name:i.name,image:e.image,src:e.src,palette:e.palette}]}))},addImageToCanvas:function(e){var i=new fabric.Image(e.image,{left:e.left,top:e.top,width:e.width,height:e.height,scaleX:e.scaleX,scaleY:e.scaleY});canvas.add(i),i.uid=e.uid,i.name=e.name,i.palette=e.palette,e.angle&&i.setAngle(e.angle),canvas.renderAll(),i.setCoords(),e.self&&(e.self=!1,t.comm.sendDrawMsg({action:"importimage",palette:i.palette,args:[{uid:i.uid,left:i.left,top:i.top,width:i.width,height:i.height,scaleX:i.scaleX,scaleY:i.scaleY,name:i.name,image:e.image,src:e.src,palette:e.palette}]}))}};return u.commOnDraw(),u}),define("storm.layouts",["storm","storm.main","storm.ui","storm.util"],function(t){return{registerLayout:function(e,i){t.layout[e]=i},createLayoutsList:function(){var e,i='<div id="layoutList" style="padding:15px"><b style="font-size:14px">Select a Layout: </b>',n="<select id='layouts' style='width: 160px'>";for(e in t.layout){n+="<optgroup label="+e+">";for(var r in t.layout[e].layouts)n+="<option value="+r+" id="+r+">"+r}i+=n,$(document.getElementById("result")).append(i),document.getElementById("layouts").onchange=function(){var t=document.getElementById("layouts").value;"uploadLayout"==t&&$(document.getElementById("result")).append('<input id = "loadLayout" type="file" style="position: absolute; left: 18px; top: 90px;"/>')}},setLayoutType:function(e){var i=document.getElementById(e),n=i.parentElement.label,r=t.layout[n].layouts[e].toolAction();if(r)for(var o=0;o<r.length;o++)t.comm.sendDrawMsg({palette:"shapes",action:"rectangle",args:r[o]})}}}),define("storm.containers",["storm","storm.main","storm.ui","storm.util","storm.layouts"],function(t,e,i,n,r){return{containerName:null,currSelection:null,canvasWidth:0,canvasHeight:0,registercontainer:function(e,i){t.containers[e]=i},createContainerList:function(){var e,i=this,n='<div id="containerlist" style="padding:15px"><b style="font-size: 14px">Select a Container:  </b>',o="<select id='containers' >";for(e in t.containers){var s=t.containers[e],a=s.displayName;o+="<option value="+e+" id="+a+">"+a}n+=o,onButtonClick=function(){i.onOkClick()},$(document.getElementById("result")).append(n),r.createLayoutsList();var c="<div style='padding:15px'><b style='font-size: 14px'>Canvas Width: </b><input id='canvasWidth' type = 'text' value='1024'><b style='font-size: 14px'>px</b></div>";$(document.getElementById("result")).append(c),$("#canvasWidth").val(t.containers[$("#containers").val()].width);var l="<div style='padding:15px'><b style='font-size: 14px'>Canvas Height: </b><input id='canvasHeight' type = 'text' value='768'><b style='font-size: 14px'>px</b></div>";$(document.getElementById("result")).append(l),$("#canvasHeight").val(t.containers[$("#containers").val()].height);var h="<div style='padding:15px'><br><input type='button' value='Ok' onclick=onButtonClick() /></div>";$(document.getElementById("result")).append(h),$("#containers").change(function(){$("#canvasWidth").val(t.containers[$("#containers").val()].width),$("#canvasHeight").val(t.containers[$("#containers").val()].height)}),popup("popUpDiv","closediv",300,300),$("#closediv").css("display","none")},onOkClick:function(){this.containerName=document.getElementById("containers").value,this.canvasWidth=document.getElementById("canvasWidth").value,this.canvasHeight=document.getElementById("canvasHeight").value,this.setContainer(this.containerName,"new");var e=document.getElementById("layouts").value;"uploadLayout"==e&&$(document.getElementById("result")).append('<input id = "loadLayout" type="file" />'),t.comm.sendContainerInfo({action:"setContainer",containerName:this.containerName,canvasWidth:this.canvasWidth,canvasHeight:this.canvasHeight}),$("#closediv").css("display","block")},setContainer:function(e,n){var o=t.containers[e];i.deviceHeight=o.height,i.deviceWidth=o.width,i.canvasWidth=this.canvasWidth<=0?o.width:this.canvasWidth,i.canvasHeight=this.canvasHeight<=0?o.height:this.canvasHeight,i.deviceInnerHeight=o.innerHeight,i.deviceInnerWidth=o.innerWidth,t.xOffset=o.xOffset,t.yOffset=o.yOffset,$("#containerBody").css("position","relative");var s={position:"relative",left:o.xOffset,top:o.yOffset};if($("#canvasId").css(s),$(".canvas-container").css("width",this.canvasWidth),$(".canvas-container").css("height",this.canvasHeight),t.deviceOffsetX=o.xOffset,t.deviceOffsetY=o.yOffset,"new"===n){var a=document.getElementById("layouts").value;"uploadLayout"==a&&(t.layoutURL=document.getElementById("loadLayout").files[0]),r.setLayoutType(a)}$("#loading").hide(),$("#containerBody").css("visibility","visible")}}}),require(["storm","storm.main","storm.containers","storm.palettes.properties","storm.util"],function(t,e,i){i.registercontainer("desktop-1366x768",{displayName:"desktop-1366x768",src:"",width:1086,height:768,innerWidth:1086,innerHeight:768,xOffset:0,yOffset:0,canvasWidth:1086,canvasHeight:768}),i.registercontainer("desktop-1024x768",{displayName:"desktop-1024x768",src:"",width:1024,height:768,innerWidth:1024,innerHeight:768,xOffset:0,yOffset:0,canvasWidth:1024,canvasHeight:768}),i.registercontainer("desktop-1280x1024",{displayName:"desktop-1280x1024",src:"",width:1280,height:1024,innerWidth:1280,innerHeight:1024,xOffset:0,yOffset:0,canvasWidth:1280,canvasHeight:1024}),i.registercontainer("iphone",{displayName:"iPhone",src:"iphone_overlay.png",width:420,height:740,innerWidth:330,innerHeight:500,xOffset:53,yOffset:134,canvasWidth:330,canvasHeight:800,viewportX:52,viewportY:135}),i.registercontainer("ipad",{displayName:"iPad",src:"ipad_overlay.png",width:564,height:723,innerWidth:467,innerHeight:606,xOffset:60,yOffset:70,canvasWidth:467,canvasHeight:606,viewportX:60,viewportY:70}),i.registercontainer("blackberry",{displayName:"BlackBerry",src:"BlackBerry.png",width:396,height:700,innerWidth:327,innerHeight:247,xOffset:32,yOffset:125,canvasWidth:327,canvasHeight:247,viewportX:32,viewportY:125}),i.registercontainer("browser",{displayName:"Browser",src:"browser_container.png",width:1050,height:752,innerWidth:1040,innerHeight:670,xOffset:5,yOffset:80,canvasWidth:1040,canvasHeight:670,viewportX:8,viewportY:81})}),define("storm.containers.devices",function(){}),define("features/modified-by-user",["storm","storm.comm"],function(t,e){function i(){function i(t,e,i){return'<div class="modified-user" style="left: '+e+"px; top: "+i+'px;">'+t+"</div>"}function n(t){$(t).appendTo("#canvasId").animate({top:"-=20",opacity:"-=10"},1e3,"swing",function(){$(this).remove()})}e.prototype.sendDrawMsg=function(e){return function(i){i.modifiedBy=t.user.name,e.call(t.comm,i)}}(e.prototype.sendDrawMsg),e.prototype.onDraw=function(e){return function(r){if(e.call(t.comm,r),r.modifiedBy&&t.sync){var o=r.args[0].object||r.args[0];n(i(r.modifiedBy,o.left,o.top))}}}(e.prototype.onDraw)}return{init:i}}),define("features/chat",["storm","underscore"],function(t){function e(t){return t.replace(new RegExp(l.join("|"),"ig"),function(t){var e=t.toLowerCase().trim();return"undefined"!=typeof c[e]?' <span class="'+c[e]+'"></span> ':t})}function i(t){return t.replace(u,function(t){return'<a href="'+t+'" target="_blank">'+t+"<a>"})}function n(t,e,i){return i.split(t).join(e)}function r(t){return 10>t&&(t="0"+t),t}function o(t){var o=new Date(t.createdTime),s=r(o.getHours())+":"+r(o.getMinutes());o.toLocaleDateString()!=(new Date).toLocaleDateString()&&(s=o.getFullYear()+"/"+r(o.getMonth())+"/"+r(o.getDate())+" "+s);var a=n("\n","</br>",t.message);a=e(a),a=i(a),$("#chattext").append('<li><span class="sender">['+s+"] "+t.createdBy+": </span>"+a+"</li>"),$(".listChat").scrollTop($(".listChat #chattext").height())}function s(e){var i={boardId:t.parentBoardId,createdBy:t.user.name,message:e,createdTime:(new Date).getTime()};o(i),t.comm.socket.emit("sendMessage",t.parentBoardId,i)}function a(){var t=!1;$(window).keydown(function(e){16==e.keyCode&&(t=!0)}).keyup(function(e){16==e.keyCode&&(t=!1)}),$("#chat").keypress(function(e){return 13==e.keyCode&&0==t?($("#chat").val()&&(s($("#chat").val()),$("#chat").val("").focus()),$(".listChat").scrollTop($(".listChat #chattext").height()),!1):void 0})}var c={">:(":"emoticon-grumpy","3:)":"emoticon-devil","O:)":"emoticon-angel",">:O":"emoticon-upset",":)":"emoticon-smile",":(":"emoticon-sad",":p":"emoticon-tongue",":d":"emoticon-big-smile",":O":"emoticon-gasp",";)":"emoticon-wink","B)":"emoticon-glasses","B|":"emoticon-sunglasses",":/":"emoticon-unsure",":'(":"emoticon-cry",":*":"emoticon-kiss","<3":"emoticon-heart","^_^":"emoticon-kiki","-_-":"emoticon-squint","o.O":"emoticon-confused",":v":"emoticon-pacman",":3":"emoticon-curlylips","(y)":"emoticon-like","(n)":"emoticon-dislike"},l=[],h=/[[\]{}()*+?.\\|^$\-,&#\s]/g,u=/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/gi,d={init:function(){t.comm.socket.on("sendMessage",function(t){t&&t.message&&o(t)});for(var e in c)if(c.hasOwnProperty(e)){var i=e.replace(h,"\\$&");l.push("(^"+i+"|\\s"+i+"\\s|"+i+"$)")}a()},sendMessage:s};return d}),define("features/question",["storm"],function(t){function e(){t.comm.socket.on("createQuestion",function(t){t&&t.question&&r(t)}),t.comm.socket.on("setQuestionDone",function(t){var e=$("#question_"+t.questionId);u(e,t.done)}),t.comm.socket.on("deleteQuestion",function(t){$("#question_"+t.questionId).fadeOut("slow").remove(),o()}),h()}function i(t,e,i){return i.split(t).join(e)}function n(t){return 10>t&&(t="0"+t),t}function r(t){var e=t.user.userId,r=new Date(t.createdTime),o=n(r.getHours())+":"+n(r.getMinutes());r.toLocaleDateString()!=(new Date).toLocaleDateString()&&(o=r.getFullYear()+"/"+n(r.getMonth())+"/"+n(r.getDate())+" "+o),$("#questions").append('<li id="question_'+t.questionId+'"><span class="remove" ></span><input class="check_done" type="checkbox" data-owner="'+e+'"  name="question_'+t.questionId+'"/><span class="sender">'+t.user.name+" ["+o+"] : </span><p>"+i("\n","</br>",t.question)+"</p></li>");var s=$("#question_"+t.questionId);u(s,t.done),$(".ask-content .listChat").scrollTop($(".listChat #questions").height()),0==t.done&&($(".tab-items .tab-ask").hasClass("active")||$(".tab-items .tab-ask").hasClass("in-coming")||$(".tab-items .tab-ask").addClass("in-coming"))}function o(){var t=$("#questions li.asking-question").length;$("#tab-title .tab-items .tab-ask span").html("Câu hỏi ("+t+")")}function s(){if($("#ask").val()){var e=$("#ask").val(),i={boardId:t.parentBoardId,user:t.user,question:e,createdTime:(new Date).getTime()};a(i)}$("#ask").val("").focus()}function a(e){t.comm.socket.emit("createQuestion",t.parentBoardId,e)}function c(e){e.boardId=t.parentBoardId,t.comm.socket.emit("setQuestionDone",t.parentBoardId,e)}function l(e){e.boardId=t.parentBoardId,t.comm.socket.emit("deleteQuestion",t.parentBoardId,e),o()}function h(){$(".askSend #send").click(function(){return s(),$(".ask-content .listChat").scrollTop($(".listChat #questions").height()),$(".askSend").hide(),$(".showAsk").fadeIn("slow"),!1}),$(".askSend #discard").click(function(){$("#ask").val(""),$(".askSend").hide(),$(".showAsk").fadeIn("slow")}),$("#questions").on("click","input.check_done",function(e){return t.user.role==t.roles.STUDENT&&t.user.userId!=$(this).attr("data-owner")?(e.preventDefault(),!1):void 0}),$("#questions").on("click",".remove",function(e){var i=$(this).parent().find("input[type=checkbox]");if(t.user.role==t.roles.STUDENT&&i.attr("data-owner")!=t.user.userId)return e.preventDefault(),!1;var n=$(this),r=n.parent();if(window.confirm("Bạn có chắc muốn xóa câu hỏi này không?")){var o=r.attr("id"),s=o.split("_"),a=s[1];l({questionId:a})}}),$("#questions").on("change","input.check_done",function(e){if(t.user.role==t.roles.STUDENT)return e.preventDefault(),!1;var i=$(this).attr("name"),n=i.split("_"),r=n[1],o=this.checked?1:0,s=$("#question_"+r);u(s,o),c({questionId:r,done:o})})}function u(t,e){1==e?($("#questions li.done-question").length?t.removeClass("asking-question").insertBefore($(".done-question").first()).addClass("done-question"):t.appendTo("#questions").removeClass("asking-question").addClass("done-question"),t.find("input[type=checkbox]").prop("checked",!0)):($("#questions li.asking-question").length?t.insertAfter("#questions li.asking-question:last").removeClass("done-question").addClass("asking-question"):t.prependTo("#questions").removeClass("done-question").addClass("asking-question"),t.find("input[type=checkbox]").prop("checked",!1)),o()}return{init:function(){e()}}}),define("features/user-actions",["storm","features/chat"],function(t,e){function i(){t.comm.socket.on("user-actions",function(t){"thumb-up"==t.action?r(t.userId,"up"):"thumb-down"==t.action&&r(t.userId,"down")}),n()}function n(){$("#button_thumb_up").click(function(){"ready"==s()&&(a("active"),l("disabled"),setTimeout(o,3e3),t.comm.socket.emit("user-actions",t.parentBoardId,{action:"thumb-up",userId:t.user.userId}),e.sendMessage("(y)"))}),$("#button_thumb_down").click(function(){"ready"==c()&&(a("disabled"),l("active"),setTimeout(o,3e3),t.comm.socket.emit("user-actions",t.parentBoardId,{action:"thumb-down",userId:t.user.userId}),e.sendMessage("(n)"))})}function r(t,e){var i='<div class="thumb board-icon-thumb-'+e+'-active"></div>';$("#user"+t+" .action").prepend(i),setTimeout(function(){$("#user"+t+" .action .thumb").remove()},3e3)}function o(){a("ready"),l("ready")}function s(){var t=$("#button_thumb_up").attr("class");return void 0!=t&&t.indexOf("board-icon-thumb-up-")>-1?t.substring(20):""}function a(t){$("#button_thumb_up").attr("class","board-icon-thumb-up-"+t)}function c(){var t=$("#button_thumb_down").attr("class");return void 0!=t&&t.indexOf("board-icon-thumb-down-")>-1?t.substring(22):""}function l(t){$("#button_thumb_down").attr("class","board-icon-thumb-down-"+t)}return{init:i}}),define("board.sync",["storm","storm.util","boards"],function(t,e,i){function n(e){e=parseInt(e),t.sync=e?!0:!1;var i=$("#boards-tab .sync-whiteboard");i.removeClass("sync").removeClass("async"),e?(i.addClass("sync"),i.attr("title","Đang đồng bộ")):(i.addClass("async"),i.attr("title","Đang không đồng bộ"))}function r(e){t.comm.socket.emit("toggleSync",t.parentBoardId,e)}function o(){$("#boards-tab").on("click",".sync-whiteboard",function(){return t.user.role!=t.roles.STUDENT?1!=t.sessionStatus?void alert("Chức năng đồng bộ chỉ có tác dụng khi lớp đang diễn ra"):void($(this).hasClass("sync")?s.toggleSync(0):$(this).hasClass("async")&&s.toggleSync(1)):void 0})}var s={init:function(){t.comm.socket.on("toggleSync",function(t){n(t.sync),1==t.sync?t.active&&i.setActiveBoard(t.active,!1):e.isAllowBoard(t.boardId)||$("#boards div#boards-tab ul li:first a.link-board").click()}),o()},toggleSync:function(e){var i={boardId:t.currentBoardId,sync:e,active:t.currentBoardId};n(e),r(i)},displaySyncButton:function(t){0==$("#boards-tab .sync-whiteboard").length&&$("#boards-tab").append('<div class="sync-whiteboard"></div>'),n(t)}};return s}),define("board.session",["storm","storm.palettes","board.sync"],function(t,e,i){function n(){$("#start-stop-calc-time").on("click",function(e){e.preventDefault(),t.user.role!=t.roles.STUDENT&&($(this).hasClass("disabled")||($(this).hasClass("stoped")?_.size(t.teachers)>0&&_.size(t.students)>0?(h({status:"start"}),r()):alert("Cần ít nhất một giáo viên và một học sinh trong lớp để bắt đầu lớp học!"):confirm("Bạn có chắc chắn muốn kết thúc lớp học hay không?")&&(h({status:"stop"}),o())))})}function r(){var n=$("#start-stop-calc-time");n.removeClass("stoped").addClass("started"),n.find("i").removeClass("board-icon-play").addClass("board-icon-pause"),n.find("span.status-text").html("Kết thúc"),a(),c(u,1),e.turnOnPalettes(),t.sessionStatus=1,t.enableDraw=!0,t.sync||i.toggleSync(1)}function o(){var n=$("#start-stop-calc-time");n.removeClass("started").addClass("stoped"),n.find("i").removeClass("board-icon-pause").addClass("board-icon-play"),n.find("span.status-text").html("Tiếp tục"),l(),e.turnOffPalettes(),t.sessionStatus=2,t.enableDraw=!1,t.sync&&i.toggleSync(0),u=parseInt($("#time_second").text())+60*parseInt($("#time_minutes").text())+3600*parseInt($("#time_hours").text())}function s(){0==$("body").find(".board-disabled").length&&$("body").append(t.user.role==t.roles.STUDENT?'<div class="board-disabled"><div class="alert-start">Chờ giáo viên để bắt đầu lớp học<br/> Nếu gặp lỗi không nghe hoặc không dùng bảng được... <br> Vui lòng  <span style="color: red;">reload</span> lại trình duyệt <span style="color: red;">(nhấn F5)</span> để thử lại</div></div>':'<div class="board-disabled"><div class="alert-start">Ấn nút “Bắt đầu” hoặc “Tiếp tục” để bắt đầu lớp học</div></div>')}function a(){$("body .board-disabled").remove()}function c(e,i){var n=parseInt(e,10),i=parseInt(i),r=Math.floor(n/3600),o=Math.floor((n-3600*r)/60),a=n-3600*r-60*o;if(10>r&&(r="0"+r),10>o&&(o="0"+o),10>a&&(a="0"+a),$("#time_second").text(a),$("#time_minutes").text(o),$("#time_hours").text(r),0!=i){if(clearTimeout(t.myTimer),t.timer_started=!0,i>0){var c=$("#start-stop-calc-time");c.removeClass("stoped").addClass("started"),c.find("i").removeClass("board-icon-play").addClass("board-icon-pause"),c.find("span.status-text").html("Kết thúc")}t.myTimer=setInterval(function(){var e=parseInt($("#time_hours").text()),n=parseInt($("#time_minutes").text()),r=parseInt($("#time_second").text());i>0?r++:r--,60==r?(r="00",n++):0>r?(r="59",n--):10>r&&(r="0"+r),60==n?(n="00",e++):0>n?(n="59",e--):10>n&&(n="0"+n),0>e?(r="00",n="00",e="00",clearTimeout(t.myTimer),s()):10>e&&(e="0"+e),$("#time_second").text(r),$("#time_minutes").text(n),$("#time_hours").text(e)},1e3)}}function l(){t.timer_started=!1,clearInterval(t.myTimer)}function h(e){t.comm.socket.emit("toggleBoard",t.parentBoardId,e)}var u=0,d={init:function(){t.comm.socket.on("toggleBoard",function(t){"start"==t.status?r():"stop"==t.status&&o()}),n()},setTime:function(){var i=t.dataBoards[t.parentBoardId],n=parseInt(i.totalTime),r=i.sessionStatus,l=i.sessionType;if(0==l)$("#start-stop-calc-time").addClass("disabled");else if(0==r){var h=t.user;h.role==t.roles.STUDENT?(e.turnOffPalettes(),s()):a(),n>0?c(n,-1):s()}else 1==r?(c(n,1),a()):2==r&&(c(n,0),o());t.sessionStatus=r}};return d}),define("board.export",["storm","storm.util"],function(t,e){function i(){$("#export .board-icon-export").click(function(){$("#boards").append("<canvas id='export_canvas'></canvas>");var i=document.getElementById("export_canvas");i.height=$("#canvasId").height(),i.width=$("#canvasId").width();var n=i.getContext("2d"),r=document.getElementById("pdf"+t.currentBoardId);if(r){var o=new Image;o.src=r.toDataURL("image/png"),n.drawImage(o,0,0)}var s=e.getCanvasByBoardId(t.currentBoardId),a=new Image;a.src=s.toDataURL("image/png"),n.drawImage(a,0,0);var a=i.toDataURL("image/png"),c="daykem123.png";window.navigator.userAgent.match("Chrome")?$("<a>").attr({href:a,download:c})[0].click():(a=a.replace("image/png","image/octet-stream"),window.open(a)),$("#export_canvas").remove()})}var n={init:function(){i()}};return n}),define("board.quick-menu",["storm","storm.util","math.util"],function(t,e,i){function n(){$("div.m-quick-edit").on("click","span",function(){var n=$(this).attr("class");switch(n){case"edit-icon":r.hideQuickMenu();var o=canvas.getActiveObject();if(o.type&&"text"==o.type)return e.textForm(canvas.getActiveObject());if(""!=o.latex)return i.createMathEditor(o.latex);break;case"delete-icon":t.main.deleteObjects(),r.hideQuickMenu();break;case"visible-icon":var s=canvas.getActiveObject();s.setOpacity(0),t.main.sendModifiedObject(),$("#visible_icon").removeClass("visible-icon").addClass("invisible-icon"),e.displayImage(s);break;case"invisible-icon":var s=canvas.getActiveObject();s.setOpacity(1),t.main.sendModifiedObject(),$("#visible_icon").removeClass("invisible-icon").addClass("visible-icon"),e.displayImage(s)}}),$("div.m-quick-edit-group").on("click","span",function(){var e=$(this).attr("class");switch(e){case"delete-icon":t.main.deleteObjects(),r.hideQuickMenuGroup()}})}var r={init:function(){n()},showQuickMenu:function(i){"text"==i.name||i.latex?($("#edit_icon").show(),""!=i.text?$("div.m-quick-edit").show():$("div.m-quick-edit").hide()):$("#edit_icon").hide(),"image"==i.name&&t.user.canChangeInvisibleImage()?(0==i.opacity||i.opacity==e.INVISIBLE_OPACITY?$("#visible_icon").attr("class","invisible-icon"):$("#visible_icon").attr("class","visible-icon"),$("#visible_icon").show()):$("#visible_icon").hide(),$(".load-text-box").is(":visible")&&$("div.m-quick-edit").hide(),$("div.m-quick-edit").show();var n=i.oCoords.tl.x,r=i.oCoords.tl.y,o=document.getElementById("containerDiv").scrollLeft,s=document.getElementById("containerDiv").scrollTop,a=n-o>40?n-o:40,c=r-s>40?r-s:40;$("div.m-quick-edit").offset({top:c,left:a})},hideQuickMenu:function(){$("div.m-quick-edit").hide()},showQuickMenuGroup:function(t){var e=$("div.m-quick-edit-group");e.show();var i=t.oCoords.tl.x,n=t.oCoords.tl.y,r=document.getElementById("containerDiv").scrollLeft,o=document.getElementById("containerDiv").scrollTop,s=i-r>40?i-r:40,a=n-o>40?n-o:40;e.offset({top:a,left:s})},hideQuickMenuGroup:function(){$("div.m-quick-edit-group").hide()}};return r}),define("user",["storm"],function(t){var e={canViewInvisibleImage:function(){return t.user.role==t.roles.STUDENT?!1:!0},canChangeInvisibleImage:function(){return t.user.role==t.roles.STUDENT?!1:!0},canKickUser:function(){return t.user.role==t.roles.ADMIN||t.user.role==t.roles.MONITOR},isStudent:function(){return t.user.role==t.roles.STUDENT},isTeacher:function(){return t.user.role==t.roles.TEACHER}};return e}),require(["storm","storm.main","storm.palettes","storm.palettes.properties","storm.util"],function(t,e,i,n,r){var o=function(t,e){e.left&&(t.left=e.left),e.top&&(t.top=e.top),e.scaleX&&(t.scaleX=e.scaleX),e.scaleY&&(t.scaleY=e.scaleY),e.width&&(t.width=e.width),e.height&&(t.height=e.height),e.points&&(t.points=e.points),e.x2&&(t.x2=e.x2),e.y2&&(t.y2=e.y2),e.angle&&t.setAngle(e.angle),e.fill&&t.set("fill",e.fill),e.strokeWidth&&t.set("strokeWidth",e.strokeWidth),e.textBackgroundColor&&t.set("textBackgroundColor",e.textBackgroundColor),e.stroke&&t.set("stroke",e.stroke),e.text&&(t.text=e.text),e.fontSize&&(t.fontSize=e.fontSize),e.path&&(t.path=e.path),t.setCoords()};i.registerpalette("shapes",{order:1,collectionName:"shapes",shapes:{drawingpath:{name:"path",displayName:"Vẽ",activeIcon:"brush_w.png",inactiveIcon:"brush_g.png",toolAction:null,modifyAction:function(t){console.log("path");var e=r.getCanvasByBoardId(t.boardId),i=r.getObjectById(t.uid,e),n=t.object;o(i,n)},applyProperties:function(t){n._applyProperties(t)},properties:[{name:"left",type:"number",action:function(t){t.obj.set("left",t.property)},defaultvalue:100},{name:"top",type:"number",action:function(t){t.obj.set("top",t.property)},defaultvalue:100},{name:"scaleX",type:"number",action:function(t){t.obj.set("scaleX",t.property)},defaultvalue:1},{name:"scaleY",type:"number",action:function(t){t.obj.set("scaleY",t.property)},defaultvalue:1},{name:"stroke",type:"string",action:function(t){t.obj.set("stroke",t.property)},defaultvalue:"#00FF00"},{name:"strokeWidth",type:"number",action:function(t){t.obj.set("strokeWidth",t.property)},defaultvalue:1}]},text:{name:"text",displayName:"Chữ",activeIcon:"text_w.png",inactiveIcon:"text_g.png",toolAction:function(t){var e;e=t.text?t.text:"";var i=new fabric.Text(e,{left:t.left,top:t.top,fontFamily:"Arial",angle:t.angle,fill:t.fill,hasControls:!1,scaleX:t.scaleX,scaleY:t.scaleY,lockRotation:!0,fontWeight:"100",originX:"left",fontSize:t.fontSize?t.fontSize:"16px",textBackgroundColor:t.textBackgroundColor?t.textBackgroundColor:"#FFF",showEditIcon:!0});i.uid=t.uid,i.name="text",i.palette=t.palette,i.customName="text";var n=t.boardId;r.getCanvasByBoardId(n).add(i)},modifyAction:function(t){var e=r.getCanvasByBoardId(t.boardId),i=r.getObjectById(t.uid,e),n=t.object;o(i,n)},resizeAction:function(t){var e=r.getObjectById(t.uid);e.width=t.width,e.height=t.height},applyProperties:function(t){n._applyProperties(t)},properties:[{name:"left",type:"number",action:function(t){t.obj.set("left",t.property)},defaultvalue:100},{name:"top",type:"number",action:function(t){t.obj.set("top",t.property)},defaultvalue:100},{name:"scaleX",type:"number",action:function(t){t.obj.set("scaleX",t.property)},defaultvalue:1},{name:"scaleY",type:"number",action:function(t){t.obj.set("scaleY",t.property)},defaultvalue:1},{name:"fill",type:"string",action:function(t){t.obj.set("fill",t.property)},defaultvalue:"#222222"},{name:"stroke",type:"string",action:function(t){t.obj.set("stroke",t.property)},defaultvalue:"#00FF00"},{name:"angle",type:"number",action:function(t){t.obj.set("angle",t.property)},defaultvalue:0},{name:"text",type:"string",action:function(t){t.obj.set("text",t.property)},defaultvalue:""},{name:"strokeWidth",type:"number",action:function(t){t.obj.set("strokeWidth",t.property)},defaultvalue:0},{name:"fontSize",type:"number",action:function(t){t.obj.set("fontSize",t.property)},defaultvalue:13}]},rectangle:{name:"rectangle",displayName:"Chữ nhật",activeIcon:"rectangle_w.png",inactiveIcon:"rectangle_g.png",toolAction:function(t){var e=new fabric.Rect({width:t.width,height:t.height,left:t.left,top:t.top,fill:t.fill,stroke:t.stroke,scaleX:t.scaleX,scaleY:t.scaleY,strokeWidth:t.strokeWidth,originX:t.originX?t.originX:"left",originY:t.originY?t.originY:"top"});e.uid=t.uid,e.name="rectangle",e.palette=t.palette,e.setAngle(t.angle);var i=t.boardId;r.getCanvasByBoardId(i).add(e)},modifyAction:function(t){var e=r.getCanvasByBoardId(t.boardId),i=r.getObjectById(t.uid,e),n=t.object;o(i,n)},applyProperties:function(t){n._applyProperties(t)},properties:[{name:"left",type:"number",action:function(t){t.obj.set("left",t.property)},defaultvalue:100},{name:"top",type:"number",action:function(t){t.obj.set("top",t.property)},defaultvalue:100},{name:"width",type:"number",action:function(t){t.obj.set("width",t.property)},defaultvalue:1},{name:"height",type:"number",action:function(t){t.obj.set("height",t.property)},defaultvalue:1},{name:"scaleX",type:"number",action:function(t){t.obj.set("scaleX",t.property)},defaultvalue:1},{name:"scaleY",type:"number",action:function(t){t.obj.set("scaleY",t.property)},defaultvalue:1},{name:"fill",type:"string",action:function(t){t.obj.set("fill",t.property)},defaultvalue:0},{name:"stroke",type:"string",action:function(t){t.obj.set("stroke",t.property)},defaultvalue:"#000000"},{name:"angle",type:"number",action:function(t){t.obj.set("angle",t.property)},defaultvalue:0},{name:"strokeWidth",type:"number",action:function(t){t.obj.set("strokeWidth",t.property)},defaultvalue:1}]},circle:{name:"circle",displayName:"Hình tròn",activeIcon:"circle_w.png",inactiveIcon:"circle_g.png",toolAction:function(t){var e=new fabric.Circle({radius:t.radius,left:t.left,top:t.top,width:t.width,height:t.height,fill:t.fill,stroke:t.stroke,opacity:1,scaleX:t.scaleX,scaleY:t.scaleY,strokeWidth:t.strokeWidth,originX:t.originX?t.originX:"left",originY:t.originY?t.originY:"top"});e.setAngle(t.angle),e.uid=t.uid,e.name="circle",e.palette=t.palette,r.getCanvasByBoardId(t.boardId).add(e)},modifyAction:function(t){var e=r.getCanvasByBoardId(t.boardId),i=r.getObjectById(t.uid,e),n=t.object;o(i,n),i.radius=n.width/2},resizeAction:function(t){var e=r.getCanvasByBoardId(t.boardId),i=r.getObjectById(t.uid,e);
i.width/2==i.radius?(i.radius=t.height/2,i.width=t.height):i.height/2==i.radius?(i.radius=t.width/2,i.height=t.width):(i.radius=t.width/2,i.height=t.width)},applyProperties:function(t){n._applyProperties(t)},properties:[{name:"left",type:"number",action:function(t){t.obj.set("left",t.property)},defaultvalue:100},{name:"top",type:"number",action:function(t){t.obj.set("top",t.property)},defaultvalue:100},{name:"radius",type:"number",action:function(t){t.obj.set("radius",t.property/t.obj.scaleX)},defaultvalue:0},{name:"scaleX",type:"number",action:function(t){t.obj.set("scaleX",t.property)},defaultvalue:1},{name:"scaleY",type:"number",action:function(t){t.obj.set("scaleY",t.property)},defaultvalue:1},{name:"fill",type:"string",action:function(t){t.obj.set("fill",t.property)},defaultvalue:""},{name:"stroke",type:"string",action:function(t){t.obj.set("stroke",t.property)},defaultvalue:"#000000"},{name:"angle",type:"number",action:function(t){t.obj.set("angle",t.property)},defaultvalue:0},{name:"strokeWidth",type:"number",action:function(t){t.obj.set("strokeWidth",t.property)},defaultvalue:1}]},triangle:{name:"triangle",displayName:"Tam giác",activeIcon:"triangle_w.png",inactiveIcon:"triangle_g.png",toolAction:function(t){var e=new fabric.Triangle({left:t.left,top:t.top,fill:t.fill,stroke:t.stroke,scaleX:t.scaleX,scaleY:t.scaleY,strokeWidth:t.strokeWidth,originX:t.originX?t.originX:"left",originY:t.originY?t.originY:"top"});e.setAngle(t.angle),e.uid=t.uid,e.name="triangle",e.palette=t.palette,e.width=t.width,e.height=t.height,r.getCanvasByBoardId(t.boardId).add(e)},modifyAction:function(t){var e=r.getCanvasByBoardId(t.boardId),i=r.getObjectById(t.uid,e),n=t.object;o(i,n)},resizeAction:function(){},applyProperties:function(t){n._applyProperties(t)},properties:[{name:"left",type:"number",action:function(t){t.obj.set("left",t.property)},defaultvalue:100},{name:"top",type:"number",action:function(t){t.obj.set("top",t.property)},defaultvalue:100},{name:"scaleX",type:"number",action:function(t){t.obj.set("scaleX",t.property)},defaultvalue:1},{name:"scaleY",type:"number",action:function(t){t.obj.set("scaleY",t.property)},defaultvalue:1},{name:"fill",type:"string",action:function(t){t.obj.set("fill",t.property)},defaultvalue:"#D3DAE5"},{name:"stroke",type:"string",action:function(t){t.obj.set("stroke",t.property)},defaultvalue:"#000000"},{name:"width",type:"number",action:function(t){t.obj.set("width",t.property)},defaultvalue:0},{name:"height",type:"number",action:function(t){t.obj.set("height",t.property)},defaultvalue:0},{name:"angle",type:"number",action:function(t){t.obj.set("angle",t.property)},defaultvalue:0},{name:"strokeWidth",type:"number",action:function(t){t.obj.set("strokeWidth",t.property)},defaultvalue:1}]},line:{name:"line",displayName:"Đường thẳng",activeIcon:"line_w.png",inactiveIcon:"line_g.png",toolAction:function(t){if(t.points||(t.points=t.x1&&t.y1?[t.x1,t.y1,t.x2,t.y2]:[t.left-t.width/2,t.top,t.left+t.width/2,t.top]),t.style)var e=new fabric.Line(t.points,t.style);else var e=new fabric.Line(t.points,{fill:t.fill,stroke:t.stroke?t.stroke:"#000000",strokeWidth:t.strokeWidth,top:t.top,left:t.left,strokeDashArray:t.strokeDashArray?t.strokeDashArray:null,originX:t.originX?t.originX:"left",originY:t.originY?t.originY:"top"});return e.uid=t.uid,e.name="line",e.palette=t.palette,e.setAngle(t.angle),r.getCanvasByBoardId(t.boardId).add(e),e},modifyAction:function(t){var e=r.getCanvasByBoardId(t.boardId),i=r.getObjectById(t.uid,e),n=t.object;o(i,n),i.strokeWidth=n.strokeWidth},resizeAction:function(t){var e=r.getCanvasByBoardId(t.boardId),i=r.getObjectById(t.uid,e);i.left=t.left,i.top=t.top,i.angle=t._angle,i.height=t.strokeWidth},applyProperties:function(t){n._applyProperties(t)},properties:[{name:"left",type:"number",action:function(t){t.obj.set("left",t.property)},defaultvalue:100},{name:"top",type:"number",action:function(t){t.obj.set("top",t.property)},defaultvalue:100},{name:"scaleX",type:"number",action:function(t){t.obj.set("scaleX",t.property)},defaultvalue:1},{name:"scaleY",type:"number",action:function(t){t.obj.set("scaleY",t.property)},defaultvalue:1},{name:"fill",type:"string",action:function(t){t.obj.set("fill",t.property)},defaultvalue:"#000000"},{name:"strokeWidth",type:"number",action:function(t){t.obj.set("strokeWidth",t.property)},defaultvalue:1},{name:"angle",type:"number",action:function(t){t.obj.set("angle",t.property)},defaultvalue:0},{name:"strokeWidth",type:"number",action:function(t){t.obj.set("strokeWidth",t.property)},defaultvalue:1}]},importimage:{name:"importimage",displayName:"Image",activeIcon:"rectangle_w.png",inactiveIcon:"rectangle_g.png",toolAction:null,modifyAction:function(t){var e=r.getCanvasByBoardId(t.boardId),i=r.getObjectById(t.uid,e),n=t.object;o(i,n)},applyProperties:function(t){n._applyProperties(t)},properties:[{name:"left",type:"number",action:function(t){t.obj.set("left",t.property)},defaultvalue:100},{name:"top",type:"number",action:function(t){t.obj.set("top",t.property)},defaultvalue:100},{name:"width",type:"number",action:function(t){t.obj.set("width",t.property/t.obj.scaleX)},defaultvalue:200},{name:"height",type:"number",action:function(t){t.obj.set("height",t.property/t.obj.scaleY)},defaultvalue:100},{name:"scaleX",type:"number",action:function(t){t.obj.set("scaleX",t.property)},defaultvalue:1},{name:"scaleY",type:"number",action:function(t){t.obj.set("scaleY",t.property)},defaultvalue:1},{name:"angle",type:"number",action:function(t){t.obj.set("angle",t.property)},defaultvalue:0}]}}}),e.addTools()}),define("storm.palettes.basicshapes",function(){}),define("storm.palettes.components",["storm","storm.palettes","storm.util","storm.palettes.properties"],function(t,e,i,n){function r(e){$("#proptable").append("<tr><td><input id='txtbox' type='text'>Progress %</input> </td></tr>");var i=document.getElementById("txtbox"),n=e.paths[0].width;i.value=(n/2+e.paths[1].points[1].x)*(100/n),i.onfocus=function(){this.value=(n/2+e.paths[1].points[1].x)*(100/n)},i.onkeyup=function(){this.value<=100&&this.value>=0&&(e.paths[1].points[1].x=n*this.value/100-n/2,e.paths[1].points[2].x=n*this.value/100-n/2,t.comm.sendDrawMsg({action:"modified",args:[{uid:e.uid,object:e}]}),canvas.renderAll())}}function o(t,e,i,n){this.name=t,this.type=e?e:"number",this.defaultValue=null==i||void 0==i?100:i,this.action=n?n:function(e){e.obj.set(t,e.property)}}function s(t){this.name=t,this.properties=[],this.actions={},this.actionKeys=["toolAction","modifyAction","applyProperties","resizeAction"]}var a=function(t,e){var n=new fabric.PathGroup(e,{width:t.width,height:t.height});return n.set({left:t.left,top:t.top,angle:t.angle,scaleX:t.scaleX,scaleY:t.scaleY,originX:t.originX?t.originX:"left",originY:t.originY?t.originY:"top"}),n.setCoords(),n.name=t.name,n.uid=t.uid,n.palette=t.palette,i.getCanvasByBoardId(t.boardId).add(n),n},c=function(e,i){i.width&&(e.width=i.width),i.height&&(e.height=i.height),e.left=i.left,e.top=i.top,e.scaleX=i.scaleX,e.scaleY=i.scaleY,e.setAngle(i.angle),i.latex&&(e.latex=i.latex),i.type&&(e.type=i.type),i.showEditIcon&&(e.showEditIcon=i.showEditIcon),i.fill&&e.set("fill",i.fill),i.stroke&&e.set("stroke",i.stroke),e.text&&(e.text=i.text),e.source&&e.source!=i.src&&(e.source=i.src,fabric.Image.fromURL(e.source,function(t){t.set({left:i.left,top:i.top,scaleX:i.scaleX,scaleY:i.scaleY,source:i.src}),t.setAngle(i.angle),t.setCoords(),t.name="image",t.uid=e.uid,i.latex&&(t.latex=i.latex),i.type&&(t.type=i.type),i.showEditIcon&&(t.showEditIcon=i.showEditIcon),t.palette="components",canvas.remove(e),canvas.add(t),canvas.renderAll()})),void 0!=e.opacity&&(e.opacity=i.opacity),e.setCoords(),canvas.getActiveObject()===e&&t.quickMenu.showQuickMenu(e)},l=function(t){var e="",i=0;if(t.paths&&t.paths.length>=3){e="";for(var n=2;n<t.paths.length;n++)t.paths[n].points&&(e+=t.paths[n-1].text+"|",i++);e=e.substring(0,e.length-1)+"\n";for(var r=0,o=2+2*i;o<t.paths.length;o++)r==i&&(e=e.substring(0,e.length-1)+"\n",r=0),t.paths[o].text&&(e+=t.paths[o].text,r++,e=r>=1?e+"|":e);e=e.substring(0,e.length-1)+"\n"}return e},h=function(t,e){var i=e.split("\n"),n=[];n.push(t.paths[0]),n.push(t.paths[1]),canvas.remove(t);for(var r=i[0],o=r.split("|"),s=0,a=0;a<o.length;a++)if(""!=o[a]){var c=new fabric.Text(o[a],{fontSize:16,fontFamily:"delicious_500",fontWeight:16,left:-t.paths[0].width/2+t.paths[0].width/(4*o.length)+s++*(t.paths[0].width/o.length)+10,top:-t.paths[0].height/2+10,stroke:"#000000"}),l=new fabric.Polyline([{x:-t.paths[0].width/2+s*(t.width/o.length),y:-t.height/2},{x:-t.paths[0].width/2+s*(t.width/o.length)+.005,y:t.height/2}],{fill:"#ffffff",stroke:"#aaa"});n.push(c),n.push(l)}for(var a=1;a<i.length;a++)if(""!=i[a])for(var h=i[a].split("|"),u="",s=0;s<o.length;s++){u=h[s],u||(u=" ");var c=new fabric.Text(u,{fontSize:16,fontFamily:"delicious_500",fontWeight:16,left:-t.paths[0].width/2+t.paths[0].width/(4*o.length)+s*(t.paths[0].width/o.length)+10,top:-t.paths[0].height/2+20*a+10,stroke:"#000000"});n.push(c)}var d=new fabric.PathGroup(n,{width:n[0].width,height:n[0].height});return d.set({left:t.left,top:t.top,angle:0,scaleX:1,scaleY:1}),d.setCoords(),d.name="table",d.uid=t.uid,d.palette="components",canvas.add(d),canvas.renderAll(),d},u=function(e){$("#proptable").append("<tr id = 'txtrow'><td id= 'txttd' valign='top'><label style = 'text-align:right; vertical-align:top' id='labl' for='txtarea'>text:</label></td><td><textarea id='txtarea' cols= '10' style='height:75px'></textarea> </td></tr>");var i=document.getElementById("txtarea"),n=l(e);i.value=""==n?i.value:n,i.onkeyup=function(){if(canvas.getActiveObject()){var e=h(canvas.getActiveObject(),i.value);t.comm.sendDrawMsg({action:"modified",args:[{uid:e.uid,object:e}]}),t.isUpdatingProperties=!0,canvas.setActiveObject(e),t.isUpdatingProperties=!1}}};(function(){this.export=function(){var t={};return t.name=this.name,t.type=this.type,t.defaultvalue=this.defaultValue,t.action=this.action,t}}).call(o.prototype),function(){var t=function(t,e,i){var n="",r=0;for(r=0;r<i.length;r++)n=i[r],t[n]=e[n]},e=function(t){return t.charAt(0).toUpperCase()+t.slice(1)};this.export=function(){var i={};return i.name=this.name,i.displayName=e(this.name),i.activeIcon=this.name+"_w.png",i.inactiveIcon=this.name+"_g.png",i.properties=this.properties,t(i,this.actions,this.actionKeys),i},this.addProperty=function(t,e,i,n){this.properties.push(new o(t,i,e,n).export())},this.addProperties=function(t){var e=0;for(e=0;e<t.length;e++)this.addProperty(t[e])},this.addStringProperty=function(t,e){this.addProperty(t,e,"string",null)},this.addActions=function(t){this.actions=t},this.addDimensionAndScale=function(){this.addProperties(["left","top"]),this.addProperty("angle",0),this.addProperty("scaleX",1),this.addProperty("scaleY",1)}}.call(s.prototype);var d=new s("div");d.addDimensionAndScale(),d.addProperties(["width","height"]),d.addStringProperty("stroke","#ccc"),d.addActions({toolAction:function(t){var e=new fabric.Rect({width:t.width,height:t.height,left:t.left,top:t.top,fill:null,stroke:t.stroke,scaleX:t.scaleX,scaleY:t.scaleY,originX:t.originX?t.originX:"left",originY:t.originY?t.originY:"top"});e.uid=t.uid,e.name="div",e.palette=t.palette,e.setAngle(t.angle),i.getCanvasByBoardId(t.boardId).add(e)},modifyAction:function(t){var e=i.getCanvasByBoardId(t.boardId),n=i.getObjectById(t.uid,e),r=t.object;c(n,r)},applyProperties:function(t){n._applyProperties(t)},resizeAction:function(t){var e=i.getCanvasByBoardId(t.boardId),n=i.getObjectById(t.uid,e);n.left=t.left,n.top=t.top,n.width=t.width,n.height=t.height,n.scaleX=t.scaleX,n.scaleY=t.scaleY,n.angle=t.angle,n.stroke=t.stroke}});var f=d.export();f.activeIcon="rectangle_w.png",f.inactiveIcon="rectangle_g.png";var p=new s("table");p.addProperties(["left","top"]),p.addProperty("angle",0),p.addActions({toolAction:function(t){var e=[],i="",n=new fabric.Rect({width:t.paths?t.paths[0].width:180,height:t.paths?t.paths[0].height:200,fill:"#fdfdfd",stroke:"#000000"}),r=new fabric.Polygon([{x:-n.width/2+1,y:-n.height/2+1},{x:n.width/2-1,y:-n.height/2+1},{x:n.width/2-1,y:-n.height/2+22},{x:-n.width/2+1,y:-n.height/2+22}],{fill:"#efefef",stroke:"#dfdfdf"});t.width=n.width,t.height=n.height,t.scaleX=1,t.scaleY=1,e.push(n),e.push(r);var o=a(t,e);i=l(t),i=t.paths?i:"column1|column2\ncontent1|content2\n",h(o,i,t)},modifyAction:function(t){var e=i.getCanvasByBoardId(t.boardId),n=i.getObjectById(t.uid,e),r=t.object,o="";c(n,r);for(var s in r.paths[0])n.paths[0][s]=r.paths[0][s];n.paths[1].points=[{x:-r.width/2+1,y:-r.height/2+1},{x:r.width/2-1,y:-r.height/2+1},{x:r.width/2-1,y:-r.height/2+22},{x:-r.width/2+1,y:-r.height/2+22}],o=l(r),h(n,o)},resizeAction:function(t){var e=i.getCanvasByBoardId(t.boardId),n=i.getObjectById(t.uid,e),r=1,o=0,s=0;if(n.paths[0].width=t.width,n.paths[0].height=t.height,n.paths[1].points=[{x:-t.width/2+1,y:-t.height/2+1},{x:t.width/2-1,y:-t.height/2+1},{x:t.width/2-1,y:-t.height/2+22},{x:-t.width/2+1,y:-t.height/2+22}],t.paths&&t.paths.length>=3){for(var a=2;a<t.paths.length;a++)t.paths[a].points&&o++;for(var a=2;a<t.paths.length;a++)t.paths[a].points&&(n.paths[a].points=[{x:-t.paths[0].width/2+r*(t.width/o),y:-t.height/2},{x:-t.paths[0].width/2+r*(t.width/o)+.005,y:t.height/2}],r++);r=0;for(var a=2;a<t.paths.length;a++)t.paths[a].text&&(r==o&&(r=0,s++),n.paths[a].left=-t.width/2+t.width/o/4+t.width/o*r+10,n.paths[a].top=-t.height/2+20*s+10,r++)}},applyProperties:function(t){n._applyProperties(t);var e=canvas.getActiveObject();u(e)}});var g=new s("image");g.addDimensionAndScale(),g.addActions({toolAction:function(t){t.src=t.src?t.src:"",t.scale||(t.scale=1),t.scale=t.scale>1?1:t.scale,t.scale=t.scale<0?1:t.scale;parseFloat(t.scale),fabric.Image.fromURL(t.src,function(e){e.set({left:t.left,top:t.top,scaleX:t.scaleX,scaleY:t.scaleY,source:t.src,originX:t.originX?t.originX:"left",originY:t.originY?t.originY:"top",opacity:t.opacity?t.opacity:0,latex:t.latex?t.latex:""}),e.setAngle(t.angle),e.name=t.name,e.uid=t.uid,e.palette=t.palette,i.getCanvasByBoardId(t.boardId).add(e),i.displayImage(e)})},modifyAction:function(t){var e=i.getCanvasByBoardId(t.boardId),n=i.getObjectById(t.uid,e),r=t.object;t.latex&&(r.latex=t.latex),t.showEditIcon&&(r.showEditIcon=t.showEditIcon),c(n,r),i.displayImage(n)},resizeAction:function(){},applyProperties:function(t){n._applyProperties(t)}});var m=new s("slider");m.addDimensionAndScale(),m.addActions({toolAction:function(t){var e=[];t.width=t.paths?t.paths[0].width:200,t.height=t.paths?t.paths[0].height:5;var i=new fabric.Rect({width:t.width,height:t.height,fill:"#dfdfdf",stroke:"#8f8f8f"}),n=new fabric.Rect({width:t.width/20,height:3*t.height,fill:"#8f8f8f",stroke:"#9f9f9f"}),r=new fabric.Polygon([{x:.3*-t.width,y:t.height/2},{x:.3*-t.width+.05,y:t.height/2},{x:.3*-t.width+.05,y:t.height/2+7.5},{x:.3*-t.width,y:t.height/2+7.5}],{fill:"#AAAAAA",stroke:"#AAAAAA"}),o=new fabric.Polygon([{x:.2*-t.width,y:t.height/2},{x:.2*-t.width+.05,y:t.height/2},{x:.2*-t.width+.05,y:t.height/2+4.5},{x:.2*-t.width,y:t.height/2+4.5}],{fill:"#AAAAAA",stroke:"#AAAAAA"}),s=new fabric.Polygon([{x:.3*t.width,y:t.height/2},{x:.3*t.width-.05,y:t.height/2},{x:.3*t.width-.05,y:t.height/2+7.5},{x:.3*t.width,y:t.height/2+7.5}],{fill:"#AAAAAA",stroke:"#AAAAAA"}),c=new fabric.Polygon([{x:.2*t.width,y:t.height/2},{x:.2*t.width-.05,y:t.height/2},{x:.2*t.width-.05,y:t.height/2+4.5},{x:.2*t.width,y:t.height/2+4.5}],{fill:"#AAAAAA",stroke:"#AAAAAA	"});e.push(i),e.push(n),e.push(r),e.push(s),e.push(o),e.push(c),a(t,e)},modifyAction:function(t){var e=i.getCanvasByBoardId(t.boardId),n=i.getObjectById(t.uid,e),r=t.object;c(n,r),n.paths[0].width=r.width,n.paths[0].height=r.height,n.paths[1].width=r.width/20,n.paths[1].height=3*r.height,n.paths[2].points=r.paths[2].points,n.paths[3].points=r.paths[3].points,n.paths[4].points=r.paths[4].points,n.paths[5].points=r.paths[5].points},resizeAction:function(t){var e=i.getCanvasByBoardId(t.boardId),n=i.getObjectById(t.uid,e);n.paths[0].width=t.width,n.paths[0].height=t.height,n.paths[1].width=t.width/20,n.paths[1].height=3*t.height,n.paths[2].points=[{x:.3*-t.width,y:t.height/2},{x:.3*-t.width+.05,y:t.height/2},{x:.3*-t.width+.05,y:t.height/2+7.5},{x:.3*-t.width,y:t.height/2+7.5}],n.paths[3].points=[{x:.2*-t.width,y:t.height/2},{x:.2*-t.width+.05,y:t.height/2},{x:.2*-t.width+.05,y:t.height/2+4.5},{x:.2*-t.width,y:t.height/2+4.5}],n.paths[4].points=[{x:.3*t.width,y:t.height/2},{x:.3*t.width-.05,y:t.height/2},{x:.3*t.width-.05,y:t.height/2+7.5},{x:.3*t.width,y:t.height/2+7.5}],n.paths[5].points=[{x:.2*t.width,y:t.height/2},{x:.2*t.width-.05,y:t.height/2},{x:.2*t.width-.05,y:t.height/2+4.5},{x:.2*t.width,y:t.height/2+4.5}]},applyProperties:function(t){n._applyProperties(t)}});var v=new s("progressbar");v.addActions({toolAction:function(t){var e=[];t.width=t.paths?t.paths[0].width:150,t.height=t.paths?t.paths[0].height:20;var i=new fabric.Rect({width:t.width,height:t.height,fill:"#ffffff",stroke:"#8f8f8f"}),n=new fabric.Polygon(t.paths?t.paths[1].points:[{x:-t.width/2,y:t.height/2},{x:-t.width/4,y:t.height/2},{x:-t.width/4,y:-t.height/2},{x:-t.width/2,y:-t.height/2}],{fill:"#9f9f9f",stroke:"#8f8f8f"});e.push(i),e.push(n),a(t,e)},modifyAction:function(t){var e=i.getCanvasByBoardId(t.boardId),n=i.getObjectById(t.uid,e),r=t.object;c(n,r),n.paths[0].width=r.width,n.paths[0].height=r.height,n.paths[1].points=[{x:-r.width/2,y:r.height/2},{x:-r.width/4,y:r.height/2},{x:-r.width/4,y:-r.height/2},{x:-r.width/2,y:-r.height/2}],n.paths[1].points[1].x=r.paths[1].points[1].x,n.paths[1].points[2].x=r.paths[1].points[2].x},resizeAction:function(t){var e=i.getCanvasByBoardId(args.boardId),n=i.getObjectById(t.uid,e),r=document.getElementById("txtbox");n.paths[0].width=t.width,n.paths[0].height=t.height,n.paths[1].points=[{x:-t.width/2,y:t.height/2},{x:-t.width/4,y:t.height/2},{x:-t.width/4,y:-t.height/2},{x:-t.width/2,y:-t.height/2}],n.paths[1].points[1].x=t.width*r.value/100-t.width/2,n.paths[1].points[2].x=t.width*r.value/100-t.width/2},applyProperties:function(t){n._applyProperties(t),r(canvas.getActiveObject())}}),v.addDimensionAndScale();var b=v.export();b.displayName="Progress Bar",e.registerpalette("components",{order:3,collectionName:"components",shapes:{table:p.export(),div:f,image:g.export(),slider:m.export(),progressbar:b}})}),define("storm.setup",["storm","storm.util","licode.client","storm.fabric","storm.comm","storm.main","storm.containers","boards","storm.containers.devices","storm.layouts","features/modified-by-user","features/list-users","features/chat","features/popup","features/question","features/user-actions","storm.events","storm.ui","board.files","board.scroll","board.session","board.sync","board.pdf","board.mouse","board.export","board.quick-menu","user","storm.palettes","storm.palettes.basicshapes","storm.palettes.components"],function(t,e,i,n,r,o,s,a,c,l,h,u,d,f,p,g,m,v,b,y,x,w,C,S,A,k,_,T){$(function(){var e=window.location.protocol+"//"+window.location.host,n=new r(e);n.onContainerDraw=function(e){if(t.containerName="empty"==e?e:e.parent.container,"empty"!==t.containerName){s.containerName=t.containerName;var i=e.parent,n=e.children;return t.currentBoardId=i.active?i.active:i.boardId,s.canvasWidth=i.canvasWidth,s.canvasHeight=i.canvasHeight,s.setContainer(t.containerName,"old",s.canvasWidth,s.canvasHeight),$("#boardName").text(i.name),$("#boardName").css("top",$("#boardName").width()+60),t.dataBoards[i.boardId]=i,x.setTime(),w.displaySyncButton(i.sync),n.length>0&&n.forEach(function(e){e.boardId&&(t.dataBoards[e.boardId]=e,a.createChildBoardFromServer(e))}),void a.setActiveBoard(t.currentBoardId,!0)}},t.comm=n,t.main=o,t.palettes=T,t.ui=v,t.boards=a,t.quickMenu=k,t.user=_,a.init(),h.init(),u.init(),d.init(),f.init(),g.init(),i.init(),b.init(),y.init(),x.init(),w.init(),C.init(),S.init(),A.init(),k.init()})}),function(){function t(){}function e(t){var e=f.call(arguments,1);return function(){return t.apply(this,e)}}function i(t,e){if(!e)throw new Error("prayer failed: "+t)}function n(t){i("a direction was passed",t===v||t===b)}function r(e,i,n,r){function o(){h=s;var t=l.selection?"$"+l.selection.latex()+"$":"";w.select(t)}function a(){d.detach(),f.focused=!1}var c=e.contents().detach();n||e.addClass("mathquill-rendered-math"),i.jQ=e.attr(u,i.id),i.revert=function(){e.empty().unbind(".mathquill").removeClass("mathquill-rendered-math mathquill-editable mathquill-textbox").append(c)};var l=i.cursor=ce(i);i.renderLatex(c.text());var h,d=i.textarea=y('<span class="textarea"><textarea></textarea></span>'),f=d.children();i.selectionChanged=function(){h===s&&(h=setTimeout(o)),P(e[0])},e.bind("selectstart.mathquill",function(t){t.target!==f[0]&&t.preventDefault(),t.stopPropagation()});var p,m=l.blink;if(e.bind("mousedown.mathquill",function(i){function n(t){return l.seek(y(t.target),t.pageX,t.pageY),(l[v]!==p[v]||l.parent!==p.parent)&&l.selectFrom(p),!1}function o(t){return delete t.target,n(t)}function a(t){p=s,l.blink=m,l.selection||(r?l.show():d.detach()),e.unbind("mousemove",n),y(t.target.ownerDocument).unbind("mousemove",o).unbind("mouseup",a)}return setTimeout(function(){f.focus(),f.focused=!0}),l.blink=t,l.seek(y(i.target),i.pageX,i.pageY),p=x(l.parent,l[v],l[b]),r||f.focused||e.prepend(d),e.mousemove(n),y(i.target.ownerDocument).mousemove(o).mouseup(a),!1}),!r){var w=g(f,{container:e});return e.bind("cut paste",!1).bind("copy",o).prepend('<span class="selectable">$'+i.latex()+"$</span>"),void f.blur(function(){l.clearSelection(),setTimeout(a)})}var w=g(f,{container:e,key:function(t,e){l.parent.bubble("onKey",t,e)},text:function(t){l.parent.bubble("onText",t)},cut:function(t){l.selection&&setTimeout(function(){l.prepareEdit(),l.parent.bubble("redraw")}),t.stopPropagation()},paste:function(t){t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}",l.writeLatex(t).show()}});e.prepend(d),e.addClass("mathquill-editable"),n&&e.addClass("mathquill-textbox"),f.focus(function(t){l.parent||l.insAtRightEnd(i),l.parent.jQ.addClass("hasCursor"),l.selection?(l.selection.jQ.removeClass("blur"),setTimeout(i.selectionChanged)):l.show(),t.stopPropagation()}).blur(function(t){l.hide().parent.blur(),l.selection&&l.selection.jQ.addClass("blur"),t.stopPropagation()}),e.bind("focus.mathquill blur.mathquill",function(t){f.trigger(t)}).blur()}function o(t,e,i){return p(Q,{ctrlSeq:t,htmlTemplate:"<"+e+" "+i+">&0</"+e+">"})}var s,a,c,l=window.jQuery,h="mathquill-command-id",u="mathquill-block-id",d=Math.min,f=(Math.max,[].slice),p=function(t,e,i){function n(t){return"object"==typeof t}function r(t){return"function"==typeof t}function o(){}return function s(a,c){function l(){var t=new h;return r(t.init)&&t.init.apply(t,arguments),t}function h(){}c===i&&(c=a,a=Object),l.Bare=h;var u,d=o[t]=a[t],f=h[t]=l[t]=l.p=new o;return f.constructor=l,l.mixin=function(e){return h[t]=l[t]=s(l,e)[t],l},(l.open=function(t){if(u={},r(t)?u=t.call(l,f,d,l,a):n(t)&&(u=t),n(u))for(var i in u)e.call(u,i)&&(f[i]=u[i]);return r(f.init)||(f.init=a),l})(c)}}("prototype",{}.hasOwnProperty),g=function(){function e(t){var e,n=t.which||t.keyCode,r=i[n],o=[];return t.ctrlKey&&o.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&o.push("Meta"),t.altKey&&o.push("Alt"),t.shiftKey&&o.push("Shift"),e=r||String.fromCharCode(n),o.length||r?(o.push(e),o.join("-")):e}var i={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(i,n){function r(t){k=t,clearTimeout(b),b=setTimeout(t)}function o(e){k(),k=t,clearTimeout(b),S.val(e),e&&S[0].select()}function s(){var t=S[0];return"selectionStart"in t?t.selectionStart!==t.selectionEnd:!1}function a(t){var e=S.val();S.val(""),e&&t(e)}function c(){x(e(m),m)}function h(t){m=t,v=null,c()}function u(t){m&&v&&c(),v=t,r(d)}function d(){s()||a(y)}function f(){m=v=null}function p(){S.focus(),r(g)}function g(){a(w)}var m=null,v=null;n||(n={});var b,y=n.text||t,x=n.key||t,w=n.paste||t,C=n.cut||t,S=l(i),A=l(n.container||S),k=t;return A.bind("keydown keypress input keyup focusout paste",function(){k()}),A.bind({keydown:h,keypress:u,focusout:f,cut:C,paste:p}),{select:o}}}(),m=p(function(t,e,n){function r(t,e){throw t=t?"'"+t+"'":"EOF","Parse Error: "+e+" at "+t}t.init=function(t){this._=t},t.parse=function(t){function e(t,e){return e}return this.skip(a)._(t,e,r)},t.or=function(t){i("or is passed a parser",t instanceof n);var e=this;return n(function(i,n,r){function o(){return t._(i,n,r)}return e._(i,n,o)})},t.then=function(t){var e=this;return n(function(r,o,s){function a(e,r){var a=t instanceof n?t:t(r);return i("a parser is returned",a instanceof n),a._(e,o,s)}return e._(r,a,s)})},t.many=function(){var t=this;return n(function(e,i){function n(t,i){return e=t,o.push(i),!0}function r(){return!1}for(var o=[];t._(e,n,r););return i(e,o)})},t.times=function(t,e){arguments.length<2&&(e=t);var i=this;return n(function(n,r,o){function s(t,e){return h.push(e),n=t,!0}function a(t,e){return l=e,n=t,!1}function c(){return!1}for(var l,h=[],u=!0,d=0;t>d;d+=1)if(u=i._(n,s,a),!u)return o(n,l);for(;e>d&&u;d+=1)u=i._(n,s,c);return r(n,h)})},t.result=function(t){return this.then(s(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.map=function(t){return this.then(function(e){return s(t(e))})},t.skip=function(t){return this.then(function(e){return t.result(e)})};var o=(this.string=function(t){var e=t.length,i="expected '"+t+"'";return n(function(n,r,o){var s=n.slice(0,e);return s===t?r(n.slice(e),s):o(n,i)})},this.regex=function(t){i("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return n(function(i,n,r){var o=t.exec(i);if(o){var s=o[0];return n(i.slice(s.length),s)}return r(i,e)})}),s=n.succeed=function(t){return n(function(e,i){return i(e,t)})},a=(n.fail=function(t){return n(function(e,i,n){return n(e,t)})},n.letter=o(/^[a-z]/i),n.letters=o(/^[a-z]*/i),n.digit=o(/^[0-9]/),n.digits=o(/^[0-9]*/),n.whitespace=o(/^\s+/),n.optWhitespace=o(/^\s*/),n.any=n(function(t,e,i){return t?e(t.slice(1),t.charAt(0)):i(t,"expected any character")}),n.all=n(function(t,e){return e("",t)}),n.eof=n(function(t,e,i){return t?i(t,"expected EOF"):e(t,t)}))}),v=-1,b=1,y=p(l,function(t){t.insDirOf=function(t,e){return t===v?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===v?this.prependTo(e):this.appendTo(e)}}),x=p(function(t){t.parent=0,t[v]=0,t[b]=0,t.init=function(t,e,i){this.parent=t,this[v]=e,this[b]=i}}),w=p(function(t){t[v]=0,t[b]=0,t.parent=0,t.init=function(){this.ends={},this.ends[v]=0,this.ends[b]=0},t.children=function(){return C(this.ends[v],this.ends[b])},t.eachChild=function(t){return this.children().each(t)},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.adopt=function(t,e,i){return C(this,this).adopt(t,e,i),this},t.disown=function(){return C(this,this).disown(),this}}),C=p(function(t){function e(t,e,n){i("a parent is always present",t),i("leftward is properly set up",function(){return e?e[b]===n&&e.parent===t:t.ends[v]===n}()),i("rightward is properly set up",function(){return n?n[v]===e&&n.parent===t:t.ends[b]===e}())}t.init=function(t,e){i("no half-empty fragments",!t==!e),this.ends={},t&&(i("left end node is passed to Fragment",t instanceof w),i("right end node is passed to Fragment",e instanceof w),i("leftEnd and rightEnd have the same parent",t.parent===e.parent),this.ends[v]=t,this.ends[b]=e)},t.adopt=function(t,i,n){e(t,i,n);var r=this;r.disowned=!1;var o=r.ends[v];if(!o)return this;var s=r.ends[b];return i||(t.ends[v]=o),n?n[v]=s:t.ends[b]=s,r.ends[b][b]=n,r.each(function(e){e[v]=i,e.parent=t,i&&(i[b]=e),i=e}),r},t.disown=function(){var t=this,i=t.ends[v];if(!i||t.disowned)return t;t.disowned=!0;var n=t.ends[b],r=i.parent;return e(r,i[v],i),e(r,n,n[b]),i[v]?i[v][b]=n[b]:r.ends[v]=n[b],n[b]?n[b][v]=i[v]:r.ends[b]=i[v],t},t.each=function(t){var e=this,i=e.ends[v];if(!i)return e;for(;i!==e.ends[b][b]&&t.call(e,i)!==!1;i=i[b]);return e},t.fold=function(t,e){return this.each(function(i){t=e.call(this,t,i)}),t}}),S=function(){var t=0;return function(){return t+=1}}(),A=p(w,function(t,e){t.init=function(){e.init.call(this),this.id=S(),A[this.id]=this},t.toString=function(){return"[MathElement "+this.id+"]"},t.bubble=function(t){for(var e=f.call(arguments,1),i=this;i;i=i.parent){var n=i[t]&&i[t].apply(i,e);if(n===!1)break}return this},t.postOrder=function(t){var e=f.call(arguments,1);if("string"==typeof t){var i=t;t=function(t){i in t&&t[i].apply(t,e)}}!function n(e){e.eachChild(n),t(e)}(this)},t.jQ=y(),t.jQadd=function(t){this.jQ=this.jQ.add(t)},this.jQize=function(t){var e=y(t);return e.find("*").andSelf().each(function(){var t=y(this),e=t.attr("mathquill-command-id"),i=t.attr("mathquill-block-id");e&&A[e].jQadd(t),i&&A[i].jQadd(t)}),e},t.finalizeInsert=function(){var t=this;t.postOrder("finalizeTree"),t.postOrder("blur"),t.postOrder("respace"),t[b].respace&&t[b].respace(),t[v].respace&&t[v].respace(),t.postOrder("redraw"),t.bubble("redraw")}}),k=p(A,function(e,n){e.init=function(t,e,i){var r=this;n.init.call(r),r.ctrlSeq||(r.ctrlSeq=t),e&&(r.htmlTemplate=e),i&&(r.textTemplate=i)},e.replaces=function(t){t.disown(),this.replacedFragment=t},e.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},e.parser=function(){var t=ae.block,e=this;return t.times(e.numBlocks()).map(function(t){e.blocks=t;for(var i=0;i<t.length;i+=1)t[i].adopt(e,e.ends[b],0);return e})},e.createLeftOf=function(t){var e=this,i=e.replacedFragment;e.createBlocks(),A.jQize(e.html()),i&&(i.adopt(e.ends[v],0,0),i.jQ.appendTo(e.ends[v].jQ)),t.jQ.before(e.jQ),t[v]=e.adopt(t.parent,t[v],t[b]),e.finalizeInsert(t),e.placeCursor(t)},e.createBlocks=function(){for(var t=this,e=t.numBlocks(),i=t.blocks=Array(e),n=0;e>n;n+=1){var r=i[n]=T();r.adopt(t,t.ends[b],0)}},e.respace=t,e.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[v],function(t,e){return t.isEmpty()?t:e}))},e.remove=function(){return this.disown(),this.jQ.remove(),this.postOrder(function(t){delete A[t.id]}),this},e.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},e.html=function(){var t=this,e=t.blocks,n=" mathquill-command-id="+t.id,r=t.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);i("no unmatched angle brackets",r.join("")===this.htmlTemplate);for(var o=0,s=r[0];s;o+=1,s=r[o])if("/>"===s.slice(-2))r[o]=s.slice(0,-2)+n+"/>";else if("<"===s.charAt(0)){i("not an unmatched top-level close tag","/"!==s.charAt(1)),r[o]=s.slice(0,-1)+n+">";var a=1;do o+=1,s=r[o],i("no missing close tags",s),"</"===s.slice(0,2)?a-=1:"<"===s.charAt(0)&&"/>"!==s.slice(-2)&&(a+=1);while(a>0)}return r.join("").replace(/>&(\d+)/g,function(t,i){return" mathquill-block-id="+e[i].id+">"+e[i].join("html")})},e.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},e.textTemplate=[""],e.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(i,n){e+=1;var r=n.text();return i&&"("===t.textTemplate[e]&&"("===r[0]&&")"===r.slice(-1)?i+r.slice(1,-1)+t.textTemplate[e]:i+n.text()+(t.textTemplate[e]||"")})}}),_=p(k,function(e,i){e.init=function(t,e,n){n||(n=t&&t.length>1?t.slice(1):t),i.init.call(this,t,e,[n])},e.parser=function(){return m.succeed(this)},e.numBlocks=function(){return 0},e.replaces=function(t){t.remove()},e.createBlocks=t,e.latex=function(){return this.ctrlSeq},e.text=function(){return this.textTemplate},e.placeCursor=t,e.isEmpty=function(){return!0}}),T=p(A,function(t){t.join=function(t){return this.foldChildren("",function(e,i){return e+i[t]()})},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[v]===this.ends[b]?this.ends[v].text():"("+this.join("text")+")"},t.isEmpty=function(){return 0===this.ends[v]&&0===this.ends[b]
},t.write=function(t,e,i){var n;n=e.match(/^[a-eg-zA-Z]$/)?Z(e):(n=I[e]||L[e])?n(e):te(e),i&&n.replaces(i),n.createLeftOf(t)},t.focus=function(){return this.jQ.addClass("hasCursor"),this.jQ.removeClass("empty"),this},t.blur=function(){return this.jQ.removeClass("hasCursor"),this.isEmpty()&&this.jQ.addClass("empty"),this}}),O=p(C,function(t,e){t.init=function(t,i){e.init.call(this,t,i||t),this.jQ=this.fold(y(),function(t,e){return e.jQ.add(t)})},t.latex=function(){return this.fold("",function(t,e){return t+e.latex()})},t.remove=function(){return this.jQ.remove(),this.each(function(t){t.postOrder(function(t){delete A[t.id]})}),this.disown()}}),j=p(T,function(t,e){t.latex=function(){return e.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},t.text=function(){return this.foldChildren("",function(t,e){return t+e.text()})},t.renderLatex=function(t){var e=this.jQ;e.children().slice(1).remove(),this.ends[v]=this.ends[b]=0,delete this.cursor.selection,this.cursor.insAtRightEnd(this).writeLatex(t)},t.onKey=function(t,e){switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":for(;this.cursor[v]||this.cursor.selection;)this.cursor.backspace();break;case"Shift-Backspace":case"Backspace":this.cursor.backspace();break;case"Esc":case"Tab":case"Spacebar":var i=this.cursor.parent;if(i===this.cursor.root)return void("Spacebar"===t&&e.preventDefault());this.cursor.prepareMove(),i[b]?this.cursor.insAtLeftEnd(i[b]):this.cursor.insRightOf(i.parent);break;case"Shift-Tab":case"Shift-Esc":case"Shift-Spacebar":var i=this.cursor.parent;if(i===this.cursor.root)return void("Shift-Spacebar"===t&&e.preventDefault());this.cursor.prepareMove(),i[v]?this.cursor.insAtRightEnd(i[v]):this.cursor.insLeftOf(i.parent);break;case"Enter":break;case"End":this.cursor.prepareMove().insAtRightEnd(this.cursor.parent);break;case"Ctrl-End":this.cursor.prepareMove().insAtRightEnd(this);break;case"Shift-End":for(;this.cursor[b];)this.cursor.selectRight();break;case"Ctrl-Shift-End":for(;this.cursor[b]||this.cursor.parent!==this;)this.cursor.selectRight();break;case"Home":this.cursor.prepareMove().insAtLeftEnd(this.cursor.parent);break;case"Ctrl-Home":this.cursor.prepareMove().insAtLeftEnd(this);break;case"Shift-Home":for(;this.cursor[v];)this.cursor.selectLeft();break;case"Ctrl-Shift-Home":for(;this.cursor[v]||this.cursor.parent!==this;)this.cursor.selectLeft();break;case"Left":this.cursor.moveLeft();break;case"Shift-Left":this.cursor.selectLeft();break;case"Ctrl-Left":break;case"Right":this.cursor.moveRight();break;case"Shift-Right":this.cursor.selectRight();break;case"Ctrl-Right":break;case"Up":this.cursor.moveUp();break;case"Down":this.cursor.moveDown();break;case"Shift-Up":if(this.cursor[v])for(;this.cursor[v];)this.cursor.selectLeft();else this.cursor.selectLeft();case"Shift-Down":if(this.cursor[b])for(;this.cursor[b];)this.cursor.selectRight();else this.cursor.selectRight();case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":for(;this.cursor[b]||this.cursor.selection;)this.cursor.deleteForward();break;case"Shift-Del":case"Del":this.cursor.deleteForward();break;case"Meta-A":case"Ctrl-A":if(this!==this.cursor.root)return;for(this.cursor.prepareMove().insAtRightEnd(this);this.cursor[v];)this.cursor.selectLeft();break;default:return!1}return e.preventDefault(),!1},t.onText=function(t){return this.cursor.write(t),!1}}),E=p(k,function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mathquill-rendered-math">&0</span>',t.createBlocks=function(){this.ends[v]=this.ends[b]=j(),this.blocks=[this.ends[v]],this.ends[v].parent=this,this.ends[v].cursor=this.cursor,this.ends[v].write=function(t,e,i){"$"!==e?T.prototype.write.call(this,t,e,i):this.isEmpty()?(t.insRightOf(this.parent).backspace().show(),te("\\$","$").createLeftOf(t)):t[b]?t[v]?T.prototype.write.call(this,t,e,i):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[v].latex()+"$"}}),D=p(T,function(t){t.renderLatex=function(t){var e=this,i=e.cursor;e.jQ.children().slice(1).remove(),e.ends[v]=e.ends[b]=0,delete i.selection,i.show().insAtRightEnd(e);var n=m.regex,r=m.string,o=m.eof,s=m.all,a=r("$").then(ae).skip(r("$").or(o)).map(function(t){var e=E(i);e.createBlocks();var n=e.ends[v];return t.children().adopt(n,0,0),e}),c=r("\\$").result("$"),l=c.or(n(/^[^$]/)).map(te),h=a.or(l).many(),u=h.skip(o).or(s.result(!1)).parse(t);if(u){for(var d=0;d<u.length;d+=1)u[d].adopt(e,e.ends[b],0);var f=e.join("html");A.jQize(f).appendTo(e.jQ),this.finalizeInsert()}},t.onKey=function(t){"Spacebar"!==t&&"Shift-Spacebar"!==t&&j.prototype.onKey.apply(this,arguments)},t.onText=j.prototype.onText,t.write=function(t,e,i){if(i&&i.remove(),"$"===e)E(t).createLeftOf(t);else{var n;"<"===e?n="&lt;":">"===e&&(n="&gt;"),te(e,n).createLeftOf(t)}}}),I={},L={},P=t,M=document.createElement("div"),B=M.style,R={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(var F in R)if(F in B){c=F;break}c?a=function(t,e,i){t.css(c,"scale("+e+","+i+")")}:"filter"in B?(P=function(t){t.className=t.className},a=function(t,e,i){function n(){t.css("marginRight",(r.width()-1)*(e-1)/e+"px")}e/=1+(i-1)/2,t.css("fontSize",i+"em"),t.hasClass("matrixed-container")||t.addClass("matrixed-container").wrapInner('<span class="matrixed"></span>');var r=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')");n();var o=setInterval(n);y(window).load(function(){clearTimeout(o),n()})}):a=function(t,e,i){t.css("fontSize",i+"em")};var $=p(k,function(t,e){t.init=function(t,i,n){e.init.call(this,t,"<"+i+" "+n+">&0</"+i+">")}});L.mathrm=e($,"\\mathrm","span",'class="roman font"'),L.mathit=e($,"\\mathit","i",'class="font"'),L.mathbf=e($,"\\mathbf","b",'class="font"'),L.mathsf=e($,"\\mathsf","span",'class="sans-serif font"'),L.mathtt=e($,"\\mathtt","span",'class="monospace font"'),L.underline=e($,"\\underline","span",'class="non-leaf underline"'),L.overline=L.bar=e($,"\\overline","span",'class="non-leaf overline"');var N=p(k,function(t,e){t.init=function(t,i,n){e.init.call(this,t,"<"+i+' class="non-leaf">&0</'+i+">",[n])},t.finalizeTree=function(){function t(t){var e=this.parent,i=t;do{if(i[b])return t.insLeftOf(e),!1;i=i.parent.parent}while(i!==e);return t.insRightOf(e),!1}i("SupSub is only _ and ^","^"===this.ctrlSeq||"_"===this.ctrlSeq),"_"===this.ctrlSeq?(this.down=this.ends[v],this.ends[v].up=t):(this.up=this.ends[v],this.ends[v].down=t)},t.latex=function(){var t=this.ends[v].latex();return 1===t.length?this.ctrlSeq+t:this.ctrlSeq+"{"+(t||" ")+"}"},t.redraw=function(){this[v]&&this[v].respace(),this[v]instanceof N||(this.respace(),!this[b]||this[b]instanceof N||this[b].respace())},t.respace=function(){if("\\int "===this[v].ctrlSeq||this[v]instanceof N&&this[v].ctrlSeq!=this.ctrlSeq&&this[v][v]&&"\\int "===this[v][v].ctrlSeq?this.limit||(this.limit=!0,this.jQ.addClass("limit")):this.limit&&(this.limit=!1,this.jQ.removeClass("limit")),this.respaced=this[v]instanceof N&&this[v].ctrlSeq!=this.ctrlSeq&&!this[v].respaced,this.respaced){var t=+this.jQ.css("fontSize").slice(0,-2),e=this[v].jQ.outerWidth(),i=this.jQ.outerWidth();this.jQ.css({left:(this.limit&&"_"===this.ctrlSeq?-.25:0)-e/t+"em",marginRight:.1-d(i,e)/t+"em"})}else this.jQ.css(this.limit&&"_"===this.ctrlSeq?{left:"-.25em",marginRight:""}:{left:"",marginRight:""});return this[b]instanceof N&&this[b].respace(),this}});L.subscript=L._=e(N,"_","sub","_"),L.superscript=L.supscript=L["^"]=e(N,"^","sup","**");var z=L.frac=L.dfrac=L.cfrac=L.fraction=p(k,function(t){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="fraction non-leaf"><span class="numerator">&0</span><span class="denominator">&1</span><span style="display:inline-block;width:0">&nbsp;</span></span>',t.textTemplate=["(","/",")"],t.finalizeTree=function(){this.up=this.ends[b].up=this.ends[v],this.down=this.ends[v].down=this.ends[b]}}),W=L.over=I["/"]=p(z,function(t,e){t.createLeftOf=function(t){if(!this.replacedFragment){for(var i=t[v];i&&!(i instanceof ne||i instanceof Q||i instanceof oe||/^[,;:]$/.test(i.ctrlSeq));)i=i[v];i instanceof oe&&i[b]instanceof N&&(i=i[b],i[b]instanceof N&&i[b].ctrlSeq!=i.ctrlSeq&&(i=i[b])),i!==t[v]&&(this.replaces(O(i[b]||t.parent.ends[v],t[v])),t[v]=i)}e.createLeftOf.call(this,t)}}),q=L.sqrt=L["√"]=p(k,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="non-leaf"><span class="scaled sqrt-prefix">&radic;</span><span class="non-leaf sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return ae.optBlock.then(function(t){return ae.block.map(function(e){var i=H();return i.blocks=[t,e],t.adopt(i,0,0),e.adopt(i,t,0),i})}).or(e.parser.call(this))},t.redraw=function(){var t=this.ends[b].jQ;a(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),H=(L.vec=p(k,function(t){t.ctrlSeq="\\vec",t.htmlTemplate='<span class="non-leaf"><span class="vector-prefix">&rarr;</span><span class="vector-stem">&0</span></span>',t.textTemplate=["vec(",")"]}),L.nthroot=p(q,function(t){t.htmlTemplate='<sup class="nthroot non-leaf">&0</sup><span class="scaled"><span class="sqrt-prefix scaled">&radic;</span><span class="sqrt-stem non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[v].latex()+"]{"+this.ends[b].latex()+"}"}})),X=p(k,function(t,e){t.init=function(t,i,n,r){e.init.call(this,"\\left"+n,'<span class="non-leaf"><span class="scaled paren">'+t+'</span><span class="non-leaf">&0</span><span class="scaled paren">'+i+"</span></span>",[t,i]),this.end="\\right"+r},t.jQadd=function(){e.jQadd.apply(this,arguments);var t=this.jQ;this.bracketjQs=t.children(":first").add(t.children(":last"))},t.latex=function(){return this.ctrlSeq+this.ends[v].latex()+this.end},t.redraw=function(){var t=this.ends[v].jQ,e=t.outerHeight()/+t.css("fontSize").slice(0,-2);a(this.bracketjQs,d(1+.2*(e-1),1.2),1.05*e)}});L.left=p(k,function(t){t.parser=function(){var t=m.regex,e=m.string,i=m.succeed,n=m.optWhitespace;return n.then(t(/^(?:[([|]|\\\{)/)).then(function(r){"\\"===r.charAt(0)&&(r=r.slice(1));var o=I[r]();return ae.map(function(t){o.blocks=[t],t.adopt(o,0,0)}).then(e("\\right")).skip(n).then(t(/^(?:[\])|]|\\\})/)).then(function(t){return t.slice(-1)!==o.end.slice(-1)?m.fail("open doesn't match close"):i(o)})})}}),L.right=p(k,function(t){t.parser=function(){return m.fail("unmatched \\right")}}),L.lbrace=I["{"]=e(X,"{","}","\\{","\\}"),L.langle=L.lang=e(X,"&lang;","&rang;","\\langle ","\\rangle ");var Y=p(X,function(t,e){t.createLeftOf=function(t){t[b]||!t.parent.parent||t.parent.parent.end!==this.end||this.replacedFragment?e.createLeftOf.call(this,t):t.insRightOf(t.parent.parent)},t.placeCursor=function(t){this.ends[v].blur(),t.insRightOf(this)}});L.rbrace=I["}"]=e(Y,"{","}","\\{","\\}"),L.rangle=L.rang=e(Y,"&lang;","&rang;","\\langle ","\\rangle ");var U=function(t,e){t.init=function(t,i){e.init.call(this,t,i,t,i)}},G=p(X,U);L.lparen=I["("]=e(G,"(",")"),L.lbrack=L.lbracket=I["["]=e(G,"[","]");var V=p(Y,U);L.rparen=I[")"]=e(V,"(",")"),L.rbrack=L.rbracket=I["]"]=e(V,"[","]");var Q=(L.lpipe=L.rpipe=I["|"]=p(G,function(t,e){t.init=function(){e.init.call(this,"|","|")},t.createLeftOf=Y.prototype.createLeftOf}),I.$=L.text=L.textnormal=L.textrm=L.textup=L.textmd=p(k,function(t,e){t.ctrlSeq="\\text",t.htmlTemplate='<span class="text">&0</span>',t.replaces=function(t){t instanceof O?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.textTemplate=['"','"'],t.parser=function(){var t=this,e=m.string,i=m.regex,n=m.optWhitespace;return n.then(e("{")).then(i(/^[^}]*/)).skip(e("}")).map(function(e){t.createBlocks();for(var i=t.ends[v],n=0;n<e.length;n+=1){var r=te(e.charAt(n));r.adopt(i,i.ends[b],0)}return t})},t.createBlocks=function(){this.ends[v]=this.ends[b]=J(),this.blocks=[this.ends[v]],this.ends[v].parent=this},t.finalizeInsert=function(){this.ends[v].blur=function(){return delete this.blur,this},e.finalizeInsert.call(this)},t.createLeftOf=function(t){if(e.createLeftOf.call(this,this.cursor=t),this.replacedText)for(var i=0;i<this.replacedText.length;i+=1)this.ends[v].write(t,this.replacedText.charAt(i))}})),J=p(T,function(t,e){t.onKey=function(t){return"Spacebar"===t||"Shift-Spacebar"===t?!1:void 0},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this.parent)},t.write=function(t,e,i){if(i&&i.remove(),"$"!==e){var n;"<"===e?n="&lt;":">"===e&&(n="&gt;"),te(e,n).createLeftOf(t)}else if(this.isEmpty())t.insRightOf(this.parent).backspace(),te("\\$","$").createLeftOf(t);else if(t[b])if(t[v]){var r=Q();r.replaces(O(t[b],this.ends[b])),t.insRightOf(this.parent),r.adopt=function(){delete this.adopt,this.adopt.apply(this,arguments),this[v]=0},r.createLeftOf(t),r[v]=this.parent,t.insLeftOf(r)}else t.insLeftOf(this.parent);else t.insRightOf(this.parent);return!1},t.blur=function(){if(this.jQ.removeClass("hasCursor"),this.isEmpty()){var t=this.parent,e=t.cursor;e.parent===this?this.jQ.addClass("empty"):(e.hide(),t.remove(),e[b]===t?e[b]=t[b]:e[v]===t&&(e[v]=t[v]),e.show().parent.bubble("redraw"))}return this},t.focus=function(){e.focus.call(this);var t=this.parent;if(t[b].ctrlSeq===t.ctrlSeq){var i=this,n=t.cursor,r=t[b].ends[v];r.eachChild(function(t){t.parent=i,t.jQ.appendTo(i.jQ)}),this.ends[b]?this.ends[b][b]=r.ends[v]:this.ends[v]=r.ends[v],r.ends[v][v]=this.ends[b],this.ends[b]=r.ends[b],r.parent.remove(),n[v]?n.insRightOf(n[v]):n.insAtLeftEnd(this),n.parent.bubble("redraw")}else if(t[v].ctrlSeq===t.ctrlSeq){var n=t.cursor;n[v]?t[v].ends[v].focus():n.insAtRightEnd(t[v].ends[v])}return this}});L.em=L.italic=L.italics=L.emph=L.textit=L.textsl=o("\\textit","i",'class="text"'),L.strong=L.bold=L.textbf=o("\\textbf","b",'class="text"'),L.sf=L.textsf=o("\\textsf","span",'class="sans-serif text"'),L.tt=L.texttt=o("\\texttt","span",'class="monospace text"'),L.textsc=o("\\textsc","span",'style="font-variant:small-caps" class="text"'),L.uppercase=o("\\uppercase","span",'style="text-transform:uppercase" class="text"'),L.lowercase=o("\\lowercase","span",'style="text-transform:lowercase" class="text"');{var K=(I["\\"]=p(k,function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="latex-command-input non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[v].focus=function(){return this.parent.jQ.addClass("hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("empty"),this},this.ends[v].blur=function(){return this.parent.jQ.removeClass("hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("empty"),this}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this.cursor=t.insAtRightEnd(this.ends[v]),this._replacedFragment){var i=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("blur").bind("mousedown mousemove",function(t){return y(t.target=i).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}this.ends[v].write=function(t,e,i){i&&i.remove(),e.match(/[a-z]/i)?te(e).createLeftOf(t):(this.parent.renderCommand(),"\\"===e&&this.isEmpty()||this.parent.parent.write(t,e))}},t.latex=function(){return"\\"+this.ends[v].latex()+" "},t.onKey=function(t,e){return"Tab"===t||"Enter"===t||"Spacebar"===t?(this.renderCommand(),e.preventDefault(),!1):void 0},t.renderCommand=function(){this.jQ=this.jQ.last(),this.remove(),this[b]?this.cursor.insLeftOf(this[b]):this.cursor.insAtRightEnd(this.parent);var t=this.ends[v].latex();t||(t="backslash"),this.cursor.insertCmd(t,this._replacedFragment)}}),L.binom=L.binomial=p(k,function(t){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="paren scaled">(</span><span class="non-leaf"><span class="array non-leaf"><span>&0</span><span>&1</span></span></span><span class="paren scaled">)</span>',t.textTemplate=["choose(",",",")"],t.redraw=function(){var t=this.jQ.eq(1),e=t.outerHeight()/+t.css("fontSize").slice(0,-2),i=this.jQ.filter(".paren");a(i,d(1+.2*(e-1),1.2),1.05*e)}}));L.choose=p(K,function(t){t.createLeftOf=W.prototype.createLeftOf}),L.vector=p(k,function(t,e){t.ctrlSeq="\\vector",t.htmlTemplate='<span class="array"><span>&0</span></span>',t.latex=function(){return"\\begin{matrix}"+this.foldChildren([],function(t,e){return t.push(e.latex()),t}).join("\\\\")+"\\end{matrix}"},t.text=function(){return"["+this.foldChildren([],function(t,e){return t.push(e.text()),t}).join()+"]"},t.createLeftOf=function(t){e.createLeftOf.call(this,this.cursor=t)},t.onKey=function(t,e){var i=this.cursor.parent;if(i.parent===this){if("Enter"===t){var n=T();return n.parent=this,n.jQ=y("<span></span>").attr(u,n.id).insertAfter(i.jQ),i[b]?i[b][v]=n:this.ends[b]=n,n[b]=i[b],i[b]=n,n[v]=i,this.bubble("redraw").cursor.insAtRightEnd(n),e.preventDefault(),!1}if("Tab"===t&&!i[b]){if(i.isEmpty())return i[v]?(this.cursor.insRightOf(this),delete i[v][b],this.ends[b]=i[v],i.jQ.remove(),this.bubble("redraw"),e.preventDefault(),!1):void 0;var n=T();return n.parent=this,n.jQ=y("<span></span>").attr(u,n.id).appendTo(this.jQ),this.ends[b]=n,i[b]=n,n[v]=i,this.bubble("redraw").cursor.insAtRightEnd(n),e.preventDefault(),!1}if(8===e.which){if(i.isEmpty())return i[v]?(this.cursor.insAtRightEnd(i[v]),i[v][b]=i[b]):(this.cursor.insLeftOf(this),this.ends[v]=i[b]),i[b]?i[b][v]=i[v]:this.ends[b]=i[v],i.jQ.remove(),this.isEmpty()?this.cursor.deleteForward():this.bubble("redraw"),e.preventDefault(),!1;if(!this.cursor[v])return e.preventDefault(),!1}}}})}L.editable=p(E,function(t,e){t.init=function(){k.prototype.init.call(this,"\\editable")},t.jQadd=function(){var t=this;e.jQadd.apply(t,arguments);var i=t.ends[v].disown(),n=t.jQ.children().detach();t.ends[v]=t.ends[b]=j(),t.blocks=[t.ends[v]],t.ends[v].parent=t,r(t.jQ,t.ends[v],!1,!0),t.cursor=t.ends[v].cursor,i.children().adopt(t.ends[v],0,0),n.appendTo(t.ends[v].jQ),t.ends[v].cursor.insAtRightEnd(t.ends[v])},t.latex=function(){return this.ends[v].latex()},t.text=function(){return this.ends[v].text()}}),L.f=e(_,"f",'<var class="florin">&fnof;</var><span style="display:inline-block;width:0">&nbsp;</span>');var Z=p(_,function(t,e){t.init=function(t,i){e.init.call(this,t,"<var>"+(i||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return!this[v]||this[v]instanceof Z||this[v]instanceof ne||(t="*"+t),!this[b]||this[b]instanceof ne||"^"===this[b].ctrlSeq||(t+="*"),t}}),te=p(_,function(t,e){t.init=function(t,i){e.init.call(this,t,"<span>"+(i||t)+"</span>")}});I[" "]=e(te,"\\:"," "),L.prime=I["'"]=e(te,"'","&prime;");var ee=p(_,function(t,e){t.init=function(t,i){e.init.call(this,t,'<span class="nonSymbola">'+(i||t)+"</span>")}});L["@"]=ee,L["&"]=e(ee,"\\&","&amp;"),L["%"]=e(ee,"\\%","%"),L.alpha=L.beta=L.gamma=L.delta=L.zeta=L.eta=L.theta=L.iota=L.kappa=L.mu=L.nu=L.xi=L.rho=L.sigma=L.tau=L.chi=L.psi=L.omega=p(Z,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),L.phi=e(Z,"\\phi ","&#981;"),L.phiv=L.varphi=e(Z,"\\varphi ","&phi;"),L.epsilon=e(Z,"\\epsilon ","&#1013;"),L.epsiv=L.varepsilon=e(Z,"\\varepsilon ","&epsilon;"),L.piv=L.varpi=e(Z,"\\varpi ","&piv;"),L.sigmaf=L.sigmav=L.varsigma=e(Z,"\\varsigma ","&sigmaf;"),L.thetav=L.vartheta=L.thetasym=e(Z,"\\vartheta ","&thetasym;"),L.upsilon=L.upsi=e(Z,"\\upsilon ","&upsilon;"),L.gammad=L.Gammad=L.digamma=e(Z,"\\digamma ","&#989;"),L.kappav=L.varkappa=e(Z,"\\varkappa ","&#1008;"),L.rhov=L.varrho=e(Z,"\\varrho ","&#1009;"),L.pi=L.π=e(ee,"\\pi ","&pi;"),L.lambda=e(ee,"\\lambda ","&lambda;"),L.Upsilon=L.Upsi=L.upsih=L.Upsih=e(_,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),L.Gamma=L.Delta=L.Theta=L.Lambda=L.Xi=L.Pi=L.Sigma=L.Phi=L.Psi=L.Omega=L.forall=p(te,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}});var ie=p(k,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){t.writeLatex(this.latex)},t.parser=function(){var t=ae.parse(this.latex).children();return m.succeed(t)}});L["¹"]=e(ie,"^1"),L["²"]=e(ie,"^2"),L["³"]=e(ie,"^3"),L["¼"]=e(ie,"\\frac14"),L["½"]=e(ie,"\\frac12"),L["¾"]=e(ie,"\\frac34");var ne=p(_,function(t,e){t.init=function(t,i,n){e.init.call(this,t,'<span class="binary-operator">'+i+"</span>",n)}}),re=p(ne,function(t){t.init=te.prototype.init,t.respace=function(){return this.jQ[0].className=this[v]?this[v]instanceof ne&&this[b]&&!(this[b]instanceof ne)?"unary-operator":"binary-operator":"",this}});L["+"]=e(re,"+","+"),L["–"]=L["-"]=e(re,"-","&minus;"),L["±"]=L.pm=L.plusmn=L.plusminus=e(re,"\\pm ","&plusmn;"),L.mp=L.mnplus=L.minusplus=e(re,"\\mp ","&#8723;"),I["*"]=L.sdot=L.cdot=e(ne,"\\cdot ","&middot;"),L["="]=e(ne,"=","="),L["<"]=e(ne,"<","&lt;"),L[">"]=e(ne,">","&gt;"),L.notin=L.sim=L.cong=L.equiv=L.oplus=L.otimes=p(ne,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),L.times=e(ne,"\\times ","&times;","[x]"),L["÷"]=L.div=L.divide=L.divides=e(ne,"\\div ","&divide;","[/]"),L["≠"]=L.ne=L.neq=e(ne,"\\ne ","&ne;"),L.ast=L.star=L.loast=L.lowast=e(ne,"\\ast ","&lowast;"),L.therefor=L.therefore=e(ne,"\\therefore ","&there4;"),L.cuz=L.because=e(ne,"\\because ","&#8757;"),L.prop=L.propto=e(ne,"\\propto ","&prop;"),L["≈"]=L.asymp=L.approx=e(ne,"\\approx ","&asymp;"),L.lt=e(ne,"<","&lt;"),L.gt=e(ne,">","&gt;"),L["≤"]=L.le=L.leq=e(ne,"\\le ","&le;"),L["≥"]=L.ge=L.geq=e(ne,"\\ge ","&ge;"),L.isin=L["in"]=e(ne,"\\in ","&isin;"),L.ni=L.contains=e(ne,"\\ni ","&ni;"),L.notni=L.niton=L.notcontains=L.doesnotcontain=e(ne,"\\not\\ni ","&#8716;"),L.sub=L.subset=e(ne,"\\subset ","&sub;"),L.sup=L.supset=L.superset=e(ne,"\\supset ","&sup;"),L.nsub=L.notsub=L.nsubset=L.notsubset=e(ne,"\\not\\subset ","&#8836;"),L.nsup=L.notsup=L.nsupset=L.notsupset=L.nsuperset=L.notsuperset=e(ne,"\\not\\supset ","&#8837;"),L.sube=L.subeq=L.subsete=L.subseteq=e(ne,"\\subseteq ","&sube;"),L.supe=L.supeq=L.supsete=L.supseteq=L.supersete=L.superseteq=e(ne,"\\supseteq ","&supe;"),L.nsube=L.nsubeq=L.notsube=L.notsubeq=L.nsubsete=L.nsubseteq=L.notsubsete=L.notsubseteq=e(ne,"\\not\\subseteq ","&#8840;"),L.nsupe=L.nsupeq=L.notsupe=L.notsupeq=L.nsupsete=L.nsupseteq=L.notsupsete=L.notsupseteq=L.nsupersete=L.nsuperseteq=L.notsupersete=L.notsuperseteq=e(ne,"\\not\\supseteq ","&#8841;");var oe=p(_,function(t,e){t.init=function(t,i){e.init.call(this,t,"<big>"+i+"</big>")}});L["∑"]=L.sum=L.summation=e(oe,"\\sum ","&sum;"),L["∏"]=L.prod=L.product=e(oe,"\\prod ","&prod;"),L.coprod=L.coproduct=e(oe,"\\coprod ","&#8720;"),L["∫"]=L["int"]=L.integral=e(oe,"\\int ","&int;"),L.N=L.naturals=L.Naturals=e(te,"\\mathbb{N}","&#8469;"),L.P=L.primes=L.Primes=L.projective=L.Projective=L.probability=L.Probability=e(te,"\\mathbb{P}","&#8473;"),L.Z=L.integers=L.Integers=e(te,"\\mathbb{Z}","&#8484;"),L.Q=L.rationals=L.Rationals=e(te,"\\mathbb{Q}","&#8474;"),L.R=L.reals=L.Reals=e(te,"\\mathbb{R}","&#8477;"),L.C=L.complex=L.Complex=L.complexes=L.Complexes=L.complexplane=L.Complexplane=L.ComplexPlane=e(te,"\\mathbb{C}","&#8450;"),L.H=L.Hamiltonian=L.quaternions=L.Quaternions=e(te,"\\mathbb{H}","&#8461;"),L.quad=L.emsp=e(te,"\\quad ","    "),L.qquad=e(te,"\\qquad ","        "),L.diamond=e(te,"\\diamond ","&#9671;"),L.bigtriangleup=e(te,"\\bigtriangleup ","&#9651;"),L.ominus=e(te,"\\ominus ","&#8854;"),L.uplus=e(te,"\\uplus ","&#8846;"),L.bigtriangledown=e(te,"\\bigtriangledown ","&#9661;"),L.sqcap=e(te,"\\sqcap ","&#8851;"),L.triangleleft=e(te,"\\triangleleft ","&#8882;"),L.sqcup=e(te,"\\sqcup ","&#8852;"),L.triangleright=e(te,"\\triangleright ","&#8883;"),L.odot=e(te,"\\odot ","&#8857;"),L.bigcirc=e(te,"\\bigcirc ","&#9711;"),L.dagger=e(te,"\\dagger ","&#0134;"),L.ddagger=e(te,"\\ddagger ","&#135;"),L.wr=e(te,"\\wr ","&#8768;"),L.amalg=e(te,"\\amalg ","&#8720;"),L.models=e(te,"\\models ","&#8872;"),L.prec=e(te,"\\prec ","&#8826;"),L.succ=e(te,"\\succ ","&#8827;"),L.preceq=e(te,"\\preceq ","&#8828;"),L.succeq=e(te,"\\succeq ","&#8829;"),L.simeq=e(te,"\\simeq ","&#8771;"),L.mid=e(te,"\\mid ","&#8739;"),L.ll=e(te,"\\ll ","&#8810;"),L.gg=e(te,"\\gg ","&#8811;"),L.parallel=e(te,"\\parallel ","&#8741;"),L.bowtie=e(te,"\\bowtie ","&#8904;"),L.sqsubset=e(te,"\\sqsubset ","&#8847;"),L.sqsupset=e(te,"\\sqsupset ","&#8848;"),L.smile=e(te,"\\smile ","&#8995;"),L.sqsubseteq=e(te,"\\sqsubseteq ","&#8849;"),L.sqsupseteq=e(te,"\\sqsupseteq ","&#8850;"),L.doteq=e(te,"\\doteq ","&#8784;"),L.frown=e(te,"\\frown ","&#8994;"),L.vdash=e(te,"\\vdash ","&#8870;"),L.dashv=e(te,"\\dashv ","&#8867;"),L.longleftarrow=e(te,"\\longleftarrow ","&#8592;"),L.longrightarrow=e(te,"\\longrightarrow ","&#8594;"),L.Longleftarrow=e(te,"\\Longleftarrow ","&#8656;"),L.Longrightarrow=e(te,"\\Longrightarrow ","&#8658;"),L.longleftrightarrow=e(te,"\\longleftrightarrow ","&#8596;"),L.updownarrow=e(te,"\\updownarrow ","&#8597;"),L.Longleftrightarrow=e(te,"\\Longleftrightarrow ","&#8660;"),L.Updownarrow=e(te,"\\Updownarrow ","&#8661;"),L.mapsto=e(te,"\\mapsto ","&#8614;"),L.nearrow=e(te,"\\nearrow ","&#8599;"),L.hookleftarrow=e(te,"\\hookleftarrow ","&#8617;"),L.hookrightarrow=e(te,"\\hookrightarrow ","&#8618;"),L.searrow=e(te,"\\searrow ","&#8600;"),L.leftharpoonup=e(te,"\\leftharpoonup ","&#8636;"),L.rightharpoonup=e(te,"\\rightharpoonup ","&#8640;"),L.swarrow=e(te,"\\swarrow ","&#8601;"),L.leftharpoondown=e(te,"\\leftharpoondown ","&#8637;"),L.rightharpoondown=e(te,"\\rightharpoondown ","&#8641;"),L.nwarrow=e(te,"\\nwarrow ","&#8598;"),L.ldots=e(te,"\\ldots ","&#8230;"),L.cdots=e(te,"\\cdots ","&#8943;"),L.vdots=e(te,"\\vdots ","&#8942;"),L.ddots=e(te,"\\ddots ","&#8944;"),L.surd=e(te,"\\surd ","&#8730;"),L.triangle=e(te,"\\triangle ","&#9653;"),L.ell=e(te,"\\ell ","&#8467;"),L.top=e(te,"\\top ","&#8868;"),L.flat=e(te,"\\flat ","&#9837;"),L.natural=e(te,"\\natural ","&#9838;"),L.sharp=e(te,"\\sharp ","&#9839;"),L.wp=e(te,"\\wp ","&#8472;"),L.bot=e(te,"\\bot ","&#8869;"),L.clubsuit=e(te,"\\clubsuit ","&#9827;"),L.diamondsuit=e(te,"\\diamondsuit ","&#9826;"),L.heartsuit=e(te,"\\heartsuit ","&#9825;"),L.spadesuit=e(te,"\\spadesuit ","&#9824;"),L.oint=e(te,"\\oint ","&#8750;"),L.bigcap=e(te,"\\bigcap ","&#8745;"),L.bigcup=e(te,"\\bigcup ","&#8746;"),L.bigsqcup=e(te,"\\bigsqcup ","&#8852;"),L.bigvee=e(te,"\\bigvee ","&#8744;"),L.bigwedge=e(te,"\\bigwedge ","&#8743;"),L.bigodot=e(te,"\\bigodot ","&#8857;"),L.bigotimes=e(te,"\\bigotimes ","&#8855;"),L.bigoplus=e(te,"\\bigoplus ","&#8853;"),L.biguplus=e(te,"\\biguplus ","&#8846;"),L.lfloor=e(te,"\\lfloor ","&#8970;"),L.rfloor=e(te,"\\rfloor ","&#8971;"),L.lceil=e(te,"\\lceil ","&#8968;"),L.rceil=e(te,"\\rceil ","&#8969;"),L.slash=e(te,"\\slash ","&#47;"),L.opencurlybrace=e(te,"\\opencurlybrace ","&#123;"),L.closecurlybrace=e(te,"\\closecurlybrace ","&#125;"),L.caret=e(te,"\\caret ","^"),L.underscore=e(te,"\\underscore ","_"),L.backslash=e(te,"\\backslash ","\\"),L.vert=e(te,"|"),L.perp=L.perpendicular=e(te,"\\perp ","&perp;"),L.nabla=L.del=e(te,"\\nabla ","&nabla;"),L.hbar=e(te,"\\hbar ","&#8463;"),L.AA=L.Angstrom=L.angstrom=e(te,"\\text\\AA ","&#8491;"),L.ring=L.circ=L.circle=e(te,"\\circ ","&#8728;"),L.bull=L.bullet=e(te,"\\bullet ","&bull;"),L.setminus=L.smallsetminus=e(te,"\\setminus ","&#8726;"),L.not=L["¬"]=L.neg=e(te,"\\neg ","&not;"),L["…"]=L.dots=L.ellip=L.hellip=L.ellipsis=L.hellipsis=e(te,"\\dots ","&hellip;"),L.converges=L.darr=L.dnarr=L.dnarrow=L.downarrow=e(te,"\\downarrow ","&darr;"),L.dArr=L.dnArr=L.dnArrow=L.Downarrow=e(te,"\\Downarrow ","&dArr;"),L.diverges=L.uarr=L.uparrow=e(te,"\\uparrow ","&uarr;"),L.uArr=L.Uparrow=e(te,"\\Uparrow ","&uArr;"),L.to=e(ne,"\\to ","&rarr;"),L.rarr=L.rightarrow=e(te,"\\rightarrow ","&rarr;"),L.implies=e(ne,"\\Rightarrow ","&rArr;"),L.rArr=L.Rightarrow=e(te,"\\Rightarrow ","&rArr;"),L.gets=e(ne,"\\gets ","&larr;"),L.larr=L.leftarrow=e(te,"\\leftarrow ","&larr;"),L.impliedby=e(ne,"\\Leftarrow ","&lArr;"),L.lArr=L.Leftarrow=e(te,"\\Leftarrow ","&lArr;"),L.harr=L.lrarr=L.leftrightarrow=e(te,"\\leftrightarrow ","&harr;"),L.iff=e(ne,"\\Leftrightarrow ","&hArr;"),L.hArr=L.lrArr=L.Leftrightarrow=e(te,"\\Leftrightarrow ","&hArr;"),L.Re=L.Real=L.real=e(te,"\\Re ","&real;"),L.Im=L.imag=L.image=L.imagin=L.imaginary=L.Imaginary=e(te,"\\Im ","&image;"),L.part=L.partial=e(te,"\\partial ","&part;"),L.inf=L.infin=L.infty=L.infinity=e(te,"\\infty ","&infin;"),L.alef=L.alefsym=L.aleph=L.alephsym=e(te,"\\aleph ","&alefsym;"),L.xist=L.xists=L.exist=L.exists=e(te,"\\exists ","&exist;"),L.and=L.land=L.wedge=e(te,"\\wedge ","&and;"),L.or=L.lor=L.vee=e(te,"\\vee ","&or;"),L.o=L.O=L.empty=L.emptyset=L.oslash=L.Oslash=L.nothing=L.varnothing=e(ne,"\\varnothing ","&empty;"),L.cup=L.union=e(ne,"\\cup ","&cup;"),L.cap=L.intersect=L.intersection=e(ne,"\\cap ","&cap;"),L.deg=L.degree=e(te,"^\\circ ","&deg;"),L.ang=L.angle=e(te,"\\angle ","&ang;");var se=p(_,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","<span>"+t+"</span>")},t.respace=function(){this.jQ[0].className=this[b]instanceof N||this[b]instanceof X?"":"non-italicized-function"}});L.ln=L.lg=L.log=L.span=L.proj=L.det=L.dim=L.min=L.max=L.mod=L.lcm=L.gcd=L.gcf=L.hcf=L.lim=se,function(){var t=["sin","cos","tan","sec","cosec","csc","cotan","cot"];for(var e in t)L[t[e]]=L[t[e]+"h"]=L["a"+t[e]]=L["arc"+t[e]]=L["a"+t[e]+"h"]=L["arc"+t[e]+"h"]=se}();var ae=function(){function t(t){var e=T();return t.adopt(e,0,0),e}function e(t){for(var e=t[0]||T(),i=1;i<t.length;i+=1)t[i].children().adopt(e,e.ends[b],0);return e}var i=m.string,n=m.regex,r=m.letter,o=m.any,s=m.optWhitespace,a=m.succeed,c=m.fail,l=r.map(Z),h=n(/^[^${}\\_^]/).map(te),u=n(/^[^\\a-eg-zA-Z]/).or(i("\\").then(n(/^[a-z]+/i).or(n(/^\s+/).result(" ")).or(o))).then(function(t){var e=L[t];return e?e(t).parser():c("unknown command: \\"+t)}),d=u.or(l).or(h),f=i("{").then(function(){return g}).skip(i("}")),p=s.then(f.or(d.map(t))),g=p.many().map(e).skip(s),v=i("[").then(p.then(function(t){return"]"!==t.join("latex")?a(t):c()}).many().map(e).skip(s)).skip(i("]")),y=g;return y.block=p,y.optBlock=v,y}(),ce=p(x,function(t){function e(t,e){if(t.clearSelection().show(),t[b][e])t.insAtLeftEnd(t[b][e]);else if(t[v][e])t.insAtRightEnd(t[v][e]);else{var n=t.parent;do{var r=n[e];if(r&&("function"==typeof r&&(r=n[e](t)),r===!1||r instanceof T)){if(t.upDownCache[n.id]=x(t.parent,t[v],t[b]),r instanceof T){var o=t.upDownCache[r.id];if(o)o[b]?t.insLeftOf(o[b]):t.insAtRightEnd(o.parent);else{var s=i(t).left;t.insAtRightEnd(r),t.seekHoriz(s,r)}}break}n=n.parent.parent}while(n)}return t}function i(t){var e=t.jQ.removeClass("cursor").offset();return t.jQ.addClass("cursor"),e}function r(t){t.upDownCache={}}t.init=function(t){this.parent=this.root=t;var e=this.jQ=this._jQ=y('<span class="cursor">&zwj;</span>');this.blink=function(){e.toggleClass("blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("blink"),"intervalId"in this?clearInterval(this.intervalId):(this[b]?this.jQ.insertBefore(this.selection&&this.selection.ends[v][v]===this[v]?this.selection.jQ:this[b].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=y(),this},t.withDirInsertAt=function(t,e,i,n){var r=this.parent;this.parent=e,this[t]=i,this[-t]=n,r.blur()},t.insDirOf=function(t,e){return n(t),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("hasCursor"),this.jQ.insDirOf(t,e.jQ),this},t.insLeftOf=function(t){return this.insDirOf(v,t)},t.insRightOf=function(t){return this.insDirOf(b,t)},t.insAtDirEnd=function(t,e){return n(t),this.withDirInsertAt(t,e,0,e.ends[t]),t===v&&e.textarea?this.jQ.insDirOf(-t,e.textarea):this.jQ.insAtDirEnd(t,e.jQ),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(v,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(b,t)},t.hopDir=function(t){return n(t),this.jQ.insDirOf(t,this[t].jQ),this[-t]=this[t],this[t]=this[t][t],this},t.hopLeft=function(){return this.hopDir(v)},t.hopRight=function(){return this.hopDir(b)},t.moveDirWithin=function(t,e){if(n(t),this[t])this[t].ends[-t]?this.insAtDirEnd(-t,this[t].ends[-t]):this.hopDir(t);else{if(this.parent===e)return;
this.parent[t]?this.insAtDirEnd(-t,this.parent[t]):this.insDirOf(t,this.parent.parent)}},t.moveLeftWithin=function(t){return this.moveDirWithin(v,t)},t.moveRightWithin=function(t){return this.moveDirWithin(b,t)},t.moveDir=function(t){return n(t),r(this),this.selection?this.insDirOf(t,this.selection.ends[t]).clearSelection():this.moveDirWithin(t,this.root),this.show()},t.moveLeft=function(){return this.moveDir(v)},t.moveRight=function(){return this.moveDir(b)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},t.seek=function(t,e){r(this);var i,n,o=this.clearSelection().show();return t.hasClass("empty")?(o.insAtLeftEnd(A[t.attr(u)]),o):(i=A[t.attr(h)],i instanceof _?(t.outerWidth()>2*(e-t.offset().left)?o.insLeftOf(i):o.insRightOf(i),o):(i||(n=A[t.attr(u)],n||(t=t.parent(),i=A[t.attr(h)],i||(n=A[t.attr(u)],n||(n=o.root)))),i?o.insRightOf(i):o.insAtRightEnd(n),o.seekHoriz(e,o.root)))},t.seekHoriz=function(t,e){var n,r=this,o=i(r).left-t;do r.moveLeftWithin(e),n=o,o=i(r).left-t;while(o>0&&(r[v]||r.parent!==e));return-o>n&&r.moveRightWithin(e),r},t.writeLatex=function(t){var e=this;r(e),e.show().deleteSelection();var i=m.all,n=m.eof,o=ae.skip(n).or(i.result(!1)).parse(t);return o&&(o.children().adopt(e.parent,e[v],e[b]),A.jQize(o.join("html")).insertBefore(e.jQ),e[v]=o.ends[b],o.finalizeInsert(),e.parent.bubble("redraw")),this.hide()},t.write=function(t){var e=this.prepareWrite();return this.insertCh(t,e)},t.insertCh=function(t,e){return this.parent.write(this,t,e),this},t.insertCmd=function(t,e){var i=L[t];return i?(i=i(t),e&&i.replaces(e),i.createLeftOf(this)):(i=Q(),i.replaces(t),i.ends[v].focus=function(){return delete this.focus,this},i.createLeftOf(this),this.insRightOf(i),e&&e.remove()),this},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,i=t[b],n=t[v];if(t.disown().eachChild(function(r){r.isEmpty()||(r.children().adopt(e,n,i).each(function(e){e.jQ.insertBefore(t.jQ.first())}),n=r.ends[b])}),!this[b])if(this[v])this[b]=this[v][b];else for(;!this[b];){if(this.parent=this.parent[b],!this.parent){this[b]=t[b],this.parent=e;break}this[b]=this.parent.ends[v]}this[b]?this.insLeftOf(this[b]):this.insAtRightEnd(e),t.jQ.remove(),t[v]&&t[v].respace(),t[b]&&t[b].respace()},t.deleteDir=function(t){if(n(t),r(this),this.show(),this.deleteSelection());else if(this[t])this[t].isEmpty()?this[t]=this[t].remove()[t]:this.selectDir(t);else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insDirOf(-t,this.parent.parent).deleteDir(t);this.unwrapGramp()}return this[v]&&this[v].respace(),this[b]&&this[b].respace(),this.parent.bubble("redraw"),this},t.backspace=function(){return this.deleteDir(v)},t.deleteForward=function(){return this.deleteDir(b)},t.selectFrom=function(t){var e=this,i=t;t:for(;;){for(var n=this;n!==e.parent.parent;n=n.parent.parent)if(n.parent===i.parent){o=n,s=i;break t}for(var r=t;r!==i.parent.parent;r=r.parent.parent)if(e.parent===r.parent){o=e,s=r;break t}e.parent.parent&&(e=e.parent.parent),i.parent.parent&&(i=i.parent.parent)}var o,s,a;if(o[b]!==s){for(var c=o;c;c=c[b])if(c===s[v]){a=!0;break}a||(a=s,s=o,o=a)}this.hide().selection=le(o[v][b]||o.parent.ends[v],s[b][v]||s.parent.ends[b]),this.insRightOf(s[b][v]||s.parent.ends[b]),this.root.selectionChanged()},t.selectDir=function(t){if(n(t),r(this),this.selection)if(this.selection.ends[t]===this[-t])this[t]?this.hopDir(t).selection.extendDir(t):this.parent!==this.root&&this.insDirOf(t,this.parent.parent).selection.levelUp();else{if(this.hopDir(t),this.selection.ends[t]===this.selection.ends[-t])return void this.clearSelection().show();this.selection.retractDir(t)}else{if(this[t])this.hopDir(t);else{if(this.parent===this.root)return;this.insDirOf(t,this.parent.parent)}this.hide().selection=le(this[-t])}this.root.selectionChanged()},t.selectLeft=function(){return this.selectDir(v)},t.selectRight=function(){return this.selectDir(b)},t.prepareMove=function(){return r(this),this.show().clearSelection()},t.prepareEdit=function(){return r(this),this.show().deleteSelection()},t.prepareWrite=function(){return r(this),this.show().replaceSelection()},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.root.selectionChanged()),this},t.deleteSelection=function(){return this.selection?(this[v]=this.selection.ends[v][v],this[b]=this.selection.ends[b][b],this.selection.remove(),this.root.selectionChanged(),delete this.selection):!1},t.replaceSelection=function(){var t=this.selection;return t&&(this[v]=t.ends[v][v],this[b]=t.ends[b][b],delete this.selection),t}}),le=p(O,function(t,e){t.init=function(){var t=this;e.init.apply(t,arguments),t.jQwrap(t.jQ)},t.jQwrap=function(t){this.jQ=t.wrapAll('<span class="selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ.children()),this},t.levelUp=function(){var t=this,e=t.ends[v]=t.ends[b]=t.ends[b].parent.parent;return t.clear().jQwrap(e.jQ),t},t.extendDir=function(t){return n(t),this.ends[t]=this.ends[t][t],this.ends[t].jQ.insAtDirEnd(t,this.jQ),this},t.extendLeft=function(){return this.extendDir(v)},t.extendRight=function(){return this.extendDir(b)},t.retractDir=function(t){n(t),this.ends[-t].jQ.insDirOf(-t,this.jQ),this.ends[-t]=this.ends[-t][t]},t.retractRight=function(){return this.retractDir(b)},t.retractLeft=function(){return this.retractDir(v)}});l.fn.mathquill=function(t,e){switch(t){case"redraw":return this.each(function(){var t=y(this).attr(u),e=t&&A[t];e&&!function i(t){t.eachChild(i),t.redraw&&t.redraw()}(e)});case"revert":return this.each(function(){var t=y(this).attr(u),e=t&&A[t];e&&e.revert&&e.revert()});case"latex":if(arguments.length>1)return this.each(function(){var t=y(this).attr(u),i=t&&A[t];i&&i.renderLatex(e)});var i=y(this).attr(u),n=i&&A[i];return n&&n.latex();case"text":var i=y(this).attr(u),n=i&&A[i];return n&&n.text();case"html":return this.html().replace(/ ?hasCursor|hasCursor /,"").replace(/ class=(""|(?= |>))/g,"").replace(/<span class="?cursor( blink)?"?><\/span>/i,"").replace(/<span class="?textarea"?><textarea><\/textarea><\/span>/i,"");case"write":if(arguments.length>1)return this.each(function(){var t=y(this).attr(u),i=t&&A[t],n=i&&i.cursor;n&&n.writeLatex(e).parent.blur()});case"cmd":if(arguments.length>1)return this.each(function(){var t=y(this).attr(u),i=t&&A[t],n=i&&i.cursor;if(n){var r=n.prepareWrite();/^\\[a-z]+$/i.test(e)?n.insertCmd(e.slice(1),r):n.insertCh(e,r),n.hide().parent.blur()}});default:var o="textbox"===t,s=o||"editable"===t,a=o?D:j;return this.each(function(){r(y(this),a(),o,s)})}},l(function(){l(".mathquill-editable:not(.mathquill-rendered-math)").mathquill("editable"),l(".mathquill-textbox:not(.mathquill-rendered-math)").mathquill("textbox"),l(".mathquill-embedded-latex").mathquill()})}(),define("mathquill",["jquery"],function(){}),define("app",["jquery","storm","licode.client","jquery.mousewheel","jquery.mCustomScrollbar","jquery.form","jquery.slimscroll","jquery.cookie","pdfjs","socket.io","fabric","bootstrap","storm.setup","mathquill"],function(t,e,i){t(document).ready(function(){PDFJS.workerSrc=baseUrl+"javascripts/thirdparty/pdfjs/pdf.worker.js",t("#containerDiv").show(),t("#loading").css("top",t(window).height()/2),t("#loading").show(),t("#form_upload").ajaxForm(function(){}),t(".listChat").slimScroll({width:t(".rightdiv").width(),alwaysVisible:!0}),window.onbeforeunload=function(){return e.reloadConfirm?"vi"==window.navigator.language?"Bạn đang trong lớp học đang diễn ra!":"You are in a happening session":void 0},window.onunload=function(){e.comm.socket.emit("bye"),i.stop()},L.Logger.setLogLevel(L.Logger.INFO)})}),requirejs.config({paths:{app:"../app/app",erizo:"../thirdparty/erizo",jquery:"../thirdparty/jquery/jquery-1.11.min","jquery.mousewheel":"../thirdparty/jquery/jquery.mousewheel.min","jquery.mCustomScrollbar":"../thirdparty/mscrollbar/jquery.mCustomScrollbar","jquery.form":"../thirdparty/jquery/jquery.form","jquery.slimscroll":"../thirdparty/jquery/jquery.slimscroll.min","jquery.cookie":"../thirdparty/jquery/jquery.cookie",bootstrap:"../thirdparty/bootstrap/bootstrap.min",fabric:"../thirdparty/fabric/fabric","socket.io":"../thirdparty/socket.io",pdfjs:"../thirdparty/pdfjs/pdf",underscore:"../thirdparty/underscore-min",mathquill:"../thirdparty/mathquill/mathquill"},shim:{jquery:{exports:"jQuery"},"jquery.mousewheel":{deps:["jquery"]},"jquery.mCustomScrollbar":{deps:["jquery"]},"jquery.form":{deps:["jquery"]},"jquery.slimscroll":{deps:["jquery"]},"jquery.cookie":{deps:["jquery"]},brain:{deps:["jquery"]},bootstrap:{deps:["jquery"]},mathquill:{deps:["jquery"]}}}),requirejs(["app"]),define("../main",function(){});